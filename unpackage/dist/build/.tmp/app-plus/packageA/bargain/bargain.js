(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/bargain/bargain"],{1548:function(t,a,i){"use strict";i.r(a);var e=i("6bd1"),n=i("ecbd");for(var r in n)"default"!==r&&function(t){i.d(a,t,function(){return n[t]})}(r);i("c9e5");var s=i("2877"),o=Object(s["a"])(n["default"],e["a"],e["b"],!1,null,null,null);a["default"]=o.exports},"6a61":function(t,a,i){},"6bd1":function(t,a,i){"use strict";var e=function(){var t=this,a=t.$createElement;t._self._c},n=[];i.d(a,"a",function(){return e}),i.d(a,"b",function(){return n})},c9e5:function(t,a,i){"use strict";var e=i("6a61"),n=i.n(e);n.a},ecbd:function(t,a,i){"use strict";i.r(a);var e=i("f33c"),n=i.n(e);for(var r in e)"default"!==r&&function(t){i.d(a,t,function(){return e[t]})}(r);a["default"]=n.a},f33c:function(t,a,i){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e=getApp().globalData,n=i("28c1"),r=(i("b6a1"),{data:function(){return{iconURL:e.dataBase.iconURL,showSettingModalStatus:!1,showRank:3,showMoreRank:!0,d:"00",h:"00",m:"00",s:"00",ad:"00",ah:"00",am:"00",as:"00",ahs:0,isShowGoHome:!1,showRules:!0,persentBox:50,buttonDisplay:!1,activity_bargain_id:0,bargaining_id:0,buttonDisplayText:"商品已抢光,正在补货中~",itemData:{},bargainBySelfInfo:{},swiperImgBl:!1,iphoneXBottom:"0rpx",rule:{},navbarOpacity:0,showBack:!1,navBarHeight:e.navBarHeight,entryData:"",is_login:!0}},components:{},props:{},onLoad:function(t){var a=this;a.activity_bargain_id=t.activity_bargain_id;var i=getCurrentPages();i.length>1&&a.setData({showBack:!0}),t&&t.entryType&&"external"==t.entryType?this.setData({isShowGoHome:!1}):this.setData({isShowGoHome:!0}),a.setData({entryData:t});t=a.entryData;var r=n.getStorageSync("getpickup");t&&(t.atitude||t.pickup_id)&&!r&&a.getExternal(t.pickup_id).then(function(){e.firstlaunchApp=!1,a.entryData={},n.setStorageSync("authSetting",{"scope.userLocation":!0})}),wx.getSystemInfo({success:function(t){var i=t.model;-1!=i.search("iPhone X")&&a.setData({iphoneXBottom:"68rpx"})}})},onShow:function(){var t=this;t.getBaseInfo()},onShareAppMessage:function(t){var a=this,i=n.getStorageSync("getpickup");return{title:a.itemData.bargain_share_title,path:"/packageA/bargain/bargain?activity_bargain_id="+a.itemData.activity_bargain_id+"&pickup_id="+i.pickup_id,imageUrl:a.itemData.bargain_share_img}},methods:{getExternal:function(t){var a=e.getPath.getpickup,i={pickup_id:t};return new Promise(function(t,e){n.ApiGateWayTest(a,i,!0,function(a){if(a&&a.data&&1==a.data.success){a=a.data.result.cities.pick_up;n.setStorage({key:"getpickup",data:{pickup_id:a.pickup_id,cityName:a.pickup_name,pickup_address:a.pickup_address,pickup_contact:a.pickup_contact,pickup_phone:a.pickup_phone,pickup_type:a.pickup_type}},function(a){t("获取id成功")}),n.setStorage({key:"city",data:{pickup_id:a.pickup_id,warehouse_id:a.warehouse_id,cityName:a.city_name,is_pick_up:1}})}})})},showMoreRank2:function(){this.setData({showRank:5,showMoreRank:!1})},countDown:function(t){var a=this,i=(new Date).getTime()/1e3,e=t-i;clearInterval(a.timeStart),a.timeStart=setInterval(function(){if(e>0){e--;var t=parseInt(e/60/60/24),i=parseInt(e/60/60%24)+24*t,n=parseInt(e/60%60),r=parseInt(e%60);i<10&&(i="0"+i),n<10&&(n="0"+n),r<10&&(r="0"+r),a.setData({h:i,m:n,s:r})}else clearInterval(a.timeStart),a.getBaseInfo()},1e3)},countDownB:function(t){var a=this,i=(new Date).getTime()/1e3,e=t-i;clearInterval(a.timeStartB),a.timeStartB=setInterval(function(){if(e>0){e--;var t=parseInt(e/60/60/24),i=parseInt(e/60/60%24),n=parseInt(e/60%60),r=parseInt(e%60);i<10&&(i="0"+i),n<10&&(n="0"+n),r<10&&(r="0"+r),a.setData({ad:t<10?"0"+t:t,ah:i,am:n,as:r})}else clearInterval(a.timeStartB),a.getBaseInfo()},1e3)},hsCountTime:function(){var t=this,a=9;setInterval(function(){a--,a<0&&(a=9),t.setData({ahs:a})},100)},showRule:function(t){var a=this;n.formIdUpdate(t),this.setData({showRules:!a.showRules})},getBaseInfo:function(){var a=this,i=e.getPath.getBargainGoodsInfo,r={activity_bargain_id:a.activity_bargain_id};n.ApiGateWayTest(i,r,!0,function(i){var r=i.data;if(1==r.success){if(a.activity_bargain_id=r.result.activity_bargain_id,a.bargaining_id=r.result.activity_bargaining_id,r.result.floor_price=parseFloat(r.result.floor_price),r.result.shop_price=parseFloat(r.result.shop_price),a.setData({itemData:r.result}),t.setNavigationBarTitle({title:r.result.goods_name}),0==r.result.time_status&&!r.result.is_notice){var s=n.getStorageSync("isOldUser");e.checkSessionKey&&2!=s||a.setData({is_login:!1})}a.verificationShop(),a.getTeamRule();var o=(new Date).getTime()/1e3;r.result.end_time>o&&a.countDown(r.result.end_time),2!=r.result.time_status&&(1==r.result.time_status?a.countDownB(r.result.activity_end_time):a.countDownB(r.result.activity_start_time)),n.hideLoad(a)}else n.toast(i.data.msg)})},verificationShop:function(){var t=this;1==t.itemData.is_on_sale?1==t.itemData.is_enough?2!=t.itemData.time_status||0!=t.itemData.bargain_activity_status||t.setData({buttonDisplayText:"活动已结束",buttonDisplay:!0}):t.setData({buttonDisplayText:"商品已抢光，正在补货中~",buttonDisplay:!0}):t.setData({buttonDisplayText:"商品已下架",buttonDisplay:!0})},setPreviewImage:function(t){var a=this,i=t.currentTarget.dataset.current,e=a.itemData.gallery.map(function(t){return t.src});wx.previewImage({current:i,urls:e})},swiperImageLoad:function(){var t=this;t.setData({swiperImgBl:!0})},getBargainBySelf:function(t){var a=this,i=n.getStorageSync("isOldUser");if(!e.checkSessionKey||2==i)return n.goRegister(),!1;n.formIdUpdate(t),n.showLoad(this);var r=a.itemData,s=e.getPath.preCheckOrder,o=[{goods_id:r.goods_id,sku_key:r.stock[0].key,num:1}];o=JSON.stringify(o);var c={order_product:o,activity_bargaining_id:r.activity_bargaining_id?r.activity_bargaining_id:0,time_atitude:e.dataBase.userAtitude},u=e.getPath.bargainBySelf,g={activity_bargain_id:a.activity_bargain_id};n.ApiGateWayTest(s,c,!0,function(t){1==t.data.success?(n.ApiGateWayTest(u,g,!0,function(t){var i=t.data;1==i.success?(a.bargaining_id=i.result.activity_bargaining_id,wx.navigateTo({url:"../bargainshare/bargainshare?bargaining_id="+i.result.activity_bargaining_id+"&self_info="+JSON.stringify(i.result)})):n.toast(t.data.msg)}),setTimeout(function(){n.hideLoad(a)},2e3)):n.toast(t.data.msg)})},goShop:function(t){var a=this,i=t.currentTarget.dataset.shopType,r=n.getStorageSync("isOldUser");if(!e.checkSessionKey||2==r)return n.goRegister(),!1;function s(){var t=a.itemData,i=e.getPath.preCheckOrder,r=[{goods_id:t.goods_id,sku_key:t.stock[0].key,num:1}];r=JSON.stringify(r);var s={order_product:r,activity_bargaining_id:t.activity_bargaining_id?t.activity_bargaining_id:0,time_atitude:e.dataBase.userAtitude};n.ApiGateWayTest(i,s,!0,function(a){if(1==a.data.success){var i=[{goods_id:t.goods_id,sku_key:t.stock[0].key,amount:1,team_order:0,activity_bargaining_id:t.activity_bargaining_id,activity_bargain_id:t.activity_bargain_id,channel:1}];n.setStorage({key:"nowPay",data:i}),wx.navigateTo({url:"/pages/confirm/confirm"})}else n.toast(a.data.msg)})}n.formIdUpdate(t),0==i?n.showModal("砍价成功后，您可以用更低的价格进行购买，您还确定要购买吗？","继续购买",function(t){t.confirm&&s()}):1==i&&s()},getTeamRule:function(){var t=this,a=e.getPath.bargainRule,i={activity_bargain_id:t.activity_bargain_id};n.ApiGateWayTest(a,i,!0,function(a){t.setData({rule:a.data.result.rule})})},shareFromId:function(t){var a=this;n.formIdUpdate(t),n.showLoad(this),setTimeout(function(){n.hideLoad(a)},2e3)},gotoHome:function(){wx.switchTab({url:"/pages/index/index"})},goMyBrangin:function(){wx.navigateTo({url:"../mybargain/mybargain"})},goBranging:function(t){var a=this;n.formIdUpdate(t),wx.navigateTo({url:"../bargainshare/bargainshare?bargaining_id="+a.bargaining_id})},onPageScroll:function(t){var a=this;a.navbarOpacity<1&&t.scrollTop>100?a.setData({navbarOpacity:t.scrollTop/500}):a.navbarOpacity>0&&t.scrollTop<200&&a.setData({navbarOpacity:t.scrollTop/500})},back:function(){wx.navigateBack({delta:1})},backHome:function(){wx.switchTab({url:"/pages/index/index"})},shareRedEnvelopes:function(t){var a=this,i=n.getStorageSync("isOldUser");if(!e.checkSessionKey||2==i)return n.goRegister(),!1;n.formIdUpdate(t);var r=e.getPath.bargainNotice,s={activity_bargain_id:a.activity_bargain_id};n.ApiGateWayTest(r,s,!0,function(t){var i=t.data;1==i.success?1==i.result.status&&(a.data.popupShow=!0):n.toast(i.msg)})},setData:function(t){var a=this,i=[];Object.keys(t).forEach(function(e){i=e.split("."),t[e],a.$data,i.forEach(function(i,n){a[e]=t[e]})})}}});a.default=r}).call(this,i("6e42")["default"])}},[["7a13","common/runtime","common/vendor"]]]);