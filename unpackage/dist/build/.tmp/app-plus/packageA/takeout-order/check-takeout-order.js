(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/takeout-order/check-takeout-order"],{5132:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){t.stopPropagation(),e.showChooseTag},e.e1=function(t){e.selectedGoods.is_in_shipping_time})},o=[];s.d(t,"a",function(){return i}),s.d(t,"b",function(){return o})},"7b9a":function(e,t,s){"use strict";s.r(t);var i=s("5132"),o=s("8ec0");for(var a in o)"default"!==a&&function(e){s.d(t,e,function(){return o[e]})}(a);s("bbf0");var n=s("2877"),d=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,null,null);t["default"]=d.exports},"8ec0":function(e,t,s){"use strict";s.r(t);var i=s("aee1"),o=s.n(i);for(var a in i)"default"!==a&&function(e){s.d(t,e,function(){return i[e]})}(a);t["default"]=o.a},aee1:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=getApp().globalData,o=s("28c1"),a={data:function(){return{iconURL:i.dataBase.iconURL,showDialog:!1,order_confirm_show:!1,selectedGoods:{},consignee:{consignee:""},isTopaydis:!1,productInfo:{},order_info:{},orderSn:"",invoiceData:{},cashgift:{},address_extra:"",canPurchase:!1,showBonusModal:!1,tip_show:{tip1:!0,tip2:!0},storageAddr:!1,isEditAddr:!1,message:"",iphoneXBottom:"0rpx",shop_id:0,address_tag:[],tag_num:-1,label_id:0,label_name:"",has_shop:"",showOrderWindow:!1,orderTimeId:0,orderTimeText:{},title_text:[],timeOrderCheck:!0,checkShowOrder:!1,showChooseTag:!1,checkChoose:!1,coupon_id:"",cashgifts:"",animationData:"",user_note:""}},components:{},props:{},onLoad:function(e){var t=this;t.shop_id=e.shop_id,wx.getSystemInfo({success:function(e){var s=e.model;-1!=s.search("iPhone X")&&t.setData({iphoneXBottom:"68rpx"})}}),this.checkUser()},onShow:function(){var e=this;this.tag_num=-1,this.label_id=0,Promise.all([e.getaddresslist(),e.getOrderCouponList()]).then(function(t){e.getcheckOrderinfo()})},methods:{checkUser:function(){var e=i.getPath.checkUser;o.ApiGateWayTest(e,"",!0,function(e){1!=e.data.success&&wx.showModal({title:"用户禁用下单提示",content:e.data.msg,confirmText:"确定",confirmColor:"#eb3c39",showCancel:!1,cancelColor:"#030303",success:function(e){e.confirm&&wx.navigateBack({delta:1})}})})},isShow:function(e){var t=e.currentTarget.dataset.name,s=this.tip_show;s[t]=!1,this.setData({tip_show:s})},getaddresslist:function(){var e=this,t=i.getPath.getaddresslist,s={is_default:"1"};return new Promise(function(i,a){o.ApiGateWayTest(t,s,!0,function(t){if(200==t.statusCode){t=t.data.result.consignees;if(e.consignee&&e.consignee.address_id)e.setData({consignee:e.consignee,storageAddr:!1}),e.getAddressTag();else{if(!(t.length>0))return o.getStorage({key:"getpickup"},function(t){t.data.pickup_id&&t.data.pickup_id>0&&(e.setData({consignee:t.data,storageAddr:!0}),e.getAddressTag())}),void i("无地址");e.setData({consignee:t[0],storageAddr:!1}),e.getAddressTag()}i("getAddress success")}})})},addAddress:function(e){var t=this,s=/^[0-9]{11}$/;if(void 0!=t.consignee.consignee&&""!=t.consignee.consignee)if(s.test(this.consignee.mobile))if(""!=this.consignee.address_extra||1!=t.has_shop)if(t.address_tag.length>0&&1==t.has_shop&&0==t.label_id)o.toast("请选择闪送地址");else{var a=i.getPath.addaddress,n={consignee:t.consignee.consignee,mobile:t.consignee.mobile,pickup_id:t.consignee.pickup_id,address_extra:t.consignee.address_extra,is_default:1,pick_up_label_id:t.label_id};o.ApiGateWayTest(a,n,!0,function(s){if(s&&1==s.data.success){s=s.data.result;t.setData({consignee:s.consignees}),e&&"function"===typeof e&&e()}})}else o.toast("请输入闪送地址");else o.toast("请输入正确的手机号");else o.toast("请输入提货人姓名")},editAddress:function(e){var t=this,s=/^[0-9]{11}$/;if(void 0!=t.consignee.consignee&&""!=t.consignee.consignee)if(s.test(this.consignee.mobile))if(""!=this.consignee.address_extra||1!=t.has_shop)if(t.address_tag.length>0&&1==t.has_shop&&0==t.label_id)o.toast("请选择闪送地址");else{t.isEditAddr=!1;var a=i.getPath.alteraddress,n={consignee:t.consignee.consignee,mobile:t.consignee.mobile,address_id:t.consignee.address_id,pickup_id:t.consignee.pickup_id,address_extra:t.consignee.address_extra,is_default:t.consignee.is_default,pick_up_label_id:t.label_id};o.ApiGateWayTest(a,n,!0,function(s){if(s&&1==s.data.success){s=s.data.result;t.getAddressTag(),e&&"function"===typeof e&&e()}})}else o.toast("请输入闪送地址");else o.toast("请输入正确的手机号");else o.toast("请输入提货人姓名")},editInput:function(e){var t=e.target.dataset.keyname,s=e.detail.value,i=this.consignee;i[t]=s,this.isEditAddr=!0,this.setData({consignee:i})},getcheckOrderinfo:function(){var e=this,t=(o.getStorageSync("city"),i.getPath.shopCheckOrderInfo);void 0==e.coupon_id&&(e.coupon_id=0),void 0==e.selectedGoods.use_balance&&(e.selectedGoods.use_balance=0),void 0==e.consignee.address_id&&(e.consignee.address_id=0);var s={coupon_id:e.coupon_id,address_id:e.consignee.address_id,use_balance:e.selectedGoods.use_balance,shop_id:e.shop_id};return new Promise(function(i,a){o.ApiGateWayTest(t,s,!0,function(t){if(200==t.statusCode){t=t.data.result;if(e.setData({selectedGoods:t,cashgift:t.coupon_info,coupon_id:t.coupon_info.id,order_info:t.order_info}),0===t.is_in_shipping_time&&!e.checkShowOrder){var s=o.getStorageSync("tackoutOrderTime"),a=t.shipping_time.filter(function(e){return e.shopping_time_text==s.shopping_time_text});a.length>0?e.setData({showOrderWindow:!0,orderTimeId:a[0].shop_shipping_time_id,orderTimeText:a[0],title_text:t.is_in_shipping_time_text.split("，")}):(o.setStorageSync("tackoutOrderTime",t.shipping_time[0]),e.setData({showOrderWindow:!0,orderTimeId:t.shipping_time[0].shop_shipping_time_id,orderTimeText:t.shipping_time[0],title_text:t.is_in_shipping_time_text.split("，")})),e.checkShowOrder=!0}}var n=!0;e.order_info;n?e.setData({canPurchase:!0}):(e.setData({canPurchase:!1}),wx.showModal({content:"商品被抢光咯，小提正在补货中喔~",showCancel:!1,confirmText:"取消",confirmColor:"#575757"})),i("getcheckOrderinfo success")})})},touchAddress:function(){wx.navigateTo({url:"/pages/address/addressList/addressList?from=flashConfirm"})},newAddress:function(){wx.navigateTo({url:"/pages/address/address"})},touchCashgift:function(e){var t=this,s=e.currentTarget.dataset.id;if(t.coupon_id==s)return t.setModalBonus(),!1;t.coupon_id=s,t.getcheckOrderinfo(),t.setModalBonus()},getOrderCouponList:function(){var e=this,t=i.getPath.shopOrderCouponList,s={shop_id:e.shop_id};return new Promise(function(i,a){o.ApiGateWayTest(t,s,!0,function(t){if(1!=t.data.errorCode){t=t.data.result;e.setData({cashgifts:t.lists}),i("getOrderCouponList")}else o.toast(t.data.msg)})})},getExternal:function(e){var t=i.getPath.getpickup,s={pickup_id:e};return new Promise(function(e,i){o.ApiGateWayTest(t,s,!0,function(t){if(t&&t.data&&1==t.data.success){t=t.data.result.cities.pick_up;o.setStorage({key:"city",data:{pickup_id:t.pickup_id,warehouse_id:t.warehouse_id,cityName:t.city_name,is_pick_up:1}}),o.setStorage({key:"getpickup",data:{pickup_id:t.pickup_id,cityName:t.pickup_name,pickup_address:t.pickup_address,pickup_contact:t.pickup_contact,pickup_phone:t.pickup_phone,pickup_type:t.pickup_type}},function(t){e("获取id成功")})}})})},setModalBonus:function(){0==this.showBonusModal?this.showBonusModal=1:this.showBonusModal=0;var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),1==this.showBonusModal&&this.setData({showBonusModal:!0}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==this.showBonusModal&&this.setData({showBonusModal:!1})}.bind(this),200)},refreshOrderPrice:function(){},refreshComment:function(e){var t=e.detail.value;this.setData({user_note:t})},showConfirm:function(e){var t=this;o.getStorage({key:"getpickup"},function(s){if(s.data.pickup_id&&s.data.pickup_id>0){var i=/^[0-9]{11}$/;if(void 0==t.consignee.consignee||""==t.consignee.consignee)return void o.toast("请输入提货人姓名");if(!i.test(t.consignee.mobile))return void o.toast("请输入正确的手机号");if(""==t.consignee.address_extra&&1==t.has_shop)return void o.toast("请输入闪送地址");if(t.address_tag.length>0&&1==t.has_shop&&0==t.label_id)return void o.toast("请选择闪送地址");t.beforeSubmit()}else t.touchSubmit(e)})},hideConfirm:function(e){o.formIdUpdate(e),this.setData({order_confirm_show:!1})},unLoad:function(){},beforeSubmit:function(e){var t=this;this.storageAddr?(t.setData({order_confirm_show:!0}),t.addAddress(function(){t.getaddresslist()})):1==this.isEditAddr?t.editAddress(function(){t.setData({order_confirm_show:!0})}):t.setData({order_confirm_show:!0})},getMessage:function(e){this.message=e.detail.value,this.setData({message:e.detail.value})},touchSubmit:function(e){var t=this,s=(t.productInfo,i.getPath.shopConfirmOrder);if(t.consignee&&!t.consignee.address_id){var a="您还未设置收货地址",n="去设置";o.showModal(a,n,function(e){e.confirm&&t.newAddress()})}else{o.showLoad(t),0==t.selectedGoods.coupons_can_use&&(t.coupon_id=-1);var d=0;0===t.selectedGoods.is_in_shipping_time&&(d=t.orderTimeText.shop_shipping_time_id);var r={coupon_id:t.coupon_id,address_id:t.consignee.address_id,shop_id:t.shop_id,payment_code:t.selectedGoods.payment_code[0],user_note:t.message,use_balance:t.selectedGoods.use_balance,time_atitude:i.dataBase.userAtitude,shop_shipping_time_id:d};o.formIdUpdate(e),o.ApiGateWayTest(s,r,!0,function(e){e=e.data;if(!(r.shop_id&&r.shop_id.length>0&&1==e.success))return o.hideLoad(t),void o.toast(e.msg);var s=i.getPath.doPay,a={order_type:2,order_id:e.result.order_id,payment_code:t.selectedGoods.payment_code[0]};o.hideLoad(t),1==e.result.status?wx.redirectTo({url:"./order-detail?order_id="+a.order_id+"&entryType=external"}):o.ApiGateWayTest(s,a,!0,function(e){if(1!=e.data.success)return o.hideLoad(t),void o.toast(e.data.msg);var s=e.data.result;o.doWechatPay(s,function(e){o.hideLoad(t),t.checkPay(a.order_id).then(function(e){wx.showToast({title:"支付成功",duration:2e3}),wx.redirectTo({url:"./order-detail?order_id="+a.order_id+"&entryType=external"})})},function(e){o.hideLoad(t),t.checkPay(a.order_id).then(function(e){wx.showToast({title:"支付失败",icon:"cancel",duration:2e3}),wx.redirectTo({url:"./order-detail?order_id="+a.order_id+"&entryType=external"})})},function(e){o.hideLoad(t)})})})}},checkPay:function(e){var t=i.getPath.checkPay,s={order_id:e,order_type:2};return new Promise(function(e,i){o.ApiGateWayTest(t,s,!0,function(t){1==t.data.success?e(!0):e(!1)})})},getAddressTag:function(){var e=this,t=i.getPath.pickupLabel,s={pickup_id:this.consignee.pickup_id,address_id:this.consignee.address_id};o.ApiGateWayTest(t,s,!0,function(t){t=t.data;1==t.success&&(t.result.list.forEach(function(t,s){1==t.is_selected&&(e.tag_num=s,e.label_id=t.pick_up_label_id,e.label_name=t.name,e.checkChoose||(e.showChooseTag=!0,e.checkChoose=!0))}),e.setData({address_tag:t.result.list,tag_num:e.tag_num,label_name:e.label_name,has_shop:t.result.has_shop,showChooseTag:e.showChooseTag}))})},changeChooseTag:function(){this.setData({showChooseTag:!1})},change_tag:function(e){this.label_id=e.currentTarget.dataset.label_id,this.label_name=e.currentTarget.dataset.label_name,this.isEditAddr=!0,this.setData({tag_num:e.currentTarget.dataset.tagnum})},hideWindow:function(){var e=this;e.setData({showOrderWindow:!1,timeOrderCheck:!1})},showWindow:function(){var e=this;e.setData({showOrderWindow:!0,timeOrderCheck:!0})},changeOrderTime:function(e){e.currentTarget.dataset.num;var t=e.currentTarget.dataset.item;o.setStorageSync("tackoutOrderTime",t),this.setData({orderTimeId:t.shop_shipping_time_id,orderTimeText:t})},stopMove:function(){return!0},setData:function(e){var t=this,s=[];Object.keys(e).forEach(function(i){s=i.split("."),e[i],t.$data,s.forEach(function(s,o){t[i]=e[i]})})}}};t.default=a},b800:function(e,t,s){},bbf0:function(e,t,s){"use strict";var i=s("b800"),o=s.n(i);o.a}},[["b4af","common/runtime","common/vendor"]]]);