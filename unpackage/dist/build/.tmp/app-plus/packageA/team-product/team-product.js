(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/team-product/team-product"],{1610:function(t,e,a){},"98e3":function(t,e,a){"use strict";a.r(e);var s=a("9def"),i=a.n(s);for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);e["default"]=i.a},"99e3":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.shippingBonus.length},t.e1=function(e){e.stopPropagation(),t.team_type})},i=[];a.d(e,"a",function(){return s}),a.d(e,"b",function(){return i})},"9def":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=getApp().globalData,i=a("28c1"),o=a("b6a1"),n=function(){return a.e("wxParse/wxParse").then(a.bind(null,"78b5"))},r=function(){return a.e("components/teamList/teamList").then(a.bind(null,"264e"))},u=function(){return a.e("components/navBar/navBar").then(a.bind(null,"b397"))},c={components:{teamList:r,navbar:u,WxParse:n},data:function(){return{iconURL:s.dataBase.iconURL,bannerApp:!0,iphoneXBottom:"0rpx",winWidth:0,winHeight:0,teamId:0,itemData:{shop_type:0},isLike:0,showSKUstatus:0,optionalAttrs:{},skuImages:"",bannerItem:[],buynum:1,indicatorDots:!0,indicatorColor:"rgba(0,0,0,.2)",indicatorActiveColor:"#ffe150",autoplay:!1,interval:5e3,duration:300,circular:!0,firstIndex:-1,choosed_sku:"",cartAmount:0,currentLocation:1,showSubbar:!1,scrollTop:0,scrollBar:"",showBackTop:!1,undel:!0,unadd:!1,showBonus:0,brandID:0,ipRecommend:{},formateDatas:[],comment:{},teamLabel:{},wordsLimit:!0,limitWords:"展开",isPriceEqual:!1,productgift:{},isshare:0,giftNum:"",bounsTxtnumOn:!1,showBonusModal:!1,showSettingModalStatus:!1,isShowbox:0,canPurchase:!1,date_limite_bool:!0,date_limite_ing:!0,isShowGoHome:!1,isShowSharePic:!1,preurl:null,showzjModalStatus:!1,rentToggleStatus:0,aldExposure:!0,stopCartBtn:!1,prom_bool:!1,activity_bool:!1,activity_classfy:"",h:"00",m:"00",s:"00",d:"00",teamList:[],team_num:0,check_remind:!1,check_remind_activity:!1,showPhoneModal:!1,navbarOpacity:0,showBack:!1,navBarHeight:s.navBarHeight,team_type:"",team_sku_type:0,noticeUnload:!1,activity_price_start:"0",activity_price_end:"0.00",activity_time_start:{},confirmData:{},currentAttrs:[],team_needer:""}},onPullDownRefresh:function(){that.loadProductDetail(),that.loadProductgift(),setTimeout(function(){wx.stopPullDownRefresh()},1500)},onShareAppMessage:function(t){var e=this,a=i.getStorageSync("getpickup"),s=i.getStorageSync("entry_share_info");if(t.target&&t.target.dataset.shareinfo){var o=t.target.dataset.shareinfo;return o&&"notice"==o.fromButton?{title:s.urge_share_text,path:"/pages/index/index?pickup_id="+a.pickup_id+"&user_id="+s.user_id,imageUrl:s.urge_share_img}:o&&"envelopes"==o.fromButton?{title:s.invite_share_text,path:"/pages/index/index?pickup_id="+a.pickup_id+"&user_id="+s.user_id,imageUrl:s.invite_share_img}:{title:e.itemData.share_title,path:"/packageA/team-product/team-product?teamId="+e.itemData.goods_id+"&pickup_id="+a.pickup_id,imageUrl:e.itemData.share_img}}return{title:e.itemData.share_title,path:"/packageA/team-product/team-product?teamId="+e.itemData.goods_id+"&pickup_id="+a.pickup_id,imageUrl:e.itemData.share_img}},onLoad:function(e){console.log(t("options",e," at packageA\\team-product\\team-product.vue:680"));var a=this;wx.showShareMenu({withShareTicket:!0});var n=getCurrentPages();n.length>1&&a.setData({showBack:!0}),wx.getSystemInfo({success:function(t){var e=t.model;-1!=e.search("iPhone X")&&a.setData({iphoneXBottom:"68rpx"})}}),o.on("checkSessionKey",this,function(t){var e=i.getStorageSync("isOldUser");this.setData({checkSessionKey:t,isOldUser:e})});var r="",u="";if(e.scene){var c=decodeURIComponent(e.scene);r=c.split("&")[0],u=c.split("&amp;")[1]}if(void 0!=e.teamId||""!=r){a=this;e&&e.scene&&""!=e.scene?(a.setData({teamId:r}),this.setData({isShowGoHome:!0})):(a.setData({teamId:e.teamId}),this.getTeamList()),e&&e.entryType&&"external"==e.entryType?this.setData({isShowGoHome:!1}):this.setData({isShowGoHome:!0}),this.setData({entryData:e});e=a.entryData;if(e&&e.scene&&""!=e.scene)a.getExternal(u).then(function(){s.firstlaunchApp=!1,a.entryData={},i.setStorageSync("authSetting",{"scope.userLocation":!0}),a.checkSessionKey=!0,a.loadProductDetail(),a.loadProductgift()});else{var d=i.getStorageSync("getpickup");e&&(e.atitude||e.pickup_id)&&!d?a.getExternal(e.pickup_id).then(function(){s.firstlaunchApp=!1,a.entryData={},i.setStorageSync("authSetting",{"scope.userLocation":!0}),a.checkSessionKey=!0,a.loadProductDetail(),a.loadProductgift()}):(a.checkSessionKey=!0,a.loadProductDetail(),a.loadProductgift())}}else i.toast("请求参数错误")},onUnload:function(){this.setData({noticeUnload:!0})},onShow:function(){var t=i.getStorageSync("isOldUser");this.setData({checkSessionKey:s.checkSessionKey,isOldUser:t}),this.itemData.team_id&&void 0!=this.itemData.team_id&&(this.loadProductDetail(),this.getTeamList())},props:{},methods:{getDate:function(t){var e=this,a=1e3*t.start_time,s=1e3*t.end_time,i=(new Date).getTime();i>=a&&i<=s?(e.countTime(i,s),e.setData({date_limite_ing:!0}),this.date=setInterval(function(){var t=(new Date).getTime();e.countTime(t,s)},1e3),e.countTimeMs()):a>=i&&s>=i?(e.countTime(i,a),e.setData({date_limite_ing:!1}),this.date=setInterval(function(){var t=(new Date).getTime();e.countTime(t,a)},1e3)):e.setData({date_limite_bool:!1})},countTime:function(t,e){var a,s,i,o,n=e-t;if(!(n>=0))return clearInterval(this.date),this.loadProductDetail(),!1;a=Math.floor(n/1e3/60/60/24,10),s=Math.floor(n/1e3/60/60%24)+24*a,i=Math.floor(n/1e3/60%60),o=Math.floor(n/1e3%60),s=s>9?s:"0"+s,i=i>9?i:"0"+i,o=o>9?o:"0"+o,this.setData({down_date_h:s,down_date_m:i,down_date_s:o})},countTimeMs:function(){var t=this,e=9;this.dataMs=setInterval(function(){e>1?e--:e=9,t.setData({down_date_ms:e})},100)},countDown:function(t){var e,a,s,i,o=this,n=this,r=(new Date).getTime()/1e3,u=t-r;clearInterval(n.teamTime),n.teamTime=setInterval(function(){u-=1,u>=0?(e=Math.floor(u/60/60/24,10),a=Math.floor(u/60/60%24),s=Math.floor(u/60%60),i=Math.floor(u%60),e=e>9?e:"0"+e,a=a>9?a:"0"+a,s=s>9?s:"0"+s,i=i>9?i:"0"+i):(clearInterval(n.teamTime),o.setData({showCountDown:!1}),n.loadProductDetail()),o.setData({d:e,h:a,m:s,s:i})},1e3)},getExternal:function(t){var e=s.getPath.getpickup,a={pickup_id:t};return new Promise(function(t,s){i.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){e=e.data.result.cities.pick_up;i.setStorage({key:"city",data:{pickup_id:e.pickup_id,warehouse_id:e.warehouse_id,cityName:e.city_name,is_pick_up:1}}),i.setStorage({key:"getpickup",data:{pickup_id:e.pickup_id,cityName:e.pickup_name,pickup_address:e.pickup_address,pickup_contact:e.pickup_contact,pickup_phone:e.pickup_phone,pickup_type:e.pickup_type}},function(e){t("获取id成功")})}})})},setPreviewImage:function(t){for(var e=this,a=t.currentTarget.dataset.current,s=[],i=0;e.bannerItem.length>i;i++)s.push(e.bannerItem[i].src);wx.previewImage({current:a,urls:s})},setModalStatus:function(t){var e=this;e.team_sku_type=1,0==this.showSKUstatus?this.showSKUstatus=1:this.showSKUstatus=0;var a=wx.createAnimation({duration:250,timingFunction:"linear",delay:0});a.translateY(368).opacity(1).step(),this.setData({animationData:a.export()}),1==this.showSKUstatus&&this.setData({showModalStatus:!0}),setTimeout(function(){"68rpx"==e.iphoneXBottom?a.translateY(-34).step():a.translateY(0).step(),this.setData({animationData:a}),0==this.showSKUstatus&&this.setData({showModalStatus:!1})}.bind(this),200)},setModalBonus:function(){0==this.showBonusModal?this.showBonusModal=1:this.showBonusModal=0;var t=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});t.translateY(300).opacity(1).step(),this.setData({animationData:t.export()}),1==this.showBonusModal&&this.setData({showBonusModal:!0}),setTimeout(function(){t.translateY(0).step(),this.setData({animationData:t}),0==this.showBonusModal&&this.setData({showBonusModal:!1})}.bind(this),200)},getBonus:function(t){var e=this,a=i.getStorageSync("isOldUser");if(!s.checkSessionKey||2==a)return i.goRegister(),!1;var o=t.currentTarget.dataset.typeid;if(e.shippingBonus){var n=s.getPath.addCoupon,r={coupon_id:o};i.formIdUpdate(t),i.ApiGateWayTest(n,r,!0,function(t){200==t.statusCode&&t.data.result&&i.toast(t.data.result.state_desc),e.loadProductgift()})}},setfwModalStatus:function(t){var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),this.setData({showfwModalStatus:!0}),setTimeout(function(){e.translateY("-150px").translateX("-50%").step(),this.setData({animationData:e}),0==t.currentTarget.dataset.status&&this.setData({showfwModalStatus:!1})}.bind(this),200)},showShareModalStatus:function(t){var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),this.setData({showShareModalStatus:!0}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==t.currentTarget.dataset.status&&this.setData({showShareModalStatus:!1})}.bind(this),200)},loadProductDetail:function(){var t=this;i.showLoad(this);var e=s.getPath.getTeamGoodsInfo,a=s.getPath.getSkuAmount,o={team_id:t.teamId};i.ApiGateWayTest(e,o,!0,function(e){if(200==e.statusCode){var a=e.data.result;a.goods_content,a.detail_explain,a.is_liked;a.current_price=a.shop_price,a.price=a.market_price,a.team_price=parseFloat(a.team_price),t.setData({itemData:a,bannerItem:a.gallery,indicatorDots:a.gallery.length>1,buynum:a.min_buy_amount,brandID:a.cat_id,skuSvipCurrent:parseFloat(a.shop_price),skuCurrent:parseFloat(a.market_price)}),1==a.is_notice&&t.setData({check_remind:!0}),1==a.is_activity_notice&&t.setData({check_remind_activity:!0}),1==t.aldExposure&&(t.aldExposure=!1),t.teamLabel2(),t.setDefaultSKU(a),t.isPriceEqual2(),i.hideLoad(t)}else i.hideLoad(t),i.toast("获取购物车数量失败")}),i.ApiGateWayTest(a,"",!0,function(e){200==e.statusCode&&t.setData({cartAmount:e.data.result.cart_num})})},swiperImageLoad:function(){var t=this;t.setData({swiperImgBl:!0})},loadProductgift:function(){var t=this,e=s.getPath.goodscouponlist,a={goods_id:t.teamId};i.ApiGateWayTest(e,a,!0,function(e){var a=e.data.result,s=0,i=0;a&&(s=a.length>3?3:a.length);for(var o=0;o<s;o++)i+=a[o].name.length;t.setData({shippingBonus:a}),i>24&&t.setData({bounsTxtnumOn:!0})})},setDefaultSKU:function(t){for(var e=[],a=null,s=[],o=[],n=0;n<t.properties.length;++n){var r=t.properties[n];if(!r.is_multiselect){s[n]=[];for(var u=0;u<r.attrs.length;u++)s[n].push(r.attrs[u].id)}}if(s=i.multiCartesian(s),s.length&&s[0]instanceof Array)for(n=0;n<s.length;n++)s[n].sort(function(t,e){return t-e});this.setData({canPurchase:this.checkCanPurchase()});var c=9999999999,d=9999999999;for(n=0;n<t.stock.length;++n){var l=t.stock[n].key.split("_"),h=t.stock[n].market_price,p=t.stock[n].price;if(d>p){var m=[];if(t.is_goods_number>0&&t.is_on_sale&&t.stock[n].is_enough){for(var f=0,g=l.length;f<g;f++)m.push(parseInt(l[f]));e=m,a=[{attrs:e,stock:t.stock[n]}],!0,d=p,c=h}else if(!t.is_goods_number>0||!t.is_on_sale){for(f=0,g=l.length;f<g;f++)m.push(parseInt(l[f]));e=m,a=[{attrs:e,stock:t.stock[n]}],!0,d=p,c=h}}l.sort(function(t,e){return t-e}),l=l.join("_");for(u=0;u<s.length;u++){var _="";_=s[u]instanceof Array?s[u].join("_"):s[u]instanceof Object?"":s[u],l==_&&1==t.stock[n].is_enough&&o.push({attrs:s[u],stock:t.stock[n]})}}var k=this.itemData.current_price,v=this.itemData.price;if(this.setData({sku_price:c,min_sku_price:c,sku_svip_price:d,min_sku_svip_price:d,skuSvipCurrent:parseFloat(k),skuCurrent:parseFloat(v),currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku(),e=[],a=null,this.setData({currentStock:null,hasDefaultSKU:!1}),this.currentAttrs=[],1==o.length&&(e=o[0].attrs instanceof Array?o[0].attrs:[o[0].attrs],a=o[0].stock),o.length>1)for(var n in t.properties){var D=t.properties[n].attrs;for(var u in D){var y=0;for(var w in o){var S=new RegExp(D[u].id).test(o[w].attrs);S&&y++}y==o.length&&e.push(D[u].id)}}this.setData({currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku()},set_choosed_sku:function(){var t=this,e=t.itemData;if(t.currentAttrs.length<e.properties.length)return t.sku_price=t.min_sku_price,t.sku_svip_price=t.min_sku_svip_price,t.setData({choosed_sku:"选择：商品规格",skuImages:e.header_img,skuSvipCurrent:parseFloat(t.itemData.current_price),skuCurrent:parseFloat(t.itemData.price)}),void t.setAttrsClass();var a="",s=0,i=0,o=0,n=t.itemData.current_price,r=t.itemData.price;for(var u in t.setData({choosed_sku:a,sku_price:s,sku_svip_price:i,skuSvipCurrent:parseFloat(n),skuCurrent:parseFloat(r)}),e.properties){var c=e.properties[u].attrs;for(var d in c)for(var l in t.currentAttrs)t.currentAttrs[l]==c[d].id&&(a+=c[d].item+" ")}if(""!=a){for(var u in e.stock){var h=e.stock[u].key;h=h.split("_"),h.sort(function(t,e){return t-e}),h=h.join("_");c=t.currentAttrs.join("_");c==h&&(t.skuImages=e.stock[u].header_img,s=e.stock[u].market_price,i=e.stock[u].shop_price,o=e.stock[u].team_price)}t.confirmData=[{goods_name:e.goods_name,goods_id:e.goods_id,sku_key:c,amount:t.buynum,shop_price:i,market_price:s,sku_key_name:"规格:"+a,sku_img:t.skuImages}],a="已选："+a;n=1==t.team_type?o:i,r=s;t.setData({choosed_sku:a,sku_price:s,sku_svip_price:i,skuSvipCurrent:parseFloat(n),skuCurrent:parseFloat(r),skuImages:t.skuImages})}t.setAttrsClass()},attrValueselest:function(t){var e=this.itemData;if(e){var a=t.currentTarget.dataset.property,s=t.currentTarget.dataset.attr;if(s.is_multiselect){var o=[].concat(this.optionalAttrs),n=o.indexOf(s.id);-1==n?o.push(s.id):o.splice(n,1),this.setData({optionalAttrs:o})}else{var r=!1;for(var u in e.stock)if(1==e.stock[u].is_enough&&e.stock[u].key.indexOf(String(s.id))>=0){r=!0;break}if(!r)return void i.toast("库存不足");var c=null;o=[].concat(this.currentAttrs),n=o.indexOf(s.id);for(var u in-1==n?o.push(s.id):o.splice(n,1),a.attrs)if(a.attrs[u].id!=s.id){n=o.indexOf(a.attrs[u].id);-1!=n&&o.splice(n,1)}if(o=o.filter(function(t,e,a){return a.indexOf(t)===e}),o.sort(function(t,e){return t-e}),o.length){var d=o.join("_");for(u=0;u<e.stock.length;++u){var l=e.stock[u].key.split("_");if(l.sort(function(t,e){return t-e}),l=l.join("_"),l==d){c=e.stock[u];break}}}c&&c.is_enough?(this.currentStock=c,this.currentAttrs=o,this.setData({buynum:e.min_buy_amount})):o.length<e.properties.length?(this.currentStock=null,this.currentAttrs=o,this.setData({buynum:e.min_buy_amount})):i.toast("库存不足"),this.setData({canPurchase:this.checkCanPurchase()})}this.set_choosed_sku()}},setAttrsClass:function(){var t=this.itemData,e=t.properties;for(var a in e){var s=e[a].attrs;for(var i in s){var o=s[i];if(t)if(0!=t.is_goods_number){if(o.is_multiselect)o.class=-1==this.optionalAttrs.indexOf(o.id)?"":"active";else{o.class=-1==this.currentAttrs.indexOf(o.id)?"":"active";var n=!1;for(var a in t.stock){if(1!=t.stock[a].is_enough){var r=this.currentAttrs.join("_");if(!(t.stock[a].key.indexOf(String(r))>=0&&this.currentAttrs.length>0))continue;var u=t.stock[a].key.split("_");for(var i in u)if(u[i]!=this.currentAttrs)for(var c in t.properties)for(var d in t.properties[c].attrs)t.properties[c].attrs[d].id==u[i]&&(t.properties[c].attrs[d].class="disable")}if(t.stock[a].key.indexOf(String(o.id))>=0){n=!0;break}}n||(o.class+="disable")}}else o.class="disable";else o.class="disable"}}this.setData({itemData:t})},addFavorites:function(t){var e=this,a=e.isLike,o=e.teamId,n=s.getPath.goodsLike,r=s.getPath.goodsUnlike,u={goods_id:o},c={goods_id:o};a?i.ApiGateWayTest(r,c,!0,function(t){if(200==t.statusCode){t=t.data.result;e.setData({isLike:!a}),i.toast("取消收藏")}}):i.ApiGateWayTest(n,u,!0,function(t){if(200==t.statusCode){t=t.data.result;e.setData({isLike:!a}),i.toast("收藏成功")}})},checkCanPurchase:function(){var t=this.itemData,e=!1;if(t.pre_info&&1==t.pre_info.is_pre)return this.setData({sumbitName:t.pre_info.pre_time}),!1;if(!t||0==t.is_enough)return this.setData({sumbitName:"抱歉，商品已售罄"}),!1;if(0==t.is_on_sale)return this.setData({sumbitName:"抱歉，商品已下架"}),!1;if(this.currentAttrs.length>=t.properties.length){for(var a in t.properties)if(!t.properties[a].is_multiselect){e=!0;break}if(e){if(!this.currentAttrs||!this.currentAttrs.length)return!1;if(!this.currentStock)return!1}}return this.setData({sumbitName:"立即购买"}),!0},isPriceEqual2:function(){var t=this;if(t.itemData.price&&t.itemData.current_price){var e=t.itemData.price+t.sku_price,a=t.itemData.current_price+t.sku_svip_price;e==a?t.setData({isPriceEqual:!0}):t.setData({isPriceEqual:!1})}else t.setData({isPriceEqual:!1})},changeNum:function(t){var e=this;i.formIdUpdate(t);var a=e.itemData,o=s.getPath.skuEnough;a.pre_info&&1==a.pre_info.is_pre&&(o=s.getPath.skuEnough);var n="";for(var r in a.stock){var u=a.stock[r].key;u=u.split("_"),u.sort(function(t,e){return t-e}),u=u.join("_");var c=e.currentAttrs.join("_");if(c==u){n=a.stock[r].key;break}}if(e.currentAttrs.length==a.properties.length){if(0==t.currentTarget.dataset.alphaBeta){if(!e.checkCanPurchase())return;if(e.buynum<=e.itemData.min_buy_amount)return void i.toast("不能小于最小购买数量");if(e.buynum<=1||(2===e.buynum?e.setData({buynum:e.buynum-1,undel:!0}):e.setData({buynum:e.buynum-1})),1!=e.buynum){var d={goods_id:a.goods_id,sku_key:n,amount:e.buynum};i.ApiGateWayTest(o,d,!0,function(t){t&&(1==t.data.result.is_enough||i.toast(t.data.result.msg))})}}else{if(0!=e.itemData.max_buy_amount&&e.buynum>=e.itemData.max_buy_amount)return void i.toast("不能在多啦~");if(e.setData({buynum:e.buynum+1,undel:!1}),e.buynum>1){d={goods_id:a.goods_id,sku_key:n,amount:e.buynum};i.ApiGateWayTest(o,d,!0,function(t){if(t)return 1!=t.data.result.is_enough?(i.toast(t.data.result.msg),e.setData({buynum:e.buynum-1}),void e.set_choosed_sku()):void 0})}}e.confirmData.num=e.buynum}else 0==e.showSKUstatus?e.setModalStatus():i.toast("请选择商品款式");e.set_choosed_sku()},goRegister:function(){var t=i.getStorageSync("isOldUser");if(!s.checkSessionKey||2==t)return i.goRegister(),!1},isnewpersongoods:function(t,e){var a=s.getPath.isnewpersongoods,o={goods_id:t,sku_key:e};return new Promise(function(t,e){i.ApiGateWayTest(a,o,!0,function(e){var a=e.data;if(1==a.success){var s=a.result.result;t(s)}})})},addShopCart:function(t){var e=i.getStorageSync("isOldUser");if(!s.checkSessionKey||2==e)return i.goRegister(),!1;if(this.checkCanPurchase()){var a=this,o=this.itemData,n=t.currentTarget.dataset.type;if("addcart"==n&&a.currentAttrs.length==o.properties.length){var r=function(){var e={goods_id:o.goods_id,sku_key:u,amount:a.buynum};s.aldstat.sendEvent("加入购物车",{"商品名称":a.itemData.report.goods_name,"用户名":a.itemData.report.nick_name}),i.formIdUpdate(t),0==a.stopCartBtn&&(a.stopCartBtn=!0,i.ApiGateWayTest(h,e,!0,function(t){t&&(0!=t.data.success?(a.setData({cartAmount:t.data.result.cart_num}),i.toast(t.data.msg),a.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1,showModalStatus:!1}),a.showSKUstatus=0,a.stopCartBtn=!1):i.toast(t.data.msg))}))},u="";for(var c in o.stock){var d=o.stock[c].key;d=d.split("_"),d.sort(function(t,e){return t-e}),d=d.join("_");var l=a.currentAttrs.join("_");if(l==d){u=o.stock[c].key;break}}var h="";a.isnewpersongoods(o.goods_id,u).then(function(t){t?(h=s.getPath.addCartnew,i.showModal("是否替换新人商品","确定",function(t){t.confirm&&r()})):(h=s.getPath.addCart,r())})}else"addcart"!=n||0==a.showSKUstatus?(a.setModalStatus(n),a.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):i.toast("请选择商品款式")}},nowPurchase:function(t){var e=i.getStorageSync("isOldUser");if(!s.checkSessionKey||2==e)return i.goRegister(),!1;if(this.checkCanPurchase()){var a=this;if(this.setData({team_type:0}),1!=a.itemData.shop_type){var o=a.itemData;if(a.currentAttrs.length==o.properties.length&&o.max_buy_amount<2||1==a.team_sku_type&&a.currentAttrs.length==o.properties.length){var n="";for(var r in o.stock){var u=o.stock[r].key;u=u.split("_"),u.sort(function(t,e){return t-e}),u=u.join("_");var c=a.currentAttrs.join("_");if(c==u){n=o.stock[r].key;break}}var d=s.getPath.skuEnough;o.pre_info&&1==o.pre_info.is_pre&&(d=s.getPath.skuEnough);var l={goods_id:o.goods_id,sku_key:n,amount:a.buynum};s.aldstat.sendEvent("立即购买",{"商品名称":a.itemData.report.goods_name,"用户名":a.itemData.report.nick_name}),i.formIdUpdate(t),i.showLoad(this),i.ApiGateWayTest(d,l,!0,function(e){if(e)return 1!=e.data.result.is_enough?(i.hideLoad(a),void i.toast(e.data.result.msg)):void h(t)})}else 0==a.showSKUstatus?(a.setModalStatus(),a.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):i.toast("请选择商品款式")}else a.setzjModalStatus(t)}function h(){var t=s.getPath.preCheckOrder,e=[{goods_id:a.confirmData[0].goods_id,sku_key:a.confirmData[0].sku_key,num:a.confirmData[0].amount}];e=JSON.stringify(e);var o={order_product:e,team_order:0,time_atitude:s.dataBase.userAtitude};i.ApiGateWayTest(t,o,!0,function(t){i.hideLoad(a),1==t.data.success?(a.confirmData[0]["team_order"]=0,a.confirmData[0]["channel"]=a.itemData.is_team,i.setStorage({key:"nowPay",data:a.confirmData}),wx.navigateTo({url:"/pages/confirm/confirm"})):i.toast(t.data.msg)})}},delegation:function(t){var e=i.getStorageSync("isOldUser");if(!s.checkSessionKey||2==e)return i.goRegister(),!1;if(this.checkCanPurchase()){var a=this;if(1!=a.itemData.shop_type){this.setData({team_type:1});var o=a.itemData;if(a.currentAttrs.length==o.properties.length&&o.max_buy_amount<2||1==a.team_sku_type&&a.currentAttrs.length==o.properties.length){var n="";for(var r in o.stock){var u=o.stock[r].key;u=u.split("_"),u.sort(function(t,e){return t-e}),u=u.join("_");var c=a.currentAttrs.join("_");if(c==u){n=o.stock[r].key;break}}var d=s.getPath.skuEnough;o.pre_info&&1==o.pre_info.is_pre&&(d=s.getPath.skuEnough);var l={goods_id:o.goods_id,sku_key:n,amount:a.buynum};s.aldstat.sendEvent("立即购买",{"商品名称":a.itemData.report.goods_name,"用户名":a.itemData.report.nick_name}),i.formIdUpdate(t),i.showLoad(this),i.ApiGateWayTest(d,l,!0,function(e){if(e)return 1!=e.data.result.is_enough?(i.hideLoad(a),void i.toast(e.data.result.msg)):(a.setData({showModalStatus:!1,showSKUstatus:0}),void h(t))})}else 0==a.showSKUstatus?(a.setModalStatus(),a.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1,skuSvipCurrent:o.stock[0].team_price})):i.toast("请选择商品款式")}else a.setzjModalStatus(t)}function h(){var t=s.getPath.preCheckOrder,e=[{goods_id:a.confirmData[0].goods_id,sku_key:a.confirmData[0].sku_key,num:a.confirmData[0].amount}];e=JSON.stringify(e);var o={order_product:e,team_order:1,team_id:a.itemData.team_id,time_atitude:s.dataBase.userAtitude};i.ApiGateWayTest(t,o,!0,function(t){i.hideLoad(a),1==t.data.success?(a.confirmData[0]["team_order"]=1,a.confirmData[0]["team_id"]=a.itemData.team_id,i.setStorage({key:"nowPay",data:a.confirmData}),wx.navigateTo({url:"/pages/confirm/confirm"})):i.toast(t.data.msg)})}},shareTo:function(){this.setData({isShowModeWx:1})},clossShare:function(){this.setData({isShowModeWx:0})},closeShareWx:function(){this.setData({isShowModeWx:0})},closeShareBox:function(){this.setData({isShowbox:0})},closeShareShowSku:function(){this.setData({isShowbox:0}),this.setModalStatus()},onPageScroll:function(t){var e=this;e.navbarOpacity<1&&t.scrollTop>100?e.setData({navbarOpacity:t.scrollTop/500}):e.navbarOpacity>0&&t.scrollTop<200&&e.setData({navbarOpacity:t.scrollTop/500}),t.scrollTop>300?e.setData({showBackTop:!0}):e.setData({showBackTop:!1})},gotoPagetop:function(){wx.pageScrollTo({scrollTop:0})},productGoSP:function(){this.setData({scrollTop:0})},productGoPJ:function(){this.setData({scrollBar:"comment"});var t=this;setTimeout(function(){t.setData({currentLocation:2})},400)},productGoXQ:function(){this.setData({scrollBar:"content"});var t=this;setTimeout(function(){t.setData({currentLocation:3})},400)},openSvip:function(){s.dataBase.pageUrl="http://mc.vip.qq.com/qqwallet/index?_wv=3&aid=mios.p.a.em_spxqy&ADTAG=vipmall&type=!svip&month=1",i.goWebview()},gotoHome:function(t){i.formIdUpdate(t),wx.switchTab({url:"/pages/index/index"})},goBonusPage:function(){this.setData({isShowbox:0}),wx.navigateTo({url:"/pages/rituall/rituall"})},initNavHeight:function(){var t=this;wx.getSystemInfo({success:function(e){t.setData({winWidth:e.windowWidth,winHeight:e.windowHeight})}})},bannerClosed:function(){this.setData({bannerApp:!1})},goToCart:function(t){i.formIdUpdate(t),wx.switchTab({url:"/pages/cart/cart"})},productGoProduct:function(t){var e=t.currentTarget.dataset.id;wx.navigateTo({url:"/pages/product/product?productId="+e})},productGoTheme:function(t){var e=t.currentTarget.dataset.brand;wx.navigateTo({url:"/pages/listdetail/listdetail?cat_id=&title=&brand_id="+e})},productGoComment:function(t){var e=t.currentTarget.dataset.productid;wx.navigateTo({url:"/pages/comment/comment?productId="+e})},closeSharePic:function(){this.setData({isShowSharePic:!1})},drawPic:function(){var t=this;t.clossShare(),i.showLoad(this);var e="",a="",s=new Promise(function(a,s){wx.getImageInfo({src:t.skuImages,success:function(t){e=t.path,a(t)},fail:function(t){wx.showToast({title:"网络繁忙，无法生成分享图",icon:"none"}),s()}})}),o=i.getStorageSync("getpickup"),n=new Promise(function(e,s){wx.request({url:"https://wx.shop.haoyousheng.com.cn/v1/goods/getWXACodeUnlimit",method:"post",responseType:"arraybuffer",data:{secene:t.teamId+"&"+o.pickup_id,page:"packageA/team-product/team-product",application:"goodBuy"},success:function(t){var i=Date.parse(new Date),o="".concat(wx.env.USER_DATA_PATH,"/").concat("erweima"+i,".","jpg");wx.getFileSystemManager().writeFile({filePath:o,data:t.data,encoding:"binary",success:function(){a=o,e(o)},fail:function(){s(new Error("ERROR_BASE64SRC_WRITE"))}})},fail:function(t){s()}})});Promise.all([s,n]).then(function(s){var o=wx.createCanvasContext("shareImg");o.rect(0,0,283,480),o.setFillStyle("#FFFFFF"),o.fill(),o.beginPath(),o.arc(142,-39,185,0,2*Math.PI),o.setFillStyle("#ffe150"),o.fill();var n=35,r=36,u=10,c=220,d=290;o.beginPath(),o.moveTo(n+u,r),o.arcTo(n+c,r,n+c,r+d,u),o.arcTo(n+c,r+d,n,r+d,u),o.arcTo(n,r+d,n,r,u),o.arcTo(n,r,n+c,r,u),o.setFillStyle("#FFFFFF"),o.setShadow(0,0,15,"#DDDDDD"),o.fill(),o.setShadow(0,0,0,"#ffffff");var l=95,h=275,p=2,m=40,f=16;o.beginPath(),o.moveTo(l+p,h),o.arcTo(l+m,h,l+m,h+f,p),o.arcTo(l+m,h+f,l,h+f,p),o.arcTo(l,h+f,l,h,p),o.arcTo(l,h,l+m,h,p),o.setStrokeStyle("red"),o.closePath(),o.stroke(),o.drawImage(e,66,71,150,150),o.drawImage(a,101,340,80,80),o.setTextAlign("center"),o.setFillStyle("#555555"),o.setFontSize(14),t.itemData.goods_name.length>12?(o.fillText(t.itemData.goods_name.slice(0,12),141.5,245),o.fillText(t.itemData.goods_name.slice(12,24),141.5,265)):o.fillText(t.itemData.goods_name,141.5,245),o.setTextAlign("center"),o.setFillStyle("red"),o.setFontSize(10),o.fillText("抢购价",115,287),o.setTextAlign("center"),o.setFillStyle("red"),o.setFontSize(14),o.fillText("¥"+t.skuSvipCurrent,165,289),o.setTextAlign("center"),o.setFillStyle("#555555"),o.setFontSize(11),o.fillText("长按图片识别小程序码",141.5,445),o.setTextAlign("center"),o.setFillStyle("#AAAAAA"),o.setFontSize(9),o.fillText("*实际价格以页面展示为准",141.5,460),o.setTextAlign("center"),o.setFillStyle("#AAAAAA"),o.setFontSize(12),o.fillText("原价 ¥"+t.skuCurrent,141.5,310),o.beginPath(),o.moveTo(100,305),o.lineTo(183,305),o.setStrokeStyle("#AAAAAA"),o.stroke(),i.hideLoad(t),t.setData({isShowSharePic:!0}),o.stroke(),o.draw(!1,function(){t.TransformationPic()})})},TransformationPic:function(){var e=this;wx.canvasToTempFilePath({x:0,y:0,canvasId:"shareImg",fileType:"jpg",quality:1,success:function(a){console.log(t("分享图生成成功"," at packageA\\team-product\\team-product.vue:2689")),e.setData({preurl:a.tempFilePath})},fail:function(t){wx.showModal({title:"消息提示",content:"生成分享图失败,请重试",showCancel:!1})}})},saveSharePic:function(){var t=this;i.showLoad(this),wx.saveImageToPhotosAlbum({filePath:t.preurl,success:function(e){i.hideLoad(t),t.setData({isShowSharePic:!1,preurl:null}),wx.showModal({title:"保存成功",content:"分享图保存成功",showCancel:!1})},fail:function(e){i.hideLoad(t),"saveImageToPhotosAlbum:fail auth deny"===e.errMsg&&wx.showModal({title:"提示",content:"未获取相册授权，是否获取",success:function(e){e.confirm?wx.openSetting({success:function(e){e.authSetting["scope.writePhotosAlbum"]?t.saveSharePic():wx.showToast({title:"拒绝授权将无法保存图片",icon:"none",duration:1500})}}):e.cancel&&wx.showToast({title:"拒绝授权将无法保存图片",icon:"none",duration:1500})}})}})},setzjModalStatus:function(e){console.log(t(e," at packageA\\team-product\\team-product.vue:2766"));var a=wx.createAnimation({duration:250,timingFunction:"linear",delay:0});a.translateY(368).opacity(1).step(),this.setData({animationData:a.export()}),this.setData({showzjModalStatus:!0}),setTimeout(function(){a.translateY("-150px").translateX("-50%").step(),this.setData({animationData:a}),0==e.currentTarget.dataset.status&&this.setData({showzjModalStatus:!1})}.bind(this),200)},rentToggle:function(e){var a=e.currentTarget.dataset.status;a!=this.rentToggleStatus&&(console.log(t(a," at packageA\\team-product\\team-product.vue:2797")),this.setData({rentToggleStatus:a}))},to_activity:function(t){var e=t.currentTarget.dataset.activity_id;wx.navigateTo({url:"/packageA/select/select?entryType=external&id="+e})},settingModalStatus:function(){this.setData({showSettingModalStatus:!1})},teamLabel2:function(){var t=this,e=s.getPath.teamLabel,a={team_id:t.itemData.team_id};i.ApiGateWayTest(e,a,!0,function(e){if(1==e.data.success){t.setData({teamLabel:e.data.result.data});var a=(new Date).getTime()/1e3;(t.teamLabel.start_time>a||t.teamLabel.end_time>a)&&(t.setData({showCountDown:!0}),2===t.teamLabel.status?t.countDown(t.teamLabel.start_time):1===t.teamLabel.status&&t.countDown(t.teamLabel.end_time))}})},getTeamList:function(){var e=this,a=s.getPath.teamList,o={goods_id:this.teamId};i.ApiGateWayTest(a,o,!0,function(a){a=a.data;1==a.success&&(a.result.data.length>2?(e.setData({teamList:a.result.data.concat(a.result.data),team_num:a.result.data.length}),console.log(t(e.teamList," at packageA\\team-product\\team-product.vue:2861"))):e.setData({teamList:a.result.data,team_num:a.result.data.length}))})},loadTeamList:function(){var t=this;wx.navigateTo({url:"/packageA/team-list/team-list?entryType=external&goods_id="+t.productId})},goSetting:function(){var t=this;wx.openSetting({success:function(e){1==e.authSetting["scope.userLocation"]&&t.setData({showSettingModalStatus:!1})}})},change_team:function(){var t=this;i.showLoad(this);var e=s.getPath.remindTeam,a={team_id:t.itemData.team_id,is_notice:t.check_remind?"0":"1"};i.ApiGateWayTest(e,a,!0,function(e){e=e.data;1==e.success&&(1==e.result.status?(t.setData({check_remind:!t.check_remind}),i.toast(e.result.msg)):0==e.result.status?i.toast(e.result.msg):2==e.result.status&&t.setData({showPhoneModal:!0}),i.hideLoad(t))})},goCouponList:function(){wx.navigateTo({url:"/pages/couponCenter/couponCenter?entryType=external"})},closePhoneModal:function(){this.setData({showPhoneModal:!1})},toShowPhoneModal:function(){this.setData({showPhoneModal:!0})},getPhone:function(t){if(!t.detail.encryptedData||!t.detail.iv)return!1;s.getPath.getWXMobile},back:function(){wx.navigateBack({delta:1})},backHome:function(){wx.switchTab({url:"/pages/index/index"})},setData:function(t){var e=this,a=[];Object.keys(t).forEach(function(s){a=s.split("."),t[s],e.$data,a.forEach(function(a,i){e[s]=t[s]})})}}};e.default=c}).call(this,a("0de9")["default"])},bfaf:function(t,e,a){"use strict";a.r(e);var s=a("99e3"),i=a("98e3");for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);a("d72a");var n=a("2877"),r=Object(n["a"])(i["default"],s["a"],s["b"],!1,null,null,null);e["default"]=r.exports},d72a:function(t,e,a){"use strict";var s=a("1610"),i=a.n(s);i.a}},[["29e4","common/runtime","common/vendor"]]]);