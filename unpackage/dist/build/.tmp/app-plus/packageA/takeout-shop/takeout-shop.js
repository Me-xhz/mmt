(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/takeout-shop/takeout-shop"],{"2dfc":function(t,a,e){},"5f08":function(t,a,e){"use strict";var o=e("2dfc"),s=e.n(o);s.a},b29b:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var o=getApp().globalData,s=e("28c1"),i=function(){return e.e("components/loadingBottom/loadingBottom").then(e.bind(null,"e834"))},n={data:function(){return{iconURL:o.dataBase.iconURL,showGoodstatus:0,showModalStatus:!1,showSearchModal:!1,showProductStatus:0,showSearchstatus:0,showCountModel:!1,showCountIcon:!1,showProductModal:!1,shopInfo:{},categoryInfo:[],categoryList:[],cartList:[],gallery:[],goodInfo:{},seletTag:0,cartNum:0,viewHeight:0,shop_id:1,animationActive:!1,page:1,page_size:20,search_page:1,search_page_size:20,searchValue:"",searchList:[],cartTotals:{},leftScrollTop:0,startingprice:0,rightScrollTop:0,showNotice:!1,notice:"",noticeMarqueePace:1,noticeMarqueeDistance:20,noticeSize:15,noticeInterval:20,btnDisplay:!1,btnText:"去结算",isShowGoHome:!1,shopCouponImg:"",packet_id:"",activity_red_packet_id:"",ordernum:{},showCouponFlex:!1,showCouponPopup:!1,couponPopupInfo:{},showBottomLoading:!1,animationData:"",animationSearch:"",animationDatas:"",sizeLength:"",windowWidth:"",cartAnimationImg:""}},components:{loadingbottom:i},props:{},onLoad:function(t){var a=this;a.shop_id=t.shop_id,t.give_platform&&void 0!=t.give_platform?a.give_platform=t.give_platform:a.give_platform="",t&&t.entryType&&"external"==t.entryType?a.setData({isShowGoHome:!1}):a.setData({isShowGoHome:!0})},onShow:function(){clearInterval(this.noticeIntervalFun),this.getShopCartList(),this.getShopInfo(),this.getordernum(),this.setData({leftScrollTop:0,rightScrollTop:0})},onReachBottom:function(){var t=this;t.page++,t.categoryList.length%t.page_size==0&&(t.setData({showBottomLoading:!0}),t.moreShopGoods())},onShareAppMessage:function(){var t=this,a=s.getStorageSync("getpickup");return{title:t.shopInfo.share_title,path:"/pages/index/index?pickup_id="+a.pickup_id,imageUrl:t.shopInfo.share_img}},methods:{showShop:function(){0==this.showGoodstatus?this.showGoodstatus=1:this.showGoodstatus=0;var t=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});t.translateY(300).opacity(1).step(),this.setData({animationData:t.export()}),1==this.showGoodstatus&&this.setData({showModalStatus:!0,showSearchModal:!1,showProductModal:!1}),setTimeout(function(){t.translateY(0).step(),this.setData({animationData:t.export()}),0==this.showGoodstatus&&this.setData({showModalStatus:!1})}.bind(this),200)},showSearch:function(){0==this.showSearchstatus?this.showSearchstatus=1:this.showSearchstatus=0;var t=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});t.translateY(300).opacity(1).step(),this.setData({animationSearch:t.export()}),1==this.showSearchstatus&&this.setData({showSearchModal:!0}),setTimeout(function(){t.translateY(0).step(),this.setData({animationSearch:t.export()}),0==this.showSearchstatus&&this.setData({showSearchModal:!1})}.bind(this),200)},hideConut:function(){this.setData({showCountModel:!1})},showProduct:function(t){0==this.showProductStatus?this.showProductStatus=1:this.showProductStatus=0;var a=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});a.translateY(600).opacity(1).step(),this.setData({animationDatas:a.export()}),1==this.showProductStatus&&(this.getShopGoodsImages(t),this.setData({showProductModal:!0})),setTimeout(function(){a.translateY(0).step(),this.setData({animationDatas:a.export()}),0==this.showProductStatus&&this.setData({showProductModal:!1})}.bind(this),200)},getShopInfo:function(){var t=this,a=o.getPath.shopInfo,e={shop_id:t.shop_id};s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==a.data.success?(t.setData({shopInfo:e.result}),wx.setNavigationBarTitle({title:e.result.name}),1==e.result.is_close_shop&&t.setData({btnDisplay:!0,btnText:e.result.close_button_desc}),t.getShopGoodsCategory(),t.getShopCartList(),t.getShopNotice(),t.getIsShowShopCouponAd()):s.toast(e.msg)})},getShopNotice:function(){var t=this,a=o.getPath.shopNotice,e={shop_id:t.shop_id};s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;if(1==a.data.success){if(""!=e.result&&e.result.content){var o=Number(e.result.content.length)*t.noticeSize,i=wx.getSystemInfoSync().windowWidth;t.setData({sizeLength:o,windowWidth:i,showNotice:!0,notice:e.result.content}),t.noticeRun()}}else s.toast(e.msg);wx.getSystemInfo({success:function(a){var e=a.model;-1!=e.search("iPhone X")?t.setData({viewHeight:a.windowHeight-(t.showNotice?276:240)}):t.setData({viewHeight:a.windowHeight-(t.showNotice?232:196)})}})})},noticeRun:function(){var t=this;t.noticeIntervalFun=setInterval(function(){-t.noticeMarqueeDistance<t.sizeLength?t.setData({noticeMarqueeDistance:t.noticeMarqueeDistance-t.noticeMarqueePace}):(clearInterval(t.noticeIntervalFun),t.setData({noticeMarqueeDistance:0}),t.noticeRun())},t.noticeInterval)},noticeToast:function(){s.showRidoModal(this.notice,"知道了",function(t){})},getShopGoodsCategory:function(t){var a=this,e=o.getPath.shopGoodsCategory,i={shop_id:a.shop_id};s.ApiGateWayTest(e,i,!0,function(e){var o=e.data;1==e.data.success?(a.setData({categoryInfo:o.result,seletTag:t||o.result[0].id}),t||a.getShopGoods()):s.toast(o.msg)})},getShopGoods:function(){var t=this,a=o.getPath.shopGoods,e={shop_id:t.shop_id,shop_goods_category_id:t.seletTag,page:1,page_size:20};s.showLoad(this),s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==a.data.success?(t.setData({rightScrollTop:0}),t.setData({categoryList:e.result}),s.hideLoad(t)):(s.toast(e.msg),s.hideLoad(t))})},moreShopGoods:function(){var t=this,a=o.getPath.shopGoods,e={shop_id:t.shop_id,shop_goods_category_id:t.seletTag,page:t.page,page_size:t.page_size};s.showLoad(this),s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;if(1==a.data.success){if(e.result.length>0){var o=t.categoryList.concat(e.result);t.setData({showBottomLoading:!1,categoryList:o})}else s.toast("亲~已经全部加载了哦！");s.hideLoad(t)}else s.hideLoad(t),s.toast(e.msg)})},seletedCategory:function(t){var a=t.currentTarget.dataset.id,e=t.currentTarget.dataset.index;this.page=1,this.setData({seletTag:a}),e>3?this.setData({leftScrollTop:108*(e-3)+"rpx"}):this.setData({leftScrollTop:0}),this.getShopGoods()},addCart:function(t){var a=t.currentTarget.dataset.item,e=t.currentTarget.dataset.type,i=this,n=o.getPath.shopCart,r={shop_id:i.shop_id,shop_goods_id:a.shop_goods_id,goods_num:"reduce"==e&&a.in_cart_num>0?a.in_cart_num-1:a.in_cart_num+1};1!=i.shopInfo.is_close_shop?(s.showLoad(this),s.ApiGateWayTest(n,r,!0,function(t){var o=t.data;if(1==t.data.success){s.hideLoad(i);var n=i.categoryList.map(function(t){return t.shop_goods_id==a.shop_goods_id&&("reduce"==e&&t.in_cart_num>0?t.in_cart_num--:t.in_cart_num++),t});if(1==i.showSearchModal){var r=i.searchList.map(function(t){return t.shop_goods_id==a.shop_goods_id&&("reduce"==e&&t.in_cart_num>0?t.in_cart_num--:t.in_cart_num++),t});i.setData({searchList:r})}1==i.showProductStatus&&i.showProduct(),"reduce"==e?i.setData({categoryList:n}):(i.setData({animationActive:!0,cartAnimationImg:a.original_img,categoryList:n}),setTimeout(function(){i.setData({animationActive:!1})},1e3)),i.getShopCartList(),i.getShopGoodsCategory(i.seletTag)}else s.hideLoad(i),s.toast(o.msg)})):s.toast("店铺歇业中,无法加购哦~")},getShopCartList:function(){var t=this,a=o.getPath.shopCartList,e={shop_id:t.shop_id};s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==a.data.success?(t.setData({cartList:e.result}),t.getShopGoodsNum()):s.toast(e.msg)})},onShopCartClean:function(){var t=this,a=o.getPath.shopCartClean,e={shop_id:t.shop_id};s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;if(1==a.data.success){s.toast("清空成功");var o=t.categoryList.map(function(t){return t.in_cart_num=0,t});t.setData({categoryList:o}),t.getShopCartList(),t.getShopGoodsCategory(t.seletTag)}else s.toast(e.msg)})},getShopGoodsImages:function(t){var a=this,e=t.currentTarget.dataset.id,i=o.getPath.shopGoodsImages,n={shop_goods_id:e};s.ApiGateWayTest(i,n,!0,function(e){var o=e.data;1==e.data.success?(a.setData({gallery:o.result}),a.getShopGoodsInfo(t)):s.toast(o.msg)})},getShopGoodsInfo:function(t){var a=this,e=t.currentTarget.dataset.id,i=o.getPath.shopGoodsInfo,n={shop_goods_id:e};s.ApiGateWayTest(i,n,!0,function(t){var e=t.data;1==t.data.success?a.setData({goodInfo:e.result}):s.toast(e.msg)})},getShopGoodsNum:function(){var t=this,a=o.getPath.shopGoodsNum,e={shop_id:t.shop_id};s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==a.data.success?(t.setData({cartNum:e.result.total_num}),t.getShopHotWard()):s.toast(e.msg)})},getShopHotWard:function(){var t=this,a=o.getPath.shopCartCalculateFees,e={shop_id:t.shop_id};s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==a.data.success?(t.setData({cartTotals:e.result}),1!=t.shopInfo.is_close_shop&&(0!=e.result.diff_price?e.result.diff_price==t.shopInfo.start_shipping_price?t.setData({btnDisplay:!0,btnText:"¥"+t.shopInfo.start_shipping_price+"起送"}):t.setData({btnDisplay:!0,btnText:"差¥"+e.result.diff_price+"起送"}):0==e.result.total_price&&0==t.cartNum?t.setData({btnDisplay:!0,btnText:"¥"+t.shopInfo.start_shipping_price+"起送"}):t.setData({btnDisplay:!1,btnText:"去结算"}))):s.toast(e.msg)})},searchValueInput:function(t){this.searchValue=t.detail.value},searchProductData:function(t){var a=this,e=a.searchValue.replace(/(^\s*)|(\s*$)/g,"");if(""!=e){var i=o.getPath.shopSearch,n={page:1,page_size:20,keywords:a.searchValue,shop_id:a.shop_id};s.ApiGateWayTest(i,n,!0,function(t){var e=t.data;1==e.success?e.result.length>0?(a.setData({searchList:e.result}),a.showSearch()):s.toast("亲~本店铺没有您要搜索的商品!"):s.toast("网络加载错误，请稍后重试")})}else s.toast("请输入您需要搜索的商品")},moreSearchProductData:function(){var t=this,a=o.getPath.shopSearch,e={page:t.search_page,page_size:t.search_page_size,keywords:t.searchValue,shop_id:t.shop_id};s.showLoad(this),s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;if(1==a.data.success){if(e.result.length>0){var o=t.searchList.concat(e.result);t.setData({searchList:o})}else s.toast("亲~已经全部加载了哦！");s.hideLoad(t)}else s.hideLoad(t),s.toast(e.msg)})},searchReachBottom:function(){var t=this;t.search_page++,t.searchList.length%t.search_page_size==0&&t.moreSearchProductData()},goSettlement:function(){var t=this,a=o.getPath.shopPreCheckOrder,e={shop_id:t.shop_id,time_atitude:o.dataBase.userAtitude};s.showLoad(this),s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==e.success?wx.navigateTo({url:"../takeout-order/check-takeout-order?shop_id="+t.shop_id}):s.showRidoModal(e.msg,"确定"),s.hideLoad(t)})},getIsShowShopCouponAd:function(){var t=this,a=o.getPath.isShowShopCouponAd,e={shop_id:t.shop_id,give_platform:t.give_platform};s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==e.success?(t.shopCouponAd=e.result,0!=e.result.status&&(1==e.result.status?t.setData({showCountModel:!0,showCouponPopup:!1,shopCouponImg:e.result.coupon_img}):2==e.result.status&&s.showRidoModal(e.result.status_desc,"确定")),0!=e.result.activityRedPacketInfo.status&&(t.activity_red_packet_id=e.result.activityRedPacketInfo.activity_red_packet_id,t.packet_id=e.result.activityRedPacketInfo.activity_red_packet_bargaining_id,t.setData({showCountIcon:!0}))):s.toast(e.msg)})},getSpecialCoupon:function(){var t=this,a=o.getPath.getSpecialCoupon,e={shop_id:t.shop_id,give_platform:t.give_platform,time_atitude:o.dataBase.userAtitude};s.showLoad(this),s.ApiGateWayTest(a,e,!0,function(a){var e=a.data;s.hideLoad(t),t.setData({showCountModel:!1}),1==e.success?0==e.result.data.state?(e.result.data.lists&&e.result.data.lists.length>1?t.setData({showCouponPopup:!0,couponPopupInfo:e.result.data}):s.showRidoModal(e.result.data.state_desc,"确定"),t.getordernum()):s.showRidoModal(e.result.data.state_desc,"确定"):s.toast(e.msg)})},getAssistanceCoupon:function(){var t=this;if(""!=t.packet_id)wx.navigateTo({url:"../packet/packet?packet_id="+t.packet_id+"&shop_id="+t.shop_id});else{var a=o.getPath.packetCheckDistance,e={time_atitude:o.dataBase.userAtitude,shop_id:t.shop_id};s.ApiGateWayTest(a,e,!0,function(a){if(1==a.data.success){var e=o.getPath.createPacket,i={activity_red_packet_id:t.activity_red_packet_id,shop_id:t.shop_id};s.ApiGateWayTest(e,i,!0,function(a){1==a.data.success&&(t.setData({showCountModel:!1}),wx.navigateTo({url:"../packet/packet?packet_id="+a.data.result.activity_red_packet_bargaining_id+"&shop_id="+t.shop_id+"&packet_bargaining=true"}))})}else s.toast(a.data.msg)})}},makePhoneCall:function(){wx.makePhoneCall({phoneNumber:this.shopInfo.mobile})},gotoHome:function(){wx.switchTab({url:"/pages/index/index"})},getordernum:function(){var t=this,a=o.getPath.getordernum;s.ApiGateWayTest(a,"",!0,function(a){1==a.data.success&&(clearTimeout(),t.setData({ordernum:a.data.result,showCouponFlex:!0}),setTimeout(function(){t.setData({showCouponFlex:!1})},15e3))})},toShopCoupon:function(){this.setData({showCouponFlex:!1}),wx.navigateTo({url:"/packageA/takeout-coupon/takeout-coupon?entryType=external"})},hideCouponPopup:function(){this.setData({showCouponPopup:!1})},setData:function(t){var a=this,e=[];Object.keys(t).forEach(function(o){e=o.split("."),t[o],a.$data,e.forEach(function(e,s){a[o]=t[o]})})}}};a.default=n},d068:function(t,a,e){"use strict";e.r(a);var o=e("e3d7"),s=e("f68a");for(var i in s)"default"!==i&&function(t){e.d(a,t,function(){return s[t]})}(i);e("5f08");var n=e("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);a["default"]=r.exports},e3d7:function(t,a,e){"use strict";var o=function(){var t=this,a=t.$createElement;t._self._c;t._isMounted||(t.e0=function(a){a.stopPropagation(),t.item.in_cart_num},t.e1=function(a){t.btnDisplay})},s=[];e.d(a,"a",function(){return o}),e.d(a,"b",function(){return s})},f68a:function(t,a,e){"use strict";e.r(a);var o=e("b29b"),s=e.n(o);for(var i in o)"default"!==i&&function(t){e.d(a,t,function(){return o[t]})}(i);a["default"]=s.a}},[["dc19","common/runtime","common/vendor"]]]);