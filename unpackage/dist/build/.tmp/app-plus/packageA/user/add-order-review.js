(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/user/add-order-review"],{3011:function(e,t,o){"use strict";o.r(t);var n=o("6d01"),i=o("5b50");for(var a in i)"default"!==a&&function(e){o.d(t,e,function(){return i[e]})}(a);o("3879");var r=o("2877"),c=Object(r["a"])(i["default"],n["a"],n["b"],!1,null,null,null);t["default"]=c.exports},3879:function(e,t,o){"use strict";var n=o("6173"),i=o.n(n);i.a},"5b50":function(e,t,o){"use strict";o.r(t);var n=o("83cb"),i=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,function(){return n[e]})}(a);t["default"]=i.a},6173:function(e,t,o){},"6d01":function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return i})},"83cb":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=getApp().globalData,i=o("28c1"),a={data:function(){return{iconURL:n.dataBase.iconURL,toast:!0,commentsText:"",imgList:[],uploadImg:[],imgNowLength:0,countNum:0,order_id:"",orderReview:"",review:""}},components:{},props:{},onLoad:function(e){void 0!=e&&void 0!=e.order?(this.setData({order_id:e.order}),this.getReviewInfo()):i.toast("请求参数错误")},methods:{getReviewInfo:function(){var e=this,t=n.getPath.againCommentView,o={order_id:e.order_id};i.ApiGateWayTest(t,o,!0,function(t){if(1==t.data.success){var o=t.data.result,n=[],i=[];for(var a in o)n[a]={goods_id:o[a].goods_id,content:"",comment_id:o[a].comment.comment_id,img:[],checkedId:a},i[a]={goods_id:o[a].goods_id,goods_name:o[a].goods_name,comment_id:o[a].comment.comment_id,old_content:o[a].comment.content,comment_rank:o[a].comment.comment_rank,goods_img:o[a].img,review_img:o[a].comment.img,checkedId:a,uploadImg:[]};e.setData({orderReview:i,review:n})}})},add_comments:function(e){var t=e.detail.value,o=e.currentTarget.dataset.checkedId,n=this.orderReview;for(var i in n)o==n[i].checkedId&&(this.review[i].content=t)},touchSubmit:function(){var e=this,t=JSON.stringify(e.review),o=n.getPath.againComment,a={order_id:e.order_id,review:t};i.ApiGateWayTest(o,a,!0,function(e){1==e.data.success&&(i.toast(e.data.msg),setTimeout(function(){wx.navigateBack(1)},1500))})},updataimg:function(e){var t=this,o=e.currentTarget.dataset.checkedId,n=t.orderReview;for(var i in n)if(n[i].checkedId==o&&n[i].uploadImg.length<=3){var a=3-Number(n[i].uploadImg.length);t.chooseImg(i,a)}},chooseImg:function(e,t){var o=this;wx.chooseImage({count:t,success:function(t){o.orderReview[e].uploadImg=o.orderReview[e].uploadImg.concat(t.tempFilePaths),o.setData({orderReview:o.orderReview})}})},delUploadImg:function(e){var t=e.currentTarget.dataset.index,o=e.currentTarget.dataset.checkedId,n=this.orderReview;for(var i in n)n[i].checkedId==o&&n[i].uploadImg.splice(t,1);this.setData({orderReview:n})},submitImg:function(e,t){var o=this;for(var n in o.orderReview)if(o.review[n].content.length>0&&o.review[n].content.length<5)return void wx.showToast({title:"评论字数不能少于5个",icon:"none",duration:1e3});var i=o.orderReview,a="";a=t||0;var r=0;for(var n in i)for(var c=0;c<i[n].uploadImg.length;c++)r++;o.countNum=r,o.uploadImg(a).then(function(e){if(e<o.orderReview.length-1){var t=e+1;o.submitImg("",t)}else e==o.orderReview.length-1&&(wx.hideLoading(),o.touchSubmit())})},uploadImg:function(e){var t=this,o=t.orderReview[e].uploadImg,a={accept:"application/json","content-type":"multipart/form-data","x-application":"cilicili","x-platform":"wx","x-useragent":"host","x-ver":"v1.0"};return a["X-Authorization"]=i.getStorageSync("token"),new Promise(function(i,r){if(o.length<=0)i(e);else for(var c=0;c<o.length;c++){var d=o[c],u={path:"comment",img_type:1};wx.uploadFile({url:n.dataBase.uploadFile,filePath:d,name:"file",formData:u,header:a,success:function(o){o=JSON.parse(o.data);1==o.success&&(t.review[e].img.push(o.result.url),t.review[e].img.length==t.orderReview[e].uploadImg.length&&(t.setData({review:t.review}),i(e)))}}),t.setData({imgNowLength:t.imgNowLength+1}),wx.showLoading({title:t.imgNowLength+"/"+t.countNum,mask:!0})}})},setData:function(e){var t=this,o=[];Object.keys(e).forEach(function(n){o=n.split("."),e[n],t.$data,o.forEach(function(o,i){t[n]=e[n]})})}}};t.default=a}},[["f13a","common/runtime","common/vendor"]]]);