(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/user/order-review"],{"067f":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement;e._self._c},i=[];a.d(t,"a",function(){return r}),a.d(t,"b",function(){return i})},3597:function(e,t,a){"use strict";var r=a("b8ee"),i=a.n(r);i.a},"424d":function(e,t,a){"use strict";a.r(t);var r=a("067f"),i=a("d783");for(var o in i)"default"!==o&&function(e){a.d(t,e,function(){return i[e]})}(o);a("3597");var n=a("2877"),d=Object(n["a"])(i["default"],r["a"],r["b"],!1,null,null,null);t["default"]=d.exports},b8ee:function(e,t,a){},d783:function(e,t,a){"use strict";a.r(t);var r=a("eb10"),i=a.n(r);for(var o in r)"default"!==o&&function(e){a.d(t,e,function(){return r[e]})}(o);t["default"]=i.a},eb10:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=getApp().globalData,i=a("28c1"),o={data:function(){return{iconURL:r.dataBase.iconURL,checked:1,toast:!0,def_star:[],commentsText:"",imgList:[],uploadImg:[],index:0,countNum:0,imgNowLength:0,order_id:"",logistics:"",attitude:"",orderReview:"",lgoi_service:"",logi_star:"",atti_service:"",atti_star:""}},components:{},props:{},onLoad:function(e){if(void 0!=e&&void 0!=e.order){for(var t=[],a=0;a<5;a++)t[a]={id:a+1,img:r.dataBase.iconURL+"/light-star.png"};this.setData({order_id:e.order,def_star:t,logistics:t,attitude:t}),this.getOrderInfo()}else i.toast("请求参数错误")},methods:{getOrderInfo:function(){var e=this,t=r.getPath.orderDetail,a={order_id:e.order_id};i.ApiGateWayTest(t,a,!0,function(t){if(1==t.data.success){var a=t.data.result.products,r=[];for(var i in a)r[i]={goods_id:a[i].goods_id,rec_id:a[i].rec_id,attr_name:a[i].sku_key_name,content:"",img:[],comment_rank:1,itemImg:a[i].header_img,checkedId:i,uploadImg:[],anonymous:1};e.setData({orderReview:r})}})},isAnonymous:function(e){var t=this,a=e.currentTarget.dataset.idx,r=t.orderReview;1==r[a].anonymous?r[a].anonymous=0:r[a].anonymous=1,t.setData({orderReview:r})},setGrade:function(e){var t=this,a=e.currentTarget.dataset.init,r=e.currentTarget.dataset.checkedId,i=t.orderReview;for(var o in i)i[o].checkedId==r&&(i[o].comment_rank=a);t.setData({orderReview:i}),2!=a&&3!=a||setTimeout(function(){t.setData({toast:!1})},3e3)},logistics:function(e){var t=e.currentTarget.dataset.id,a=this.starFun(t);this.setData({logistics:a.data,lgoi_service:a.text,logi_star:t})},attitude:function(e){var t=e.currentTarget.dataset.id,a=this.starFun(t);this.setData({attitude:a.data,atti_service:a.text,atti_star:t})},starFun:function(e){var t=this.def_star,a=["不满意","一般","较满意","满意","非常满意"];for(var i in t)t[i].img=r.dataBase.iconURL+"/star.png";for(i=0;i<e;i++)t[i].img=r.dataBase.iconURL+"/light-star.png";return{data:t,text:a[e-1]}},comments:function(e){var t=e.detail.value,a=e.currentTarget.dataset.checkedId,r=this.orderReview;for(var i in r)a==r[i].checkedId&&(r[i].content=t);this.setData({orderReview:r})},touchSubmit:function(){var e=this,t=[],a=e.orderReview;for(var o in e.orderReview)t[o]={goods_id:a[o].goods_id,rec_id:a[o].rec_id,attr_name:a[o].attr_name,comment_rank:a[o].comment_rank,content:a[o].content,img:a[o].img};var n=JSON.stringify(t),d=r.getPath.addComment;a={order_id:e.order_id,review:n,shipping_rank:e.logi_star,service_rank:e.atti_star};i.ApiGateWayTest(d,a,!0,function(e){1==e.data.success&&(i.toast(e.data.msg),wx.navigateBack())})},updataimg:function(e){var t=this,a=e.currentTarget.dataset.checkedId,r=t.orderReview;for(var i in r)if(r[i].checkedId==a&&r[i].uploadImg.length<3){var o=3-Number(r[i].uploadImg.length);t.chooseImg(i,o)}},chooseImg:function(e,t){var a=this;wx.chooseImage({count:t,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){a.orderReview[e].uploadImg=a.orderReview[e].uploadImg.concat(t.tempFilePaths),a.setData({orderReview:a.orderReview})}})},delUploadImg:function(e){var t=e.currentTarget.dataset.index,a=e.currentTarget.dataset.checkedId,r=this.orderReview;for(var i in r)r[i].checkedId==a&&r[i].uploadImg.splice(t,1);this.setData({orderReview:r})},submitImg:function(e,t){var a=this;for(var r in a.orderReview)a.orderReview[r].content.replace(/(^\s*)|(\s*$)/g,"");var i=this.orderReview,o="";o=t||a.index;var n=0;for(var r in i)for(var d=0;d<i[r].uploadImg.length;d++)n++;a.countNum=n,this.uploadImg(o,function(e){if(e<a.orderReview.length-1){var t=e+1;a.submitImg("",t)}else e==a.orderReview.length-1&&(wx.hideLoading(),a.touchSubmit())})},uploadImg:function(e,t){var a=this,o=a.orderReview[e].uploadImg,n={accept:"application/json","content-type":"multipart/form-data","x-application":"cilicili","x-platform":"wx","x-useragent":"host","x-ver":"v1.0"};n["X-Authorization"]=i.getStorageSync("token");var d={path:"comment",img_type:1};if(o.length<=0)t(e);else for(var s=0;s<o.length;s++){var c=o[s];wx.uploadFile({url:r.dataBase.uploadFile,filePath:c,name:"file",formData:d,header:n,success:function(r){r=JSON.parse(r.data);1==r.success&&(a.orderReview[e].img.push(r.result.url),"function"===typeof t&&a.orderReview[e].img.length==a.orderReview[e].uploadImg.length&&(a.setData({orderReview:a.orderReview}),t(e)))}}),a.setData({imgNowLength:a.imgNowLength+1}),i.showLoad(a.imgNowLength+"/"+a.countNum)}},setData:function(e){var t=this,a=[];Object.keys(e).forEach(function(r){a=r.split("."),e[r],t.$data,a.forEach(function(a,i){t[r]=e[r]})})}}};t.default=o}},[["618e","common/runtime","common/vendor"]]]);