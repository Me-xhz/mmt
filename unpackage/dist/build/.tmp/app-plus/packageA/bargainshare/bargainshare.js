(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/bargainshare/bargainshare"],{"7bea":function(t,a,e){"use strict";e.r(a);var i=e("b41e"),n=e.n(i);for(var r in i)"default"!==r&&function(t){e.d(a,t,function(){return i[t]})}(r);a["default"]=n.a},b41e:function(t,a,e){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i=getApp().globalData,n=e("28c1"),r=(e("b6a1"),{data:function(){return{bargainData:"",iconURL:i.dataBase.iconURL,helpPriceMoudle:!1,bargaining_id:0,d:"00",h:"00",m:"00",s:"00",rankList:[],page:1,page_size:20,bargainStutar:"",rule:{},bargainByFriendInfo:{},showRules:!0,iphoneXBottom:"0rpx",range_price:0,shareMoudle:!1,selfInfo:{},showCountMode:!1,takeoutAnimation:!1,duration:500,interval:5e3,indexAdcurrent:0,indicatorColor:"#fff",indicatorActiveColor:"#eb3c39",circular:!0,autoplay:!1,adList:[],indicatorDots:!1,entryData:""}},components:{},props:{},onLoad:function(t){var a=this;a.getAd(),a.bargaining_id=t.bargaining_id,t.self_info&&""!=t.self_info&&a.setData({selfInfo:JSON.parse(t.self_info),shareMoudle:!0}),a.setData({entryData:t});t=a.entryData;var e=n.getStorageSync("getpickup");t&&(t.atitude||t.pickup_id)&&!e&&a.getExternal(t.pickup_id).then(function(){i.firstlaunchApp=!1,a.entryData={},n.setStorageSync("authSetting",{"scope.userLocation":!0})}),wx.getSystemInfo({success:function(t){var e=t.model;-1!=e.search("iPhone X")&&a.setData({iphoneXBottom:"68rpx"})}})},onShow:function(){var t=this;t.getBargainingInfo()},onShareAppMessage:function(){var t=this,a=n.getStorageSync("getpickup");return{title:t.bargainData.share_title,path:"/packageA/bargainshare/bargainshare?bargaining_id="+t.bargaining_id+"&pickup_id="+a.pickup_id,imageUrl:t.bargainData.share_img}},methods:{getExternal:function(t){var a=i.getPath.getpickup,e={pickup_id:t};return new Promise(function(t,i){n.ApiGateWayTest(a,e,!0,function(a){if(a&&a.data&&1==a.data.success){a=a.data.result.cities.pick_up;n.setStorage({key:"getpickup",data:{pickup_id:a.pickup_id,cityName:a.pickup_name,pickup_address:a.pickup_address,pickup_contact:a.pickup_contact,pickup_phone:a.pickup_phone,pickup_type:a.pickup_type}},function(a){t("获取id成功")}),n.setStorage({key:"city",data:{pickup_id:a.pickup_id,warehouse_id:a.warehouse_id,cityName:a.city_name,is_pick_up:1}})}})})},getAd:function(){var t=this,a=i.getPath.adlist,e={pid:10};return new Promise(function(i,r){n.ApiGateWayTest(a,e,!0,function(a){if(a&&a.data&&1==a.data.success){var e=a.data.result;e.length>1?t.setData({indicatorDots:!0}):t.setData({indicatorDots:!1}),t.setData({adList:e,indexAdcurrent:0,indicatorDots:e.length>1}),i("successAd")}})})},adclose:function(t,a){var e=i.getPath.adclose,r={ad_id:t,is_close:a};n.ApiGateWayTest(e,r,!0,function(t){})},goWebView:function(t){n.goAdWebView(t)},getBargainingInfo:function(){var t=this,a=i.getPath.bargainInfo,e={activity_bargaining_id:t.bargaining_id};n.ApiGateWayTest(a,e,!0,function(a){var e=a.data;if(1==e.success&&e.result.activity_bargaining_id){var i="";if(1==e.result.is_self&&0==e.result.status)i="商品抢完后未能砍成即视为砍价失败";else if(1==e.result.is_self&&2==e.result.status)i="砍价超时，失败了";else if(1==e.result.is_self&&1==e.result.status)i="砍价成功，请在倒计时结束前购买";else if(1==e.result.is_self&&3==e.result.status)i="砍价已完成";else if(1==e.result.is_self&&4==e.result.status)i="支付已过期";t.setData({bargainData:e.result,bargaining_id:e.result.activity_bargaining_id,bargainStutar:i,range_price:(Number(e.result.activity_price)-Number(e.result.floor_price)).toFixed(2)}),t.getRank(),t.getTeamRule(),t.getIsShowShopCouponAd();var n=(new Date).getTime()/1e3;e.result.end_time>n&&t.countDown(e.result.end_time)}})},getBargainByFriend:function(){var t=this,a=i.getPath.bargainByFriend,e=i.getPath.checkDistance,r={activity_bargaining_id:t.bargaining_id},s={activity_bargaining_id:t.bargaining_id?t.bargaining_id:0,time_atitude:i.dataBase.userAtitude};n.ApiGateWayTest(e,s,!0,function(e){1==e.data.success?n.ApiGateWayTest(a,r,!0,function(a){var e=a.data;1==e.success?(t.setData({bargainByFriendInfo:e.result,helpPriceMoudle:!0}),t.getBargainingInfo()):n.toast(e.msg)}):n.toast(e.data.msg)})},hideHelpPriceMoudle:function(t){var a=this;n.formIdUpdate(t),a.setData({helpPriceMoudle:!1})},shareFromId:function(t){var a=this;n.formIdUpdate(t),n.showLoad(this),setTimeout(function(){n.hideLoad(a),a.setData({shareMoudle:!1})},2e3)},getRank:function(){var t=this,a=i.getPath.bargainList,e={page:t.page,page_size:t.page_size,activity_bargaining_id:t.bargaining_id};n.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==e.success&&t.setData({rankList:e.result})})},countDown:function(t){var a=this,e=(new Date).getTime()/1e3,i=t-e;clearInterval(a.timeStart),a.timeStart=setInterval(function(){if(i>0){i--;var t=parseInt(i/60/60/24),e=parseInt(i/60/60%24)+24*t,n=parseInt(i/60%60),r=parseInt(i%60);e<10&&(e="0"+e),n<10&&(n="0"+n),r<10&&(r="0"+r),a.setData({h:e,m:n,s:r})}else clearInterval(a.timeStart),a.getBargainingInfo()},1e3)},showRule:function(t){var a=this;n.formIdUpdate(t),this.setData({showRules:!a.showRules})},closeModal:function(){var t=this;t.setData({shareMoudle:!1})},getTeamRule:function(){var t=this,a=i.getPath.bargainRule,e={activity_bargain_id:t.bargainData.activity_bargain_id};n.ApiGateWayTest(a,e,!0,function(a){t.setData({rule:a.data.result.rule})})},onShare:function(t){n.formIdUpdate(t)},launchBar:function(t){var a=this;n.formIdUpdate(t);n.getStorageSync("getpickup");wx.navigateTo({url:"../bargain/bargain?activity_bargain_id="+a.bargainData.activity_bargain_id+"&entryType=external"})},goPay:function(t){n.formIdUpdate(t)},gotoHome:function(){wx.switchTab({url:"/pages/index/index"})},getIsShowShopCouponAd:function(){var t=this,a=i.getPath.isShowShopCouponAd,e={type:1};n.ApiGateWayTest(a,e,!0,function(a){var e=a.data;1==e.success?1==e.result.status?(t.shop_id=e.result.shop_id,t.setData({showCountMode:!0})):t.setData({showCountMode:!1}):n.toast(e.msg)})},goTakeoutShop:function(){var t=this;wx.navigateTo({url:"/packageA/takeout-shop/takeout-shop?entryType=external&shop_id="+t.shop_id})},onPageScroll:function(){var a=this;console.log(t(this.takeoutAnimation," at packageA\\bargainshare\\bargainshare.vue:790")),this.takeoutAnimation?(clearTimeout(this.scroll),this.scroll=setTimeout(function(){a.takeoutAnimation&&a.setData({takeoutAnimation:!1})},1e3)):this.setData({takeoutAnimation:!0})},setData:function(t){var a=this,e=[];Object.keys(t).forEach(function(i){e=i.split("."),t[i],a.$data,e.forEach(function(e,n){a[i]=t[i]})})}}});a.default=r}).call(this,e("0de9")["default"])},c9b6:function(t,a,e){"use strict";var i=e("f281"),n=e.n(i);n.a},d0ad:function(t,a,e){"use strict";e.r(a);var i=e("f017"),n=e("7bea");for(var r in n)"default"!==r&&function(t){e.d(a,t,function(){return n[t]})}(r);e("c9b6");var s=e("2877"),o=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);a["default"]=o.exports},f017:function(t,a,e){"use strict";var i=function(){var t=this,a=t.$createElement;t._self._c},n=[];e.d(a,"a",function(){return i}),e.d(a,"b",function(){return n})},f281:function(t,a,e){}},[["037e","common/runtime","common/vendor"]]]);