(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageA/packet/packet"],{"74c4":function(t,e,a){"use strict";a.r(e);var i=a("b06f"),s=a("f980");for(var c in s)"default"!==c&&function(t){a.d(e,t,function(){return s[t]})}(c);a("b963");var o=a("2877"),n=Object(o["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=n.exports},"76ac":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=getApp().globalData,s=a("28c1"),c=(a("b6a1"),function(){return a.e("components/countDown/countDown").then(a.bind(null,"513f"))}),o={data:function(){return{isShowGoHome:!1,iconURL:i.dataBase.iconURL,helpPriceMoudle:!1,packet_id:"",shop_id:0,packet_msg:{},help_packet:{},packet_list:[],packet_rule:{},showRules:!0,activity_red_packet_id:"",coupon_msg:{},isShowHelpModal:!1,pickup_id:"",showBargain:!1,showHelp:!1,showNotHelp:!1,showTimeEnd:!1,activityEnd:!1,showSelfShare:!1,entryData:""}},components:{countdown:c},props:{},onLoad:function(t){var e=this;e.packet_id=t.packet_id,e.shop_id=t.shop_id,t.packet_bargaining&&e.setData({showSelfShare:!0,isShowHelpModal:!0}),t&&t.entryType&&"external"==t.entryType?this.setData({isShowGoHome:!1}):this.setData({isShowGoHome:!0}),e.setData({entryData:t});t=e.entryData;var a=s.getStorageSync("getpickup");e.pickup_id=a.pickup_id,t&&(t.atitude||t.pickup_id)&&!a&&e.getExternal(t.pickup_id).then(function(){i.firstlaunchApp=!1,e.entryData={},s.setStorageSync("authSetting",{"scope.userLocation":!0})})},onShow:function(){this.getPacketMsg()},onShareAppMessage:function(){var t=this;s.getStorageSync("getpickup");return t.showSelfShare&&setTimeout(function(){t.setData({showSelfShare:!1,isShowHelpModal:!1})},2e3),{title:t.packet_msg.share_title,path:"/packageA/packet/packet?packet_id="+t.packet_id+"&shop_id="+t.shop_id+"&pickup_id="+t.pickup_id,imageUrl:t.packet_msg.share_img}},methods:{getExternal:function(t){var e=i.getPath.getpickup,a={pickup_id:t};return new Promise(function(t,i){s.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){e=e.data.result.cities.pick_up;s.setStorage({key:"getpickup",data:{pickup_id:e.pickup_id,cityName:e.pickup_name,pickup_address:e.pickup_address,pickup_contact:e.pickup_contact,pickup_phone:e.pickup_phone,pickup_type:e.pickup_type}},function(e){t("获取id成功")}),s.setStorage({key:"city",data:{pickup_id:e.pickup_id,warehouse_id:e.warehouse_id,cityName:e.city_name,is_pick_up:1}})}})})},gotoHome:function(t){s.formIdUpdate(t),wx.switchTab({url:"/pages/index/index"})},showModal:function(t){var e=this;s.formIdUpdate(t),1==e.packet_msg.is_max?e.getCoupon():wx.showModal({content:"您可以继续分享达到最高红包金额，是否确认立即兑换!",success:function(t){t.confirm&&e.getCoupon()}})},onShare:function(t){s.formIdUpdate(t)},getPacketMsg:function(){var t=this,e=i.getPath.packetMsg,a={activity_red_packet_bargaining_id:t.packet_id};s.ApiGateWayTest(e,a,!0,function(e){e=e.data;if(1==e.success){if(0==e.result.activity_status){if(1==e.result.status||2==e.result.status)return void t.setData({activityEnd:!0,isShowHelpModal:!0})}else 2==e.result.status&&0==e.result.is_self?t.setData({showTimeEnd:!0,isShowHelpModal:!0}):0==e.result.is_can_help&&1==e.result.is_can_sponsor&&0==e.result.is_in_activity?t.setData({showHelp:!0,isShowHelpModal:!0}):0!=e.result.is_can_help||0!=e.result.is_can_sponsor&&1!=e.result.is_in_activity||t.setData({showNotHelp:!0,isShowHelpModal:!0});t.activity_red_packet_id=e.result.activity_red_packet_id,t.setData({packet_msg:e.result}),t.getPacketRule(),t.getPacketList()}else s.toast(e.msg)})},helpGetPcket:function(t){var e=this;s.formIdUpdate(t);var a=i.getPath.packetCheckDistance,c={time_atitude:i.dataBase.userAtitude,shop_id:e.shop_id};s.ApiGateWayTest(a,c,!0,function(t){if(1==t.data.success){var a=i.getPath.packetHelp,c={activity_red_packet_bargaining_id:e.packet_id};s.ApiGateWayTest(a,c,!0,function(t){t=t.data;1==t.success?0==e.packet_msg.status&&1==t.result.is_can_help&&e.setData({help_packet:t.result,isShowHelpModal:!0,showBargain:!0}):s.toast(t.msg)})}else s.toast(t.data.msg)})},getPacketList:function(){var t=this,e=i.getPath.packetList,a={activity_red_packet_bargaining_id:t.packet_id};s.ApiGateWayTest(e,a,!0,function(e){e=e.data;1==e.success&&t.setData({packet_list:e.result})})},getPacketRule:function(){var t=this,e=i.getPath.packetRule,a={activity_red_packet_id:t.activity_red_packet_id};s.ApiGateWayTest(e,a,!0,function(e){e=e.data;1==e.success&&t.setData({packet_rule:e.result.rule})})},showRule:function(){var t=this;this.setData({showRules:!t.showRules})},toCreatePacket:function(t){var e=this;s.formIdUpdate(t);var a=i.getPath.packetCheckDistance,c={time_atitude:i.dataBase.userAtitude,shop_id:e.shop_id};s.ApiGateWayTest(a,c,!0,function(t){if(1==t.data.success){var a=i.getPath.createPacket,c={activity_red_packet_id:e.activity_red_packet_id,shop_id:e.shop_id};s.ApiGateWayTest(a,c,!0,function(t){1==t.data.success?wx.navigateTo({url:"../packet/packet?packet_id="+t.data.result.activity_red_packet_bargaining_id+"&shop_id="+e.shop_id+"&packet_bargaining=true"}):s.toast(t.data.msg)})}else s.toast(t.data.msg)})},goShop:function(t){var e=this;s.formIdUpdate(t),wx.navigateTo({url:"/packageA/takeout-shop/takeout-shop?shop_id="+e.shop_id})},getCoupon:function(){var t=this,e=i.getPath.getPcketCoupon,a={activity_red_packet_bargaining_id:t.packet_id};s.ApiGateWayTest(e,a,!0,function(e){1==e.data.success?0==e.data.result.data.state?(t.setData({coupon_msg:e.data.result.data.userCouponInfo}),t.getPacketMsg()):s.toast(e.data.result.data.state_desc):s.toast(e.msg)})},closeModal:function(){this.setData({isShowHelpModal:!1}),this.getPacketMsg()},setData:function(t){var e=this,a=[];Object.keys(t).forEach(function(i){a=i.split("."),t[i],e.$data,a.forEach(function(a,s){e[i]=t[i]})})}}};e.default=o},b06f:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){e.stopPropagation(),!t.activityEnd||t.showSelfShare})},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})},b963:function(t,e,a){"use strict";var i=a("d224"),s=a.n(i);s.a},d224:function(t,e,a){},f980:function(t,e,a){"use strict";a.r(e);var i=a("76ac"),s=a.n(i);for(var c in i)"default"!==c&&function(t){a.d(e,t,function(){return i[t]})}(c);e["default"]=s.a}},[["1da7","common/runtime","common/vendor"]]]);