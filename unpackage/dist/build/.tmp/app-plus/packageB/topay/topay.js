(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageB/topay/topay"],{"0085":function(t,e,i){},2948:function(t,e,i){"use strict";i.r(e);var a=i("a73f"),n=i.n(a);for(var c in a)"default"!==c&&function(t){i.d(e,t,function(){return a[t]})}(c);e["default"]=n.a},"49b1":function(t,e,i){"use strict";i.r(e);var a=i("aeae"),n=i("2948");for(var c in n)"default"!==c&&function(t){i.d(e,t,function(){return n[t]})}(c);i("5057");var o=i("2877"),s=Object(o["a"])(n["default"],a["a"],a["b"],!1,null,null,null);e["default"]=s.exports},5057:function(t,e,i){"use strict";var a=i("0085"),n=i.n(a);n.a},a73f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=getApp().globalData,n=i("28c1"),c=(i("b6a1"),{data:function(){return{focus:!0,price:"",now_price:"",check_price:!1,show_price:!1,disabled:!1,discount:1,priceMaxLength:9,show_discount:!0,animationView:"",entryData:""}},components:{},props:{},onShow:function(){this.getDiscount()},onLoad:function(t){var e=this;this.setData({entryData:t});t=e.entryData;var i=n.getStorageSync("getpickup");t&&(t.atitude||t.pickup_id)&&!i&&e.getExternal(t.pickup_id).then(function(){a.firstlaunchApp=!1,e.entryData={},n.setStorageSync("authSetting",{"scope.userLocation":!0})})},methods:{bindPriceFocus:function(t){var e=wx.createAnimation({duration:150,timingFunction:"ease",delay:0});e.translateY(-30).step(),this.setData({animationView:e.export()})},bindPriceBlur:function(t){var e=wx.createAnimation({duration:150,timingFunction:"ease",delay:0});e.translateY(0).step(),this.setData({animationView:e.export()})},bindPriceInput:function(t){var e=t.detail.value;if(void 0!==e.toString().split(".")[1]&&(e.toString().split(".")[1].length>2?this.setData({price:this.price}):this.setData({price:e})),t.detail.value>=0){if(""===t.detail.value)return void this.setData({show_price:!1,check_price:!1});this.setData({check_price:!0,show_price:!0,now_price:Math.floor(e*this.discount*100)/100})}else this.setData({price:"",check_price:!1,show_price:!1})},getDiscount:function(){var t=this,e=a.getPath.shopPayDiscount,i=n.getStorageSync("getpickup"),c={pickup_id:i.pickup_id};n.ApiGateWayTest(e,c,!0,function(e){var i=e;1===i.success&&(100===i.result.discount&&t.setData({show_discount:!1}),t.setData({discount:i.result.discount/100}))})},toPay:function(t){var e=this,i=t.currentTarget.dataset.payprice;if(0!=e.check_price)if(0==i)wx.showToast({title:"请输入正确金额",icon:"none"});else{n.showLoad("正在为您跳转支付");var c=a.getPath.toPayShopOrder,o={order_amount:100*e.now_price};n.ApiGateWayTest(c,o,!0,function(t){var i=t.data;if(1===i.success){var c=i.result.order_id,o=a.getPath.doPay,s={order_id:c,order_type:1};n.ApiGateWayTest(o,s,!0,function(t){if(wx.hideLoading(),1!==t.data.success)return n.toast(t.data.msg),void(e.isTopaydis=!1);var i=t.data.result;n.doWechatPay(i,function(){var t=a.getPath.checkPay;n.ApiGateWayTest(t,s,!0,function(t){1===t.data.success?(wx.showToast({title:"支付成功",icon:"none"}),this.setData({price:"",check_price:!1,show_price:!1})):wx.showToast({title:"支付失败",icon:"none"})})},function(t){wx.hideLoading(),wx.showToast({title:"取消支付",icon:"none"})})})}}),setTimeout(function(){return wx.hideLoading()},1e3)}},getExternal:function(t){var e=a.getPath.getpickup,i={pickup_id:t};return new Promise(function(t,a){n.ApiGateWayTest(e,i,!0,function(e){if(e&&e.data&&1==e.data.success){e=e.data.result.cities.pick_up;n.setStorage({key:"getpickup",data:{pickup_id:e.pickup_id,cityName:e.pickup_name,pickup_address:e.pickup_address,pickup_contact:e.pickup_contact,pickup_phone:e.pickup_phone,pickup_type:e.pickup_type}},function(e){t("获取id成功")}),n.setStorage({key:"city",data:{pickup_id:e.pickup_id,warehouse_id:e.warehouse_id,cityName:e.city_name,is_pick_up:1}})}})})},setData:function(t){var e=this,i=[];Object.keys(t).forEach(function(a){i=a.split("."),t[a],e.$data,i.forEach(function(i,n){e[a]=t[a]})})}}});e.default=c},aeae:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},n=[];i.d(e,"a",function(){return a}),i.d(e,"b",function(){return n})}},[["80d3","common/runtime","common/vendor"]]]);