(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/confirm/confirm"],{"1cfe":function(e,t,o){"use strict";o.r(t);var i=o("335f"),a=o("4314");for(var n in a)"default"!==n&&function(e){o.d(t,e,function(){return a[e]})}(n);o("e4be");var s=o("2877"),d=Object(s["a"])(a["default"],i["a"],i["b"],!1,null,null,null);t["default"]=d.exports},"335f":function(e,t,o){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c},a=[];o.d(t,"a",function(){return i}),o.d(t,"b",function(){return a})},4314:function(e,t,o){"use strict";o.r(t);var i=o("c04f"),a=o.n(i);for(var n in i)"default"!==n&&function(e){o.d(t,e,function(){return i[e]})}(n);t["default"]=a.a},5771:function(e,t,o){},c04f:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=getApp().globalData,a=o("28c1"),n={data:function(){return{iconURL:i.dataBase.iconURL,showDialog:!1,order_confirm_show:!1,selectedGoods:{},consignee:{consignee:""},consignee2:{},isTopaydis:!1,productInfo:{},order_info:{firstGoods:[],secondGoods:[]},orderSn:"",invoiceData:{},cashgift:{},canPurchase:!1,showBonusModal:!1,showGetBonusModal:!1,tip_show:{tip1:!0,tip2:!0},storageAddr:!1,isEditAddr:!1,bounsList:[],cashgifts:[],noCashgifts:[],order_product:"",coupon_id:void 0,animationData:"",user_note:""}},components:{},props:{},onLoad:function(e){var t=this;if(this.checkUser(),this.getPreData(),e.index){var o=a.getStorageSync("edit")[e.index];t.consignee=o}else this.getaddresslist();Promise.all([this.getOrderCouponList(),this.getBounsList()]).then(function(e){t.getcheckOrderinfo()})},onShow:function(){var e=a.getStorageSync("nowPay");void 0!=e&&""!=e||a.toast("请求参数错误")},methods:{goMap:function(e){var t=e.currentTarget.dataset.url,o=e.currentTarget.dataset.pickup_img;a.setStorage({key:"pickup_img",data:o},function(e){wx.navigateTo({url:t})})},checkUser:function(){var e=i.getPath.checkUser;a.ApiGateWayTest(e,"",!0,function(e){1!=e.data.success&&wx.showModal({title:"用户禁用下单提示",content:e.data.msg,confirmText:"确定",confirmColor:"#eb3c39",showCancel:!1,cancelColor:"#030303",success:function(e){e.confirm&&wx.navigateBack({delta:1})}})})},isShow:function(e){var t=e.currentTarget.dataset.name,o=this.tip_show;o[t]=!1,this.setData({tip_show:o})},getPreData:function(){var e=this,t=a.getStorageSync("nowPay"),o=[];for(var i in t)o.push({goods_id:t[i].goods_id,sku_key:t[i].sku_key,num:t[i].amount});o=JSON.stringify(o),e.setData({productInfo:t,order_product:o,"order_info.firstGoods":t}),this.cartBuyCheck()},getaddresslist:function(){var e=this,t=i.getPath.getaddresslist,o={is_default:"1"};return new Promise(function(i,n){a.ApiGateWayTest(t,o,!0,function(t){if(200==t.statusCode){t=t.data.result.consignees;e.consignee=t[0],i("getAddress success")}})})},addAddress:function(e){var t=this,o=/^[0-9]{11}$/;if(void 0!=t.consignee.consignee&&""!=t.consignee.consignee)if(o.test(this.consignee.mobile)){var n=i.getPath.addaddress,s={consignee:t.consignee.consignee,mobile:t.consignee.mobile,pickup_id:t.consignee.pickup_id,is_default:1};a.ApiGateWayTest(n,s,!0,function(o){if(o&&1==o.data.success){o=o.data.result;t.setData({consignee:o.consignees}),e&&"function"===typeof e&&e()}})}else a.toast("请输入正确的手机号");else a.toast("请输入提货人姓名")},editAddress:function(e){var t=this,o=/^[0-9]{11}$/;if(void 0!=t.consignee.consignee&&""!=t.consignee.consignee)if(o.test(this.consignee.mobile)){t.isEditAddr=!1;var n=i.getPath.alteraddress,s={consignee:t.consignee.consignee,mobile:t.consignee.mobile,address_id:t.consignee.address_id,pickup_id:t.consignee.pickup_id,is_default:t.consignee.is_default};a.ApiGateWayTest(n,s,!0,function(t){if(t&&1==t.data.success){t=t.data.result;e&&"function"===typeof e&&e()}})}else a.toast("请输入正确的手机号");else a.toast("请输入提货人姓名")},editInput:function(e){var t=e.target.dataset.keyname,o=e.detail.value,i=this.consignee;i[t]=o,this.isEditAddr=!0,this.setData({consignee:i})},getcheckOrderinfo:function(){var e=this,t=(a.getStorageSync("city"),i.getPath.checkOrderInfo);void 0==e.coupon_id&&(e.coupon_id=0),void 0==e.selectedGoods.use_balance&&(e.selectedGoods.use_balance=1),void 0==e.consignee.address_id&&(e.consignee.address_id=0);var o={coupon_id:e.coupon_id,address_id:e.consignee.address_id,use_balance:e.selectedGoods.use_balance,order_product:e.order_product,team_order:e.productInfo[0].team_order?e.productInfo[0].team_order:0,channel:e.productInfo[0].channel?e.productInfo[0].channel:0,team_id:e.productInfo[0].team_id?e.productInfo[0].team_id:0,found_id:e.productInfo[0].found_id?e.productInfo[0].found_id:"",activity_bargaining_id:e.productInfo[0].activity_bargaining_id?e.productInfo[0].activity_bargaining_id:"",activity_bargain_id:e.productInfo[0].activity_bargain_id?e.productInfo[0].activity_bargain_id:""};return new Promise(function(i,n){a.ApiGateWayTest(t,o,!0,function(t){if(200==t.statusCode){t=t.data.result;e.setData({selectedGoods:t,cashgift:t.coupon_info,coupon_id:t.coupon_info.id,order_info:t.order_info})}var o=!0,a=e.order_info;a.firstGoods.forEach(function(e){1!=e.is_disable&&0!=e.is_enough&&0!=e.is_on_sale||(o=!1)}),a.secondGoods.forEach(function(e){1!=e.is_disable&&0!=e.is_enough&&0!=e.is_on_sale||(o=!1)}),o?e.setData({canPurchase:!0}):(e.setData({canPurchase:!1}),wx.showModal({content:"商品被抢光咯，小提正在补货中喔~",showCancel:!1,confirmText:"取消",confirmColor:"#575757"})),i("getcheckOrderinfo success")})})},touchAddress:function(){wx.navigateTo({url:"/pages/address/addressList/addressList?from=confirm&&switch=1"})},newAddress:function(){wx.navigateTo({url:"/pages/address/address"})},touchCashgift:function(e){var t=this,o=e.currentTarget.dataset.id;if(t.coupon_id==o)return t.setModalBonus(),!1;t.coupon_id=o,t.getcheckOrderinfo(),t.setModalBonus()},getOrderCouponList:function(){var e=this,t=i.getPath.ordercouponList,o={order_product:e.order_product,team_order:e.productInfo[0].team_order?e.productInfo[0].team_order:0,team_id:e.productInfo[0].team_id?e.productInfo[0].team_id:0,activity_bargaining_id:e.productInfo[0].activity_bargaining_id?e.productInfo[0].activity_bargaining_id:""};return new Promise(function(i,n){a.ApiGateWayTest(t,o,!0,function(t){if(1!=t.data.errorCode){t=t.data.result;e.setData({cashgifts:t.lists,noCashgifts:t.no_lists}),i("getOrderCouponList")}else a.toast(t.data.msg)})})},getBounsList:function(){var e=this,t=i.getPath.canGetCouponList,o={order_product:e.order_product,team_order:e.productInfo[0].team_order?e.productInfo[0].team_order:0,team_id:e.productInfo[0].team_id?e.productInfo[0].team_id:0,activity_bargaining_id:e.productInfo[0].activity_bargaining_id?e.productInfo[0].activity_bargaining_id:""};return new Promise(function(i,n){a.ApiGateWayTest(t,o,!0,function(t){if(1!=t.data.errorCode){t=t.data.result;e.setData({bounsList:t.lists}),i("getBounsList")}else a.toast(t.data.msg)})})},getBouns:function(e){var t=this,o=e.currentTarget.dataset.id,n=i.getPath.addCoupon,s={coupon_id:o};a.ApiGateWayTest(n,s,!0,function(e){var o=e.data;1==o.success?(t.getBounsList(),t.getOrderCouponList(),a.toast(o.result.state_desc)):a.toast(o.result.state_desc)})},onSetBouns:function(){var e=this;e.coupon_id=0,e.getModalBonus(),e.getcheckOrderinfo(),e.getOrderCouponList()},getExternal:function(e){var t=i.getPath.getpickup,o={pickup_id:e};return new Promise(function(e,i){a.ApiGateWayTest(t,o,!0,function(t){if(t&&t.data&&1==t.data.success){t=t.data.result.cities.pick_up;a.setStorage({key:"city",data:{pickup_id:t.pickup_id,warehouse_id:t.warehouse_id,cityName:t.city_name,is_pick_up:1}}),a.setStorage({key:"getpickup",data:{pickup_id:t.pickup_id,cityName:t.pickup_name,pickup_address:t.pickup_address,pickup_contact:t.pickup_contact,pickup_phone:t.pickup_phone,pickup_type:t.pickup_type}},function(t){e("获取id成功")})}})})},setModalBonus:function(){0==this.showBonusModal?this.showBonusModal=1:this.showBonusModal=0;var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),1==this.showBonusModal&&this.setData({showBonusModal:!0}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==this.showBonusModal&&this.setData({showBonusModal:!1})}.bind(this),200)},refreshOrderPrice:function(){},getModalBonus:function(){0==this.showGetBonusModal?this.showGetBonusModal=1:this.showGetBonusModal=0;var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),1==this.showGetBonusModal&&this.setData({showGetBonusModal:!0,showBonusModal:!1}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==this.showGetBonusModal&&this.setData({showGetBonusModal:!1})}.bind(this),200)},use_balance:function(){var e=this,t=this.selectedGoods;1==t.use_balance?t.use_balance=0:t.use_balance=1,e.setData({selectedGoods:t}),e.getcheckOrderinfo()},refreshComment:function(e){var t=e.detail.value;this.setData({user_note:t})},cartBuyCheck:function(e){var t=this,o=i.getPath.cartBuyCheck,n={order_product:t.order_product};a.ApiGateWayTest(o,n,!0,function(e){1==e.data.success&&1==e.data.result.state&&wx.showModal({title:"",content:e.data.result.msg,showCancel:!1,confirmText:"确认",confirmColor:"#eb3c39",success:function(e){e.confirm&&wx.navigateBack({delta:1})}})})},showConfirm:function(e){var t=this;a.getStorage({key:"getpickup"},function(o){if(o.data.pickup_id&&o.data.pickup_id>0){var i=/^[0-9]{11}$/;if(void 0==t.consignee.consignee||""==t.consignee.consignee)return void a.toast("请输入提货人姓名");if(!i.test(t.consignee.mobile))return void a.toast("请输入正确的手机号");t.beforeSubmit()}else t.touchSubmit(e)})},hideConfirm:function(e){a.formIdUpdate(e),this.setData({order_confirm_show:!1})},beforeSubmit:function(t){var o=this;this.storageAddr?(o.setData({order_confirm_show:!0}),o.addAddress(function(){console.log(e(6666666666666," at pages\\confirm\\confirm.vue:1077")),o.getaddresslist()})):1==this.isEditAddr?o.editAddress(function(){o.setData({order_confirm_show:!0})}):o.setData({order_confirm_show:!0})},touchSubmit:function(e){var t=this,o=t.productInfo,n=i.getPath.confirmOrder,s=i.getPath.confirmCartOrder;if(t.consignee&&!t.consignee.address_id){var d="您还未设置收货地址",r="去设置";a.showModal(d,r,function(e){e.confirm&&t.newAddress()})}else{a.showLoad(t),0==t.selectedGoods.coupons_can_use&&(t.coupon_id=-1);var c={coupon_id:t.coupon_id,address_id:t.consignee.address_id,cart_ids:[],payment_code:t.selectedGoods.payment_code[0],user_note:void 0==t.user_note?"":t.user_note,use_balance:t.selectedGoods.use_balance,time_atitude:i.dataBase.userAtitude,team_order:o[0].team_order?o[0].team_order:0,channel:o[0].channel?o[0].channel:0,team_id:o[0].team_id?o[0].team_id:0,found_id:o[0].found_id?o[0].found_id:"",activity_bargaining_id:o[0].activity_bargaining_id?o[0].activity_bargaining_id:"",activity_bargain_id:o[0].activity_bargain_id?o[0].activity_bargain_id:""};for(var u in o)o[u].cart_id&&o[u].cart_id>0&&c.cart_ids.push(o[u].cart_id);if(a.formIdUpdate(e),!t.isTopaydis)if(t.isTopaydis=!0,c.cart_ids&&c.cart_ids.length>0)if(""==t.orderSn)a.ApiGateWayTest(s,c,!0,function(e){if(1!=e.data.success)return a.toast(e.data.msg),void(t.isTopaydis=!1);e=e.data.result;t.orderSn=e.order_id;var o=i.getPath.doPay,n={order_id:e.order_id,payment_code:t.selectedGoods.payment_code[0]};if(t.isTopaydis=!1,1==e.status){for(var s in a.hideLoad(t),t.order_info.firstGoods);for(var s in t.order_info.secondGoods);wx.redirectTo({url:"./paymentStatus/paymentStatus?order_id="+n.order_id+"&consignee="+JSON.stringify(t.consignee)+"&payment_code="+n.payment_code})}else a.hideLoad(t),a.ApiGateWayTest(o,n,!0,function(e){if(1!=e.data.success)return a.toast(e.data.msg),void(t.isTopaydis=!1);var o=e.data.result;a.doWechatPay(o,function(e){for(var o in t.order_info.firstGoods);for(var o in t.order_info.secondGoods);},function(e){for(var o in t.order_info.firstGoods);for(var o in t.order_info.secondGoods);},function(e){wx.redirectTo({url:"./paymentStatus/paymentStatus?order_id="+n.order_id+"&consignee="+JSON.stringify(t.consignee)+"&payment_code="+n.payment_code})})})});else{var f=i.getPath.doPay,_={order_id:parseInt(t.orderSn),payment_code:t.selectedGoods.payment_code[0]};a.hideLoad(t),t.isTopaydis=!1,a.ApiGateWayTest(f,_,!0,function(e){if(1!=e.data.success)return a.toast(e.data.msg),void(t.isTopaydis=!1);var o=e.data.result;a.doWechatPay(o,function(e){for(var o in t.order_info.firstGoods);for(var o in t.order_info.secondGoods);},function(e){for(var o in t.order_info.firstGoods);for(var o in t.order_info.secondGoods);},function(e){wx.redirectTo({url:"./paymentStatus/paymentStatus?order_id="+_.order_id+"&consignee="+JSON.stringify(t.consignee)+"&payment_code="+_.payment_code})})})}else if(""==t.orderSn||1==o[0].team_order||2==o[0].team_order)c["order_product"]=[{goods_id:o[u].goods_id,sku_key:o[u].sku_key,num:o[u].amount}],c.order_product=JSON.stringify(c.order_product),a.ApiGateWayTest(n,c,!0,function(e){if(1!=e.data.success)return a.toast(e.data.msg),a.hideLoad(t),void(t.isTopaydis=!1);e=e.data.result;t.orderSn=e.order_id;var n=i.getPath.doPay,s={order_id:e.order_id,payment_code:t.selectedGoods.payment_code[0]};if(a.hideLoad(t),t.isTopaydis=!1,1==e.status){for(var d in t.order_info.firstGoods);for(var d in t.order_info.secondGoods);wx.redirectTo({url:"./paymentStatus/paymentStatus?order_id="+s.order_id+"&consignee="+JSON.stringify(t.consignee)+"&payment_code="+s.payment_code})}else a.ApiGateWayTest(n,s,!0,function(e){if(1!=e.data.success)return a.toast(e.data.msg),void(t.isTopaydis=!1);var n=e.data.result;if(1==o[0].team_order||2==o[0].team_order)n.found_id;a.showLoad(t),a.doWechatPay(n,function(e){var n=a.getStorageSync("getpickup");for(var d in 1==t.consignee.is_default&&n!=t.consignee.pickup_id&&t.getExternal(t.consignee.pickup_id),t.order_info.firstGoods);for(var d in t.order_info.secondGoods);if(1==o[0].team_order||2==o[0].team_order){var r=i.getPath.checkPay,c={order_id:t.orderSn,payment_code:s.payment_code};a.ApiGateWayTest(r,c,!0,function(e){1==e.data.success?(wx.redirectTo({url:"../../packageA/groupbuy/groupbuy?found_id="+e.data.result.found_id+"&entryType=external&teamType="+o[0].team_order}),a.hideLoad(t)):(a.toast("支付失败"),a.hideLoad(t))})}else wx.redirectTo({url:"./paymentStatus/paymentStatus?order_id="+s.order_id+"&consignee="+JSON.stringify(t.consignee)+"&payment_code="+s.payment_code})},function(e){for(var n in t.order_info.firstGoods);for(var n in t.order_info.secondGoods);if(1==o[0].team_order||2==o[0].team_order){var d=i.getPath.checkPay,r={order_id:t.orderSn,payment_code:s.payment_code};a.ApiGateWayTest(d,r,!0,function(e){1==e.data.success?(wx.redirectTo({url:"../../packageA/groupbuy/groupbuy?found_id="+e.data.result.found_id+"&entryType=external&teamType="+o[0].team_order}),a.hideLoad(t)):(a.toast("支付失败"),a.hideLoad(t))})}else wx.redirectTo({url:"./paymentStatus/paymentStatus?order_id="+s.order_id+"&consignee="+JSON.stringify(t.consignee)+"&payment_code="+s.payment_code}),a.hideLoad(t)})})});else{f=i.getPath.doPay,_={order_id:parseInt(t.orderSn),payment_code:t.selectedGoods.payment_code[0]};a.hideLoad(t),t.isTopaydis=!1,a.ApiGateWayTest(f,_,!0,function(e){if(1!=e.data.success)return a.toast(e.data.msg),void(t.isTopaydis=!1);var o=e.data.result;a.doWechatPay(o,function(e){for(var o in t.order_info.firstGoods);for(var o in t.order_info.secondGoods);},function(e){for(var o in t.order_info.firstGoods);for(var o in t.order_info.secondGoods)i.aldstat.sendEvent("支付失败",{"商品名称":t.order_info.secondGoods[o].goods_name})},function(e){wx.redirectTo({url:"./paymentStatus/paymentStatus?order_id="+_.order_id+"&consignee="+JSON.stringify(t.consignee)+"&payment_code="+_.payment_code})})})}}},leaveModal:function(){var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),1==this.showGetBonusModal&&this.setData({showGetBonusModal:!1,showBonusModal:!0}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==this.showGetBonusModal&&this.setData({showBonusModal:!0})}.bind(this),200)},stopMove:function(){return!0},cashgift_jump_type:function(e){e?this.getModalBonus():this.setModalBonus()},setData:function(e){var t=this,o=[];Object.keys(e).forEach(function(i){o=i.split("."),e[i],t.$data,o.forEach(function(o,a){t[i]=e[i]})})}}};t.default=n}).call(this,o("0de9")["default"])},e4be:function(e,t,o){"use strict";var i=o("5771"),a=o.n(i);a.a}},[["ef19","common/runtime","common/vendor"]]]);