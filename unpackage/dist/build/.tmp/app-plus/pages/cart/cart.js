(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/cart"],{"0410":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=getApp().globalData,a=o("28c1"),i=function(){return o.e("components/goodList/goodList").then(o.bind(null,"bc0e"))},n=function(){return o.e("components/no_warehouse/no_warehouse").then(o.bind(null,"6de5"))},r={data:function(){return{iconURL:s.dataBase.iconURL,minusStatuses:["disabled","disabled","normal","normal","disabled"],total:0,totalPrice:"0.00",totalShare:"0.00",edit_mode:!1,selectedAmount:0,selectedGoods:[],isSelectedAll:!1,optionalSelect:!1,groups:[],sendMsg:"不含运费",refresh:!0,page:1,recommend_good_list:[],checkSessionKey:s.checkSessionKey,sumPrice:"0.00",isAuthorization:"",hasInvalid:"",showPage:!0}},components:{goodlist:i,no_warehouse:n},props:{},onShow:function(){var e=this;a.getStorageSync("getpickup");this.loadCartData(),this.recommend_good_list=[],console.log(t(s," at pages\\cart\\cart.vue:256")),e.local(function(t){var o={city:t,isAuthorization:!0};if(!e.isAuthorization||-1==t.warehouse_id)return o.showPage=!1,e.setData(o),!1;o.showPage=!0,e.setData(o)})},onShareAppMessage:function(t){var e=a.getStorageSync("getpickup"),o=a.getStorageSync("entry_share_info");return{title:"button"==t.from?o.urge_share_text:"",path:"/pages/index/index?pickup_id="+e.pickup_id+"&user_id="+o.user_id,imageUrl:"button"==t.from?o.urge_share_img:""}},methods:{local:function(t){var e=this;e.setData({isAuthorization:a.getStorageSync("authSetting")["scope.userLocation"]});var o=a.getStorageSync("city");a.getStorageSync("getpickup");s.firstlaunchApp&&void 0==o.warehouse_id?(e.isAuthorization&&a.showLoad(e),a.getpickup(function(o){var s=o.cities;t&&"function"===typeof t&&t(s),a.hideLoad(e)})):t&&"function"===typeof t&&t(o)},openSet:function(t){var e=this;e.setData({isAuthorization:t.detail.isAuthorization}),a.setStorageSync("reLoad",!0),s.dataBase.isRefresh=!0,e.onShow()},toggleEdit:function(){this.setData({edit_mode:!this.edit_mode}),this.getCartPrice()},clearCart:function(){var t=this,e=s.getPath.clearCart,o={};a.showModal("确定清空购物车商品吗？","清空",function(s){s.confirm&&a.ApiGateWayTest(e,o,!0,function(e){e=e.data;if(1==e.success){var o=t.groups;o.goods=[],t.setData({groups:o})}})})},touchAmountSub:function(t){var e=this;a.formIdUpdate(t);var o=t.currentTarget.dataset.goods,i=t.currentTarget.dataset.index,n=t.currentTarget.dataset.g_index,r=o.amount;if(1!=o.is_disable&&0!=o.is_enough&&0!=o.is_on_sale)if(r<=o.min_buy_amount)a.showModal("是否从购物车删除？","删除",function(t){t.confirm&&e.delete([o.cart_id],function(t){t&&(a.toast("删除成功"),e.deletingGoods=null,e.getCartPrice())},function(){e.refreshEditModeAmount()})});else{r--;var d=o.cart_id,c=s.getPath.changCartNum,l={cart_id:d,amount:r};a.ApiGateWayTest(c,l,!0,function(t){if(t&&1==t.data.success){var o=e.groups;o.goods[i].list[n].amount=r;var s=r<=1?"disabled":"normal",a=e.minusStatuses;a[i]=s,e.setData({groups:o,minusStatuses:a});for(var d=e.selectedGoods,c=0;c<d.length;++c)if(d[c].cart_id==o.goods[i].list[n].cart_id){d[c]=o.goods[i].list[n];break}e.setData({selectedGoods:d}),e.getOptional()}e.count()})}},touchAmountAdd:function(t){var e=this;a.formIdUpdate(t);var o=t.currentTarget.dataset.goods,i=t.currentTarget.dataset.index,n=t.currentTarget.dataset.g_index,r=o.amount;if(1!=o.is_disable&&0!=o.is_enough&&0!=o.is_on_sale)if(r>=o.max_buy_amount)a.toast("不能再多啦~");else{r++;var d=o.cart_id,c=s.getPath.changCartNum,l={cart_id:d,amount:r};a.ApiGateWayTest(c,l,!0,function(t){if(1==t.data.success){var o=e.groups;o.goods[i].list[n].amount=r;var s=r<=1?"disabled":"normal",d=e.minusStatuses;d[i]=s,e.setData({groups:o,minusStatuses:d});for(var c=e.selectedGoods,l=0;l<c.length;++l)if(c[l].cart_id==o.goods[i].list[n].cart_id){c[l]=o.goods[i].list[n];break}e.setData({selectedGoods:c}),e.getOptional()}else a.toast("库存已经达到上限了~");e.count()})}},getCartPrice:function(){var t=this,e=[],o=s.getPath.calculateCart,i=0,n=this.selectedGoods;for(var r in n)e.push({goods_id:n[r].goods_id,sku_key:n[r].sku_key,num:n[r].amount}),i+=n[r].amount;e=JSON.stringify(e);var d={order_product:e};a.ApiGateWayTest(o,d,!0,function(e){var o=e.data;1==o.success?t.setData({totalPrice:o.result.total_price,totalShare:o.result.total_share,selectedAmount:i}):t.setData({totalPrice:"0.00",totalShare:"0.00"})})},getOptional:function(){var t=this,e=s.getPath.cartList,o={};a.ApiGateWayTest(e,o,!0,function(e){t.setData({groups:e.data.result,isSelectedAll:!1}),t.touchSelectAll()})},touchSelect:function(t){for(var e=t.currentTarget.dataset.goods,o=(t.currentTarget.dataset.tips,t.currentTarget.dataset.g_index,this.selectedGoods),s=-1,a=0;a<o.length;++a){var i=o[a];if(i.cart_id==e.cart_id){s=a;break}}-1==s?o.push(e):o.splice(s,1);var n=this.groups,r=0;for(var d in n.goods)for(var c in n.goods[d].list)r++,this.edit_mode||0!=n.goods[d].list[c].is_on_sale&&0!=n.goods[d].list[c].is_enough&&1!=n.goods[d].list[c].is_disable||r--;r<=o.length?this.isSelectedAll=!0:this.isSelectedAll=!1,this.setData({selectedGoods:o,isSelectedAll:this.isSelectedAll}),this.getCartPrice(),this.edit_mode||this.setSettledPrice(),this.resetCheckbox()},touchSelectAll:function(){var t=this.groups,e=[],o=!this.isSelectedAll;if(o)for(var s=0;s<t.goods.length;++s)for(var a=0;a<t.goods[s].list.length;++a)if(this.edit_mode){var i=t.goods[s].list[a];e.push(i)}else if(1==t.goods[s].list[a].is_on_sale&&1==t.goods[s].list[a].is_enough&&0==t.goods[s].list[a].is_disable){i=t.goods[s].list[a];e.push(i)}this.setData({selectedGoods:e,isSelectedAll:o,optionalSelect:o}),this.edit_mode||this.setSettledPrice(),this.getCartPrice(),this.resetCheckbox()},resetCheckbox:function(){var t=this.groups;for(var e in t.goods)for(var o in t.goods[e].list){var s=t.goods[e].list[o];s.selected=!1}for(var e in t.goods)for(var a in t.goods[e].list){s=t.goods[e].list[a];for(var o in this.selectedGoods)this.selectedGoods[o].cart_id===s.cart_id&&(s.selected=!0)}this.setData({groups:t})},recomputeSVIPPrice:function(){for(var t=0,e=this.selectedGoods,o=0;o<e.length;++o){var s=e[o].shop_price;1==e[o].is_on_sale&&1==e[o].is_enough&&0==e[o].is_disable&&(t+=e[o].amount*s)}this.selectedSVIPPrice=t.toFixed(2)},setSettledPrice:function(){this.svipGoodsPrice=0,this.savePrice=0},loadCartData:function(t){var e=this,o=s.getPath.cartList,i={};a.ApiGateWayTest(o,i,!0,function(o){o=o.data;if(o){var s=o.result,a=!1;for(var i in s.goods)for(var n in s.goods[i].list)s.goods[i].list[n].edit_amount=s.goods[i].list[n].amount,s.goods[i].list[n].min_buy_amount=s.goods[i].list[n].min_buy_amount?s.goods[i].list[n].min_buy_amount:1,0!=s.goods[i].list[n].is_enough&&0!=s.goods[i].list[n].is_on_sale&&1!=s.goods[i].list[n].is_disable||(a=!0);e.setData({groups:s,hasInvalid:a,selectedGoods:[],totalPrice:"0.00",selectedAmount:0,isSelectedAll:!1}),e.count(),e.touchSelectAll(),"function"===typeof t&&t()}})},computeAllPrice:function(){for(var t=this.groups,e=0,o=0,s=0;s<t.goods.length;++s)for(var a=0;a<t.goods[s].list.length;++a){var i=t.goods[s].list[a].market_price,n=t.goods[s].list[a].shop_price;1==t.goods[s].list[a].is_on_sale&&1==t.goods[s].list[a].is_enough&&0==t.goods[s].list[a].is_disable&&(e+=t.goods[s].list[a].amount*n,o+=t.goods[s].list[a].amount*i)}this.allPrice=e.toFixed(2),this.allMarketPrice=o.toFixed(2),this.setSettledPrice()},count:function(){var t=0;if(this.groups)for(var e=this.groups,o=0;o<e.goods.length;++o)for(var s=0;s<e.goods[o].list.length;++s)t+=e.goods[o].list[s].amount;this.setData({total:t})},refreshEditModeAmount:function(){var t=this.groups,e=t.goods;for(var o in e)for(var s in e[o].list)e[o].list[s].edit_amount=e[o].list[s].amount;this.setData({groups:t})},touchDelete:function(){var t=this;if(t.selectedGoods&&t.selectedGoods.length){var e="是否要删除选中商品",o="确定";a.showModal(e,o,function(e){if(e.confirm){var o=[];for(var s in t.selectedGoods)o.push(t.selectedGoods[s].cart_id);if(o.length<=0)return;t.delete(o,function(e){e&&(a.toast("删除成功"),t.deletingGoods=null,t.recomputePrice(),t.getCartPrice())},function(){t.refreshEditModeAmount()})}else e.cancel&&(t.deletingGoods=null)})}else a.toast("还没有选择任何商品哦~")},delAllInvalidGoods:function(){var t=this,e="确认清空所有失效商品？",o="确定",i=s.getPath.clearLoseCart;a.showModal(e,o,function(e){if(e.confirm){for(var o=t.groups,s=[],n=0;n<o.goods.length;++n)for(var r=0;r<o.goods[n].list.length;++r)if(0==o.goods[n].list[r].is_on_sale||0==o.goods[n].list[r].is_enough||1==o.goods[n].list[r].is_disable){var d=o.goods[n].list[r];s.push(d.cart_id)}if(s.length<=0)return;a.ApiGateWayTest(i,{},!0,function(e){1==e.data.success&&(a.toast("删除成功"),t.deletingGoods=null,t.loadCartData())})}else e.cancel&&(t.deletingGoods=null)})},touchDel:function(t){var e=this;a.formIdUpdate(t),a.showModal("确认删除该商品？","删除",function(o){if(o.confirm){var i=s.getPath.delCart,n={cart_ids:t.currentTarget.dataset.product.cart_id.toString()};a.ApiGateWayTest(i,n,!0,function(t){t.data&&1==t.data.success&&(e.loadCartData(),e.count())})}})},delete:function(t,e,o){var i=this,n=s.getPath.delCart,r={cart_ids:t.join(",")};a.ApiGateWayTest(n,r,!0,function(t){t.data&&1==t.data.success&&(i.loadCartData(o),i.count()),"function"===typeof e&&e(1==t.data.success)})},touchWinlog:function(){var t=this;if(t.selectedGoods&&t.selectedGoods.length){var e="是否将商品移入收藏？",o="确定";a.showModal(e,o,function(e){if(e.confirm){var o=[],i=[];for(var n in t.selectedGoods)o.push(t.selectedGoods[n].goods_id),i.push(t.selectedGoods[n].cart_id);if(o.length<=0||i.length<=0)return;var r=s.getPath.goodsLike,d={goods_id:o.join(",")};a.ApiGateWayTest(r,d,!0,function(e){200==e.statusCode&&(a.toast("收藏成功"),t.delete(i,function(e){e&&(t.loadCartData(t.refreshEditModeAmount),t.count(),t.deletingGoods=null,t.recomputePrice())}))})}else e.cancel&&(t.deletingGoods=null)})}else a.toast("还没有选择任何商品哦~")},load_select:function(t){var e=t.currentTarget.dataset.activity_id;wx.navigateTo({url:"../../packageA/select/select?entryType=external&id="+e})},toNowpay:function(t){var e=this,o=a.getStorageSync("isOldUser");if(!s.checkSessionKey||2==o)return a.goRegister(),!1;var i=e.selectedGoods;a.formIdUpdate(t),i.length>0?(a.setStorage({key:"nowPay",data:i}),wx.navigateTo({url:"/pages/confirm/confirm"})):a.toast("请勾选需要结算的商品")},touchProduct:function(t){var e=t.currentTarget.dataset.product.goods_id;wx.navigateTo({url:"../product/product?entryType=external&productId="+e})},goHome:function(t){wx.switchTab({url:"../index/index"})},setData:function(t){var e=this,o=[];Object.keys(t).forEach(function(s){o=s.split("."),t[s],e.$data,o.forEach(function(o,a){e[s]=t[s]})})}}};e.default=r}).call(this,o("0de9")["default"])},"5a39":function(t,e,o){"use strict";var s=o("fc39"),a=o.n(s);a.a},7173:function(t,e,o){"use strict";o.r(e);var s=o("0410"),a=o.n(s);for(var i in s)"default"!==i&&function(t){o.d(e,t,function(){return s[t]})}(i);e["default"]=a.a},"8ef2":function(t,e,o){"use strict";o.r(e);var s=o("9228"),a=o("7173");for(var i in a)"default"!==i&&function(t){o.d(e,t,function(){return a[t]})}(i);o("5a39");var n=o("2877"),r=Object(n["a"])(a["default"],s["a"],s["b"],!1,null,null,null);e["default"]=r.exports},9228:function(t,e,o){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c},a=[];o.d(e,"a",function(){return s}),o.d(e,"b",function(){return a})},fc39:function(t,e,o){}},[["01d5","common/runtime","common/vendor"]]]);