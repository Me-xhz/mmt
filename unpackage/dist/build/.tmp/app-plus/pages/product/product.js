(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/product"],{"24f8":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){e.stopPropagation(),t.team_type})},i=[];a.d(e,"a",function(){return s}),a.d(e,"b",function(){return i})},"67d1":function(t,e,a){"use strict";(function(t,s){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=getApp().globalData,o=a("28c1"),r=a("b6a1"),n=(a("0155"),function(){return a.e("components/teamList/teamList").then(a.bind(null,"264e"))}),u=function(){return a.e("components/navBar/navBar").then(a.bind(null,"b397"))},c={data:function(){return{iconURL:i.dataBase.iconURL,bannerApp:!0,iphoneXBottom:"0rpx",winWidth:0,winHeight:0,productId:0,itemData:{shop_type:0},isLike:0,showSKUstatus:0,optionalAttrs:{},skuImages:"",bannerItem:[],buynum:1,indicatorDots:!0,indicatorColor:"rgba(0,0,0,.2)",indicatorActiveColor:"#ffe150",autoplay:!1,interval:5e3,duration:300,circular:!0,firstIndex:-1,choosed_sku:"",cartAmount:0,currentLocation:1,showSubbar:!1,scrollTop:0,scrollBar:"",showBackTop:!1,undel:!0,unadd:!1,showBonus:0,brandID:0,ipRecommend:{},formateDatas:[],comment:{},teamLabel:{},wordsLimit:!0,limitWords:"展开",isPriceEqual:!1,productgift:{},isshare:0,giftNum:"",bounsTxtnumOn:!1,showBonusModal:!1,showSettingModalStatus:!1,isShowbox:0,canPurchase:!1,date_limite_bool:!0,date_limite_ing:!0,isShowGoHome:!1,isShowSharePic:!1,preurl:null,showzjModalStatus:!1,rentToggleStatus:0,aldExposure:!0,stopCartBtn:!1,prom_bool:!1,activity_bool:!1,activity_classfy:"",h:"00",m:"00",s:"00",d:"00",teamList:[],team_num:0,check_remind:!1,check_remind_activity:!1,showPhoneModal:!1,navbarOpacity:0,showBack:!1,navBarHeight:i.navBarHeight,team_type:"",team_sku_type:0,noticeUnload:!1,activity_price_start:"0",activity_price_end:"0.00",activity_time_start:{},confirmData:{},down_date_h:"",down_date_m:"",down_date_s:"",down_date_ms:"",showCountDown:!1,checkSessionKey:!1,isOldUser:"",entryData:"",animationData:"",showModalStatus:!1,showfwModalStatus:!1,showShareModalStatus:!1,skuSvipCurrent:"",skuCurrent:"",promInfoData:"",swiperImgBl:!1,shippingBonus:"",sku_price:"",min_sku_price:"",sku_svip_price:"",min_sku_svip_price:"",currentStock:"",hasDefaultSKU:"",sumbitName:"",scgGoodsList:[],isShowModeWx:0,currentAttrs:[]}},onLoad:function(e){var a=this,s=getCurrentPages();s.length>1&&a.setData({showBack:!0}),wx.getSystemInfo({success:function(t){var e=t.model;-1!=e.search("iPhone X")&&a.setData({iphoneXBottom:"68rpx"})}}),console.log(t("1",i.checkSessionKey," at pages\\product\\product.vue:962")),r.on("checkSessionKey",this,function(t){var e=o.getStorageSync("isOldUser");this.setData({checkSessionKey:t,isOldUser:e})});var n="",u="";if(e.scene){var c=decodeURIComponent(e.scene);n=c.split("&")[0],u=c.split("&amp;")[1]}if(void 0!=e.productId||""!=n){a=this;e&&e.scene&&""!=e.scene?(a.setData({productId:n}),this.setData({isShowGoHome:!0})):(a.setData({productId:e.productId}),this.getTeamList()),e&&e.entryType&&"external"==e.entryType?this.setData({isShowGoHome:!1}):this.setData({isShowGoHome:!0}),this.setData({entryData:e});e=a.entryData;if(e&&e.scene&&""!=e.scene)a.getExternal(u).then(function(){i.firstlaunchApp=!1,a.entryData={},o.setStorageSync("authSetting",{"scope.userLocation":!0}),a.checkSessionKey=!0,a.loadProductDetail(),a.loadProductgift(),a.sameCategoryGoods()});else{var d=o.getStorageSync("getpickup");e&&(e.atitude||e.pickup_id)&&!d?a.getExternal(e.pickup_id).then(function(){i.firstlaunchApp=!1,a.entryData={},o.setStorageSync("authSetting",{"scope.userLocation":!0}),a.checkSessionKey=!0,a.loadProductDetail(),a.loadProductgift(),a.sameCategoryGoods()}):(a.checkSessionKey=!0,a.loadProductDetail(),a.loadProductgift(),a.sameCategoryGoods())}}else o.toast("请求参数错误")},components:{teamList:n,navbar:u},props:{},onShow:function(){var e=o.getStorageSync("isOldUser");console.log(t("productlist",i.checkSessionKey," at pages\\product\\product.vue:1066")),this.setData({checkSessionKey:i.checkSessionKey,isOldUser:e}),this.itemData.team_id&&void 0!=this.itemData.team_id&&(this.loadProductDetail(),this.getTeamList())},onUnload:function(){this.setData({noticeUnload:!0})},onShareAppMessage:function(t){var e=this,a=o.getStorageSync("getpickup"),s=o.getStorageSync("entry_share_info");if(t.target&&t.target.dataset.shareinfo){var i=t.target.dataset.shareinfo;return i&&"notice"==i.fromButton?{title:s.urge_share_text,path:"/pages/index/index?pickup_id="+a.pickup_id+"&user_id="+s.user_id,imageUrl:s.urge_share_img}:i&&"envelopes"==i.fromButton?{title:s.invite_share_text,path:"/pages/index/index?pickup_id="+a.pickup_id+"&user_id="+s.user_id,imageUrl:s.invite_share_img}:{title:e.itemData.share_title,path:"/pages/product/product?productId="+e.itemData.goods_id+"&pickup_id="+a.pickup_id,imageUrl:e.itemData.share_img}}return{title:e.itemData.share_title,path:"/pages/product/product?productId="+e.itemData.goods_id+"&pickup_id="+a.pickup_id,imageUrl:e.itemData.share_img}},onPullDownRefresh:function(){that.loadProductDetail(),that.loadProductgift(),setTimeout(function(){wx.stopPullDownRefresh()},1500)},methods:{getDate:function(t){var e=this,a=1e3*t.start_time,s=1e3*t.end_time,i=(new Date).getTime();i>=a&&i<=s?(e.countTime(i,s),e.setData({date_limite_ing:!0}),this.date=setInterval(function(){var t=(new Date).getTime();e.countTime(t,s)},1e3),e.countTimeMs()):a>=i&&s>=i?(e.countTime(i,a),e.setData({date_limite_ing:!1}),this.date=setInterval(function(){var t=(new Date).getTime();e.countTime(t,a)},1e3)):e.setData({date_limite_bool:!1})},countTime:function(t,e){var a,s,i,o,r=e-t;if(!(r>=0))return clearInterval(this.date),this.loadProductDetail(),!1;a=Math.floor(r/1e3/60/60/24,10),s=Math.floor(r/1e3/60/60%24)+24*a,i=Math.floor(r/1e3/60%60),o=Math.floor(r/1e3%60),s=s>9?s:"0"+s,i=i>9?i:"0"+i,o=o>9?o:"0"+o,this.setData({down_date_h:s,down_date_m:i,down_date_s:o})},countTimeMs:function(){var t=this,e=9;this.dataMs=setInterval(function(){e>1?e--:e=9,t.setData({down_date_ms:e})},100)},countDown:function(t){var e,a,s,i,o=this,r=this,n=(new Date).getTime()/1e3,u=t-n;clearInterval(r.teamTime),r.teamTime=setInterval(function(){u-=1,u>=0?(e=Math.floor(u/60/60/24,10),a=Math.floor(u/60/60%24),s=Math.floor(u/60%60),i=Math.floor(u%60),e=e>9?e:"0"+e,a=a>9?a:"0"+a,s=s>9?s:"0"+s,i=i>9?i:"0"+i):(clearInterval(r.teamTime),o.setData({showCountDown:!1}),r.loadProductDetail()),o.setData({d:e,h:a,m:s,s:i})},1e3)},getExternal:function(t){var e=i.getPath.getpickup,a={pickup_id:t};return new Promise(function(t,s){o.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){e=e.data.result.cities.pick_up;o.setStorage({key:"city",data:{pickup_id:e.pickup_id,warehouse_id:e.warehouse_id,cityName:e.city_name,is_pick_up:1}}),o.setStorage({key:"getpickup",data:{pickup_id:e.pickup_id,cityName:e.pickup_name,pickup_address:e.pickup_address,pickup_contact:e.pickup_contact,pickup_phone:e.pickup_phone,pickup_type:e.pickup_type}},function(e){t("获取id成功")})}})})},setPreviewImage:function(t){for(var e=this,a=t.currentTarget.dataset.current,s=[],i=0;e.bannerItem.length>i;i++)s.push(e.bannerItem[i].src);wx.previewImage({current:a,urls:s})},setModalStatus:function(e){var a=this;console.log(t(this.showSKUstatus," at pages\\product\\product.vue:1315")),0==this.showSKUstatus?this.showSKUstatus=1:this.showSKUstatus=0;var s=wx.createAnimation({duration:250,timingFunction:"linear",delay:0});s.translateY(368).opacity(1).step(),this.setData({animationData:s.export()}),1==this.showSKUstatus&&this.setData({showModalStatus:!0}),setTimeout(function(){"68rpx"==a.iphoneXBottom?s.translateY(-34).step():s.translateY(0).step(),this.setData({animationData:s}),0==this.showSKUstatus&&this.setData({showModalStatus:!1})}.bind(this),200)},setModalBonus:function(){0==this.showBonusModal?this.showBonusModal=1:this.showBonusModal=0;var t=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});t.translateY(300).opacity(1).step(),this.setData({animationData:t.export()}),1==this.showBonusModal&&this.setData({showBonusModal:!0}),setTimeout(function(){t.translateY(0).step(),this.setData({animationData:t}),0==this.showBonusModal&&this.setData({showBonusModal:!1})}.bind(this),200)},getBonus:function(t){var e=this,a=o.getStorageSync("isOldUser");if(!i.checkSessionKey||2==a)return o.goRegister(),!1;var s=t.currentTarget.dataset.typeid;if(e.shippingBonus){var r=i.getPath.addCoupon,n={coupon_id:s};o.formIdUpdate(t),o.ApiGateWayTest(r,n,!0,function(t){200==t.statusCode&&t.data.result&&o.toast(t.data.result.state_desc),e.loadProductgift()})}},setfwModalStatus:function(t){var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),this.setData({showfwModalStatus:!0}),setTimeout(function(){e.translateY("-150px").translateX("-50%").step(),this.setData({animationData:e}),0==t.currentTarget.dataset.status&&this.setData({showfwModalStatus:!1})}.bind(this),200)},showShareModalStatus2:function(t){var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),this.setData({showShareModalStatus:!0}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==t.currentTarget.dataset.status&&this.setData({showShareModalStatus:!1})}.bind(this),200)},loadProductDetail:function(){var e=this;o.showLoad(this);var a=i.getPath.goodsInfo,s=i.getPath.goodsLabel,r=i.getPath.getSkuAmount,n={goods_id:e.productId};o.ApiGateWayTest(a,n,!0,function(a){if(200==a.statusCode){var i=a.data.result;console.log(t("productlist",i," at pages\\product\\product.vue:1489"));i.goods_content,i.detail_explain,i.is_liked;i.current_price=i.shop_price,i.price=i.market_price,i.team_price=parseFloat(i.team_price),e.setData({itemData:i,bannerItem:i.gallery,indicatorDots:i.gallery.length>1,buynum:i.min_buy_amount,brandID:i.cat_id,skuSvipCurrent:parseFloat(i.shop_price),skuCurrent:parseFloat(i.market_price)}),1==i.is_notice&&e.setData({check_remind:!0}),1==i.is_activity_notice&&e.setData({check_remind_activity:!0}),1==e.aldExposure&&(e.aldExposure=!1),1==i.is_team&&e.teamLabel2(),e.setDefaultSKU(i),e.isPriceEqualFun(),o.ApiGateWayTest(s,n,!0,function(t){var a=t.data.result.data;if("[object Object]"===Object.prototype.toString.call(a)){e.getDate(a);var s=a.activity_price.split("."),i=new Date(1e3*a.start_time).getMonth()+1<10?"0"+(new Date(1e3*a.start_time).getMonth()+1):new Date(1e3*a.start_time).getMonth()+1,o=new Date(1e3*a.start_time).getDate()<10?"0"+new Date(1e3*a.start_time).getDate():new Date(1e3*a.start_time).getDate(),r=new Date(1e3*a.start_time).getHours()<10?"0"+new Date(1e3*a.start_time).getHours():new Date(1e3*a.start_time).getHours(),n=new Date(1e3*a.start_time).getMinutes()<10?"0"+new Date(1e3*a.start_time).getMinutes():new Date(1e3*a.start_time).getMinutes(),u={activity_time_start_month:i,activity_time_start_date:o,activity_time_start_hours:r,activity_time_start_min:n};e.setData({activity_bool:!0,promInfoData:a,activity_price_start:s[0],activity_price_end:s[1],activity_time_start:u,activity_classfy:t.data.result.type})}else e.setData({activity_bool:!1,promInfoData:a,activity_classfy:""})}),o.hideLoad(e)}else o.hideLoad(e),o.toast("获取购物车数量失败")}),o.ApiGateWayTest(r,"",!0,function(t){200==t.statusCode&&e.setData({cartAmount:t.data.result.cart_num})})},swiperImageLoad:function(){var t=this;t.setData({swiperImgBl:!0})},loadProductgift:function(){var t=this,e=i.getPath.goodscouponlist,a={goods_id:t.productId};o.ApiGateWayTest(e,a,!0,function(e){var a=e.data.result,s=0,i=0;a&&(s=a.length>3?3:a.length);for(var o=0;o<s;o++)i+=a[o].name.length;t.setData({shippingBonus:a}),i>24&&t.setData({bounsTxtnumOn:!0})})},setDefaultSKU:function(t){for(var e=[],a=null,s=[],i=[],r=0;r<t.properties.length;++r){var n=t.properties[r];if(!n.is_multiselect){s[r]=[];for(var u=0;u<n.attrs.length;u++)s[r].push(n.attrs[u].id)}}if(s=o.multiCartesian(s),s.length&&s[0]instanceof Array)for(r=0;r<s.length;r++)s[r].sort(function(t,e){return t-e});this.setData({canPurchase:this.checkCanPurchase()});var c=9999999999,d=9999999999;for(r=0;r<t.stock.length;++r){var l=t.stock[r].key.split("_"),h=t.stock[r].market_price,p=t.stock[r].price;if(d>p){var m=[];if(t.is_goods_number>0&&t.is_on_sale&&t.stock[r].is_enough){for(var g=0,f=l.length;g<f;g++)m.push(parseInt(l[g]));e=m,a=[{attrs:e,stock:t.stock[r]}],!0,d=p,c=h}else if(!t.is_goods_number>0||!t.is_on_sale){for(g=0,f=l.length;g<f;g++)m.push(parseInt(l[g]));e=m,a=[{attrs:e,stock:t.stock[r]}],!0,d=p,c=h}}l.sort(function(t,e){return t-e}),l=l.join("_");for(u=0;u<s.length;u++){var _="";_=s[u]instanceof Array?s[u].join("_"):s[u]instanceof Object?"":s[u],l==_&&1==t.stock[r].is_enough&&i.push({attrs:s[u],stock:t.stock[r]})}}var v=this.itemData.current_price,k=this.itemData.price;if(this.setData({sku_price:c,min_sku_price:c,sku_svip_price:d,min_sku_svip_price:d,skuSvipCurrent:parseFloat(v),skuCurrent:parseFloat(k),currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku(),e=[],a=null,this.setData({currentStock:null,hasDefaultSKU:!1}),this.currentAttrs=[],1==i.length&&(e=i[0].attrs instanceof Array?i[0].attrs:[i[0].attrs],a=i[0].stock),i.length>1)for(var r in t.properties){var D=t.properties[r].attrs;for(var u in D){var y=0;for(var w in i){var S=new RegExp(D[u].id).test(i[w].attrs);S&&y++}y==i.length&&e.push(D[u].id)}}this.setData({currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku()},set_choosed_sku:function(){var t=this,e=t.itemData;if(t.currentAttrs.length<e.properties.length)return t.sku_price=t.min_sku_price,t.sku_svip_price=t.min_sku_svip_price,t.setData({choosed_sku:"选择：商品规格",skuImages:e.header_img,skuSvipCurrent:parseFloat(t.itemData.current_price),skuCurrent:parseFloat(t.itemData.price)}),void t.setAttrsClass();var a="",s=0,i=0,o=0,r=t.itemData.current_price,n=t.itemData.price;for(var u in t.setData({choosed_sku:a,sku_price:s,sku_svip_price:i,skuSvipCurrent:parseFloat(r),skuCurrent:parseFloat(n)}),e.properties){var c=e.properties[u].attrs;for(var d in c)for(var l in t.currentAttrs)t.currentAttrs[l]==c[d].id&&(a+=c[d].item+" ")}if(""!=a){for(var u in e.stock){var h=e.stock[u].key;h=h.split("_"),h.sort(function(t,e){return t-e}),h=h.join("_");c=t.currentAttrs.join("_");c==h&&(t.skuImages=e.stock[u].header_img,s=e.stock[u].market_price,i=e.stock[u].shop_price,o=e.stock[u].team_price)}t.confirmData=[{goods_name:e.goods_name,goods_id:e.goods_id,sku_key:c,amount:t.buynum,shop_price:i,market_price:s,sku_key_name:"规格:"+a,sku_img:t.skuImages}],a="已选："+a;r=1==t.team_type?o:i,n=s;t.setData({choosed_sku:a,sku_price:s,sku_svip_price:i,skuSvipCurrent:parseFloat(r),skuCurrent:parseFloat(n),skuImages:t.skuImages})}t.setAttrsClass()},attrValueselest:function(t){var e=this.itemData;if(e){var a=t.currentTarget.dataset.property,s=t.currentTarget.dataset.attr;if(s.is_multiselect){var i=[].concat(this.optionalAttrs),r=i.indexOf(s.id);-1==r?i.push(s.id):i.splice(r,1),this.setData({optionalAttrs:i})}else{var n=!1;for(var u in e.stock)if(1==e.stock[u].is_enough&&e.stock[u].key.indexOf(String(s.id))>=0){n=!0;break}if(!n)return void o.toast("库存不足");var c=null;i=[].concat(this.currentAttrs),r=i.indexOf(s.id);for(var u in-1==r?i.push(s.id):i.splice(r,1),a.attrs)if(a.attrs[u].id!=s.id){r=i.indexOf(a.attrs[u].id);-1!=r&&i.splice(r,1)}if(i=i.filter(function(t,e,a){return a.indexOf(t)===e}),i.sort(function(t,e){return t-e}),i.length){var d=i.join("_");for(u=0;u<e.stock.length;++u){var l=e.stock[u].key.split("_");if(l.sort(function(t,e){return t-e}),l=l.join("_"),l==d){c=e.stock[u];break}}}c&&c.is_enough?(this.currentStock=c,this.currentAttrs=i,this.setData({buynum:e.min_buy_amount})):i.length<e.properties.length?(this.currentStock=null,this.currentAttrs=i,this.setData({buynum:e.min_buy_amount})):o.toast("库存不足"),this.setData({canPurchase:this.checkCanPurchase()})}this.set_choosed_sku()}},setAttrsClass:function(){var t=this.itemData,e=t.properties;for(var a in e){var s=e[a].attrs;for(var i in s){var o=s[i];if(t)if(0!=t.is_goods_number){if(o.is_multiselect)o.class=-1==this.optionalAttrs.indexOf(o.id)?"":"active";else{o.class=-1==this.currentAttrs.indexOf(o.id)?"":"active";var r=!1;for(var a in t.stock){if(1!=t.stock[a].is_enough){var n=this.currentAttrs.join("_");if(!(t.stock[a].key.indexOf(String(n))>=0&&this.currentAttrs.length>0))continue;var u=t.stock[a].key.split("_");for(var i in u)if(u[i]!=this.currentAttrs)for(var c in t.properties)for(var d in t.properties[c].attrs)t.properties[c].attrs[d].id==u[i]&&(t.properties[c].attrs[d].class="disable")}if(t.stock[a].key.indexOf(String(o.id))>=0){r=!0;break}}r||(o.class+="disable")}}else o.class="disable";else o.class="disable"}}this.setData({itemData:t})},addFavorites:function(t){var e=this,a=e.isLike,s=e.productId,r=i.getPath.goodsLike,n=i.getPath.goodsUnlike,u={goods_id:s},c={goods_id:s};a?o.ApiGateWayTest(n,c,!0,function(t){if(200==t.statusCode){t=t.data.result;e.setData({isLike:!a}),o.toast("取消收藏")}}):o.ApiGateWayTest(r,u,!0,function(t){if(200==t.statusCode){t=t.data.result;e.setData({isLike:!a}),o.toast("收藏成功")}})},checkCanPurchase:function(){var t=this.itemData,e=!1;if(t.pre_info&&1==t.pre_info.is_pre)return this.setData({sumbitName:t.pre_info.pre_time}),!1;if(!t||0==t.is_enough)return this.setData({sumbitName:"抱歉，商品已售罄"}),!1;if(0==t.is_on_sale)return this.setData({sumbitName:"抱歉，商品已下架"}),!1;if(this.currentAttrs.length>=t.properties.length){for(var a in t.properties)if(!t.properties[a].is_multiselect){e=!0;break}if(e){if(!this.currentAttrs||!this.currentAttrs.length)return!1;if(!this.currentStock)return!1}}return this.setData({sumbitName:"立即购买"}),!0},isPriceEqualFun:function(){var t=this;if(t.itemData.price&&t.itemData.current_price){var e=t.itemData.price+t.sku_price,a=t.itemData.current_price+t.sku_svip_price;e==a?t.setData({isPriceEqual:!0}):t.setData({isPriceEqual:!1})}else t.setData({isPriceEqual:!1})},changeNum:function(t){var e=this;o.formIdUpdate(t);var a=e.itemData,s=i.getPath.skuEnough;a.pre_info&&1==a.pre_info.is_pre&&(s=i.getPath.skuEnough);var r="";for(var n in a.stock){var u=a.stock[n].key;u=u.split("_"),u.sort(function(t,e){return t-e}),u=u.join("_");var c=e.currentAttrs.join("_");if(c==u){r=a.stock[n].key;break}}if(e.currentAttrs.length==a.properties.length){if(0==t.currentTarget.dataset.alphaBeta){if(!e.checkCanPurchase())return;if(e.buynum<=e.itemData.min_buy_amount)return void o.toast("不能小于最小购买数量");if(e.buynum<=1||(2===e.buynum?e.setData({buynum:e.buynum-1,undel:!0}):e.setData({buynum:e.buynum-1})),1!=e.buynum){var d={goods_id:a.goods_id,sku_key:r,amount:e.buynum};o.ApiGateWayTest(s,d,!0,function(t){t&&(1==t.data.result.is_enough||o.toast(t.data.result.msg))})}}else{if(0!=e.itemData.max_buy_amount&&e.buynum>=e.itemData.max_buy_amount)return void o.toast("不能在多啦~");if(e.setData({buynum:e.buynum+1,undel:!1}),e.buynum>1){d={goods_id:a.goods_id,sku_key:r,amount:e.buynum};o.ApiGateWayTest(s,d,!0,function(t){if(t)return 1!=t.data.result.is_enough?(o.toast(t.data.result.msg),e.setData({buynum:e.buynum-1}),void e.set_choosed_sku()):void 0})}}e.confirmData.num=e.buynum}else 0==e.showSKUstatus?e.setModalStatus():o.toast("请选择商品款式");e.set_choosed_sku()},goRegister:function(){var t=o.getStorageSync("isOldUser");if(!i.checkSessionKey||2==t)return o.goRegister(),!1},isnewpersongoods:function(t,e){var a=i.getPath.isnewpersongoods,s={goods_id:t,sku_key:e};return new Promise(function(t,e){o.ApiGateWayTest(a,s,!0,function(e){var a=e.data;if(1==a.success){var s=a.result.result;t(s)}})})},addShopCart:function(e){console.log(t("点击加入购物车按钮"," at pages\\product\\product.vue:2341"));var a=o.getStorageSync("isOldUser");if(!i.checkSessionKey||2==a)return o.goRegister(),!1;if(this.checkCanPurchase()){var s=this,r=this.itemData,n=e.currentTarget.dataset.type;if("addcart"==n&&s.currentAttrs.length==r.properties.length){var u=function(){var t={goods_id:r.goods_id,sku_key:c,amount:s.buynum};o.formIdUpdate(e),0==s.stopCartBtn&&(s.stopCartBtn=!0,o.ApiGateWayTest(p,t,!0,function(t){t&&(0!=t.data.success?(s.setData({cartAmount:t.data.result.cart_num}),o.toast(t.data.msg),s.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1,showModalStatus:!1}),s.showSKUstatus=0,s.stopCartBtn=!1):o.toast(t.data.msg))}))},c="";for(var d in r.stock){var l=r.stock[d].key;l=l.split("_"),l.sort(function(t,e){return t-e}),l=l.join("_");var h=s.currentAttrs.join("_");if(h==l){c=r.stock[d].key;break}}var p="";s.isnewpersongoods(r.goods_id,c).then(function(t){t?(p=i.getPath.addCartnew,o.showModal("是否替换新人商品","确定",function(t){t.confirm&&u()})):(p=i.getPath.addCart,u())})}else"addcart"!=n||0==s.showSKUstatus?(s.setModalStatus(n),s.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):o.toast("请选择商品款式")}},nowPurchase:function(e){console.log(t("点击立即购买按钮"," at pages\\product\\product.vue:2445"));var a=o.getStorageSync("isOldUser");if(console.log(t(i.checkSessionKey," at pages\\product\\product.vue:2448")),!i.checkSessionKey||2==a)return o.goRegister(),console.log(t("登录"," at pages\\product\\product.vue:2451")),!1;if(this.checkCanPurchase()){var r=this;if(this.setData({team_type:0}),1!=r.itemData.shop_type){var n=r.itemData;if(r.team_sku_type=1,console.log(t("that.team_sku_type",r.team_sku_type," at pages\\product\\product.vue:2473")),r.currentAttrs.length==n.properties.length&&n.max_buy_amount<2||1==r.team_sku_type&&r.currentAttrs.length==n.properties.length){console.log(t("点击购买按钮"," at pages\\product\\product.vue:2476"));var u="";for(var c in n.stock){var d=n.stock[c].key;d=d.split("_"),d.sort(function(t,e){return t-e}),d=d.join("_");var l=r.currentAttrs.join("_");if(l==d){u=n.stock[c].key;break}}var h=i.getPath.skuEnough;n.pre_info&&1==n.pre_info.is_pre&&(h=i.getPath.skuEnough);var p={goods_id:n.goods_id,sku_key:u,amount:r.buynum};o.formIdUpdate(e),o.showLoad(this),o.ApiGateWayTest(h,p,!0,function(t){if(t)return 1!=t.data.result.is_enough?(o.hideLoad(r),void o.toast(t.data.result.msg)):void m(e)})}else 0==r.showSKUstatus?(r.setModalStatus(),r.team_sku_type=1,console.log(t("team_sku_type改变"," at pages\\product\\product.vue:2527")),r.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):o.toast("请选择商品款式0")}else r.setzjModalStatus(e)}function m(){var t=i.getPath.preCheckOrder,e=[{goods_id:r.confirmData[0].goods_id,sku_key:r.confirmData[0].sku_key,num:r.confirmData[0].amount}];e=JSON.stringify(e);var a={order_product:e,team_order:0,time_atitude:i.dataBase.userAtitude};o.ApiGateWayTest(t,a,!0,function(t){o.hideLoad(r),1==t.data.success?(r.confirmData[0]["team_order"]=0,r.confirmData[0]["channel"]=r.itemData.is_team,o.setStorage({key:"nowPay",data:r.confirmData}),s.navigateTo({url:"/pages/confirm/confirm"})):o.toast(t.data.msg)})}},delegation:function(t){var e=o.getStorageSync("isOldUser");if(!i.checkSessionKey||2==e)return o.goRegister(),!1;if(this.checkCanPurchase()){var a=this;if(1!=a.itemData.shop_type){this.setData({team_type:1});var s=a.itemData;if(a.currentAttrs.length==s.properties.length&&s.max_buy_amount<2||1==a.team_sku_type&&a.currentAttrs.length==s.properties.length){var r="";for(var n in s.stock){var u=s.stock[n].key;u=u.split("_"),u.sort(function(t,e){return t-e}),u=u.join("_");var c=a.currentAttrs.join("_");if(c==u){r=s.stock[n].key;break}}var d=i.getPath.skuEnough;s.pre_info&&1==s.pre_info.is_pre&&(d=i.getPath.skuEnough);var l={goods_id:s.goods_id,sku_key:r,amount:a.buynum};o.formIdUpdate(t),o.showLoad(this),o.ApiGateWayTest(d,l,!0,function(e){if(e)return 1!=e.data.result.is_enough?(o.hideLoad(a),void o.toast(e.data.result.msg)):(a.setData({showModalStatus:!1,showSKUstatus:0}),void h(t))})}else 0==a.showSKUstatus?(a.setModalStatus(),a.team_sku_type=1,a.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1,skuSvipCurrent:s.stock[0].team_price})):o.toast("请选择商品款式")}else a.setzjModalStatus(t)}function h(){var t=i.getPath.preCheckOrder,e=[{goods_id:a.confirmData[0].goods_id,sku_key:a.confirmData[0].sku_key,num:a.confirmData[0].amount}];e=JSON.stringify(e);var s={order_product:e,team_order:1,team_id:a.itemData.team_id,time_atitude:i.dataBase.userAtitude};o.ApiGateWayTest(t,s,!0,function(t){o.hideLoad(a),1==t.data.success?(a.confirmData[0]["team_order"]=1,a.confirmData[0]["team_id"]=a.itemData.team_id,o.setStorage({key:"nowPay",data:a.confirmData}),wx.navigateTo({url:"/pages/confirm/confirm"})):o.toast(t.data.msg)})}},sameCategoryGoods:function(){var t=this,e=i.getPath.sameCategoryGoods,a={goods_id:t.productId,page_size:10};o.ApiGateWayTest(e,a,!0,function(e){e=e.data.result;t.setData({scgGoodsList:e.products})})},shareTo:function(){this.setData({isShowModeWx:1})},clossShare:function(){this.setData({isShowModeWx:0})},closeShareWx:function(){this.setData({isShowModeWx:0})},closeShareBox:function(){this.setData({isShowbox:0})},closeShareShowSku:function(){this.setData({isShowbox:0}),this.setModalStatus()},onPageScroll:function(t){var e=this;e.navbarOpacity<1&&t.scrollTop>100?e.setData({navbarOpacity:t.scrollTop/500}):e.navbarOpacity>0&&t.scrollTop<200&&e.setData({navbarOpacity:t.scrollTop/500}),t.scrollTop>300?e.setData({showBackTop:!0}):e.setData({showBackTop:!1})},gotoPagetop:function(){wx.pageScrollTo({scrollTop:0})},productGoSP:function(){this.setData({scrollTop:0})},productGoPJ:function(){this.setData({scrollBar:"comment"});var t=this;setTimeout(function(){t.setData({currentLocation:2})},400)},productGoXQ:function(){this.setData({scrollBar:"content"});var t=this;setTimeout(function(){t.setData({currentLocation:3})},400)},openSvip:function(){i.dataBase.pageUrl="http://mc.vip.qq.com/qqwallet/index?_wv=3&aid=mios.p.a.em_spxqy&ADTAG=vipmall&type=!svip&month=1",o.goWebview()},gotoHome:function(t){o.formIdUpdate(t),wx.switchTab({url:"/pages/index/index"})},goBonusPage:function(){this.setData({isShowbox:0}),wx.navigateTo({url:"../rituall/rituall"})},initNavHeight:function(){var t=this;wx.getSystemInfo({success:function(e){t.setData({winWidth:e.windowWidth,winHeight:e.windowHeight})}})},bannerClosed:function(){this.setData({bannerApp:!1})},goToCart:function(t){o.formIdUpdate(t),wx.switchTab({url:"../cart/cart"})},productGoProduct:function(t){var e=t.currentTarget.dataset.id;wx.navigateTo({url:"../product/product?productId="+e})},productGoTheme:function(t){var e=t.currentTarget.dataset.brand;wx.navigateTo({url:"../listdetail/listdetail?cat_id=&title=&brand_id="+e})},productGoComment:function(t){var e=t.currentTarget.dataset.productid;wx.navigateTo({url:"../comment/comment?productId="+e})},aldminishare:function(t){var e=this,a=o.getStorageSync("getpickup"),s="pages/product/product?productId="+e.itemData.goods_id+"&entryType=external&pickup_id="+a.pickup_id,i={};i=t.currentTarget.dataset,i["path"]=s,wx.showToast({title:"分享生成中...",icon:"loading"}),wx.request({method:"post",url:"https://shareapi.aldwx.com/Main/action/Template/Template/applet_htmlpng",data:i,success:function(t){200===t.data.code&&wx.previewImage({urls:[t.data.data]}),e.clossShare(),o.hideLoad(e)},complete:function(){o.hideLoad(e)},fail:function(){o.hideLoad(e)}})},closeSharePic:function(){this.setData({isShowSharePic:!1})},drawPic:function(){var t=this;t.clossShare(),o.showLoad(this);var e="",a="",s=new Promise(function(a,s){wx.getImageInfo({src:t.skuImages,success:function(t){e=t.path,a(t)},fail:function(t){wx.showToast({title:"网络繁忙，无法生成分享图",icon:"none"}),s()}})}),i=o.getStorageSync("getpickup"),r=new Promise(function(e,s){wx.request({url:"https://wx.shop.haoyousheng.com.cn/v1/goods/getWXACodeUnlimit",method:"post",responseType:"arraybuffer",data:{secene:t.productId+"&"+i.pickup_id,page:"pages/product/product",application:"goodBuy"},success:function(t){var i=Date.parse(new Date),o="".concat(wx.env.USER_DATA_PATH,"/").concat("erweima"+i,".","jpg");wx.getFileSystemManager().writeFile({filePath:o,data:t.data,encoding:"binary",success:function(){a=o,e(o)},fail:function(){s(new Error("ERROR_BASE64SRC_WRITE"))}})},fail:function(t){s()}})});Promise.all([s,r]).then(function(s){var i=wx.createCanvasContext("shareImg");i.rect(0,0,283,480),i.setFillStyle("#FFFFFF"),i.fill(),i.beginPath(),i.arc(142,-39,185,0,2*Math.PI),i.setFillStyle("#ffe150"),i.fill();var r=35,n=36,u=10,c=220,d=290;i.beginPath(),i.moveTo(r+u,n),i.arcTo(r+c,n,r+c,n+d,u),i.arcTo(r+c,n+d,r,n+d,u),i.arcTo(r,n+d,r,n,u),i.arcTo(r,n,r+c,n,u),i.setFillStyle("#FFFFFF"),i.setShadow(0,0,15,"#DDDDDD"),i.fill(),i.setShadow(0,0,0,"#ffffff");var l=95,h=275,p=2,m=40,g=16;i.beginPath(),i.moveTo(l+p,h),i.arcTo(l+m,h,l+m,h+g,p),i.arcTo(l+m,h+g,l,h+g,p),i.arcTo(l,h+g,l,h,p),i.arcTo(l,h,l+m,h,p),i.setStrokeStyle("red"),i.closePath(),i.stroke(),i.drawImage(e,66,71,150,150),i.drawImage(a,101,340,80,80),i.setTextAlign("center"),i.setFillStyle("#555555"),i.setFontSize(14),t.itemData.goods_name.length>12?(i.fillText(t.itemData.goods_name.slice(0,12),141.5,245),i.fillText(t.itemData.goods_name.slice(12,24),141.5,265)):i.fillText(t.itemData.goods_name,141.5,245),i.setTextAlign("center"),i.setFillStyle("red"),i.setFontSize(10),i.fillText("抢购价",115,287),i.setTextAlign("center"),i.setFillStyle("red"),i.setFontSize(14),i.fillText("¥"+t.skuSvipCurrent,165,289),i.setTextAlign("center"),i.setFillStyle("#555555"),i.setFontSize(11),i.fillText("长按图片识别小程序码",141.5,445),i.setTextAlign("center"),i.setFillStyle("#AAAAAA"),i.setFontSize(9),i.fillText("*实际价格以页面展示为准",141.5,460),i.setTextAlign("center"),i.setFillStyle("#AAAAAA"),i.setFontSize(12),i.fillText("原价 ¥"+t.skuCurrent,141.5,310),i.beginPath(),i.moveTo(100,305),i.lineTo(183,305),i.setStrokeStyle("#AAAAAA"),i.stroke(),o.hideLoad(t),t.setData({isShowSharePic:!0}),i.stroke(),i.draw(!1,function(){t.TransformationPic()})})},TransformationPic:function(){var e=this;wx.canvasToTempFilePath({x:0,y:0,canvasId:"shareImg",fileType:"jpg",quality:1,success:function(a){console.log(t("分享图生成成功"," at pages\\product\\product.vue:3289")),e.setData({preurl:a.tempFilePath})},fail:function(t){wx.showModal({title:"消息提示",content:"生成分享图失败,请重试",showCancel:!1})}})},saveSharePic:function(){var t=this;o.showLoad(this),wx.saveImageToPhotosAlbum({filePath:t.preurl,success:function(e){o.hideLoad(t),t.setData({isShowSharePic:!1,preurl:null}),wx.showModal({title:"保存成功",content:"分享图保存成功",showCancel:!1})},fail:function(e){o.hideLoad(t),"saveImageToPhotosAlbum:fail auth deny"===e.errMsg&&wx.showModal({title:"提示",content:"未获取相册授权，是否获取",success:function(e){e.confirm?wx.openSetting({success:function(e){e.authSetting["scope.writePhotosAlbum"]?t.saveSharePic():wx.showToast({title:"拒绝授权将无法保存图片",icon:"none",duration:1500})}}):e.cancel&&wx.showToast({title:"拒绝授权将无法保存图片",icon:"none",duration:1500})}})}})},setzjModalStatus:function(e){console.log(t(e," at pages\\product\\product.vue:3366"));var a=wx.createAnimation({duration:250,timingFunction:"linear",delay:0});a.translateY(368).opacity(1).step(),this.setData({animationData:a.export()}),this.setData({showzjModalStatus:!0}),setTimeout(function(){a.translateY("-150px").translateX("-50%").step(),this.setData({animationData:a}),0==e.currentTarget.dataset.status&&this.setData({showzjModalStatus:!1})}.bind(this),200)},rentToggle:function(e){var a=e.currentTarget.dataset.status;a!=this.rentToggleStatus&&(console.log(t(a," at pages\\product\\product.vue:3397")),this.setData({rentToggleStatus:a}))},to_activity:function(t){var e=t.currentTarget.dataset.activity_id;wx.navigateTo({url:"../../packageA/select/select?entryType=external&id="+e})},settingModalStatus:function(){this.setData({showSettingModalStatus:!1})},teamLabel2:function(){var t=this,e=i.getPath.teamLabel,a={team_id:t.itemData.team_id};o.ApiGateWayTest(e,a,!0,function(e){if(1==e.data.success){t.setData({teamLabel:e.data.result.data});var a=(new Date).getTime()/1e3;(t.teamLabel.start_time>a||t.teamLabel.end_time>a)&&(t.setData({showCountDown:!0}),2===t.teamLabel.status?t.countDown(t.teamLabel.start_time):1===t.teamLabel.status&&t.countDown(t.teamLabel.end_time))}})},getTeamList:function(){var e=this,a=i.getPath.teamList,s={goods_id:this.productId};o.ApiGateWayTest(a,s,!0,function(a){a=a.data;1==a.success&&(a.result.data.length>2?(e.setData({teamList:a.result.data.concat(a.result.data),team_num:a.result.data.length}),console.log(t(e.teamList," at pages\\product\\product.vue:3461"))):e.setData({teamList:a.result.data,team_num:a.result.data.length}))})},loadTeamList:function(){var t=this;wx.navigateTo({url:"../../packageA/team-list/team-list?entryType=external&goods_id="+t.productId})},goSetting:function(){var t=this;wx.openSetting({success:function(e){1==e.authSetting["scope.userLocation"]&&t.setData({showSettingModalStatus:!1})}})},change_team:function(){var t=this;o.showLoad(this);var e=i.getPath.remindTeam,a={team_id:t.itemData.team_id,is_notice:t.check_remind?"0":"1"};o.ApiGateWayTest(e,a,!0,function(e){e=e.data;1==e.success&&(1==e.result.status?(t.setData({check_remind:!t.check_remind}),o.toast(e.result.msg)):0==e.result.status?o.toast(e.result.msg):2==e.result.status&&t.setData({showPhoneModal:!0}),o.hideLoad(t))})},activeChangeMe:function(t){var e=this;o.formIdUpdate(t);var a=i.getPath.fastbuy,s={notice_activity_id:e.itemData.notice_activity_id};o.ApiGateWayTest(a,s,!0,function(t){var a=t.data;if(1==a.success)return 1==a.result.status?(o.toast(a.result.msg),void e.setData({check_remind_activity:!e.check_remind_activity})):void(2==a.result.status?e.setData({showPhoneModal:!0}):o.toast(a.result.msg));o.toast(a.msg)})},goCouponList:function(){console.log(t(6666," at pages\\product\\product.vue:3561")),wx.navigateTo({url:"../couponCenter/couponCenter?entryType=external"})},closePhoneModal:function(){this.setData({showPhoneModal:!1})},toShowPhoneModal:function(){this.setData({showPhoneModal:!0})},getPhone:function(t){if(!t.detail.encryptedData||!t.detail.iv)return!1;i.getPath.getWXMobile},back:function(){wx.navigateBack({delta:1})},backHome:function(){wx.switchTab({url:"/pages/index/index"})},setData:function(t){var e=this,a=[];Object.keys(t).forEach(function(s){a=s.split("."),t[s],e.$data,a.forEach(function(a,i){e[s]=t[s]})})}}};e.default=c}).call(this,a("0de9")["default"],a("6e42")["default"])},b685:function(t,e,a){"use strict";a.r(e);var s=a("24f8"),i=a("bcd9");for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);a("d59b");var r=a("2877"),n=Object(r["a"])(i["default"],s["a"],s["b"],!1,null,null,null);e["default"]=n.exports},bcd9:function(t,e,a){"use strict";a.r(e);var s=a("67d1"),i=a.n(s);for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);e["default"]=i.a},cd3e:function(t,e,a){},d59b:function(t,e,a){"use strict";var s=a("cd3e"),i=a.n(s);i.a}},[["3446","common/runtime","common/vendor"]]]);