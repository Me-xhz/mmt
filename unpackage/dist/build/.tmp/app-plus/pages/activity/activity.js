(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/activity"],{"18ad":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=getApp().globalData,n=a("28c1"),o=function(){return a.e("components/countDown/countDown").then(a.bind(null,"513f"))},s={data:function(){return{autoplay:!0,interval:3e3,duration:500,indicatorDots:!0,indicatorColor:"rgba(0,0,0,.2)",indicatorActiveColor:"#FF7F95",shareContent:{},iconURL:i.dataBase.iconURL,showPhoneModal:!1,join_id:0,joinName:"",joinPhone:"",joinAge:"",joinFactory:"",showSkuDrawer:!1,field_data:[],field_upd_data:[],selectedSkuArr:[],selected_field_idx:0,skuArr:[],countTimeDate:0,countTimeType:0,isShowGoHome:!1,entryData:"",ConfigStyle:"",Items:"",preImageWidth:"",preImageHeight:"",animationData:"",skuAnimationData:"",select_label_name:"",goods_id:"",good_idx:"",properties:""}},components:{countdown:o},props:{},onLoad:function(t){var e=this;n.showLoad(this),this.ad_id=t.ad_id,this.activity_id=t.activity_id,this.getActivity(),t&&t.entryType&&"external"==t.entryType?this.setData({isShowGoHome:!1}):this.setData({isShowGoHome:!0}),this.setData({entryData:t});t=e.entryData;var a=n.getStorageSync("getpickup");t&&(t.atitude||t.pickup_id)&&!a&&e.getExternal(t.pickup_id).then(function(){i.firstlaunchApp=!1,e.entryData={},n.setStorageSync("authSetting",{"scope.userLocation":!0})})},onReady:function(){n.hideLoad(this)},onShareAppMessage:function(){var e=this,a=n.getStorageSync("getpickup");return{title:e.shareContent.shareTitle.value,path:"/pages/activity/activity?activity_id="+e.activity_id+"&pickup_id="+a.pickup_id,imageUrl:e.shareContent.shareImage.value,success:function(e){console.log(t("转发成功"," at pages\\activity\\activity.vue:288"))},fail:function(e){console.log(t("转发失败"," at pages\\activity\\activity.vue:291"))}}},methods:{getExternal:function(t){var e=i.getPath.getpickup,a={pickup_id:t};return new Promise(function(t,i){n.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){e=e.data.result.cities.pick_up;n.setStorage({key:"getpickup",data:{pickup_id:e.pickup_id,cityName:e.pickup_name,pickup_address:e.pickup_address,pickup_contact:e.pickup_contact,pickup_phone:e.pickup_phone,pickup_type:e.pickup_type}},function(e){t("获取id成功")}),n.setStorage({key:"city",data:{pickup_id:e.pickup_id,warehouse_id:e.warehouse_id,cityName:e.city_name,is_pick_up:1}})}})})},gotoHome:function(){wx.switchTab({url:"/pages/index/index"})},getActivity:function(){var e=this;wx.request({url:"https://api.activity.haoyousheng.com.cn/api/ActivityApi/activityList",data:{id:e.activity_id},method:"post",success:function(a){var i=a.data,n=JSON.stringify(i.pageList.items),o=n.replace(/px/g,"");e.setData({ConfigStyle:i.pageList.config.style,Items:JSON.parse(o),shareContent:i.pageList.config}),wx.setNavigationBarTitle({title:i.pageList.title});for(var s=0;s<e.Items.length;s++)for(var r=0;r<e.Items[s].children.length;r++)if("countdown"==e.Items[s].children[r].type){var d=(new Date).getTime(),c=new Date(e.Items[s].children[r].data.time.value[0]).getTime(),u=new Date(e.Items[s].children[r].data.time.value[1]).getTime();d<c?e.setData({countTimeType:0,countTimeDate:c}):e.setData({countTimeType:1,countTimeDate:u})}console.log(t(e.countTimeDate," at pages\\activity\\activity.vue:386"))},fail:function(t){wx.hideLoading()}})},imagesLoad:function(t){var e=this,a=t.detail;e.setData({preImageWidth:a.width,preImageHeight:a.height})},hotpotLink:function(t){var e=this,a=t.target.dataset.type,o=t.target.dataset.id;if(1==a){var s=i.getPath.addCoupon,r=n.getStorageSync("isOldUser");if(!i.checkSessionKey||2==r)return n.goRegister(),!1;var d={coupon_id:o};n.ApiGateWayTest(s,d,!0,function(t){200!=t.statusCode||t.data.result.error_desc?n.toast(t.data.result.error_desc):t.data.result?(n.toast(t.data.result.state_desc),e.adclose(e.ad_id,1)):n.toast(t.data.msg)})}else if(2==a)wx.navigateTo({url:"../../pages/product/product?entryType=external&productId="+o});else if(3==a)wx.navigateTo({url:"../../pages/listdetail/listdetail?brand_id="+o});else if(5==a)wx.navigateTo({url:"../../pages/projectPage/projectPage?entryType=external&type=3&id="+o});else if(6==a)wx.navigateTo({url:"../../pages/projectPage/projectPage?entryType=external&type=5&id="+o});else if(7==a)wx.switchTab({url:"/pages/index/index"});else if(8==a){r=n.getStorageSync("isOldUser");if(!i.checkSessionKey||2==r)return n.goRegister(),!1;var c=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});c.translateY(300).opacity(1).step(),e.setData({animationData:c.export()});var u=i.getPath.enrolluser,l={type:1,activity_id:o};n.ApiGateWayTest(u,l,!0,function(a){if(200==a.statusCode)if(0==a.data.result.status){var i=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});i.translateY(300).opacity(1).step(),e.setData({animationData:i.export()}),e.setData({join_id:o,showPhoneModal:!0}),setTimeout(function(){i.translateY("-150px").translateX("-50%").step(),e.setData({animationData:i}),0==t.currentTarget.dataset.status&&e.setData({showPhoneModal:!1})}.bind(e),200),e.setData({field_data:a.data.result.data})}else n.toast(a.data.result.msg);else n.toast("网络错误请重试！")})}},adclose:function(t,e){var a=i.getPath.adclose,o={ad_id:t,is_close:e};n.ApiGateWayTest(a,o,!0,function(t){})},countdown:function(){},phoneMaskSubmit:function(){var t=this;if(0!=t.joinName.length)if(0!=t.joinPhone.length)if(0!=t.joinAge.length)if(0!=t.joinFactory.length){var e=i.getPath.enrolluser,a={type:2,real_name:t.joinName,mobile:t.joinPhone,factory_name:t.joinFactory,age:t.joinAge,activity_id:t.join_id};n.ApiGateWayTest(e,a,!0,function(e){200==e.statusCode?(t.setData({joinName:"",joinPhone:"",joinAge:"",joinFactory:"",showPhoneModal:!1}),n.toast(e.data.result.msg)):n.toast("网络错误请重试！")})}else n.toast("请填写工厂名称");else n.toast("请填写年龄");else n.toast("请填写手机号码");else n.toast("请填写姓名")},phoneMaskCancel:function(){this.setData({joinName:"",joinPhone:"",joinAge:"",joinFactory:"",showPhoneModal:!1})},inputInfo:function(t){1==t.currentTarget.dataset.item?this.setData({joinName:t.detail.value}):2==t.currentTarget.dataset.item?this.setData({joinPhone:t.detail.value}):3==t.currentTarget.dataset.item?this.setData({joinAge:t.detail.value}):4==t.currentTarget.dataset.item&&this.setData({joinFactory:t.detail.value})},showSkuDrawerHandle:function(){var t=wx.createAnimation({duration:500,timingFunction:"ease"});this.showSkuDrawer?t.bottom(-700).step():t.bottom(0).step(),this.setData({skuAnimationData:t.export(),showSkuDrawer:!this.showSkuDrawer})},showSku:function(t){var e=t.currentTarget.dataset.idx,a=this.field_data[e].field_list;this.setData({select_label_name:this.field_data[e].label_name,goods_id:this.field_data[e].field_list[0].goods_id,selectedSkuArr:a,selected_field_idx:e}),this.showSkuDrawerHandle(),this.selectGood()},selectGood:function(t){if(t)var e=t.currentTarget.dataset.index,a=t.currentTarget.dataset.goodid;else e=0,a=this.goods_id;var i=this.selectedSkuArr[e];this.setData({goods_id:a,good_idx:e,properties:i,skuArr:[]});for(var o=[],s=0;s<i.spec_name.length;++s){var r=i.spec_name[s];o[s]=[];for(var d=0;d<r.attrs.length;d++)o[s].push(r.attrs[d].id)}o=n.multiCartesian(o),this.maybeStock=o},selectAttr:function(t){var e=t.currentTarget.dataset.idx,a=t.currentTarget.dataset.attr.id,i=this.skuArr.concat();if(i[e]=a,this.properties.spec_name.length==i.length){var o=i.join("_"),s=!1;if(this.properties.spec_key.forEach(function(t){t==o&&(s=!0)}),!s)return n.toast("商品无库存"),!1}this.setData({skuArr:i})},affirm:function(){var t=this.skuArr,e=this.properties.goods_name;if(t.length<this.properties.spec_name.length)return n.toast("请选择规格"),!1;this.properties.spec_name.forEach(function(a,i){for(var n in a.attrs)a.attrs[n].id==t[i]&&(e+="/"+a.attrs[n].item)});var a=this.field_data;a[this.selected_field_idx].val=e;var i=this.field_upd_data;i[this.selected_field_idx]=this.goods_id+"+"+t.join("_"),this.setData({field_upd_data:i,field_data:a}),this.showSkuDrawerHandle()},inputBind:function(t){var e=t.detail.value,a=t.target.dataset.idx,i=this.field_upd_data;i[a]=e,this.setData({field_upd_data:i})},field_upd:function(){var t=this,e=this.field_upd_data.length,a=this.field_data.length;if(e<a)return n.toast("请填写所有数据"),!1;for(var o=0;o<a;o++)if(void 0==this.field_upd_data[o]||""==this.field_upd_data[o])return n.toast("请填写所有数据"),!1;var s=this.field_data,r=[];s.forEach(function(t){r.push(t.field_id)});var d=i.getPath.enrolluser,c={type:2,name_key:r.join(","),name:this.field_upd_data.join(","),activity_id:t.join_id};n.ApiGateWayTest(d,c,!0,function(e){200==e.statusCode?(t.setData({joinName:"",joinPhone:"",joinAge:"",joinFactory:"",showPhoneModal:!1}),t.adclose(t.ad_id,1),n.toast(e.data.result.msg)):n.toast("网络错误请重试！")})},goProduct:function(t){var e=t.currentTarget.dataset.id;wx.navigateTo({url:"../../pages/product/product?entryType=external&productId="+e})},setData:function(t){var e=this,a=[];Object.keys(t).forEach(function(i){a=i.split("."),t[i],e.$data,a.forEach(function(a,n){e[i]=t[i]})})}}};e.default=s}).call(this,a("0de9")["default"])},"5fe8":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},"63f8":function(t,e,a){},a380:function(t,e,a){"use strict";var i=a("63f8"),n=a.n(i);n.a},af05:function(t,e,a){"use strict";a.r(e);var i=a("18ad"),n=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=n.a},c916:function(t,e,a){"use strict";a.r(e);var i=a("5fe8"),n=a("af05");for(var o in n)"default"!==o&&function(t){a.d(e,t,function(){return n[t]})}(o);a("a380");var s=a("2877"),r=Object(s["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports}},[["2a63","common/runtime","common/vendor"]]]);