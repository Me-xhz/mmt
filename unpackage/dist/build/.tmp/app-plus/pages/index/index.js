(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{5146:function(t,e,a){"use strict";a.r(e);var i=a("8da0"),s=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=s.a},"8da0":function(t,e,a){"use strict";(function(t,i){function s(t){return r(t)||n(t)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function n(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function r(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=getApp().globalData,u=(getApp(),a("28c1")),d=a("b6a1"),p=function(){return a.e("components/countDown/countDown").then(a.bind(null,"513f"))},h=function(){return a.e("components/goodList/goodList").then(a.bind(null,"bc0e"))},g=function(){return a.e("components/subject/subject").then(a.bind(null,"b666"))},l=function(){return a.e("pages/index/configureModel/configureModel").then(a.bind(null,"3b6f"))},_=function(){return a.e("components/no_warehouse/no_warehouse").then(a.bind(null,"6de5"))},f=function(){return a.e("components/pickUpActivity/pickUpActivity").then(a.bind(null,"78cd"))},m=function(){return a.e("components/loadingBottom/loadingBottom").then(a.bind(null,"e834"))},v={data:function(){return{switch_index:!0,pickup:{cityName:"请选择提货点"},navBarHeight:c.navBarHeight,showTissue:!1,listScroll:!0,showAdver:!1,indicatorDots:!1,autoplay:!1,buy_now:0,showSearchBG:!1,scrollTop:0,duration:500,interval:5e3,singleAdcurrent:0,indexAdcurrent:0,indicatorColor:"#fff",indicatorActiveColor:"#eb3c39",circular:!0,adList:[],service_title:[],barList:[],acticity_new_person:[],acticity_buy:{},page_size:10,shopList:[],page:1,refresh:!0,checkSessionKey:c.checkSessionKey,iconURL:c.dataBase.iconURL,showCouponList:!1,flashSale_title:"",ac_load_btn:!0,actived_idx:1,activity_id:0,activitylist:[],good_list:[],total:0,timer_btn:!1,singleAd:[],advertisementAd:[],AdClickBtn:!0,isGoodListBool:!1,productId:0,itemData:{},showSKUstatus:0,optionalAttrs:{},skuImages:"",bannerItem:[],buynum:1,firstIndex:-1,choosed_sku:"",cartAmount:0,undel:!0,unadd:!1,isPriceEqual:!1,canPurchase:!1,indexModel:null,newFactoryList:[],share_data:{share_title:"",share_img:""},showOfficial:!0,showTips:!0,pickUpActivity:{},takeoutAnimation:!1,choosePickupShow:!1,chooseSelectIndex:0,choosePickupList:[],showMoreTips:!1,shop_id:0,showPacketAd:!0,showPacketCoupon:!1,subjectAdList:[],packetModal:[],teamNum:0,teamGoodsList:[],team_page:1,team_page_size:20,bargain_page:1,bargain_page_size:20,be_team_page:1,be_team_page_size:20,bargainList:[],teamList:[],beTeamList:[],sliderBarFixed:!1,showCouponsSuccess:!1,showPhoneModal:!1,getRemind:!1,checkShowBottom:!1,showBottomLoading:!1,homeSituation:{},showRedEnvel:!1,showRedEnvelType:1,confirmData:{},entryData:"",recommendList:[],height:"",isAuthorization:"",signcheckStatus:"",showCloseImg:!1,popupCouponsList:"",to_top:!1,animationData:"",showModalStatus:!1,productid:0,showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1,brandID:"",skuSvipCurrent:"",skuCurrent:"",sku_price:"",min_sku_price:"",sku_svip_price:"",min_sku_svip_price:"",currentStock:"",hasDefaultSKU:"",sumbitName:"",indexModel2:"",loadingShow:!1,showPage:!0,city:{}}},components:{countDown:p,goodList:h,subject:g,configuremodel:l,no_warehouse:_,pickupgoods:f,loadingbottom:m},props:{},onLoad:function(e){var a=this;setTimeout(function(){a.loadData()},1e3),console.log(t("onLoad"," at pages\\index\\index.vue:965"));var s=this;this.showPage&&this.getNewFactory(),i.$on("update",function(t){s.showPage=t.showPage}),u.showLoad(this),wx.showShareMenu({withShareTicket:!0}),u.setStorageSync("reLoad",!0);u.getStorageSync("getpickup");this.setData({entryData:e}),d.on("show",this,function(t){this.setData({showCouponsSuccess:!1,AdClickBtn:!0})}),d.on("hide",this,function(t){this.setData({showOfficial:!1})}),c.checkSessionKey||d.on("checkSessionKey",this,function(t){this.checkSessionKey=t}),this.getPacketModal()},onReady:function(){u.hideLoad(this)},onShow:function(t){var e=t||this,a=u.getStorageSync("getpickup");if(e.pickup=a,e.setInviteShareLogin(),0==a.pickup_type&&e.signcheck(),a&&e.pickup.pickup_id!=a.pickup_id&&void 0!=e.pickup.pickup_id&&(0==a.pickup_type?e.loadData():e.getPickUpAcitivity(),e.setData({pickup:a})),u.getStorageSync("reLoad")){u.setStorageSync("reLoad",!1),e.setData({pickup:u.getStorageSync("getpickup"),good_list:[],page:1});var i=e.entryData;i&&"true"==i.tissue&&this.setData({showTissue:!0}),!i||!i.atitude&&!i.pickup_id||a?(e.local(function(t){var i={city:t,isAuthorization:u.getStorageSync("authSetting")["scope.userLocation"]};if(e.setData(i),c.firstlaunchApp=!1,-1==t.warehouse_id||!a.pickup_id)return i.showPage=!1,e.setData(i),!1;e.showAddTips(),i.showPage=!0,e.setData(i),e.setData({page:1,shopList:[],recommendList:[],good_list:[]}),0==a.pickup_type?(e.loadData(t),e.getAdvertisement()):(e.getPickUpAcitivity(t),e.getAdvertisement()),e.getIndexShareInfo(),e.getShopPickUp()}),wx.getSystemInfo({success:function(t){e.setData({height:t.windowWidth/1.70454545})}})):i.atitude?e.getExternal(i.atitude,1).then(function(){c.firstlaunchApp=!1,e.entryData={};var t=u.getStorageSync("city"),a=u.getStorageSync("getpickup"),i={pickup:a,city:t,isAuthorization:!0,showPage:!0};e.setData(i),e.loadData(t),u.setStorageSync("authSetting",{"scope.userLocation":!0})}):e.getExternal(i.pickup_id,2).then(function(){c.firstlaunchApp=!1,e.entryData={};var t=u.getStorageSync("city"),a=u.getStorageSync("getpickup"),i={pickup:a,city:t,isAuthorization:!0,showPage:!0};e.setData(i),e.loadData(t),u.setStorageSync("authSetting",{"scope.userLocation":!0})})}else 0==a.pickup_type&&e.getHomeSituation()},onReachBottom:function(){console.log(t("滑到最底部执行事件"," at pages\\index\\index.vue:1190"));var e=u.getStorageSync("getpickup");0==e.pickup_type?this.refresh&&(this.setData({page:this.page+1}),this.getIndexProducts()):1==this.teamNum?this.bargainList.length>0&&this.bargainList.length%this.bargain_page_size==0&&(this.bargain_page=this.bargainList.length/this.bargain_page_size+1,this.setData({showBottomLoading:!0}),this.getBargainActivity()):0==this.teamNum?this.teamList.length>0&&this.teamList.length%this.team_page_size==0&&(this.team_page=this.teamList.length/this.team_page_size+1,this.setData({showBottomLoading:!0}),this.getTeamList()):2==this.teamNum&&this.beTeamList.length>0&&this.beTeamList.length%this.be_team_page_size==0&&(this.be_team_page=this.beTeamList.length/this.be_team_page_size+1,this.setData({showBottomLoading:!0}),this.getBeTeamList())},onPullDownRefresh:function(){this.setData({page:1,shopList:[],recommendList:[],good_list:[],showAdver:!1,showCouponsSuccess:!1}),u.setStorageSync("reLoad",!0),0==this.pickup.pickup_type?this.loadData():this.getPickUpAcitivity()},onShareAppMessage:function(t){var e=this,a=u.getStorageSync("getpickup"),i=u.getStorageSync("entry_share_info");if(t.target&&t.target.dataset.shareinfo){var s=t.target.dataset.shareinfo;return s&&"notice"==s.fromButton?{title:i.urge_share_text,path:"/pages/index/index?pickup_id="+a.pickup_id+"&user_id="+i.user_id,imageUrl:i.urge_share_img}:s&&"envelopes"==s.fromButton?{title:i.invite_share_text,path:"/pages/index/index?pickup_id="+a.pickup_id+"&user_id="+i.user_id,imageUrl:i.invite_share_img}:{title:e.share_data.share_title,path:"/pages/index/index?pickup_id="+a.pickup_id,imageUrl:e.share_data.share_img}}return{title:e.share_data.share_title,path:"/pages/index/index?pickup_id="+a.pickup_id,imageUrl:e.share_data.share_img}},created:function(){},methods:{navPick2:function(){var e=u.getStorageSync("city");console.log(t(e," at pages\\index\\index.vue:1295")),i.navigateTo({url:"/pages/pickup2/pickup2?warehouse_id=".concat(e.warehouse_id)})},getExternal:function(e,a){var i=c.getPath.getpickup;if(console.log(t("获取提货点"," at pages\\index\\index.vue:1305")),1==a)var s={atitude:e};else s={pickup_id:e};return new Promise(function(e,o){u.ApiGateWayTest(i,s,!0,function(i){if(console.log(t("获取提货点",i," at pages\\index\\index.vue:1319")),i&&i.data&&1==i.data.success){if(1==a)i=i.data.result.cities;else i=i.data.result.cities.pick_up;u.setStorage({key:"city",data:{pickup_id:i.pickup_id,warehouse_id:i.warehouse_id,cityName:i.city_name,is_pick_up:1}}),u.setStorage({key:"getpickup",data:{pickup_id:i.pickup_id,pickup_type:i.pickup_type,cityName:i.pickup_name,pickup_address:i.pickup_address,pickup_contact:i.pickup_contact,pickup_phone:i.pickup_phone}},function(t){e("获取id成功")})}})})},closeTips:function(){this.setData({showTips:!1})},showAddTips:function(){var t=this;setTimeout(function(){t.setData({showTips:!1})},1e4)},toShowTips:function(){this.setData({showMoreTips:!0})},closeAllTips:function(){this.setData({showMoreTips:!1,showTips:!1})},loadData:function(t){var e=u.getStorageSync("warehouse_id");t&&(t.warehouse_id!=e&&this.getAdvertisement(),u.setStorageSync("warehouse_id",t.warehouse_id));var a=this;Promise.all([a.getpickuplistr(),a.getAd(),a.getBar(),a.getsingleAd(),a.getIndexProducts(),a.getHomeSituation()]).then(function(t){if(!t[0])return u.setStorageSync("reLoad",!0),void a.$options.onShow[0](a);wx.stopPullDownRefresh()}),wx.createSelectorQuery?wx.createSelectorQuery().select("#topHeight").boundingClientRect(function(t){t&&t.top&&a.setData({scrollTop:t.top})}).exec():wx.showModal({title:"提示1",content:"当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。"})},getNewFactory:function(t){var e=this;e.getAdvertisement(),e.getNewAd(),e.getSubjectAd();var a=c.getPath.newFactory;u.ApiGateWayTest(a,"",!0,function(t){var a=t.data;1==a.success?(e.setData({newFactoryList:a.result.data}),wx.stopPullDownRefresh()):u.toast(a.msg)})},getIndexShareInfo:function(){var t=this,e=c.getPath.indexShareInfo,a={type:5};u.ApiGateWayTest(e,a,!0,function(e){var a=e.data;1==a.success?""!=a.result.data&&null!=a.result.data&&t.setData({share_data:a.result.data}):u.toast(a.msg)})},local:function(e){var a=this;a.setData({isAuthorization:u.getStorageSync("authSetting")["scope.userLocation"]});var i=u.getStorageSync("city"),s=u.getStorageSync("getpickup");c.firstlaunchApp&&void 0==s.pickup_id?(a.isAuthorization&&u.showLoad(a),u.getpickup(function(i){var s=i.cities;if(s.choose_pickup&&s.choose_pickup.length>1)return console.log(t("if"," at pages\\index\\index.vue:1510")),a.setData({choosePickupShow:!0,choosePickupList:s.choose_pickup}),e&&"function"===typeof e&&e(s),void u.hideLoad(a);u.setStorageSync("reLoad",!0),a.$options.onShow[0](a),e&&"function"===typeof e&&e(s),u.hideLoad(a)})):e&&"function"===typeof e&&e(i)},openSet:function(t){var e=this;e.setData({isAuthorization:t.detail.isAuthorization}),u.setStorageSync("reLoad",!0),c.dataBase.isRefresh=!0,e.$options.onShow[0](e)},goCategory:function(){wx.switchTab({url:"/pages/category/category"})},signcheck:function(){var t=this,e=c.getPath.signcheck;return new Promise(function(a,i){u.ApiGateWayTest(e,{},!0,function(e){if(e&&e.data&&1==e.data.success){var i=e.data.result;t.setData({signcheckStatus:i.status}),a("success signcheck")}})})},to_sign:function(){var t=u.getStorageSync("isOldUser");c.checkSessionKey&&2!=t||wx.navigateTo({url:"/pages/register/register?isGetCoupon=1"});u.getStorageSync("getpickup");0==this.signcheckStatus?wx.navigateTo({url:"/pages/sign/sign?entryType=external"}):1==this.signcheckStatus&&wx.navigateTo({url:"/packageB/tools/turntable"})},getAd:function(){var e=this,a=c.getPath.adlist,i={pid:1};return new Promise(function(s,o){u.ApiGateWayTest(a,i,!0,function(a){if(a&&a.data&&1==a.data.success){var i=a.data.result;i.length>1?e.setData({indicatorDots:!0}):e.setData({indicatorDots:!1}),e.setData({adList:i,indexAdcurrent:0,indicatorDots:i.length>1}),console.log(t("adList",e.adList," at pages\\index\\index.vue:1622")),s("successAd")}})})},getNewAd:function(){var t=this,e=c.getPath.adlist,a={pid:6};return new Promise(function(i,s){u.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){var a=e.data.result;a.length>1?t.setData({indicatorDots:!0}):t.setData({indicatorDots:!1}),t.setData({adList:a,indexAdcurrent:0,indicatorDots:a.length>1}),i("successAd")}})})},goWebView:function(e){var a=e.currentTarget.dataset.item,i=e.currentTarget.dataset.type;if(console.log(t("type",i," at pages\\index\\index.vue:1669")),1==i)u.getStorageSync("getpickup");else if(2==i)u.getStorageSync("getpickup");else if(3==i)u.getStorageSync("getpickup");else if(4==i)u.getStorageSync("getpickup");if(9!=a.media_type)u.goAdWebView(e),this.adclose(a.ad_id,0),this.setData({showAdver:!1});else if(9==a.media_type){var s=u.getStorageSync("isOldUser");if(!c.checkSessionKey||2==s)return u.goRegister(),!1;this.getCoupons(a.ad_id)}},getDate:function(){var t=this;this.timer=setInterval(function(){var e=Math.floor((new Date).getTime()/1e3),a=t.actived_idx,i=t.activitylist[a].progress.start_time/1e3-e,s=t.activitylist[a].progress.end_time/1e3-e;-3!=i&&-3!=s||(u.showLoad(t),t.setData({page:1,good_list:[],timer_btn:!0}),t.getActivitylist())},1e3)},actived:function(t){var e=this,a=t.currentTarget.dataset;if(!e.ac_load_btn)return!1;e.setData({activity_id:a.activity_id,actived_idx:a.actived_idx,page:1,good_list:[]}),e.getActivitygoodslist()},getActivitylist:function(){var t=this,e=c.getPath.activitylist;return new Promise(function(a,i){u.ApiGateWayTest(e,{},!0,function(e){e=e.data;if(1==e.success){var i=0,s=0,o=e.result.lists;if(0==o.length)return t.setData({activitylist:[],activity_id:i,actived_idx:s,flashSale_title:""}),!1;t.getDate();for(var n=!0,r=0;r<o.length;r++){var c=o[r].progress.state;if(1==c){i=o[r].activity_id,s=r,n=!1;break}}if(n)for(r=0;r<o.length;r++){c=o[r].progress.state;if(2==c){i=o[r].activity_id,s=r,n=!1;break}}n&&(i=o[2].activity_id,s=2),t.setData({activitylist:o,activity_id:i,actived_idx:s,flashSale_title:"下单无门槛，全场免邮费"}),t.getActivitygoodslist(),a("getActivitylist success")}})})},getActivitygoodslist:function(t){var e=this;u.showLoad(e),e.ac_load_btn=!1;var a=c.getPath.activitygoodslist,i={page:this.page,page_size:this.page_size,activity_id:this.activity_id};u.ApiGateWayTest(a,i,!0,function(t){if(500==t.statusCode)return u.hideLoad(e),!1;t=t.data;var a=e.activitylist[e.actived_idx];for(var i in e.activitylist)if(e.activitylist[i].activity_id==e.activity_id)a=e.activitylist[i].progress.state;if(1==t.success){for(var s=t.result.lists,o=0;o<s.length;o++)s[o].state=a;var n=e.good_list?e.good_list.concat(s):s;if(n.length>0)var r=!1;else r=!0;e.setData({good_list:n,total:t.result.total,isGoodListBool:r}),e.good_list.length<e.total?e.refreshFun(!0):e.refreshFun(!1),e.ac_load_btn=!0,u.hideLoad(e)}})},getsingleAd:function(){var t=this,e=c.getPath.adlist,a={pid:4};u.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){var a=e.data.result;t.setData({singleAd:a,singleAdcurrent:0})}})},getCoupon:function(t,e,a){var i=this;if(!this.AdClickBtn)return!1;this.AdClickBtn=!1;var s=c.getPath.addCoupon,o={coupon_id:t};u.ApiGateWayTest(s,o,!0,function(t){if(t&&t.data&&1==t.data.success){t.data.result;i.adclose(e,1),i.setData({showCouponList:!0}),2==a&&i.setData({showCloseImg:!0})}else i.AdClickBtn=!0})},getCoupons:function(t){var e=this;if(!this.AdClickBtn)return!1;this.AdClickBtn=!1;var a=c.getPath.addAdCoupon,i={ad_id:t};u.ApiGateWayTest(a,i,!0,function(t){var a=t.data;if(1!=a.success||0!=a.result.state)return e.setData({showAdver:!1}),e.AdClickBtn=!0,void u.toast(a.result.state_desc);e.setData({popupCouponsList:a.result.couponInfo,showAdver:!1,showCouponsSuccess:!0})})},adclose:function(t,e){var a=c.getPath.adclose,i={ad_id:t,is_close:e};u.ApiGateWayTest(a,i,!0,function(t){})},getAdvertisement:function(){var t=this,e=c.getPath.adlist,a={pid:5};u.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){var a=e.data.result;if("object"==typeof a&&a.constructor==Array&&a[0].ad_code&&""!=a[0].ad_code){u.getStorageSync("getpickup");t.setData({advertisementAd:a,showAdver:!0,showCouponsSuccess:!1})}else 9==a[0].media_type&&""==a[0].ad_code?(t.setData({advertisementAd:a,showAdver:!1}),t.getCoupons(a[0].ad_id)):t.setData({showAdver:!1})}})},advertisementOut:function(t){var e=this,a=t.detail.target.dataset.ad_id;c.checkSessionKey&&(u.formIdUpdate(t),a&&a>0&&e.adclose(a,0)),e.setData({showAdver:!1,showCouponsSuccess:!1,AdClickBtn:!0})},getBar:function(){var t=this,e=c.getPath.barList;return new Promise(function(a,i){u.ApiGateWayTest(e,"",!0,function(e){if(e&&e.data&&1==e.data.success){for(var i=e.data.result,s=0;s<i.barList.length;s++)switch(i.barList[s].type){case 1:i.barList[s].url="/pages/sign/sign?entryType=external";break;case 2:i.barList[s].url="/pages/couponCenter/couponCenter?entryType=external";break;case 3:i.barList[s].position>0?i.barList[s].url="/pages/index/configureModelPage/configureModelPage?position="+i.barList[s].position:i.barList[s].url="/pages/projectPage/projectPage?entryType=external&type=3&id="+i.barList[s].id;break;case 4:i.barList[s].url="/pages/activity/activity?entryType=external&activity_id="+i.barList[s].id;break;case 5:i.barList[s].url="/pages/flashSale/flashSale";break;case 6:i.barList[s].url="../../packageB/topay/topay";break;case 7:i.barList[s].url="/packageA/select/select?entryType=external&id="+i.barList[s].id;break;case 8:i.barList[s].url="/packageA/bargain/bargain?entryType=external&activity_bargain_id="+i.barList[s].id;break;default:i.barList[s].url=""}t.setData({barList:i.barList,service_title:i.service_title}),a("barSuccess")}else u.toast("网络错误")})})},goBar:function(e){var a=e.currentTarget.dataset.url;e.currentTarget.dataset.index,u.getStorageSync("getpickup");console.log(t(a," at pages\\index\\index.vue:2259")),c.checkSessionKey&&u.formIdUpdate(e),wx.navigateTo({url:a})},getActivitynewperson:function(){var t=this,e=c.getPath.activitynewperson;return new Promise(function(a,i){u.ApiGateWayTest(e,"",!0,function(e){if(e&&e.data&&1==e.data.success){var i=e.data.result;t.setData({acticity_new_person:i.acticity_new_person}),a("barSuccess")}})})},getActivityindex:function(){var t=this,e=c.getPath.activityindex;return new Promise(function(a,i){u.ApiGateWayTest(e,"",!0,function(e){if(e&&e.data&&1==e.data.success){var i=e.data.result;t.setData({acticity_buy:i.acticity_buy}),a("barSuccess")}else u.toast("网络错误")})})},getIndexProducts:function(t){var e=this,a=c.getPath.goodsRecommend,i={page:this.page,page_size:this.page_size};return new Promise(function(t,s){u.ApiGateWayTest(a,i,!0,function(a){if(a&&a.data){var i=a.data;if(1==i.success){var s=i.result.products;e.setData({shopList:e.shopList.concat(s)}),i.result.products.length<e.page_size?(e.refreshFun(!1),e.setData({showBottomLoading:!1})):(e.refreshFun(!0),e.setData({showBottomLoading:!0}))}else 0==i.success&&e.refreshFun(!1);t("productsSuccess")}else u.toast("网络错误")})})},refreshFun:function(t){this.setData({refresh:t})},goSearch:function(){wx.navigateTo({url:"../search/search?keyWord="+this.keyWord})},tap_to_top:function(){wx.pageScrollTo({scrollTop:0,duration:300})},onPageScroll:function(t){var e=this,a=wx.createSelectorQuery();a.select("#slider-bar-team").boundingClientRect(function(t){t&&t.top&&(t.top<e.navBarHeight&&!e.sliderBarFixed?e.setData({sliderBarFixed:!0}):t.top>e.navBarHeight&&e.sliderBarFixed&&e.setData({sliderBarFixed:!1}))}).exec(),t.scrollTop>150&&!e.to_top?e.setData({to_top:!0}):t.scrollTop<150&&e.to_top&&e.setData({to_top:!1}),this.takeoutAnimation?this.endScroll():this.setData({takeoutAnimation:!0})},endScroll:function(){clearTimeout(this.scroll),this.scroll=setTimeout(function(){this.takeoutAnimation&&this.setData({takeoutAnimation:!1})}.bind(this),500)},goToProduct:function(t){var e=t.currentTarget.dataset.goodsId;t.currentTarget.dataset.name,u.getStorageSync("getpickup");c.checkSessionKey&&u.formIdUpdate(t),wx.navigateTo({url:"/pages/product/product?entryType=external&productId="+e})},setModalStatus:function(t){0==this.showSKUstatus?this.showSKUstatus=1:this.showSKUstatus=0;var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),1==this.showSKUstatus&&this.setData({showModalStatus:!0}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==this.showSKUstatus&&this.setData({showModalStatus:!1})}.bind(this),200)},addShopCart:function(t){var e=u.getStorageSync("isOldUser");if(!c.checkSessionKey||2==e)return u.goRegister(),!1;var a=this;function i(t){if(a.checkCanPurchase()){var e=a.itemData,i=t.currentTarget.dataset.type;if(a.setData({buy_now:0}),a.currentAttrs.length==e.properties.length){var s="";for(var o in e.stock){var n=e.stock[o].key;n=n.split("_"),n.sort(function(t,e){return t-e}),n=n.join("_");var r=a.currentAttrs.join("_");if(r==n){s=e.stock[o].key;break}}var d=c.getPath.addCart;e.pre_info&&1==e.pre_info.is_pre&&(d=c.getPath.addCart);var p={goods_id:e.goods_id,sku_key:s,amount:a.buynum};u.formIdUpdate(t),u.ApiGateWayTest(d,p,!0,function(t){t&&(0!=t.data.success?(a.currentAttrs=[],a.setData({cartAmount:t.data.result.cart_num,productid:0}),u.toast(t.data.msg),"bottomcart"==i&&a.setData({showModalStatus:!1,showSKUstatus:0})):u.toast(t.data.msg))})}else 0==a.showSKUstatus?(a.setModalStatus(i),a.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):u.toast("请选择商品款式")}}this.productid==t.target.dataset.productid?i(t):this.loadProductDetail(t).then(function(){i(t)})},nowPurchase:function(t){var e=this,a=u.getStorageSync("isOldUser");if(!c.checkSessionKey||2==a)return u.goRegister(),!1;function i(t){if(e.checkCanPurchase()){var a=e.itemData;if(e.setData({buy_now:1}),e.currentAttrs.length==a.properties.length){var i="";for(var s in a.stock){var o=a.stock[s].key;o=o.split("_"),o.sort(function(t,e){return t-e}),o=o.join("_");var n=e.currentAttrs.join("_");if(n==o){i=a.stock[s].key;break}}var r=c.getPath.skuEnough;a.pre_info&&1==a.pre_info.is_pre&&(r=c.getPath.skuEnough);var d={goods_id:a.goods_id,sku_key:i,amount:e.buynum};u.formIdUpdate(t),u.ApiGateWayTest(r,d,!0,function(t){t&&(1==t.data.result.is_enough?(e.currentAttrs=[],e.setData({showModalStatus:!1,showSKUstatus:0,cartAmount:t.data.result.cart_num,productid:0}),wx.navigateTo({url:"/pages/confirm/confirm"})):u.toast(t.data.result.msg))})}else 0==e.showSKUstatus?(e.setModalStatus(),e.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):u.toast("请选择商品款式");u.setStorage({key:"nowPay",data:e.confirmData})}}e.productid==t.target.dataset.productid?i(t):e.loadProductDetail(t).then(function(){i(t)})},loadProductDetail:function(t){var e=t.target.dataset.productid;this.setData({productid:t.target.dataset.productid});var a=this;u.showLoad(a);var i=c.getPath.goodsInfo,s=c.getPath.getSkuAmount,o={goods_id:e};return new Promise(function(t,e){u.ApiGateWayTest(i,o,!0,function(e){if(200==e.statusCode){var i=e.data.result;i.goods_content,i.detail_explain,i.is_liked;i.current_price=i.shop_price,i.price=i.market_price,a.setData({itemData:i,bannerItem:i.gallery,indicatorDots:i.gallery.length>1,buynum:i.min_buy_amount,brandID:i.cat_id,skuSvipCurrent:i.shop_price,skuCurrent:i.market_price}),a.setDefaultSKU(i),a.isPriceEqualFun(),u.hideLoad(a)}else{if(500==e.statusCode)return void u.hideLoad(a);u.hideLoad(a),u.toast("获取购物车数量失败")}t("获取商详信息")}),u.ApiGateWayTest(s,"",!0,function(t){200==t.statusCode&&a.setData({cartAmount:t.data.result.cart_num})})})},setDefaultSKU:function(t){for(var e=[],a=null,i=[],s=[],o=0;o<t.properties.length;++o){var n=t.properties[o];if(!n.is_multiselect){i[o]=[];for(var r=0;r<n.attrs.length;r++)i[o].push(n.attrs[r].id)}}if(i=u.multiCartesian(i),i.length&&i[0]instanceof Array)for(o=0;o<i.length;o++)i[o].sort(function(t,e){return t-e});this.setData({canPurchase:this.checkCanPurchase()});var c=9999999999,d=9999999999;for(o=0;o<t.stock.length;++o){var p=t.stock[o].key.split("_"),h=t.stock[o].market_price,g=t.stock[o].price;if(d>g){var l=[];if(t.is_goods_number>0&&t.is_on_sale&&t.stock[o].is_enough){for(var _=0,f=p.length;_<f;_++)l.push(parseInt(p[_]));e=l,a=[{attrs:e,stock:t.stock[o]}],!0,d=g,c=h}else if(!t.is_goods_number>0||!t.is_on_sale){for(_=0,f=p.length;_<f;_++)l.push(parseInt(p[_]));e=l,a=[{attrs:e,stock:t.stock[o]}],!0,d=g,c=h}}p.sort(function(t,e){return t-e}),p=p.join("_");for(r=0;r<i.length;r++){var m="";m=i[r]instanceof Array?i[r].join("_"):i[r]instanceof Object?"":i[r],p==m&&1==t.stock[o].is_enough&&s.push({attrs:i[r],stock:t.stock[o]})}}var v=this.itemData.current_price,k=this.itemData.price;if(this.setData({sku_price:c,min_sku_price:c,sku_svip_price:d,min_sku_svip_price:d,skuSvipCurrent:parseFloat(v).toFixed(2),skuCurrent:k,currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku(),e=[],a=null,this.setData({currentStock:null,hasDefaultSKU:!1}),this.currentAttrs=[],1==s.length&&(e=s[0].attrs instanceof Array?s[0].attrs:[s[0].attrs],a=s[0].stock),s.length>1)for(var o in t.properties){var y=t.properties[o].attrs;for(var r in y){var S=0;for(var w in s){var b=new RegExp(y[r].id).test(s[w].attrs);b&&S++}S==s.length&&e.push(y[r].id)}}this.setData({currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku()},set_choosed_sku:function(){var t=this,e=t.itemData;if(t.currentAttrs.length<e.properties.length)return t.sku_price=t.min_sku_price,t.sku_svip_price=t.min_sku_svip_price,t.setData({choosed_sku:"选择：商品规格",skuImages:e.header_img,skuSvipCurrent:t.itemData.current_price,skuCurrent:t.itemData.price}),void t.setAttrsClass();var a="",i=0,s=0,o=t.itemData.current_price,n=t.itemData.price;for(var r in t.setData({choosed_sku:a,sku_price:i,sku_svip_price:s,skuSvipCurrent:o,skuCurrent:n}),e.properties){var c=e.properties[r].attrs;for(var u in c)for(var d in t.currentAttrs)t.currentAttrs[d]==c[u].id&&(a+=c[u].item+" ")}if(""!=a){for(var r in e.stock){var p=e.stock[r].key;p=p.split("_"),p.sort(function(t,e){return t-e}),p=p.join("_");c=t.currentAttrs.join("_");c==p&&(t.skuImages=e.stock[r].header_img,i=e.stock[r].market_price,s=e.stock[r].shop_price)}t.confirmData=[{goods_name:e.goods_name,goods_id:e.goods_id,sku_key:c,amount:t.buynum,shop_price:s,market_price:i,sku_key_name:"规格:"+a,sku_img:t.skuImages}],a="已选："+a;o=s,n=i;t.setData({choosed_sku:a,sku_price:i,sku_svip_price:s,skuSvipCurrent:o,skuCurrent:n,skuImages:t.skuImages})}t.setAttrsClass()},attrValueselest:function(t){var e=this.itemData;if(e){var a=t.currentTarget.dataset.property,i=t.currentTarget.dataset.attr;if(i.is_multiselect){var s=[].concat(this.optionalAttrs),o=s.indexOf(i.id);-1==o?s.push(i.id):s.splice(o,1),this.setData({optionalAttrs:s})}else{var n=!1;for(var r in e.stock)if(1==e.stock[r].is_enough&&e.stock[r].key.indexOf(String(i.id))>=0){n=!0;break}if(!n)return void u.toast("库存不足");var c=null;s=[].concat(this.currentAttrs),o=s.indexOf(i.id);for(var r in-1==o?s.push(i.id):s.splice(o,1),a.attrs)if(a.attrs[r].id!=i.id){o=s.indexOf(a.attrs[r].id);-1!=o&&s.splice(o,1)}if(s=s.filter(function(t,e,a){return a.indexOf(t)===e}),s.sort(function(t,e){return t-e}),s.length){var d=s.join("_");for(r=0;r<e.stock.length;++r){var p=e.stock[r].key.split("_");if(p.sort(function(t,e){return t-e}),p=p.join("_"),p==d){c=e.stock[r];break}}}c&&c.is_enough?(this.currentStock=c,this.currentAttrs=s,this.setData({buynum:e.min_buy_amount})):s.length<e.properties.length?(this.currentStock=null,this.currentAttrs=s,this.setData({buynum:e.min_buy_amount})):u.toast("库存不足"),this.setData({canPurchase:this.checkCanPurchase()})}this.set_choosed_sku()}},setAttrsClass:function(){var t=this.itemData,e=t.properties;for(var a in e){var i=e[a].attrs;for(var s in i){var o=i[s];if(t)if(0!=t.is_goods_number){if(o.is_multiselect)o.class=-1==this.optionalAttrs.indexOf(o.id)?"":"active";else{o.class=-1==this.currentAttrs.indexOf(o.id)?"":"active";var n=!1;for(var a in t.stock){if(1!=t.stock[a].is_enough){var r=this.currentAttrs.join("_");if(!(t.stock[a].key.indexOf(String(r))>=0&&this.currentAttrs.length>0))continue;var c=t.stock[a].key.split("_");for(var s in c)if(c[s]!=this.currentAttrs)for(var u in t.properties)for(var d in t.properties[u].attrs)t.properties[u].attrs[d].id==c[s]&&(t.properties[u].attrs[d].class="disable")}if(t.stock[a].key.indexOf(String(o.id))>=0){n=!0;break}}n||(o.class+="disable")}}else o.class="disable";else o.class="disable"}}this.setData({itemData:t})},checkCanPurchase:function(){var t=this.itemData,e=!1;if(t.pre_info&&1==t.pre_info.is_pre)return this.setData({sumbitName:t.pre_info.pre_time}),!1;if(!t||0==t.is_enough)return this.setData({sumbitName:"抱歉，商品已售罄"}),!1;if(0==t.is_on_sale)return this.setData({sumbitName:"抱歉，商品已下架"}),!1;if(this.currentAttrs.length>=t.properties.length){for(var a in t.properties)if(!t.properties[a].is_multiselect){e=!0;break}if(e){if(!this.currentAttrs||!this.currentAttrs.length)return!1;if(!this.currentStock)return!1}}return this.setData({sumbitName:"立即购买"}),!0},isPriceEqualFun:function(){var t=this;if(t.itemData.price&&t.itemData.current_price){var e=t.itemData.price+t.sku_price,a=t.itemData.current_price+t.sku_svip_price;e==a?t.setData({isPriceEqual:!0}):t.setData({isPriceEqual:!1})}else t.setData({isPriceEqual:!1})},changeNum:function(t){var e=this,a=e.itemData,i=c.getPath.skuEnough;a.pre_info&&1==a.pre_info.is_pre&&(i=c.getPath.skuEnough);var s="";for(var o in a.stock){var n=a.stock[o].key;n=n.split("_"),n.sort(function(t,e){return t-e}),n=n.join("_");var r=e.currentAttrs.join("_");if(r==n){s=a.stock[o].key;break}}if(e.currentAttrs.length==a.properties.length){if(0==t.currentTarget.dataset.alphaBeta){if(!e.checkCanPurchase())return;if(e.buynum<=e.itemData.min_buy_amount)return void u.toast("不能小于最小购买数量");if(e.buynum<=1||(2===e.buynum?e.setData({buynum:e.buynum-1,undel:!0}):e.setData({buynum:e.buynum-1})),1!=e.buynum){var d={goods_id:a.goods_id,sku_key:s,amount:e.buynum};u.ApiGateWayTest(i,d,!0,function(t){t&&(1==t.data.result.is_enough||u.toast(t.data.result.msg))})}}else{if(0!=e.itemData.max_buy_amount&&e.buynum>=e.itemData.max_buy_amount)return void u.toast("不能在多啦~");if(e.setData({buynum:e.buynum+1,undel:!1}),e.buynum>1){d={goods_id:a.goods_id,sku_key:s,amount:e.buynum};u.ApiGateWayTest(i,d,!0,function(t){if(t)return 1!=t.data.result.is_enough?(u.toast(t.data.result.msg),e.setData({buynum:e.buynum-1}),void e.set_choosed_sku()):void 0})}}e.confirmData.num=e.buynum}else 0==e.showSKUstatus?e.setModalStatus():u.toast("请选择商品款式");e.set_choosed_sku()},gzhBindload:function(t){0!=t.detail.status&&this.setData({showOfficial:!1})},getConfigureIndexModel2:function(){var t=this,e=c.getPath.indexmodel,a={position:3};u.ApiGateWayTest(e,a,!0,function(e){e&&e.data&&1==e.data.success&&t.setData({indexModel2:e.data.result.lists})})},getConfigureIndexModel:function(){var t=this,e=c.getPath.indexmodel,a={position:1};u.ApiGateWayTest(e,a,!0,function(e){e&&e.data&&1==e.data.success&&t.setData({indexModel:e.data.result.lists})})},getPickUpAcitivity:function(t){var e=this;Promise.all([e.getpickuplistr()]).then(function(t){if(!t[0])return u.setStorageSync("reLoad",!0),void e.$options.onShow[0](e);e.getNewAd(),e.getSubjectAd(),e.bargain_page=1,e.bargain_page_size=20,e.team_page=1,e.team_page_size=20,e.be_team_page=1,e.be_team_page_size=20,e.teamList=[],e.beTeamList=[],e.bargainList=[],e.teamGoodsList=[],e.getAllActivity(),wx.stopPullDownRefresh()})},getAllActivity:function(){var e=this;0==e.teamNum?(console.log(t("获取首页拼团信息"," at pages\\index\\index.vue:3482")),e.getTeamList()):1==e.teamNum?e.getBargainActivity():2==e.teamNum&&e.getBeTeamList()},choosePickupChange:function(t){this.setData({chooseSelectIndex:t.currentTarget.dataset.index})},choosePickupSubmit:function(){this.setData({choosePickupShow:!1}),u.setStorageSync("getpickup",this.choosePickupList[this.chooseSelectIndex?this.chooseSelectIndex:0]),u.setStorageSync("reLoad",!0),this.$options.onShow[0](this)},goTissue:function(t){u.formIdUpdate(t);var e="https://share.lltjs.com/app/index.php?i=2&c=entry&from=account&account=a450f613484aea3458ac7a7eba952d720d671557&xid=&do=entry&m=llt_afan";c.dataBase.pageUrl=e,u.goWebview(),this.setData({showTissue:!1})},goTakeoutShop:function(){var t=this;wx.navigateTo({url:"/packageA/takeout-shop/takeout-shop?entryType=external&shop_id="+t.shop_id})},getShopPickUp:function(){var t=this,e=c.getPath.getShopPickUp;u.ApiGateWayTest(e,"",!0,function(e){e=e.data;1==e.success&&t.setData({shop_id:e.result.shop_id})})},getPacket:function(){this.setData({showPacketAd:!1,showPacketCoupon:!0})},hide_packet_ad:function(){this.setData({showPacketAd:!1})},hide_packet_coupon:function(){this.setData({showPacketCoupon:!1})},getSubjectAd:function(){var t=this,e=c.getPath.adlist,a={pid:9};return new Promise(function(i,s){u.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){var a=e.data.result;t.setData({subjectAdList:a}),i("successAd")}})})},getPacketModal:function(){var t=this,e=c.getPath.adlist,a={pid:10};return new Promise(function(i,s){u.ApiGateWayTest(e,a,!0,function(e){if(e&&e.data&&1==e.data.success){var a=e.data.result;t.setData({packetModal:a}),i("successAd")}})})},change_team_tab:function(t){var e=this,a=t.currentTarget.dataset.num;a!=e.teamNum&&(u.showLoad(e),this.setData({teamNum:a}),this.bargain_page=1,this.bargain_page_size=20,this.team_page=1,this.team_page_size=20,this.be_team_page=1,this.be_team_page_size=20,this.teamList=[],this.beTeamList=[],this.bargainList=[],this.teamGoodsList=[],this.setData({checkShowBottom:!1,showBottomLoading:!1}),e.sliderBarFixed&&(u.compareVersion("2.3.1")>=0?wx.pageScrollTo({selector:"#slider-bar-team"}):wx.pageScrollTo({scrollTop:0})),e.getAllActivity())},getTeamList:function(){console.log(t("获取首页拼团信息"," at pages\\index\\index.vue:3645"));var e=this,a=c.getPath.getTeamActivity,i={page:e.team_page,page_size:e.team_page_size,type:1};u.ApiGateWayTest(a,i,!0,function(a){console.log(t("获取首页拼团信息",a," at pages\\index\\index.vue:3654"));var i=a.data;if(1===i.success){i.result.data.length<e.team_page_size&&e.setData({checkShowBottom:!0});var o=e.teamList;e.teamList=o.length>0?[].concat(s(o),s(i.result.data)):i.result.data,e.teamList=e.teamList.map(function(t){return t.shop_price=parseFloat(t.shop_price),t.market_price=parseFloat(t.market_price),t}),e.setData({showBottomLoading:!1,teamGoodsList:e.teamList}),console.log(t("teamGoodsList",e.teamGoodsList," at pages\\index\\index.vue:3675")),u.hideLoad(e)}})},getBargainActivity:function(){var t=this,e=c.getPath.getBargainActivity,a={page:t.bargain_page,page_size:t.bargain_page_size};u.ApiGateWayTest(e,a,!0,function(e){var a=e.data;if(1===a.success){a.result.data.length<t.bargain_page_size&&t.setData({checkShowBottom:!0});var i=t.bargainList;t.bargainList=i.length>0?[].concat(s(i),s(a.result.data)):a.result.data,t.bargainList=t.bargainList.map(function(t){return t.shop_price=parseFloat(t.shop_price),t.market_price=parseFloat(t.market_price),t}),t.setData({showBottomLoading:!1,teamGoodsList:t.bargainList}),u.hideLoad(t)}})},getBeTeamList:function(){var t=this,e=c.getPath.getTeamActivity,a={page:t.be_team_page,page_size:t.be_team_page_size,type:2};u.ApiGateWayTest(e,a,!0,function(e){var a=e.data;if(1===a.success){a.result.data.length<t.team_page_size&&t.setData({checkShowBottom:!0});var i=t.beTeamList;t.beTeamList=i.length>0?[].concat(s(i),s(a.result.data)):a.result.data,t.beTeamList=t.beTeamList.map(function(t){return t.shop_price=parseFloat(t.shop_price),t.market_price=parseFloat(t.market_price),t}),t.setData({showBottomLoading:!1,teamGoodsList:t.beTeamList}),u.hideLoad(t)}})},newSwiperChange:function(t){this.setData({indexAdcurrent:t.detail.current})},getHomeSituation:function(){var t=this,e=c.getPath.sureHomeSituation;u.ApiGateWayTest(e,"",!0,function(e){var a=e.data;if(1==a.success){t.setData({homeSituation:a.result});var i={user_id:a.result.user_id,invite_share_img:a.result.invite_share_img,invite_share_text:a.result.invite_share_text,urge_share_img:a.result.urge_share_img,urge_share_text:a.result.urge_share_text,rule_img:a.result.rule_img};u.setStorageSync("entry_share_info",i)}})},getEnvelopes:function(t){var e=t.currentTarget.dataset.item,a=this;u.getStorageSync("getpickup");2==e.status||3==e.status?wx.navigateTo({url:"/packageB/invitation-share/invitation-share?type=2"}):4==e.status?wx.navigateTo({url:"/packageB/invitation-share/invitation-share?type=1"}):1==e.status&&a.setData({showRedEnvel:!0,showRedEnvelType:e.status})},closePhoneModal:function(){this.setData({showPhoneModal:!1})},toShowPhoneModal:function(){this.setData({showPhoneModal:!0})},setInviteShareLogin:function(){var t=c.getPath.inviteShareLogin,e=u.getStorageSync("shareTicket_info");e&&""!=e&&wx.getShareInfo({shareTicket:e.shareTicket,success:function(a){var i={user_id:e.query.user_id,wx_scene:e.scene,encrypted_data:JSON.stringify(a)};u.ApiGateWayTest(t,i,!0,function(t){var e=t.data;e.result.success&&u.setStorageSync("shareTicket_info","")})},fail:function(a){var i={user_id:e.query.user_id,wx_scene:e.scene,encrypted_data:""};u.ApiGateWayTest(t,i,!0,function(t){var e=t.data;e.result.success&&u.setStorageSync("shareTicket_info","")})}})},getPhone:function(t){if(!t.detail.encryptedData||!t.detail.iv)return!1;c.getPath.getWXMobile},getpickuplistr:function(){var t=c.getPath.pickupInfo,e=u.getStorageSync("getpickup");return new Promise(function(a,i){u.ApiGateWayTest(t,"",!0,function(t){var s=t.data;1==s.success?s.result.pickup_type!=e.pickup_type?(u.setStorageSync("getpickup",s.result),a(!1)):a(!0):i()})})},setData:function(t){var e=this,a=[];Object.keys(t).forEach(function(i){a=i.split("."),t[i],e.$data,a.forEach(function(a,s){e[i]=t[i]})})}}};e.default=v}).call(this,a("0de9")["default"],a("6e42")["default"])},b920:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})},bd05:function(t,e,a){"use strict";a.r(e);var i=a("b920"),s=a("5146");for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);a("f1a5");var n=a("2877"),r=Object(n["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},f1a5:function(t,e,a){"use strict";var i=a("f8a5"),s=a.n(i);s.a},f8a5:function(t,e,a){}},[["28c2","common/runtime","common/vendor"]]]);