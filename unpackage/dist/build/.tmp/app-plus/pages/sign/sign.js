(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sign/sign"],{"30dc":function(t,e,n){"use strict";n.r(e);var i=n("be10"),s=n("d291");for(var o in s)"default"!==o&&function(t){n.d(e,t,function(){return s[t]})}(o);n("b3a2");var a=n("2877"),c=Object(a["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=c.exports},"56c5":function(t,e,n){"use strict";(function(t){function i(t){return a(t)||o(t)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function a(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=getApp().globalData,r=n("28c1"),u=n("b6a1"),g=function(){return n.e("components/goodList/goodList").then(n.bind(null,"bc0e"))},d={data:function(){return{iconURL:c.dataBase.iconURL,showRules:!0,showSignin:!0,gift_list:[{is_signined:0,text:"第一天",today:!1},{is_signined:0,text:"第二天",today:!1},{is_signined:0,text:"第三天",today:!1},{is_signined:0,text:"第四天",today:!1},{is_signined:0,text:"第五天",today:!1},{is_signined:0,text:"第六天",today:!1},{is_signined:0,text:"第七天",today:!1}],rule_text:["1、每天签到，每天可领取奖励，余额将自动充值至账户余额中，余额明细可点击我的——账户余额，即可查看；优惠券将自动加入我的优惠券中。","2、签到漏签不可补签，签到需连续性进行签到，否则会错过后面的大额优惠券喔。","3、当连续签到7天后，系统将重置，重新从第一天签到开始计数。","4、签到已领取现金余额，表示您通过签到获取的余额总额。","5、签到重置的时间为每日的24点钟整","6、如果用户存在违规行为，主办方将取消用户的活动资格、并有权撤销相关违规交易、收回奖励等利益，同时依照相关规则进行处罚。","7、如出现不可抗力或情势变更的情况（包括但不限于重大灾害事件、活动受政府机关指令需要停止举办或调整的、活动遭受严重网络攻击或因系统故障需要暂停举办的），则主办方可依相关法律法规的规定主张免责。"],signState:{},signcount:{sign:0,count:0,money:"0.00",now_points:0},goAc:!1,guideShow:!1,refresh:!0,page:1,recommend_good_list:[],isShowGoHome:!1,checkSessionKey:!1,entryData:"",random:"",animationData:""}},components:{goodlist:g},props:{},onLoad:function(t){var e=this;c.checkSessionKey?(this.setData({checkSessionKey:!0}),e.usersigncount()):u.on("checkSessionKey",this,function(t){this.setData({checkSessionKey:t}),e.usersigncount()}),t&&t.entryType&&"external"==t.entryType?this.setData({isShowGoHome:!1}):this.setData({isShowGoHome:!0}),this.setData({entryData:t});t=e.entryData;var n=r.getStorageSync("getpickup");t&&(t.atitude||t.pickup_id)&&!n&&e.getExternal(t.pickup_id).then(function(){c.firstlaunchApp=!1,e.entryData={},r.setStorageSync("authSetting",{"scope.userLocation":!0});r.getStorageSync("token")})},onReady:function(){},onReachBottom:function(t){this.refresh&&(this.setData({page:this.page+1}),this.getRecommendGoodList())},onShow:function(){this.usersigncount(),this.getRecommendGoodList()},onShareAppMessage:function(){var t=this,e=r.getStorageSync("getpickup");return{title:t.signcount.share_info.share_title,path:"/pages/sign/sign?pickup_id="+e.pickup_id,imageUrl:t.signcount.share_info.share_img,success:function(t){r.toast("分享成功")},fail:function(t){r.toast("分享失败")}}},methods:{getExternal:function(t){var e=c.getPath.getpickup,n={pickup_id:t};return new Promise(function(t,i){r.ApiGateWayTest(e,n,!0,function(e){if(e&&e.data&&1==e.data.success){e=e.data.result.cities.pick_up;r.setStorage({key:"city",data:{pickup_id:e.pickup_id,warehouse_id:e.warehouse_id,cityName:e.city_name,is_pick_up:1}}),r.setStorage({key:"getpickup",data:{pickup_id:e.pickup_id,cityName:e.pickup_name,pickup_address:e.pickup_address,pickup_contact:e.pickup_contact,pickup_phone:e.pickup_phone,pickup_type:e.pickup_type}},function(e){t("获取id成功")})}})})},usersigncount:function(){var t=this,e=c.getPath.usersigncount;r.ApiGateWayTest(e,"",!0,function(e){if(1==e.data.success){e=e.data.result;e.days=1==e.sign?e.count:e.count+1,t.setData({random:Math.random(),signcount:e}),t.barAction()}})},gotoHome:function(){wx.switchTab({url:"/pages/index/index"})},isCheckLogin:function(){var t=r.getStorageSync("isOldUser");if(!c.checkSessionKey||2==t)return r.goRegister(),!1},sign:function(t){var e=this;r.formIdUpdate(t);var n=r.getStorageSync("isOldUser");if(!c.checkSessionKey||2==n)return r.goRegister(),!1;if(1!=e.signcount.sign){var i=c.getPath.usersign;r.ApiGateWayTest(i,"",!0,function(t){if(1==t.data.success){t=t.data.result;e.setData({signState:t}),e.showButton2()}})}},switchChange:function(t){var e=this,n=r.getStorageSync("isOldUser");if(!c.checkSessionKey||2==n)return r.goRegister(),!1;var i=t.currentTarget.dataset.open_msg;function s(t){var e=c.getPath.openmsg,n=t.signcount,s={status:i};r.ApiGateWayTest(e,s,!0,function(e){e=e.data;if(1==e.success&&1==e.result.status){n.open_msg=i,t.setData({signcount:n});var s=1==i?"已开启签到提醒":"取消提醒成功";r.toast(s)}})}i=1==i?2:1,1==i?s(e):wx.showModal({title:"关闭提醒",content:"关闭提醒可能会让你错失大额现金哦~",confirmText:"继续提醒",confirmColor:"#555555",cancelText:"关闭提醒",cancelColor:"#BBBBBB",success:function(t){if(t.cancel)s(e);else if(t.confirm)return!1}})},showButton:function(){var t=this;t.setData({showRules:!t.showRules})},showButton2:function(){var t=this;t.setData({showSignin:!t.showSignin}),t.showSignin&&(t.usersigncount(),t.showGuide(),t.setData({goAc:!0}))},closeGuide:function(){this.setData({guideShow:!1})},gameGuide:function(){var e=this,n=c.getPath.gameGuide;r.ApiGateWayTest(n,"",!0,function(n){console.log(t(n," at pages\\sign\\sign.vue:523")),1==n.data.success&&0==n.data.result.status&&e.usersigncount()})},showGuide:function(){var t=this,e=this.signcount.game_guide;if(1==e)return!1;this.gameGuide(),wx.pageScrollTo({scrollTop:0,duration:100});setTimeout(function(){t.setData({guideShow:!0})},1600)},barAction:function(){var t=this.signcount.count,e=wx.createAnimation({duration:1500,timingFunction:"ease"});this.animation=e,e.width(14.3*t+"%").step(),this.setData({animationData:e.export()})},getRecommendGoodList:function(){var t=this;r.showLoad(t);var e=c.getPath.newGoodsRecommend,n=10,s={page:this.page,page_size:n};r.ApiGateWayTest(e,s,!0,function(e){e=e.data;1==e.success&&(1==t.page&&(t.recommend_good_list=[]),t.setData({recommend_good_list:[].concat(i(t.recommend_good_list),i(e.result.products))}),e.result.products.length<n?t.refreshFun(!1):t.refreshFun(!0)),r.hideLoad(t)})},refreshFun:function(t){this.setData({refresh:t})},goIndex:function(){wx.switchTab({url:"/pages/index/index"})},goIntegralList:function(){var t=r.getStorageSync("isOldUser");if(!c.checkSessionKey||2==t)return r.goRegister(),!1;wx.navigateTo({url:"../sign/integral/integral"})},goToLotteryDraw:function(){var t=r.getStorageSync("isOldUser");if(!c.checkSessionKey||2==t)return r.goRegister(),!1;wx.navigateTo({url:"../../packageB/tools/turntable"})},goToShare:function(){var t=r.getStorageSync("isOldUser");if(!c.checkSessionKey||2==t)return r.goRegister(),!1;wx.navigateTo({url:"../../pages/user/invitation/invitation"})},setData:function(t){var e=this,n=[];Object.keys(t).forEach(function(i){n=i.split("."),t[i],e.$data,n.forEach(function(n,s){e[i]=t[i]})})}}};e.default=d}).call(this,n("0de9")["default"])},b3a2:function(t,e,n){"use strict";var i=n("fbeb"),s=n.n(i);s.a},be10:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},s=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s})},d291:function(t,e,n){"use strict";n.r(e);var i=n("56c5"),s=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);e["default"]=s.a},fbeb:function(t,e,n){}},[["8b0e","common/runtime","common/vendor"]]]);