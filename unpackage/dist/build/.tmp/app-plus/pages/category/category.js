(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/category/category"],{"0190":function(t,e,a){"use strict";function s(t){return o(t)||i(t)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function o(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=getApp().globalData,u=a("28c1"),c=(n.dataBase.iconURL,function(){return a.e("components/no_warehouse/no_warehouse").then(a.bind(null,"6de5"))}),d={data:function(){return{iconURL:n.dataBase.iconURL,sort:0,order:1,currType:1,page:1,page_size:10,good_list:[],topFixed:!1,productId:0,itemData:{},showSKUstatus:0,optionalAttrs:{},skuImages:"",bannerItem:[],buynum:1,firstIndex:-1,choosed_sku:"",cartAmount:0,undel:!0,unadd:!1,isPriceEqual:!1,canPurchase:!1,confirmData:{},isAuthorization:"",types:"",typeTree:"",animationData:"",showModalStatus:!1,buy_now:"",productid:0,showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1,indicatorDots:"",brandID:"",skuSvipCurrent:"",skuCurrent:"",sku_price:"",min_sku_price:"",sku_svip_price:"",min_sku_svip_price:"",currentStock:"",hasDefaultSKU:"",sumbitName:""}},components:{no_warehouse:c},props:{},onLoad:function(t){var e=this;e.getData(),e.local(function(t){var a={city:t,isAuthorization:!0};if(!e.isAuthorization||-1==t.warehouse_id)return a.showPage=!1,e.setData(a),!1;a.showPage=!0,e.setData(a)})},onShow:function(){var t=this;u.getStorageSync("getpickup");if(n.dataBase.isRefresh){t=this;t.setData({sort:0,order:1,currType:1,page:1,good_list:[],topFixed:!1}),t.getData(),t.local(function(e){var a={city:e,isAuthorization:!0};if(!t.isAuthorization||-1==e.warehouse_id)return a.showPage=!1,t.setData(a),!1;a.showPage=!0,t.setData(a)}),n.dataBase.isRefresh=!1}},onReachBottom:function(){var t=this;t.good_list&&t.typeTree.total!=t.good_list.length&&(this.setData({page:t.page+1}),t.getbrandList())},methods:{getData:function(){var t=this;t.getcategoryNav().then(function(e){t.getbrandList(t.currType)})},local:function(t){var e=this;e.setData({isAuthorization:u.getStorageSync("authSetting")["scope.userLocation"]});var a=u.getStorageSync("city");u.getStorageSync("getpickup");n.firstlaunchApp&&void 0==a.warehouse_id?(e.isAuthorization&&u.showLoad(e),u.getpickup(function(a){var s=a.cities;t&&"function"===typeof t&&t(s),u.hideLoad(e)})):t&&"function"===typeof t&&t(a)},openSet:function(t){var e=this;e.setData({isAuthorization:t.detail.isAuthorization}),u.setStorageSync("reLoad",!0),n.dataBase.isRefresh=!0,e.onShow()},goWebView:function(t){u.goAdWebView(t)},getcategoryNav:function(){var t=this,e=n.getPath.categorynav;return new Promise(function(a,s){u.ApiGateWayTest(e,"",!0,function(e){if(200==e.statusCode){e=e.data.result;t.setData({types:e,currType:e[0].cat_id}),a("getcategoryNavSuccess")}})})},getbrandList:function(){var t=this,e=n.getPath.categoodslist,a={cat_id:t.currType,page:t.page,page_size:t.page_size,sort:t.sort,order:t.order};u.showLoad(t),u.ApiGateWayTest(e,a,!0,function(e){if(u.hideLoad(t),0!=e.data.errorCode){e=e.data.result;0==e.lists.length&&u.toast("没有更多商品~"),t.setData({typeTree:e,good_list:[].concat(s(t.good_list),s(e.lists))})}else t.setData({typeTree:[]})})},sortTypes:function(t){var e=Number(t.currentTarget.dataset.sort),a=this.order;2==e&&(a=1==a?2:1),this.setData({sort:e,order:a,page:1,good_list:[]}),this.getbrandList()},tapType:function(t){var e=this,a=t.currentTarget.dataset.item;a.cat_id&&(e.setData({currType:a.cat_id,good_list:[],page:1,sort:0,order:2}),e.getbrandList(e.currType))},scrollEvent:function(t){var e=t.detail.scrollTop;e>60?this.setData({topFixed:!0}):this.setData({topFixed:!1})},setModalStatus:function(t){0==this.showSKUstatus?this.showSKUstatus=1:this.showSKUstatus=0;var e=wx.createAnimation({duration:300,timingFunction:"linear",delay:0});e.translateY(300).opacity(1).step(),this.setData({animationData:e.export()}),1==this.showSKUstatus&&this.setData({showModalStatus:!0}),setTimeout(function(){e.translateY(0).step(),this.setData({animationData:e}),0==this.showSKUstatus&&this.setData({showModalStatus:!1})}.bind(this),200)},addShopCart:function(t){var e=u.getStorageSync("isOldUser");if(!n.checkSessionKey||2==e)return u.goRegister(),!1;var a=this;function s(t){if(a.checkCanPurchase()){var e=a.itemData,s=t.currentTarget.dataset.type;if(a.currentAttrs.length==e.properties.length){var r="";for(var i in e.stock){var o=e.stock[i].key;o=o.split("_"),o.sort(function(t,e){return t-e}),o=o.join("_");var c=a.currentAttrs.join("_");if(c==o){r=e.stock[i].key;break}}var d=n.getPath.addCart;e.pre_info&&1==e.pre_info.is_pre&&(d=n.getPath.addCart);var h={goods_id:e.goods_id,sku_key:r,amount:a.buynum};u.formIdUpdate(t),u.ApiGateWayTest(d,h,!0,function(t){t&&(0!=t.data.success?(a.currentAttrs=[],a.setData({cartAmount:t.data.result.cart_num,productid:0}),u.toast(t.data.msg),"bottomcart"==s&&a.setData({showModalStatus:!1,showSKUstatus:0})):u.toast(t.data.msg))})}else 0==a.showSKUstatus?(a.setModalStatus(s),a.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):u.toast("请选择商品款式")}}this.setData({buy_now:t.target.dataset.buynow}),this.productid==t.target.dataset.productid?s(t):this.loadProductDetail(t).then(function(){s(t)})},nowPurchase:function(t){var e=this,a=u.getStorageSync("isOldUser");if(!n.checkSessionKey||2==a)return u.goRegister(),!1;function s(t){if(e.checkCanPurchase()){var a=e.itemData;if(e.currentAttrs.length==a.properties.length){var s="";for(var r in a.stock){var i=a.stock[r].key;i=i.split("_"),i.sort(function(t,e){return t-e}),i=i.join("_");var o=e.currentAttrs.join("_");if(o==i){s=a.stock[r].key;break}}var c=n.getPath.skuEnough;a.pre_info&&1==a.pre_info.is_pre&&(c=n.getPath.skuEnough);var d={goods_id:a.goods_id,sku_key:s,amount:e.buynum};u.formIdUpdate(t),u.ApiGateWayTest(c,d,!0,function(t){t&&(1==t.data.result.is_enough?(e.currentAttrs=[],e.setData({showModalStatus:!1,showSKUstatus:0,cartAmount:t.data.result.cart_num,productid:0}),wx.navigateTo({url:"/pages/confirm/confirm"})):u.toast(t.data.result.msg))})}else 0==e.showSKUstatus?(e.setModalStatus(),e.setData({showfwModalStatus:!1,showShareModalStatus:!1,showBonusModal:!1})):u.toast("请选择商品款式");u.setStorage({key:"nowPay",data:e.confirmData})}}this.setData({buy_now:t.target.dataset.buynow}),e.productid==t.target.dataset.productid?s(t):e.loadProductDetail(t).then(function(){s(t)})},loadProductDetail:function(t){var e=t.target.dataset.productid;this.setData({productid:t.target.dataset.productid});var a=this;u.showLoad(a);var s=n.getPath.goodsInfo,r=n.getPath.getSkuAmount,i={goods_id:e};return new Promise(function(t,e){u.ApiGateWayTest(s,i,!0,function(e){if(200==e.statusCode){var s=e.data.result;s.goods_content,s.detail_explain,s.is_liked;s.current_price=s.shop_price,s.price=s.market_price,a.setData({itemData:s,bannerItem:s.gallery,indicatorDots:s.gallery.length>1,buynum:s.min_buy_amount,brandID:s.cat_id,skuSvipCurrent:s.shop_price,skuCurrent:s.market_price}),a.setDefaultSKU(s),a.isPriceEqualFun(),u.hideLoad(a)}else u.hideLoad(a),u.toast("获取购物车数量失败");t("获取商详信息")}),u.ApiGateWayTest(r,"",!0,function(t){200==t.statusCode&&a.setData({cartAmount:t.data.result.cart_num})})})},setDefaultSKU:function(t){for(var e=[],a=null,s=[],r=[],i=0;i<t.properties.length;++i){var o=t.properties[i];if(!o.is_multiselect){s[i]=[];for(var n=0;n<o.attrs.length;n++)s[i].push(o.attrs[n].id)}}if(s=u.multiCartesian(s),s.length&&s[0]instanceof Array)for(i=0;i<s.length;i++)s[i].sort(function(t,e){return t-e});this.setData({canPurchase:this.checkCanPurchase()});var c=9999999999,d=9999999999;for(i=0;i<t.stock.length;++i){var h=t.stock[i].key.split("_"),p=t.stock[i].market_price,f=t.stock[i].price;if(d>f){var l=[];if(t.is_goods_number>0&&t.is_on_sale&&t.stock[i].is_enough){for(var _=0,g=h.length;_<g;_++)l.push(parseInt(h[_]));e=l,a=[{attrs:e,stock:t.stock[i]}],!0,d=f,c=p}else if(!t.is_goods_number>0||!t.is_on_sale){for(_=0,g=h.length;_<g;_++)l.push(parseInt(h[_]));e=l,a=[{attrs:e,stock:t.stock[i]}],!0,d=f,c=p}}h.sort(function(t,e){return t-e}),h=h.join("_");for(n=0;n<s.length;n++){var m="";m=s[n]instanceof Array?s[n].join("_"):s[n]instanceof Object?"":s[n],h==m&&1==t.stock[i].is_enough&&r.push({attrs:s[n],stock:t.stock[i]})}}var k=this.itemData.current_price,v=this.itemData.price;if(this.setData({sku_price:c,min_sku_price:c,sku_svip_price:d,min_sku_svip_price:d,skuSvipCurrent:parseFloat(k).toFixed(2),skuCurrent:v,currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku(),e=[],a=null,this.setData({currentStock:null,hasDefaultSKU:!1}),this.currentAttrs=[],1==r.length&&(e=r[0].attrs instanceof Array?r[0].attrs:[r[0].attrs],a=r[0].stock),r.length>1)for(var i in t.properties){var y=t.properties[i].attrs;for(var n in y){var D=0;for(var b in r){var S=new RegExp(y[n].id).test(r[b].attrs);S&&D++}D==r.length&&e.push(y[n].id)}}this.setData({currentStock:a}),this.currentAttrs=e,this.setData({hasDefaultSKU:!!this.currentStock}),this.set_choosed_sku()},set_choosed_sku:function(){var t=this,e=t.itemData;if(t.currentAttrs.length<e.properties.length)return t.sku_price=t.min_sku_price,t.sku_svip_price=t.min_sku_svip_price,t.setData({choosed_sku:"选择：商品规格",skuImages:e.header_img,skuSvipCurrent:t.itemData.current_price,skuCurrent:t.itemData.price}),void t.setAttrsClass();var a="",s=0,r=0,i=t.itemData.current_price,o=t.itemData.price;for(var n in t.setData({choosed_sku:a,sku_price:s,sku_svip_price:r,skuSvipCurrent:i,skuCurrent:o}),e.properties){var u=e.properties[n].attrs;for(var c in u)for(var d in t.currentAttrs)t.currentAttrs[d]==u[c].id&&(a+=u[c].item+" ")}if(""!=a){for(var n in e.stock){var h=e.stock[n].key;h=h.split("_"),h.sort(function(t,e){return t-e}),h=h.join("_");u=t.currentAttrs.join("_");u==h&&(t.skuImages=e.stock[n].header_img,s=e.stock[n].market_price,r=e.stock[n].shop_price)}t.confirmData=[{goods_name:e.goods_name,goods_id:e.goods_id,sku_key:u,amount:t.buynum,shop_price:r,market_price:s,sku_key_name:"规格:"+a,sku_img:t.skuImages}],a="已选："+a;i=r,o=s;t.setData({choosed_sku:a,sku_price:s,sku_svip_price:r,skuSvipCurrent:i,skuCurrent:o,skuImages:t.skuImages})}t.setAttrsClass()},attrValueselest:function(t){var e=this.itemData;if(e){var a=t.currentTarget.dataset.property,s=t.currentTarget.dataset.attr;if(s.is_multiselect){var r=[].concat(this.optionalAttrs),i=r.indexOf(s.id);-1==i?r.push(s.id):r.splice(i,1),this.setData({optionalAttrs:r})}else{var o=!1;for(var n in e.stock)if(1==e.stock[n].is_enough&&e.stock[n].key.indexOf(String(s.id))>=0){o=!0;break}if(!o)return void u.toast("库存不足");var c=null;r=[].concat(this.currentAttrs),i=r.indexOf(s.id);for(var n in-1==i?r.push(s.id):r.splice(i,1),a.attrs)if(a.attrs[n].id!=s.id){i=r.indexOf(a.attrs[n].id);-1!=i&&r.splice(i,1)}if(r=r.filter(function(t,e,a){return a.indexOf(t)===e}),r.sort(function(t,e){return t-e}),r.length){var d=r.join("_");for(n=0;n<e.stock.length;++n){var h=e.stock[n].key.split("_");if(h.sort(function(t,e){return t-e}),h=h.join("_"),h==d){c=e.stock[n];break}}}c&&c.is_enough?(this.currentStock=c,this.currentAttrs=r,this.setData({buynum:e.min_buy_amount})):r.length<e.properties.length?(this.currentStock=null,this.currentAttrs=r,this.setData({buynum:e.min_buy_amount})):u.toast("库存不足"),this.setData({canPurchase:this.checkCanPurchase()})}this.set_choosed_sku()}},setAttrsClass:function(){var t=this.itemData,e=t.properties;for(var a in e){var s=e[a].attrs;for(var r in s){var i=s[r];if(t)if(0!=t.is_goods_number){if(i.is_multiselect)i.class=-1==this.optionalAttrs.indexOf(i.id)?"":"active";else{i.class=-1==this.currentAttrs.indexOf(i.id)?"":"active";var o=!1;for(var a in t.stock){if(1!=t.stock[a].is_enough){var n=this.currentAttrs.join("_");if(!(t.stock[a].key.indexOf(String(n))>=0&&this.currentAttrs.length>0))continue;var u=t.stock[a].key.split("_");for(var r in u)if(u[r]!=this.currentAttrs)for(var c in t.properties)for(var d in t.properties[c].attrs)t.properties[c].attrs[d].id==u[r]&&(t.properties[c].attrs[d].class="disable")}if(t.stock[a].key.indexOf(String(i.id))>=0){o=!0;break}}o||(i.class+="disable")}}else i.class="disable";else i.class="disable"}}this.setData({itemData:t})},checkCanPurchase:function(){var t=this.itemData,e=!1;if(t.pre_info&&1==t.pre_info.is_pre)return this.setData({sumbitName:t.pre_info.pre_time}),!1;if(!t||0==t.is_enough)return this.setData({sumbitName:"抱歉，商品已售罄"}),!1;if(0==t.is_on_sale)return this.setData({sumbitName:"抱歉，商品已下架"}),!1;if(this.currentAttrs.length>=t.properties.length){for(var a in t.properties)if(!t.properties[a].is_multiselect){e=!0;break}if(e){if(!this.currentAttrs||!this.currentAttrs.length)return!1;if(!this.currentStock)return!1}}return this.setData({sumbitName:"立即购买"}),!0},isPriceEqualFun:function(){var t=this;if(t.itemData.price&&t.itemData.current_price){var e=t.itemData.price+t.sku_price,a=t.itemData.current_price+t.sku_svip_price;e==a?t.setData({isPriceEqual:!0}):t.setData({isPriceEqual:!1})}else t.setData({isPriceEqual:!1})},changeNum:function(t){var e=this,a=e.itemData,s=n.getPath.skuEnough;a.pre_info&&1==a.pre_info.is_pre&&(s=n.getPath.skuEnough);var r="";for(var i in a.stock){var o=a.stock[i].key;o=o.split("_"),o.sort(function(t,e){return t-e}),o=o.join("_");var c=e.currentAttrs.join("_");if(c==o){r=a.stock[i].key;break}}if(e.currentAttrs.length==a.properties.length){if(0==t.currentTarget.dataset.alphaBeta){if(!e.checkCanPurchase())return;if(e.buynum<=e.itemData.min_buy_amount)return void u.toast("不能小于最小购买数量");if(e.buynum<=1||(2===e.buynum?e.setData({buynum:e.buynum-1,undel:!0}):e.setData({buynum:e.buynum-1})),1!=e.buynum){var d={goods_id:a.goods_id,sku_key:r,amount:e.buynum};u.ApiGateWayTest(s,d,!0,function(t){t&&(1==t.data.result.is_enough||u.toast(t.data.result.msg))})}}else{if(0!=e.itemData.max_buy_amount&&e.buynum>=e.itemData.max_buy_amount)return void u.toast("不能在多啦~");if(e.setData({buynum:e.buynum+1,undel:!1}),e.buynum>1){d={goods_id:a.goods_id,sku_key:r,amount:e.buynum};u.ApiGateWayTest(s,d,!0,function(t){if(t)return 1!=t.data.result.is_enough?(u.toast(t.data.result.msg),e.setData({buynum:e.buynum-1}),void e.set_choosed_sku()):void 0})}}e.confirmData.num=e.buynum}else 0==e.showSKUstatus?e.setModalStatus():u.toast("请选择商品款式");e.set_choosed_sku()},goToProduct:function(t){var e=t.currentTarget.dataset.goodsid;n.checkSessionKey&&u.formIdUpdate(t),wx.navigateTo({url:"/pages/product/product?entryType=external&productId="+e})},setData:function(t){var e=this,a=[];Object.keys(t).forEach(function(s){a=s.split("."),t[s],e.$data,a.forEach(function(a,r){e[s]=t[s]})})}}};e.default=d},"37db":function(t,e,a){},4150:function(t,e,a){"use strict";a.r(e);var s=a("0190"),r=a.n(s);for(var i in s)"default"!==i&&function(t){a.d(e,t,function(){return s[t]})}(i);e["default"]=r.a},"513d":function(t,e,a){"use strict";a.r(e);var s=a("97d8"),r=a("4150");for(var i in r)"default"!==i&&function(t){a.d(e,t,function(){return r[t]})}(i);a("e16f");var o=a("2877"),n=Object(o["a"])(r["default"],s["a"],s["b"],!1,null,null,null);e["default"]=n.exports},"97d8":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement;t._self._c},r=[];a.d(e,"a",function(){return s}),a.d(e,"b",function(){return r})},e16f:function(t,e,a){"use strict";var s=a("37db"),r=a.n(s);r.a}},[["2e02","common/runtime","common/vendor"]]]);