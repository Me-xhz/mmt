(global["webpackJsonp"] = global["webpackJsonp"] || []).push([["pages/index/index"],{

/***/ 65:
/*!****************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue ***!
  \****************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index_vue_vue_type_template_id_dfa76ffc___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index.vue?vue&type=template&id=dfa76ffc& */ 66);
/* harmony import */ var _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index.vue?vue&type=script&lang=js& */ 68);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony import */ var _index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index.vue?vue&type=style&index=0&lang=scss& */ 70);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/runtime/componentNormalizer.js */ 15);






/* normalize component */

var component = Object(_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__["default"])(
  _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _index_vue_vue_type_template_id_dfa76ffc___WEBPACK_IMPORTED_MODULE_0__["render"],
  _index_vue_vue_type_template_id_dfa76ffc___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* hot reload */
if (false) { var api; }
component.options.__file = "Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ 66:
/*!***********************************************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue?vue&type=template&id=dfa76ffc& ***!
  \***********************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_dfa76ffc___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=dfa76ffc& */ 67);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_dfa76ffc___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_template_id_dfa76ffc___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ 67:
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue?vue&type=template&id=dfa76ffc& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function() {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
}
var staticRenderFns = []
render._withStripped = true



/***/ }),

/***/ 68:
/*!*****************************************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue?vue&type=script&lang=js& ***!
  \*****************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js& */ 69);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 69:
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue?vue&type=script&lang=js& ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(uni) {Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(iter) {if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) {for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {arr2[i] = arr[i];}return arr2;}} //
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

var app = getApp().globalData;
var app2 = getApp();
var common = __webpack_require__(/*! ../../utils/common.js */ 28);
var event = __webpack_require__(/*! ../../utils/event.js */ 59);var countDown = function countDown() {return __webpack_require__.e(/*! import() | components/countDown/countDown */ "components/countDown/countDown").then(__webpack_require__.bind(null, /*! ../../components/countDown/countDown */ 853));};var goodList = function goodList() {return __webpack_require__.e(/*! import() | components/goodList/goodList */ "components/goodList/goodList").then(__webpack_require__.bind(null, /*! ../../components/goodList/goodList */ 860));};var subject = function subject() {return __webpack_require__.e(/*! import() | components/subject/subject */ "components/subject/subject").then(__webpack_require__.bind(null, /*! ../../components/subject/subject */ 867));};var configuremodel = function configuremodel() {return __webpack_require__.e(/*! import() | pages/index/configureModel/configureModel */ "pages/index/configureModel/configureModel").then(__webpack_require__.bind(null, /*! ./configureModel/configureModel */ 874));};var no_warehouse = function no_warehouse() {return __webpack_require__.e(/*! import() | components/no_warehouse/no_warehouse */ "components/no_warehouse/no_warehouse").then(__webpack_require__.bind(null, /*! ../../components/no_warehouse/no_warehouse */ 881));};var pickupgoods = function pickupgoods() {return __webpack_require__.e(/*! import() | components/pickUpActivity/pickUpActivity */ "components/pickUpActivity/pickUpActivity").then(__webpack_require__.bind(null, /*! ../../components/pickUpActivity/pickUpActivity */ 729));};var loadingbottom = function loadingbottom() {return __webpack_require__.e(/*! import() | components/loadingBottom/loadingBottom */ "components/loadingBottom/loadingBottom").then(__webpack_require__.bind(null, /*! ../../components/loadingBottom/loadingBottom */ 888));};var _default =







{

  data: function data() {
    return {
      //有工厂后显示index
      switch_index: true,
      // 自提点
      pickup: {
        cityName: '请选择提货点' },

      navBarHeight: app.navBarHeight,
      showTissue: false,
      listScroll: true,
      showAdver: false,
      indicatorDots: false,
      autoplay: false,
      buy_now: 0,
      showSearchBG: false,
      scrollTop: 0,
      duration: 500,
      interval: 5000,
      singleAdcurrent: 0,
      indexAdcurrent: 0,
      indicatorColor: "#fff",
      indicatorActiveColor: "#eb3c39",
      circular: true,
      adList: [],
      service_title: [],
      barList: [],
      acticity_new_person: [],
      acticity_buy: {},
      page_size: 10,
      shopList: [],
      page: 1,
      refresh: true,
      checkSessionKey: app.checkSessionKey,
      iconURL: app.dataBase.iconURL,
      // showCloseImg: false,
      showCouponList: false,
      // 限时抢购
      flashSale_title: '',
      ac_load_btn: true,
      actived_idx: 1,
      activity_id: 0,
      activitylist: [],
      good_list: [],
      total: 0,
      timer_btn: false,
      singleAd: [],
      advertisementAd: [],
      AdClickBtn: true,
      isGoodListBool: false,
      // 商详
      productId: 0,
      itemData: {},
      showSKUstatus: 0,
      optionalAttrs: {},
      skuImages: '',
      bannerItem: [],
      buynum: 1,
      // 属性选择
      firstIndex: -1,
      choosed_sku: '',
      cartAmount: 0,
      // 弹窗SKU，不能减不能加
      undel: true,
      unadd: false,
      // SKU的VIP价格和非SVIP是否相同
      isPriceEqual: false,
      canPurchase: false,
      //模块
      indexModel: null,
      // 新厂图片数据
      newFactoryList: [],
      // 分享信息
      share_data: {
        share_title: "",
        share_img: "" },

      // 公众号组件显示
      showOfficial: true,
      showTips: true,
      pickUpActivity: {},
      takeoutAnimation: false,
      choosePickupShow: false,
      chooseSelectIndex: 0,
      choosePickupList: [],
      showMoreTips: false,
      shop_id: 0,
      showPacketAd: true,
      showPacketCoupon: false,
      subjectAdList: [],
      packetModal: [],
      teamNum: 0,
      teamGoodsList: [],
      team_page: 1,
      team_page_size: 20,
      bargain_page: 1,
      bargain_page_size: 20,
      be_team_page: 1,
      be_team_page_size: 20,
      bargainList: [],
      teamList: [],
      beTeamList: [],
      sliderBarFixed: false,
      // 领券成功弹窗
      showCouponsSuccess: false,
      showPhoneModal: false,
      getRemind: false,
      checkShowBottom: false,
      showBottomLoading: false,
      homeSituation: {},
      showRedEnvel: false,
      showRedEnvelType: 1,
      confirmData: {},
      entryData: "",
      recommendList: [],
      height: "",
      isAuthorization: "",
      signcheckStatus: "",
      showCloseImg: false,
      popupCouponsList: "",
      to_top: false,
      animationData: "",
      showModalStatus: false,
      productid: 0,
      showfwModalStatus: false,
      showShareModalStatus: false,
      showBonusModal: false,
      brandID: "",
      skuSvipCurrent: "",
      skuCurrent: "",
      sku_price: "",
      min_sku_price: "",
      sku_svip_price: "",
      min_sku_svip_price: "",
      currentStock: "",
      hasDefaultSKU: "",
      sumbitName: "",
      indexModel2: "",
      loadingShow: false,
      showPage: true,
      city: {} };

  },

  components: {
    countDown: countDown,
    goodList: goodList,
    subject: subject,
    configuremodel: configuremodel,
    no_warehouse: no_warehouse,
    pickupgoods: pickupgoods,
    loadingbottom: loadingbottom },

  props: {},
  onLoad: function onLoad(options) {
    //这里解决app端打开页面不加载数据






    console.log('onLoad');
    var than = this;
    if (this.showPage) {
      this.getNewFactory();
    }

    uni.$on('update', function (data) {
      // console.log(data);
      than.showPage = data.showPage;
    });

    common.showLoad(this);
    wx.showShareMenu({
      withShareTicket: true });

    // 设置reload 为true 才允许加载数据，为了返回当前页，onShow不重新加载数据使用
    // 加载页面时先设置默认值
    common.setStorageSync('reLoad', true);
    var pickupId = common.getStorageSync('getpickup');
    this.setData({
      entryData: options });
    // 监听checkSessionKey

    event.on('show', this, function (data) {
      this.setData({
        showCouponsSuccess: false,
        AdClickBtn: true });

    }); // 监听小程序后台后隐藏关注组件

    event.on('hide', this, function (res) {
      this.setData({
        showOfficial: false });

    });

    if (!app.checkSessionKey) {
      event.on('checkSessionKey', this, function (data) {
        this.checkSessionKey = data;
      });
    }

    this.getPacketModal();
  },

  onReady: function onReady() {
    common.hideLoad(this);
  },

  onShow: function onShow(that2) {
    // common.setStorageSync('isOldUser', 0);
    // console.log('onShow');
    //当onShow在别处调用执行时，会出现this的问题

    var that = that2 || this;


    //渲染页面时，执行正在拼团
    //使用缓存工厂的数据
    var pickupId = common.getStorageSync('getpickup');
    that.pickup = pickupId;

    that.setInviteShareLogin();

    if (pickupId.pickup_type == 0) {
      that.signcheck();
    }
    if (pickupId && that.pickup.pickup_id != pickupId.pickup_id && that.pickup.pickup_id != undefined) {
      if (pickupId.pickup_type == 0) {
        that.loadData();
      } else {

        that.getPickUpAcitivity();
      }

      that.setData({
        pickup: pickupId });

    }
    // 定位检测



    if (common.getStorageSync('reLoad')) {
      common.setStorageSync('reLoad', false);
    } else {
      if (pickupId.pickup_type == 0) {
        that.getHomeSituation();
      }
      return;
    }

    that.setData({
      pickup: common.getStorageSync('getpickup'),
      good_list: [],
      page: 1 });

    // 外部携带的参数
    var options = that.entryData;

    if (options && options.tissue == 'true') {
      this.setData({
        showTissue: true });

    }
    // 判断是否第一次进入 且是从外部进入，如二维码扫码 && app.firstlaunchApp
    // options && options.entryType && options.entryType == 'external'
    if (options && (options.atitude || options.pickup_id) && !pickupId) {

      if (options.atitude) {
        that.getExternal(options.atitude, 1).then(function () {
          // 关闭开关，让app知道已经不是第一次进入当前页
          app.firstlaunchApp = false; // 清空data内携带参数

          that.entryData = {};
          var city = common.getStorageSync('city');
          var pickup = common.getStorageSync('getpickup');
          var data = {
            pickup: pickup,
            city: city,
            isAuthorization: true };

          data.showPage = true;
          that.setData(data);
          that.loadData(city); // 外部已带经纬度定位，无需再调用定位接口，所以将缓存定位改为真，让页面可以显示

          common.setStorageSync('authSetting', {
            'scope.userLocation': true });

        });
      } else {
        that.getExternal(options.pickup_id, 2).then(function () {
          // 关闭开关，让app知道已经不是第一次进入当前页
          app.firstlaunchApp = false; // 清空data内携带参数

          that.entryData = {};
          var city = common.getStorageSync('city');
          var pickup = common.getStorageSync('getpickup');
          var data = {
            pickup: pickup,
            city: city,
            isAuthorization: true };

          data.showPage = true;
          that.setData(data);
          that.loadData(city); // 外部已带经纬度定位，无需再调用定位接口，所以将缓存定位改为真，让页面可以显示

          common.setStorageSync('authSetting', {
            'scope.userLocation': true });

        });
      }

      return;
    }

    that.local(function (city) {
      // console.log('pickupIdpickupId', pickupId)
      var data = {
        city: city,
        isAuthorization: common.getStorageSync('authSetting')['scope.userLocation'] };

      // console.log('data', data)
      that.setData(data);
      // 关闭开关，让app知道已经不是第一次进入当前页
      // console.log('app.firstlaunchApp', app.firstlaunchApp)
      app.firstlaunchApp = false;
      // 判断是否有开启定位和仓库
      if (city.warehouse_id != -1 && pickupId.pickup_id) {
        that.showAddTips();
        data.showPage = true;
        that.setData(data);

      } else {
        data.showPage = false;
        that.setData(data);
        return false;
      }

      that.setData({
        page: 1,
        shopList: [],
        recommendList: [],
        good_list: [] });


      if (pickupId.pickup_type == 0) {
        that.loadData(city);
        that.getAdvertisement();
      } else {
        // console.log('getPickUpAcitivity();')
        that.getPickUpAcitivity(city);
        that.getAdvertisement();
      }

      that.getIndexShareInfo();
      that.getShopPickUp();
    });
    //获取屏幕宽度，根据比例设置轮播的高度
    wx.getSystemInfo({
      success: function success(res) {
        that.setData({
          height: res.windowWidth / 1.70454545 });

      } });

  },
  // 获取手机号去登录注册
  // getPhone: function(e) {
  //   var url = e.currentTarget.dataset.url;
  //   var that = this;
  //   common.checkLogin(e, function() {
  //     // 登录成功，修改app与user页面的checkSessionKey状态
  //     app.checkSessionKey = true;
  //     that.data.checkSessionKey = true;
  //     // 登录成功，跳转
  //     wx.navigateTo({
  //       url: url
  //     })
  //   })
  // },
  // bar 跳转
  // 上拉加载
  //滑到最底部执行事件
  onReachBottom: function onReachBottom() {
    console.log('滑到最底部执行事件');
    var pickupId = common.getStorageSync('getpickup');

    if (pickupId.pickup_type == 0) {
      if (this.refresh) {
        this.setData({
          page: this.page + 1 });

        this.getIndexProducts(); // this.getActivitygoodslist()
      }
    } else {
      if (this.teamNum == 1) {
        if (this.bargainList.length > 0 && this.bargainList.length % this.bargain_page_size == 0) {
          this.bargain_page = this.bargainList.length / this.bargain_page_size + 1;
          this.setData({
            showBottomLoading: true });

          this.getBargainActivity();
        }
      } else if (this.teamNum == 0) {
        if (this.teamList.length > 0 && this.teamList.length % this.team_page_size == 0) {
          this.team_page = this.teamList.length / this.team_page_size + 1;
          this.setData({
            showBottomLoading: true });

          this.getTeamList();
        }
      } else if (this.teamNum == 2) {
        if (this.beTeamList.length > 0 && this.beTeamList.length % this.be_team_page_size == 0) {
          this.be_team_page = this.beTeamList.length / this.be_team_page_size + 1;
          this.setData({
            showBottomLoading: true });

          this.getBeTeamList();
        }
      }
    }
  },
  // 下拉刷新
  onPullDownRefresh: function onPullDownRefresh() {

    this.setData({
      page: 1,
      shopList: [],
      recommendList: [],
      good_list: [],
      showAdver: false,
      showCouponsSuccess: false });

    common.setStorageSync('reLoad', true); // this.onShow();

    if (this.pickup.pickup_type == 0) {
      this.loadData();
    } else {
      this.getPickUpAcitivity();
    }
  },
  //前往更多
  // goMore: function(){
  //   wx.navigateTo({
  //     url: '../category/category',
  //   })
  // },
  onShareAppMessage: function onShareAppMessage(res) {
    var that = this;
    var pickup = common.getStorageSync('getpickup');
    var entry_share_info = common.getStorageSync('entry_share_info');

    if (res.target && res.target.dataset.shareinfo) {
      var shareInfo = res.target.dataset.shareinfo;

      if (shareInfo && shareInfo.fromButton == 'notice') {
        return {
          title: entry_share_info.urge_share_text,
          path: '/pages/index/index?pickup_id=' + pickup.pickup_id + '&user_id=' + entry_share_info.user_id,
          imageUrl: entry_share_info.urge_share_img };

      } else if (shareInfo && shareInfo.fromButton == 'envelopes') {
        return {
          title: entry_share_info.invite_share_text,
          path: '/pages/index/index?pickup_id=' + pickup.pickup_id + '&user_id=' + entry_share_info.user_id,
          imageUrl: entry_share_info.invite_share_img };

      } else {
        return {
          title: that.share_data.share_title,
          path: '/pages/index/index?pickup_id=' + pickup.pickup_id,
          imageUrl: that.share_data.share_img };

      }
    } else {
      return {
        title: that.share_data.share_title,
        path: '/pages/index/index?pickup_id=' + pickup.pickup_id,
        imageUrl: that.share_data.share_img };

    }
  },
  created: function created() {

  },
  methods: {
    //跳到工厂页面
    navPick2: function navPick2() {
      var city = common.getStorageSync('city');
      console.log(city);
      uni.navigateTo({
        // url:`/pickup2/pickup2?cityName=${pickup.cityName}`
        url: "/pages/pickup2/pickup2?warehouse_id=".concat(city.warehouse_id) });

    },
    // 从外部二维码扫码，带经纬度和外部标识external
    getExternal: function getExternal(value, type) {
      var that = this;
      var uri = app.getPath.getpickup;
      console.log('获取提货点');
      if (type == 1) {
        var data = {
          atitude: value };

      } else {
        var data = {
          pickup_id: value };

      }

      return new Promise(function (resolve, reject) {
        // 获取提货点
        common.ApiGateWayTest(uri, data, true, function (res) {
          console.log('获取提货点', res);
          if (res && res.data && res.data.success == 1) {
            if (type == 1) {
              var res = res.data.result.cities;
            } else {
              var res = res.data.result.cities.pick_up;
            }

            common.setStorage({
              key: 'city',
              data: {
                'pickup_id': res.pickup_id,
                'warehouse_id': res.warehouse_id,
                'cityName': res.city_name,
                'is_pick_up': 1 } });


            common.setStorage({
              key: 'getpickup',
              data: {
                'pickup_id': res.pickup_id,
                'pickup_type': res.pickup_type,
                'cityName': res.pickup_name,
                'pickup_address': res.pickup_address,
                'pickup_contact': res.pickup_contact,
                'pickup_phone': res.pickup_phone } },

            function (res) {
              resolve('获取id成功');
            });
          }
        });
      });
    },

    //关闭首页弹窗
    closeTips: function closeTips() {
      this.setData({
        showTips: false });

    },

    // 显示添加小程序提示
    showAddTips: function showAddTips() {var _this = this;
      setTimeout(function () {
        _this.setData({
          showTips: false });

      }, 10000); // var date=new Date().toLocaleDateString();
      // if(wx.getStorageSync("add-tips")){
      //   var tips=wx.getStorageSync("add-tips");
      //   if(date===tips){
      //     this.setData({
      //       showTips:false
      //     })
      //   }else{
      //     this.setData({
      //       showTips:true
      //     })
      //     wx.setStorageSync("add-tips", date);
      //   }
      // }else{
      //   wx.setStorageSync("add-tips",date);
      // }
    },

    //显示加入小程序帮助
    toShowTips: function toShowTips() {
      this.setData({
        showMoreTips: true });

    },

    //关闭加入小程序帮助
    closeAllTips: function closeAllTips() {
      this.setData({
        showMoreTips: false,
        showTips: false });

    },

    // 获取数据
    loadData: function loadData(city) {
      var warehouse_id = common.getStorageSync('warehouse_id');

      if (city) {
        if (city.warehouse_id != warehouse_id) {
          this.getAdvertisement();
        }

        common.setStorageSync('warehouse_id', city.warehouse_id);
      }

      var that = this;
      // 全部接口回调完成后停止下拉动画
      // that.getScKillList(), that.getDate(), that.getActivitylist(), that.getSubjuctList(), that.getActivitynewperson(),
      Promise.all([that.getpickuplistr(), that.getAd(), that.getBar(), that.getsingleAd(), that.getIndexProducts(), that.
      getHomeSituation()]).
      then(function (res) {
        if (!res[0]) {
          common.setStorageSync('reLoad', true);
          that.$options.onShow[0](that);
          return;
        } else {
          wx.stopPullDownRefresh();
        }
      });

      if (wx.createSelectorQuery) {
        wx.createSelectorQuery().select('#topHeight').boundingClientRect(function (rect) {
          if (rect && rect.top) {
            that.setData({
              scrollTop: rect.top // 节点的上边界坐标
            });

          }
        }).exec();
      } else {
        wx.showModal({
          title: '提示1',
          content: '当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。' });

      }
    },

    // 新厂首页获取数据
    getNewFactory: function getNewFactory(city) {
      var that = this;
      that.getAdvertisement();
      that.getNewAd();
      that.getSubjectAd();
      var uri = app.getPath.newFactory;
      common.ApiGateWayTest(uri, '', true, function (res) {
        var resData = res.data;

        if (resData.success == 1) {
          that.setData({
            newFactoryList: resData.result.data });

        } else {
          common.toast(resData.msg);
          return;
        }

        wx.stopPullDownRefresh();
      });
    },

    // 获取首页分享数据
    getIndexShareInfo: function getIndexShareInfo() {
      var that = this;
      var uri = app.getPath.indexShareInfo;
      var data = {
        type: 5 };

      common.ApiGateWayTest(uri, data, true, function (res) {
        var resData = res.data;

        if (resData.success == 1) {
          if (resData.result.data != '' && resData.result.data != null) {
            that.setData({
              share_data: resData.result.data });

          }
        } else {
          common.toast(resData.msg);
          return;
        }
      });
    },

    // 定位检测
    local: function local(callback) {
      var that = this;
      that.setData({
        isAuthorization: common.getStorageSync('authSetting')['scope.userLocation'] });

      var city = common.getStorageSync('city');
      var pickup = common.getStorageSync('getpickup');
      // console.log('pickup', city);
      if (app.firstlaunchApp && pickup.pickup_id == undefined) {
        // 进入app后首次打开当前页面   没仓库的情况下 先获取地理定位
        if (that.isAuthorization) {
          // 增加加载，防止未加载完当前定位就点击
          common.showLoad(that);
        }
        // console.log('请求定位位置');
        common.getpickup(function (res) {
          var city = res.cities;

          if (city.choose_pickup && city.choose_pickup.length > 1) {
            console.log('if');
            that.setData({
              choosePickupShow: true,
              choosePickupList: city.choose_pickup });

            callback && typeof callback === "function" && callback(city);
            common.hideLoad(that);
            return;
          } else {
            // console.log(that);
            common.setStorageSync('reLoad', true);
            that.$options.onShow[0](that);
            callback && typeof callback === "function" && callback(city);
            common.hideLoad(that);
          }
        });
      } else {
        // 有自提点的情况下，直接 取自提点 不重新请求
        // 第二次进入当前页（从选择定位页面进入），直接用仓库地址请求数据
        callback && typeof callback === "function" && callback(city);
      }
    },
    // 打开定位回调
    openSet: function openSet(e) {
      var that = this;
      that.setData({
        isAuthorization: e.detail.isAuthorization });

      common.setStorageSync('reLoad', true);
      app.dataBase.isRefresh = true;
      that.$options.onShow[0](that);
    },
    //跳转分类页
    goCategory: function goCategory() {
      wx.switchTab({
        url: '/pages/category/category' });

    },
    // 获取是否签到
    signcheck: function signcheck() {
      var that = this;
      var uri = app.getPath.signcheck;
      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, {}, true, function (res) {
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;
            that.setData({
              signcheckStatus: data.status });

            resolve('success signcheck');
          }
        });
      });
    },
    to_sign: function to_sign() {
      // 判断是否登录或者老用户
      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        wx.navigateTo({
          url: '/pages/register/register?isGetCoupon=1' });

      }

      var pickup = common.getStorageSync('getpickup');
      // app.aldstat.sendEvent("on_index_floatSign", {
      // 	"提货点": pickup.cityName
      // });

      if (this.signcheckStatus == 0) {
        wx.navigateTo({
          url: "/pages/sign/sign?entryType=external" });

      } else if (this.signcheckStatus == 1) {
        wx.navigateTo({
          url: "/packageB/tools/turntable" });

      }
    },
    // 获取轮播图
    getAd: function getAd() {

      var that = this;
      var uri = app.getPath.adlist;
      var data = {
        pid: 1 };

      // console.log(uri, data);
      return new Promise(function (resolve, reject) {

        common.ApiGateWayTest(uri, data, true, function (res) {
          // console.log(res);
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;

            if (data.length > 1) {
              that.setData({
                indicatorDots: true });

            } else {
              that.setData({
                indicatorDots: false });

            }

            that.setData({
              adList: data,
              indexAdcurrent: 0,
              // share_title: data.share_title,
              indicatorDots: data.length > 1 ? true : false // keyWord: data.keyword
            });

            console.log('adList', that.adList);
            resolve('successAd');
          }
        });
      });
    },
    // 新版本获取轮播图
    getNewAd: function getNewAd() {
      var that = this;
      var uri = app.getPath.adlist;
      var data = {
        pid: 6 };


      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, data, true, function (res) {
          // console.log('66666666', res);
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;

            if (data.length > 1) {
              that.setData({
                indicatorDots: true });

            } else {
              that.setData({
                indicatorDots: false });

            }

            that.setData({
              adList: data,
              indexAdcurrent: 0,
              // share_title: data.share_title,
              indicatorDots: data.length > 1 ? true : false // keyWord: data.keyword
            });

            resolve('successAd');
          }
        });
      });
    },
    // 跳转指定	
    goWebView: function goWebView(e) {
      // console.log(e.currentTarget.dataset.item.media_type);
      var item = e.currentTarget.dataset.item;
      var type = e.currentTarget.dataset.type;
      console.log('type', type);
      if (type == 1) {
        var pickup = common.getStorageSync('getpickup');
      } else if (type == 2) {
        var pickup = common.getStorageSync('getpickup');
        // console.log(pickup);
      } else if (type == 3) {
        var pickup = common.getStorageSync('getpickup');
      } else if (type == 4) {
        var pickup = common.getStorageSync('getpickup');
      }

      if (item.media_type != 9) {
        common.goAdWebView(e);
        this.adclose(item.ad_id, 0);
        this.setData({
          showAdver: false });

      } else if (item.media_type == 9) {
        // if (item.take_type == 2) {
        //   // 点击领取弹窗优惠券
        //   // 判断是否登录或者老用户
        //   var isOldUser = common.getStorageSync('isOldUser');
        //   if (!app.checkSessionKey || isOldUser == 2) {
        //     wx.navigateTo({
        //       url: '/pages/register/register?isGetCoupon=1'
        //     })
        //   }
        //   if (!app.checkSessionKey || isOldUser == 2) {
        //     event.on('isGetCoupon', this, function (data) {
        //       this.getCoupon(item.ad_link, item.ad_id, 2)
        //     })
        //   } else {
        //     this.getCoupon(item.ad_link, item.ad_id, 2)
        //   }
        // }
        // 首页优惠券领券
        var isOldUser = common.getStorageSync('isOldUser');

        if (!app.checkSessionKey || isOldUser == 2) {
          common.goRegister();
          return false;
        } else {
          this.getCoupons(item.ad_id);
        }
      }
    },
    //  限时抢购
    // 时间
    getDate: function getDate() {
      var that = this;
      this.timer = setInterval(function () {
        // 精确到秒
        var timestamp = Math.floor(new Date().getTime() / 1000); // 限时秒杀判断刷新
        // var scKill_idx = that.data.scKill_idx;
        // var btn3 = that.data.scKillList[scKill_idx].progress.start_time/1000 - timestamp;
        // var btn4 = that.data.scKillList[scKill_idx].progress.end_time/1000 - timestamp;
        // if (btn3 == -3 || btn4 == -3){
        //   wx.showLoading({
        //     title: '更新中',
        //     icon: 'none'
        //   })
        //   that.setData({
        //     page: 1,
        //     scKill_list: []
        //   })
        //   that.getScKillList();
        // }
        // 限量抢购判断刷新

        var actived_idx = that.actived_idx;
        var btn1 = that.activitylist[actived_idx].progress.start_time / 1000 - timestamp;
        var btn2 = that.activitylist[actived_idx].progress.end_time / 1000 - timestamp;

        if (btn1 == -3 || btn2 == -3) {
          common.showLoad(that);
          that.setData({
            page: 1,
            good_list: [],
            timer_btn: true });

          that.getActivitylist();
        }
      }, 1000);
    },
    // 限时秒杀
    // scKillactived: function (e) {
    //   var that = this;
    //   var d = e.currentTarget.dataset;
    //   // 防止点击过快，重复加载数据
    //   if (!that.data.ac_load_btn) {
    //     return false;
    //   }
    //   that.setData({
    //     scKill_id: d.sckill_id,
    //     scKill_idx: d.sckill_idx,
    //     page: 1,
    //     scKill_list: []
    //   })
    //   that.getSckillgoodslist();
    // },
    // getScKillList:function(){
    //   var that = this;
    //   var uri = app.getPath.scKill;
    //   return new Promise(function (resolve, reject) {
    //     common.ApiGateWayTest(uri, {}, true, function (res) {
    //       var res = res.data;
    //       if (res.success == 1) {
    //         // 先置默认值
    //         var activity_id = 0;
    //         var actived_idx = 0;
    //         var lists = res.result.lists;
    //         // 如果没有数据
    //         if (lists.length == 0) {
    //           // 全清空
    //           that.setData({
    //             scKillList: [],
    //             scKill_id,
    //             scKill_idx,
    //           })
    //           return false;
    //         }
    //         that.getDate();
    //         var btn = true;
    //         for (var i = 0; i < lists.length; i++) {
    //           var state = lists[i].progress.state;
    //           // 判断正在抢购中
    //           if (state == 1) {
    //             activity_id = lists[i].activity_id;
    //             actived_idx = i;
    //             btn = false;
    //             break;
    //           }
    //         }
    //         // 没有判断距离最近的即将开始
    //         if (btn) {
    //           for (var i = 0; i < lists.length; i++) {
    //             var state = lists[i].progress.state;
    //             if (state == 2) {
    //               activity_id = lists[i].activity_id;
    //               actived_idx = i;
    //               btn = false;
    //               break;
    //             }
    //           }
    //         }
    //         // 再无则取中间项
    //         if (btn) {
    //           activity_id = lists[2].activity_id;
    //           actived_idx = 2;
    //         }
    //         that.setData({
    //           scKillList: lists,
    //           scKill_id: activity_id,
    //           scKill_idx:actived_idx
    //         })
    //         that.getSckillgoodslist();
    //         resolve('限时秒杀成功')
    //       }
    //     })
    //   })
    // },
    // getSckillgoodslist(callback){
    //   var that = this;
    //   wx.showLoading({
    //     title: '更新中',
    //     icon: 'none'
    //   })
    //   // 关闭开关
    //   that.data.ac_load_btn = false;
    //   var uri = app.getPath.activitygoodslist;
    //   var data = {
    //     page: 1,
    //     page_size: 2,
    //     activity_id: this.data.scKill_id
    //   }
    //   common.ApiGateWayTest(uri, data, true, function (res) {
    //     if (res.statusCode == 500) {
    //       wx.hideLoading();
    //       return false;
    //     }
    //     var res = res.data;
    //      // 循环活动列表，得到当前选中的状态
    //     var nowState = that.data.scKillList[that.data.scKill_idx];//当前选中的index
    //     for (let i in that.data.scKillList) {
    //       if (that.data.scKillList[i].activity_id == that.data.scKill_id) {
    //         // 当前选中的活动的状态，
    //         var nowState = that.data.scKillList[i].progress.state;
    //       }
    //     }
    //     if (res.success == 1) {
    //       var lists = res.result.lists;
    //       // 给所有的商品列表项添加状态
    //       for (var i = 0; i < lists.length; i++) {
    //         lists[i].state = nowState;
    //       }
    //       var good_list = lists;
    //       // if (good_list.length > 0) {
    //       //   var isGoodListBool = false;
    //       // } else {
    //       //   var isGoodListBool = true;
    //       // }
    //       that.setData({
    //         scKill_list: good_list,
    //         // total: res.result.total,
    //         // isGoodListBool
    //       })
    //       // 打开开关
    //       that.data.ac_load_btn = true;
    //       wx.hideLoading();
    //     }
    //   })
    // },
    // 限量抢购判断选中
    actived: function actived(e) {
      var that = this;
      var d = e.currentTarget.dataset;

      if (!that.ac_load_btn) {
        return false;
      }

      that.setData({
        activity_id: d.activity_id,
        actived_idx: d.actived_idx,
        page: 1,
        good_list: [] });

      that.getActivitygoodslist();
    },

    // 获取限量抢购上面部分信息
    getActivitylist: function getActivitylist() {
      var that = this;
      var uri = app.getPath.activitylist;
      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, {}, true, function (res) {
          var res = res.data;

          if (res.success == 1) {
            // 先置默认值
            var activity_id = 0;
            var actived_idx = 0;
            var lists = res.result.lists; // 如果没有数据

            if (lists.length == 0) {
              that.setData({
                activitylist: [],
                activity_id: activity_id,
                actived_idx: actived_idx,
                flashSale_title: '' });

              return false;
            }

            that.getDate();
            var flashSale_title = '';
            var btn = true;

            for (var i = 0; i < lists.length; i++) {
              var state = lists[i].progress.state; // 判断正在抢购中

              if (state == 1) {
                activity_id = lists[i].activity_id;
                actived_idx = i; // flashSale_title = lists[i].time + '限量抢购';

                btn = false;
                break;
              }
            } // 没有判断距离最近的即将开始


            if (btn) {
              for (var i = 0; i < lists.length; i++) {
                var state = lists[i].progress.state;

                if (state == 2) {
                  activity_id = lists[i].activity_id;
                  actived_idx = i; // flashSale_title = lists[i].time + '限量抢购';

                  btn = false;
                  break;
                }
              }
            } // 再无则取中间项


            if (btn) {
              activity_id = lists[2].activity_id;
              actived_idx = 2; // flashSale_title = lists[2].time + '限量抢购';
            }

            that.setData({
              activitylist: lists,
              activity_id: activity_id,
              actived_idx: actived_idx,
              flashSale_title: '下单无门槛，全场免邮费' });

            that.getActivitygoodslist();
            resolve('getActivitylist success');
          }
        });
      });
    },

    // 获取限量抢购商品列表信息
    getActivitygoodslist: function getActivitygoodslist(callback) {
      var that = this;
      common.showLoad(that); // 关闭开关

      that.ac_load_btn = false;
      var uri = app.getPath.activitygoodslist;
      var data = {
        page: this.page,
        page_size: this.page_size,
        activity_id: this.activity_id };

      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res.statusCode == 500) {
          common.hideLoad(that);
          return false;
        }

        var res = res.data;
        var nowState = that.activitylist[that.actived_idx];

        for (var _i in that.activitylist) {
          if (that.activitylist[_i].activity_id == that.activity_id) {
            var nowState = that.activitylist[_i].progress.state;
          }
        }

        if (res.success == 1) {
          var lists = res.result.lists; // 给所有的商品列表项添加状态

          for (var i = 0; i < lists.length; i++) {
            lists[i].state = nowState;
          } // var good_list = [...that.data.good_list, ...lists];


          var good_list = that.good_list ? that.good_list.concat(lists) : lists;

          if (good_list.length > 0) {
            var isGoodListBool = false;
          } else {
            var isGoodListBool = true;
          }

          that.setData({
            good_list: good_list,
            total: res.result.total,
            isGoodListBool: isGoodListBool });


          if (that.good_list.length < that.total) {
            that.refreshFun(true);
          } else {
            that.refreshFun(false);
          } // 打开开关


          that.ac_load_btn = true;
          common.hideLoad(that);
        }
      });
    },

    // 广告图片
    getsingleAd: function getsingleAd() {
      var that = this;
      var uri = app.getPath.adlist;
      var data = {
        pid: 4 };

      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res && res.data && res.data.success == 1) {
          var data = res.data.result;
          that.setData({
            singleAd: data,
            singleAdcurrent: 0 });

        }
      });
    },
    // 领取弹窗优惠券-新人
    getCoupon: function getCoupon(coupon_id, ad_id, take_type) {
      var that = this; // 防止多次点击

      if (!this.AdClickBtn) {
        return false;
      } else {
        this.AdClickBtn = false;
      }

      var uri = app.getPath.addCoupon;
      var data = {
        coupon_id: coupon_id };

      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res && res.data && res.data.success == 1) {
          var result = res.data.result; // common.toast(result.state_desc);

          that.adclose(ad_id, 1);
          that.setData({
            showCouponList: true });


          if (take_type == 2) {
            that.setData({
              showCloseImg: true });

          }
        } else {
          // 防点击开关打开
          that.AdClickBtn = true;
        }
      });
    },

    // 首页领券
    getCoupons: function getCoupons(ad_id) {
      var that = this; // 防止多次点击

      if (!this.AdClickBtn) {
        return false;
      } else {
        this.AdClickBtn = false;
      }

      var uri = app.getPath.addAdCoupon;
      var data = {
        ad_id: ad_id };

      common.ApiGateWayTest(uri, data, true, function (res) {
        var resData = res.data;

        if (resData.success == 1 && resData.result.state == 0) {
          that.setData({
            popupCouponsList: resData.result.couponInfo,
            showAdver: false,
            showCouponsSuccess: true });

        } else {
          that.setData({
            showAdver: false });

          that.AdClickBtn = true;
          common.toast(resData.result.state_desc);
          return;
        }
      });
    },

    adclose: function adclose(ad_id, is_close) {
      var that = this;
      var uri = app.getPath.adclose;
      var data = {
        ad_id: ad_id,
        is_close: is_close };

      common.ApiGateWayTest(uri, data, true, function (res) {
        return;
      });
    },
    // 弹窗广告
    getAdvertisement: function getAdvertisement() {
      var that = this;
      var uri = app.getPath.adlist;
      var data = {
        pid: 5 };

      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res && res.data && res.data.success == 1) {
          var data = res.data.result;

          if (typeof data == 'object' && data.constructor == Array && data[0].ad_code && data[0].ad_code != '') {
            var pickup = common.getStorageSync('getpickup');
            // app.aldstat.sendEvent("exposure_index_popup", {
            // 	"提货点": pickup.cityName
            // });
            that.setData({
              advertisementAd: data,
              showAdver: true,
              showCouponsSuccess: false });

          } else if (data[0].media_type == 9 && data[0].ad_code == '') {
            that.setData({
              advertisementAd: data,
              showAdver: false });

            that.getCoupons(data[0].ad_id);
          } else {
            that.setData({
              showAdver: false });

          }
        }
      });
    },

    advertisementOut: function advertisementOut(e) {
      var that = this;
      var ad_id = e.detail.target.dataset.ad_id;

      if (app.checkSessionKey) {
        common.formIdUpdate(e);

        if (ad_id && ad_id > 0) {
          that.adclose(ad_id, 0);
        }
      }

      that.setData({
        showAdver: false,
        showCouponsSuccess: false,
        AdClickBtn: true });

    },

    // 获取bar列表
    getBar: function getBar() {
      var that = this;
      var uri = app.getPath.barList;
      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, '', true, function (res) {
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;

            for (var i = 0; i < data.barList.length; i++) {
              // 	类型（1.签到 2.领券中心 3.专题 4.活动页 5.限时抢购 6.门店支付 7.通用活动 8.砍价活动）
              switch (data.barList[i].type) {
                case 1:
                  data.barList[i].url = '/pages/sign/sign?entryType=external';
                  break;

                case 2:
                  data.barList[i].url = '/pages/couponCenter/couponCenter?entryType=external';
                  break;

                case 3:
                  if (data.barList[i].position > 0) {
                    data.barList[i].url = '/pages/index/configureModelPage/configureModelPage?position=' + data.barList[i].position;
                  } else {
                    data.barList[i].url = '/pages/projectPage/projectPage?entryType=external&type=3&id=' + data.barList[i].id;
                  }

                  break;

                case 4:
                  data.barList[i].url = '/pages/activity/activity?entryType=external&activity_id=' + data.barList[i].id; // data.barList[i].url = '/packageA/select/select?id='+66;

                  break;

                case 5:
                  data.barList[i].url = '/pages/flashSale/flashSale';
                  break;

                case 6:
                  data.barList[i].url = '../../packageB/topay/topay';
                  break;

                case 7:
                  data.barList[i].url = '/packageA/select/select?entryType=external&id=' + data.barList[i].id;
                  break;

                case 8:
                  data.barList[i].url = '/packageA/bargain/bargain?entryType=external&activity_bargain_id=' + data.barList[
                  i].id;
                  break;

                default:
                  data.barList[i].url = '';}

            }

            that.setData({
              barList: data.barList,
              service_title: data.service_title });

            resolve('barSuccess');
          } else {
            common.toast('网络错误');
          }
        });
      });
    },
    goBar: function goBar(e) {
      var url = e.currentTarget.dataset.url;
      var index = e.currentTarget.dataset.index;
      var pickup = common.getStorageSync('getpickup');
      console.log(url);
      if (app.checkSessionKey) {
        common.formIdUpdate(e);
      }

      // app.aldstat.sendEvent("on_index_tabbar_" + (Number(index) + 1), {
      // 	"提货点": pickup.cityName
      // });
      wx.navigateTo({
        url: url });

    },
    // 获取新人活动列表
    getActivitynewperson: function getActivitynewperson() {
      var that = this;
      var uri = app.getPath.activitynewperson;
      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, '', true, function (res) {
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;
            that.setData({
              acticity_new_person: data.acticity_new_person });

            resolve('barSuccess');
          }
        });
      });
    },
    // 获取抢购接口
    getActivityindex: function getActivityindex() {
      var that = this;
      var uri = app.getPath.activityindex;
      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, '', true, function (res) {
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;
            that.setData({
              acticity_buy: data.acticity_buy });

            resolve('barSuccess');
          } else {
            common.toast('网络错误');
          }
        });
      });
    },
    // 首页专题列表
    // getSubjuctList:function(){
    //     var that = this;
    //     var uri = app.getPath.subjuctList;
    //     return new Promise(function (resolve, reject) {
    //         common.ApiGateWayTest(uri, '', true, function (res) {
    //             if (res && res.data && res.data.success == 1) {
    //                 var data = res.data.result.subjectList;
    //                 that.setData({subjuctList:data})
    //               resolve('subjuctListSuccess');
    //             } else {
    //                 common.toast('网络错误');
    //             }
    //         })
    //     })
    // },
    // 获取精选推荐
    getIndexProducts: function getIndexProducts(page) {
      var that = this;
      var uri = app.getPath.goodsRecommend;
      var data = {
        page: this.page,
        page_size: this.page_size };

      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, data, true, function (res) {
          if (res && res.data) {
            var data = res.data;

            if (data.success == 1) {
              var list = data.result.products; // var imglist = data.result.products;
              // var list = [];
              // var dataList = [];
              // for(var i in imglist){
              //   list.push(imglist[i]);
              //   if((Number(i)+1)%2 == 0){
              //     dataList.push(list);
              //     list = [];
              //   }
              //   if(i == imglist.length-1 && list.length > 0){
              //     dataList.push(list);
              //   }
              // }
              // that.setData({
              //   shopList: that.data.shopList.concat(dataList)
              // })

              that.setData({
                shopList: that.shopList.concat(list) });

              //把请求过来的值传给子组件,每一次下拉这个值都会改变that.shopList
              // uni.$emit('shopList', that.shopList)
              // console.log(that.shopList)
              if (data.result.products.length < that.page_size) {
                that.refreshFun(false);
                that.setData({
                  showBottomLoading: false });

              } else {
                that.refreshFun(true);
                that.setData({
                  showBottomLoading: true });

              }
            } else if (data.success == 0) {
              that.refreshFun(false);
            }

            resolve('productsSuccess');
          } else {
            common.toast('网络错误');
          }
        });
      });
    },
    // 是否允许上拉加载
    refreshFun: function refreshFun(data) {
      this.setData({
        refresh: data });

    },
    // 去搜索页面
    goSearch: function goSearch() {
      wx.navigateTo({
        url: '../search/search?keyWord=' + this.keyWord });

    },
    tap_to_top: function tap_to_top() {
      wx.pageScrollTo({
        scrollTop: 0,
        duration: 300 });

    },
    // 滚动判断
    onPageScroll: function onPageScroll(e) {
      var that = this;
      var query = wx.createSelectorQuery();
      query.select('#slider-bar-team').boundingClientRect(function (res) {
        if (res && res.top) {
          if (res.top < that.navBarHeight && !that.sliderBarFixed) {
            that.setData({
              sliderBarFixed: true });

          } else if (res.top > that.navBarHeight && that.sliderBarFixed) {
            that.setData({
              sliderBarFixed: false });

          }
        }
      }).exec();

      if (e.scrollTop > 150 && !that.to_top) {
        that.setData({
          to_top: true });

      } else if (e.scrollTop < 150 && that.to_top) {
        that.setData({
          to_top: false });

      }

      if (!this.takeoutAnimation) {
        this.setData({
          takeoutAnimation: true });

      } else {
        this.endScroll();
      } // if (e.scrollTop > that.data.scrollTop) {
      //   this.setData({
      //     showSearchBG: true
      //   })
      // } else {
      //   this.setData({
      //     showSearchBG: false
      //   })
      // }

    },
    endScroll: function endScroll() {
      clearTimeout(this.scroll);
      this.scroll = setTimeout(function () {
        if (this.takeoutAnimation) {
          this.setData({
            takeoutAnimation: false });

        }
      }.bind(this), 500);
    },

    //
    // 跳转商品页
    goToProduct: function goToProduct(e) {
      var goodsid = e.currentTarget.dataset.goodsId;
      var goodsName = e.currentTarget.dataset.name;
      var pickup = common.getStorageSync('getpickup');
      // app.aldstat.sendEvent("on_index_rushToBuy", {
      // 	"提货点": pickup.cityName,
      // 	"名称": goodsName,
      // 	"提货点&名称": pickup.cityName + "_" + goodsName
      // });

      if (app.checkSessionKey) {
        common.formIdUpdate(e);
      }

      wx.navigateTo({
        url: '/pages/product/product?entryType=external&productId=' + goodsid });

    },

    // SKU弹窗
    setModalStatus: function setModalStatus(type) {
      if (this.showSKUstatus == 0) {
        this.showSKUstatus = 1;
      } else {
        this.showSKUstatus = 0;
      }

      var animation = wx.createAnimation({
        duration: 300,
        timingFunction: "linear",
        delay: 0 });

      animation.translateY(300).opacity(1).step();
      this.setData({
        animationData: animation.export() });


      if (this.showSKUstatus == 1) {
        this.setData({
          showModalStatus: true });

      }

      setTimeout(function () {
        animation.translateY(0).step();
        this.setData({
          animationData: animation });


        if (this.showSKUstatus == 0) {
          this.setData({
            showModalStatus: false });

        }
      }.bind(this), 200);
    },
    //添加到购物车
    addShopCart: function addShopCart(e) {
      // 未登录跳转
      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        common.goRegister();
        return false;
      }

      var that = this;

      if (this.productid == e.target.dataset.productid) {
        addCart(e);
      } else {
        this.loadProductDetail(e).then(function () {
          addCart(e);
        });
      }

      function addCart(e) {
        if (!that.checkCanPurchase()) return;
        var product = that.itemData;
        var type = e.currentTarget.dataset.type;
        that.setData({
          buy_now: 0 });
        // type == 'addcart' &&

        if (that.currentAttrs.length == product.properties.length) {
          // 验证库存
          var product_id = '';

          for (var i in product.stock) {
            var stock = product.stock[i].key;
            stock = stock.split('_');
            stock.sort(function (a, b) {
              return a - b;
            });
            stock = stock.join('_');
            var attrs = that.currentAttrs.join('_');

            if (attrs == stock) {
              product_id = product.stock[i].key;
              break;
            }
          }

          var invurl = app.getPath.addCart;

          if (product.pre_info && product.pre_info.is_pre == 1) {
            invurl = app.getPath.addCart;
          }

          var invdata = {
            goods_id: product.goods_id,
            sku_key: product_id,
            amount: that.buynum };

          // app.aldstat.sendEvent("加入购物车", {
          // 	"商品名称": that.itemData.report.goods_name,
          // 	"用户名": that.itemData.report.nick_name
          // });
          common.formIdUpdate(e);
          common.ApiGateWayTest(invurl, invdata, true, function (ret) {
            if (!ret) return;

            if (ret.data.success != 0) {
              that.currentAttrs = [];
              that.setData({
                cartAmount: ret.data.result.cart_num,
                productid: 0 });

              common.toast(ret.data.msg);

              if (type == 'bottomcart') {
                that.setData({
                  showModalStatus: false,
                  showSKUstatus: 0 });

              }
            } else {
              common.toast(ret.data.msg);
              return;
            }
          });
        } else {
          // type != 'addcart' ||
          if (that.showSKUstatus == 0) {
            that.setModalStatus(type);
            that.setData({
              showfwModalStatus: false,
              showShareModalStatus: false,
              showBonusModal: false });

          } else {
            common.toast('请选择商品款式');
          }
        }
      }
    },
    // 立即购买
    nowPurchase: function nowPurchase(e) {
      var that = this; // 跳转登录

      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        common.goRegister();
        return false;
      }

      if (that.productid == e.target.dataset.productid) {
        nowPurchaseSub(e);
      } else {
        that.loadProductDetail(e).then(function () {
          nowPurchaseSub(e);
        });
      }

      function nowPurchaseSub(e) {
        if (!that.checkCanPurchase()) return;
        var product = that.itemData;
        that.setData({
          buy_now: 1 });


        if (that.currentAttrs.length == product.properties.length) {
          // 验证库存
          var product_id = '';

          for (var i in product.stock) {
            var stock = product.stock[i].key;
            stock = stock.split('_');
            stock.sort(function (a, b) {
              return a - b;
            });
            stock = stock.join('_');
            var attrs = that.currentAttrs.join('_');

            if (attrs == stock) {
              product_id = product.stock[i].key;
              break;
            }
          }

          var invurl = app.getPath.skuEnough;

          if (product.pre_info && product.pre_info.is_pre == 1) {
            invurl = app.getPath.skuEnough;
          }

          var invdata = {
            goods_id: product.goods_id,
            sku_key: product_id,
            amount: that.buynum };

          // app.aldstat.sendEvent("立即购买", {
          // 	"商品名称": that.itemData.report.goods_name,
          // 	"用户名": that.itemData.report.nick_name
          // });
          common.formIdUpdate(e);
          common.ApiGateWayTest(invurl, invdata, true, function (ret) {
            if (!ret) return;

            if (ret.data.result.is_enough != 1) {
              common.toast(ret.data.result.msg);
              return;
            } else {
              that.currentAttrs = []; // showSKUstatus 0关闭  1展开  重置为关闭

              that.setData({
                showModalStatus: false,
                showSKUstatus: 0,
                cartAmount: ret.data.result.cart_num,
                productid: 0 });

              wx.navigateTo({
                url: '/pages/confirm/confirm' });

            }
          });
        } else {
          if (that.showSKUstatus == 0) {
            that.setModalStatus();
            that.setData({
              showfwModalStatus: false,
              showShareModalStatus: false,
              showBonusModal: false });

          } else {
            common.toast('请选择商品款式');
          }
        } // 立即购买的缓存


        common.setStorage({
          key: "nowPay",
          data: that.confirmData });

      }
    },
    // 商品详情数据获取
    loadProductDetail: function loadProductDetail(e) {
      var productid = e.target.dataset.productid;
      this.setData({
        productid: e.target.dataset.productid });

      var that = this;
      common.showLoad(that);
      var uri = app.getPath.goodsInfo;
      var skuAmounturi = app.getPath.getSkuAmount;
      var data = {
        goods_id: productid };

      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, data, true, function (res) {
          if (res.statusCode == 200) {
            var productlist = res.data.result; // productlist.min_buy_amount = productlist.min_buy_amount ? productlist.min_buy_amount : 1;

            var content = productlist.goods_content;
            var introContent = productlist.detail_explain;
            var islike = productlist.is_liked;
            productlist.current_price = productlist.shop_price;
            productlist.price = productlist.market_price; // WxParse.wxParse('content', 'html', content, that, 0);
            // WxParse.wxParse('introContent', 'html', introContent, that, 0);

            that.setData({
              itemData: productlist,
              bannerItem: productlist.gallery,
              indicatorDots: productlist.gallery.length > 1 ? true : false,
              buynum: productlist.min_buy_amount,
              // isLike: islike,
              brandID: productlist.cat_id,
              skuSvipCurrent: productlist.shop_price,
              skuCurrent: productlist.market_price });

            that.setDefaultSKU(productlist); // that.loadipRecommend();
            // that.getGoodsRecommend();

            that.isPriceEqualFun();
            common.hideLoad(that);
          } else if (res.statusCode == 500) {
            common.hideLoad(that);
            return;
            common.toast("网络错误");
          } else {
            common.hideLoad(that);
            common.toast("获取购物车数量失败");
          }

          resolve('获取商详信息');
        });
        common.ApiGateWayTest(skuAmounturi, '', true, function (res) {
          if (res.statusCode == 200) {
            that.setData({
              cartAmount: res.data.result.cart_num });

          }
        });
      });
    },
    //设置默认SKU
    setDefaultSKU: function setDefaultSKU(product) {
      // product 请求到的数据
      var defaultAttrIds = [];
      var defaultAttrStock = null;
      var maybeStock = [];
      var effectiveStock = []; // 得到SKU组合的原始数组

      for (var i = 0; i < product.properties.length; ++i) {
        var property = product.properties[i];

        if (!property.is_multiselect) {
          maybeStock[i] = [];

          for (var j = 0; j < property.attrs.length; j++) {
            maybeStock[i].push(property.attrs[j].id);
          }
        }
      } // 得到多个笛卡尔积组合


      maybeStock = common.multiCartesian(maybeStock);

      if (maybeStock.length && maybeStock[0] instanceof Array) {
        for (var i = 0; i < maybeStock.length; i++) {
          maybeStock[i].sort(function (a, b) {
            return a - b;
          });
        }
      } //验证是否可以购买


      this.setData({
        canPurchase: this.checkCanPurchase() });

      var min_sku_price = 9999999999;
      var min_sku_svip_price = 9999999999;

      for (var i = 0; i < product.stock.length; ++i) {
        var _goods_attr = product.stock[i].key.split('_');

        var _min_sku_price = product.stock[i].market_price,
        _min_sku_svip_price = product.stock[i].price;
        var hasDefaultFlag = false;

        if (min_sku_svip_price > _min_sku_svip_price) {
          var ids = [];

          if (product.is_goods_number > 0 && product.is_on_sale && product.stock[i].is_enough) {
            //商品能购买，并且该sku有库存 则更新最低价
            for (var ind = 0, len = _goods_attr.length; ind < len; ind++) {
              ids.push(parseInt(_goods_attr[ind]));
            }

            defaultAttrIds = ids;
            defaultAttrStock = [{
              attrs: defaultAttrIds,
              stock: product.stock[i] }];

            hasDefaultFlag = true;
            min_sku_svip_price = _min_sku_svip_price;
            min_sku_price = _min_sku_price;
          } else if (!product.is_goods_number > 0 || !product.is_on_sale) {
            //商品不能购买，则一定更新最低价，否则就是9999999999
            for (var ind = 0, len = _goods_attr.length; ind < len; ind++) {
              ids.push(parseInt(_goods_attr[ind]));
            }

            defaultAttrIds = ids;
            defaultAttrStock = [{
              attrs: defaultAttrIds,
              stock: product.stock[i] }];

            hasDefaultFlag = true;
            min_sku_svip_price = _min_sku_svip_price;
            min_sku_price = _min_sku_price;
          }
        }

        _goods_attr.sort(function (a, b) {
          return a - b;
        });

        _goods_attr = _goods_attr.join('_');

        for (var j = 0; j < maybeStock.length; j++) {
          var _thisStock = '';

          if (maybeStock[j] instanceof Array) {
            _thisStock = maybeStock[j].join('_');
          } else if (maybeStock[j] instanceof Object) {
            _thisStock = '';
          } else {
            _thisStock = maybeStock[j];
          }

          if (_goods_attr == _thisStock) {
            if (product.stock[i].is_enough == true) {
              effectiveStock.push({
                attrs: maybeStock[j],
                stock: product.stock[i] });

            }
          }
        }
      }

      var skuSvipCurrent = this.itemData.current_price;
      var skuCurrent = this.itemData.price;
      this.setData({
        sku_price: min_sku_price,
        min_sku_price: min_sku_price,
        sku_svip_price: min_sku_svip_price,
        min_sku_svip_price: min_sku_svip_price,
        skuSvipCurrent: parseFloat(skuSvipCurrent).toFixed(2),
        skuCurrent: skuCurrent,
        currentStock: defaultAttrStock });
      //先通过设置默认sku，来设置默认显示价格，设置完之后，把默认sku去掉，不影响原来逻辑

      this.currentAttrs = defaultAttrIds;
      this.setData({
        hasDefaultSKU: this.currentStock ? true : false });

      this.set_choosed_sku();
      defaultAttrIds = [];
      defaultAttrStock = null;
      this.setData({
        currentStock: null,
        hasDefaultSKU: false });

      this.currentAttrs = [];

      if (effectiveStock.length == 1) {
        defaultAttrIds = effectiveStock[0].attrs instanceof Array ? effectiveStock[0].attrs : [effectiveStock[0].attrs];
        defaultAttrStock = effectiveStock[0].stock;
      }

      if (effectiveStock.length > 1) {
        for (var i in product.properties) {
          var attrs = product.properties[i].attrs;

          for (var j in attrs) {
            var isin_count = 0;

            for (var k in effectiveStock) {
              var isin = new RegExp(attrs[j].id).test(effectiveStock[k].attrs);

              if (isin) {
                isin_count++;
              }
            }

            if (isin_count == effectiveStock.length) {
              defaultAttrIds.push(attrs[j].id);
            }
          }
        }
      }

      this.setData({
        currentStock: defaultAttrStock });

      this.currentAttrs = defaultAttrIds;
      this.setData({
        hasDefaultSKU: this.currentStock ? true : false });

      this.set_choosed_sku();
    },
    //设置choosed_sku
    set_choosed_sku: function set_choosed_sku() {
      var that = this;
      var product = that.itemData;

      if (that.currentAttrs.length < product.properties.length) {
        that.sku_price = that.min_sku_price;
        that.sku_svip_price = that.min_sku_svip_price;
        that.setData({
          choosed_sku: '选择：商品规格',
          skuImages: product.header_img,
          skuSvipCurrent: that.itemData.current_price,
          skuCurrent: that.itemData.price });

        that.setAttrsClass();
        return;
      }

      var choosed_sku = '';
      var sku_price = 0;
      var sku_svip_price = 0;
      var skuSvipCurrent = that.itemData.current_price;
      var skuCurrent = that.itemData.price;
      that.setData({
        choosed_sku: choosed_sku,
        sku_price: sku_price,
        sku_svip_price: sku_svip_price,
        skuSvipCurrent: skuSvipCurrent,
        skuCurrent: skuCurrent });


      for (var i in product.properties) {
        var attrs = product.properties[i].attrs;

        for (var j in attrs) {
          for (var k in that.currentAttrs) {
            if (that.currentAttrs[k] == attrs[j].id) {
              choosed_sku += attrs[j].item + ' '; //					sku_price += attrs[j].attr_price;
              //					sku_svip_price += attrs[j].attr_svip_price;
            }
          }
        }
      }

      if (choosed_sku != '') {
        for (var i in product.stock) {
          var stock = product.stock[i].key;
          stock = stock.split('_');
          stock.sort(function (a, b) {
            return a - b;
          });
          stock = stock.join('_');
          var attrs = that.currentAttrs.join('_');

          if (attrs == stock) {
            that.skuImages = product.stock[i].header_img;
            sku_price = product.stock[i].market_price;
            sku_svip_price = product.stock[i].shop_price;
          }
        }

        that.confirmData = [{
          goods_name: product.goods_name,
          goods_id: product.goods_id,
          sku_key: attrs,
          amount: that.buynum,
          shop_price: sku_svip_price,
          market_price: sku_price,
          sku_key_name: "规格:" + choosed_sku,
          sku_img: that.skuImages }];

        choosed_sku = '已选：' + choosed_sku;
        var skuSvipCurrent = sku_svip_price;
        var skuCurrent = sku_price;
        that.setData({
          choosed_sku: choosed_sku,
          sku_price: sku_price,
          sku_svip_price: sku_svip_price,
          skuSvipCurrent: skuSvipCurrent,
          skuCurrent: skuCurrent,
          skuImages: that.skuImages });

      }

      that.setAttrsClass();
    },
    //SKU选择
    attrValueselest: function attrValueselest(e) {
      var that = this;
      var product = this.itemData;
      if (!product) return;
      var property = e.currentTarget.dataset.property;
      var attr = e.currentTarget.dataset.attr;

      if (attr.is_multiselect) {
        var attrs = [].concat(this.optionalAttrs);
        var index = attrs.indexOf(attr.id);

        if (-1 == index) {
          attrs.push(attr.id);
        } else {
          attrs.splice(index, 1);
        }

        this.setData({
          optionalAttrs: attrs });

      } else {
        var inStock = false;

        for (var i in product.stock) {
          if (product.stock[i].is_enough != true) {
            continue;
          }

          if (product.stock[i].key.indexOf(String(attr.id)) >= 0) {
            inStock = true;
            break;
          }
        }

        if (!inStock) {
          common.toast('库存不足');
          return;
        }

        var stock = null;
        var attrs = [].concat(this.currentAttrs);
        var index = attrs.indexOf(attr.id);

        if (-1 == index) {
          attrs.push(attr.id);
        } else {
          attrs.splice(index, 1);
        }

        for (var i in property.attrs) {
          if (property.attrs[i].id != attr.id) {
            var index = attrs.indexOf(property.attrs[i].id);

            if (-1 != index) {
              attrs.splice(index, 1);
            }
          }
        }

        attrs = attrs.filter(function (attr, index, self) {
          return self.indexOf(attr) === index;
        });
        attrs.sort(function (a, b) {
          return a - b;
        });

        if (attrs.length) {
          var key = attrs.join('_');

          for (var i = 0; i < product.stock.length; ++i) {
            var _goods_attr = product.stock[i].key.split('_');

            _goods_attr.sort(function (a, b) {
              return a - b;
            });

            _goods_attr = _goods_attr.join('_');

            if (_goods_attr == key) {
              stock = product.stock[i];
              break;
            }
          }
        }

        if (stock && stock.is_enough) {
          this.currentStock = stock, this.currentAttrs = attrs, this.setData({
            buynum: product.min_buy_amount });

        } else {
          if (attrs.length < product.properties.length) {
            this.currentStock = null, this.currentAttrs = attrs, this.setData({
              buynum: product.min_buy_amount });

          } else {
            common.toast('库存不足');
          }
        }

        this.setData({
          canPurchase: this.checkCanPurchase() });

      }

      this.set_choosed_sku();
    },
    //设置每一个attr的class
    setAttrsClass: function setAttrsClass() {
      var product = this.itemData;
      var property = product.properties;

      for (var i in property) {
        var attrs = property[i].attrs;

        for (var j in attrs) {
          var attr = attrs[j];

          if (!product) {
            attr.class = 'disable';
            continue;
          }

          if (product.is_goods_number == 0) {
            attr.class = 'disable';
            continue;
          }

          var attrArr = [];

          if (attr.is_multiselect) {
            attr.class = this.optionalAttrs.indexOf(attr.id) == -1 ? '' : 'active';
          } else {
            attr.class = this.currentAttrs.indexOf(attr.id) == -1 ? '' : 'active';
            var inStock = false;

            for (var i in product.stock) {
              if (product.stock[i].is_enough != true) {
                var currentAyyrsJn = this.currentAttrs.join("_");

                if (product.stock[i].key.indexOf(String(currentAyyrsJn)) >= 0 && this.currentAttrs.length > 0) {
                  var stockDisplyKey = product.stock[i].key.split("_");

                  for (var j in stockDisplyKey) {
                    if (stockDisplyKey[j] != this.currentAttrs) {
                      for (var k in product.properties) {
                        for (var s in product.properties[k].attrs) {
                          if (product.properties[k].attrs[s].id == stockDisplyKey[j]) {
                            product.properties[k].attrs[s].class = 'disable';
                          }
                        }
                      }
                    }
                  }
                } else {
                  continue;
                }
              }

              if (product.stock[i].key.indexOf(String(attr.id)) >= 0) {
                inStock = true;
                break;
              }
            }

            if (!inStock) {
              attr.class += 'disable';
            }
          }
        }
      }

      this.setData({
        itemData: product });

    },
    //验证是否可以购买
    checkCanPurchase: function checkCanPurchase() {
      var product = this.itemData;
      var required = false;

      if (product.pre_info && product.pre_info.is_pre == 1) {
        this.setData({
          sumbitName: product.pre_info.pre_time });

        return false;
      }

      if (!product || product.is_enough == 0) {
        this.setData({
          sumbitName: '抱歉，商品已售罄' });

        return false;
      }

      if (product.is_on_sale == 0) {
        this.setData({
          sumbitName: '抱歉，商品已下架' });

        return false;
      }

      if (this.currentAttrs.length >= product.properties.length) {
        for (var i in product.properties) {
          if (!product.properties[i].is_multiselect) {
            required = true;
            break;
          }
        }

        if (required) {
          if (!this.currentAttrs || !this.currentAttrs.length) {
            return false;
          }

          if (!this.currentStock) {
            return false;
          }
        }
      }

      this.setData({
        sumbitName: '立即购买' });

      return true;
    },
    // SKU价格和非VIP价格是否相同
    isPriceEqualFun: function isPriceEqualFun() {
      var that = this;

      if (that.itemData.price && that.itemData.current_price) {
        var price = that.itemData.price + that.sku_price,
        svip_price = that.itemData.current_price + that.sku_svip_price;

        if (price == svip_price) {
          that.setData({
            isPriceEqual: true });

        } else {
          that.setData({
            isPriceEqual: false });

        }
      } else {
        that.setData({
          isPriceEqual: false });

      }
    },
    // 加减
    changeNum: function changeNum(e) {
      var that = this;
      var product = that.itemData;
      var invurl = app.getPath.skuEnough;

      if (product.pre_info && product.pre_info.is_pre == 1) {
        invurl = app.getPath.skuEnough;
      }

      var product_id = '';

      for (var i in product.stock) {
        var stock = product.stock[i].key;
        stock = stock.split('_');
        stock.sort(function (a, b) {
          return a - b;
        });
        stock = stock.join('_');
        var attrs = that.currentAttrs.join('_');

        if (attrs == stock) {
          product_id = product.stock[i].key;
          break;
        }
      }

      if (that.currentAttrs.length == product.properties.length) {
        // alpha-beta 0  减
        if (e.currentTarget.dataset.alphaBeta == 0) {
          if (!that.checkCanPurchase()) return; // Lin start

          if (that.buynum <= that.itemData.min_buy_amount) {
            common.toast('不能小于最小购买数量');
            return;
          } // Lin end


          if (that.buynum <= 1) {// buynum: 1
          } else if (that.buynum === 2) {
            that.setData({
              buynum: that.buynum - 1,
              undel: true });

          } else {
            that.setData({
              buynum: that.buynum - 1 });

          } // 验证库存


          if (that.buynum != 1) {
            var invdata = {
              goods_id: product.goods_id,
              sku_key: product_id,
              amount: that.buynum };

            common.ApiGateWayTest(invurl, invdata, true, function (ret) {
              if (!ret) return;

              if (ret.data.result.is_enough != 1) {
                common.toast(ret.data.result.msg);
                return;
              }
            });
          }
        } else {
          // alpha-beta 1  加      max_buy_amount==0不限制数量
          // Lin start
          if (that.itemData.max_buy_amount != 0 && that.buynum >= that.itemData.max_buy_amount) {
            common.toast('不能在多啦~');
            return;
          } // Lin end


          that.setData({
            buynum: that.buynum + 1,
            undel: false });


          if (that.buynum > 1) {
            var invdata = {
              goods_id: product.goods_id,
              sku_key: product_id,
              amount: that.buynum };

            common.ApiGateWayTest(invurl, invdata, true, function (ret) {
              if (!ret) return;

              if (ret.data.result.is_enough != 1) {
                common.toast(ret.data.result.msg);
                that.setData({
                  buynum: that.buynum - 1 });

                that.set_choosed_sku();
                return;
              }
            });
          }
        }

        that.confirmData.num = that.buynum;
      } else {
        if (that.showSKUstatus == 0) {
          that.setModalStatus();
        } else {
          common.toast('请选择商品款式');
        }
      }

      that.set_choosed_sku();
    },

    gzhBindload: function gzhBindload(e) {
      if (e.detail.status != 0) {
        this.setData({
          showOfficial: false });

      }
    },

    getConfigureIndexModel2: function getConfigureIndexModel2() {
      var that = this;
      var uri = app.getPath.indexmodel;
      var data = {
        position: 3 };

      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res && res.data && res.data.success == 1) {
          that.setData({
            indexModel2: res.data.result.lists });

        }
      });
    },
    getConfigureIndexModel: function getConfigureIndexModel() {
      var that = this;
      var uri = app.getPath.indexmodel;
      var data = {
        position: 1 };

      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res && res.data && res.data.success == 1) {
          that.setData({
            indexModel: res.data.result.lists });

        }
      });
    },

    //获取首页团购
    getPickUpAcitivity: function getPickUpAcitivity(city) {
      var that = this;
      Promise.all([that.getpickuplistr()]).then(function (res) {
        if (!res[0]) {
          common.setStorageSync('reLoad', true);
          that.$options.onShow[0](that);
          return;
        } else {
          that.getNewAd();
          that.getSubjectAd();
          that.bargain_page = 1;
          that.bargain_page_size = 20;
          that.team_page = 1;
          that.team_page_size = 20;
          that.be_team_page = 1;
          that.be_team_page_size = 20;
          that.teamList = [];
          that.beTeamList = [];
          that.bargainList = [];
          that.teamGoodsList = [];
          that.getAllActivity();
          wx.stopPullDownRefresh();
        }
      }); // common.ApiGateWayTest(url,"",true,function (res) {
      //       var res=res.data
      //     if(res.success==1){
      //       let pickUpArr = res.result.data;
      //       that.setData({
      //         pickUpActivity: pickUpArr
      //       })
      //       if (that.data.teamNum == 0) {
      //         that.setData({
      //           teamGoodsList: pickUpArr.team_in_progress.goods_list
      //         })
      //       } else if (that.data.teamNum == 1) {
      //         that.setData({
      //           teamGoodsList: pickUpArr.bargain_in_progress.goods_list
      //         })
      //       } else if (that.data.teamNum == 2) {
      //         that.setData({
      //           teamGoodsList: pickUpArr.be_team.goods_list
      //         })
      //       }
      //   } else {
      //     common.toast(res.msg);
      //     return
      //   }
      //   wx.stopPullDownRefresh()
      // })
    },

    getAllActivity: function getAllActivity() {
      var that = this;

      if (that.teamNum == 0) {
        console.log('获取首页拼团信息');
        that.getTeamList();
      } else if (that.teamNum == 1) {
        that.getBargainActivity();
      } else if (that.teamNum == 2) {
        that.getBeTeamList();
      }
    },

    // 选择提货点(重叠提货点)
    choosePickupChange: function choosePickupChange(e) {
      this.setData({
        chooseSelectIndex: e.currentTarget.dataset.index });

    },

    // 设置提货点(重叠提货点)
    choosePickupSubmit: function choosePickupSubmit() {
      this.setData({
        choosePickupShow: false });

      common.setStorageSync('getpickup', this.choosePickupList[this.chooseSelectIndex ? this.chooseSelectIndex : 0]);
      common.setStorageSync('reLoad', true);
      this.$options.onShow[0](this);
    },

    // 前往领取纸巾
    goTissue: function goTissue(e) {
      common.formIdUpdate(e);
      var url =
      'https://share.lltjs.com/app/index.php?i=2&c=entry&from=account&account=a450f613484aea3458ac7a7eba952d720d671557&xid=&do=entry&m=llt_afan';
      app.dataBase.pageUrl = url;
      common.goWebview();
      this.setData({
        showTissue: false });

    },

    // 跳转店铺
    goTakeoutShop: function goTakeoutShop() {
      var that = this;
      wx.navigateTo({
        url: '/packageA/takeout-shop/takeout-shop?entryType=external&shop_id=' + that.shop_id });

    },

    // 获取店铺id
    getShopPickUp: function getShopPickUp() {
      var that = this;
      var url = app.getPath.getShopPickUp;
      common.ApiGateWayTest(url, '', true, function (res) {
        var res = res.data;

        if (res.success == 1) {
          that.setData({
            shop_id: res.result.shop_id });

        }
      });
    },

    // 首页弹窗领红包
    getPacket: function getPacket() {
      this.setData({
        showPacketAd: false,
        showPacketCoupon: true });

    },

    // 关闭弹窗红包广告
    hide_packet_ad: function hide_packet_ad() {
      this.setData({
        showPacketAd: false });

    },

    hide_packet_coupon: function hide_packet_coupon() {
      this.setData({
        showPacketCoupon: false });

    },

    // 获取首页专题广告
    getSubjectAd: function getSubjectAd() {
      var that = this;
      var uri = app.getPath.adlist;
      var data = {
        pid: 9 };

      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, data, true, function (res) {
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;
            that.setData({
              subjectAdList: data });

            resolve('successAd');
          }
        });
      });
    },

    // 获取首页弹窗广告
    getPacketModal: function getPacketModal() {
      var that = this;
      var uri = app.getPath.adlist;
      var data = {
        pid: 10 };

      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, data, true, function (res) {
          if (res && res.data && res.data.success == 1) {
            var data = res.data.result;
            that.setData({
              packetModal: data });

            resolve('successAd');
          }
        });
      });
    },

    // 切换活动tab
    change_team_tab: function change_team_tab(e) {
      var that = this;
      var num = e.currentTarget.dataset.num;
      if (num == that.teamNum) return;
      common.showLoad(that);
      this.setData({
        teamNum: num });

      this.bargain_page = 1;
      this.bargain_page_size = 20;
      this.team_page = 1;
      this.team_page_size = 20;
      this.be_team_page = 1;
      this.be_team_page_size = 20;
      this.teamList = [];
      this.beTeamList = [];
      this.bargainList = [];
      this.teamGoodsList = [];
      this.setData({
        checkShowBottom: false,
        showBottomLoading: false });


      if (that.sliderBarFixed) {
        if (common.compareVersion('2.3.1') >= 0) {
          wx.pageScrollTo({
            selector: '#slider-bar-team' });

        } else {
          wx.pageScrollTo({
            scrollTop: 0 });

        }
      }

      that.getAllActivity();
    },

    //获取首页拼团信息
    getTeamList: function getTeamList() {
      console.log('获取首页拼团信息');
      var that = this;
      var url = app.getPath.getTeamActivity;
      var data = {
        page: that.team_page,
        page_size: that.team_page_size,
        type: 1 };

      common.ApiGateWayTest(url, data, true, function (res) {
        console.log('获取首页拼团信息', res);
        var resData = res.data;

        if (resData.success === 1) {
          if (resData.result.data.length < that.team_page_size) {
            that.setData({
              checkShowBottom: true });

          }

          var teamList = that.teamList;
          that.teamList = teamList.length > 0 ? [].concat(_toConsumableArray(teamList), _toConsumableArray(resData.result.data)) : resData.result.data;
          that.teamList = that.teamList.map(function (item) {
            item.shop_price = parseFloat(item.shop_price);
            item.market_price = parseFloat(item.market_price);
            return item;
          });
          that.setData({
            showBottomLoading: false,
            teamGoodsList: that.teamList });

          console.log('teamGoodsList', that.teamGoodsList);
          common.hideLoad(that);
        }
      });
    },

    // 获取首页砍价信息
    getBargainActivity: function getBargainActivity() {

      var that = this;
      var url = app.getPath.getBargainActivity;
      var data = {
        page: that.bargain_page,
        page_size: that.bargain_page_size };

      common.ApiGateWayTest(url, data, true, function (res) {

        var resData = res.data;

        if (resData.success === 1) {
          if (resData.result.data.length < that.bargain_page_size) {
            that.setData({
              checkShowBottom: true });

          }

          var bargainList = that.bargainList;
          that.bargainList = bargainList.length > 0 ? [].concat(_toConsumableArray(bargainList), _toConsumableArray(resData.result.data)) : resData.result.data;
          that.bargainList = that.bargainList.map(function (item) {
            item.shop_price = parseFloat(item.shop_price);
            item.market_price = parseFloat(item.market_price);
            return item;
          });
          that.setData({
            showBottomLoading: false,
            teamGoodsList: that.bargainList });

          common.hideLoad(that);
        }
      });
    },



    //获取首页即将拼团信息
    getBeTeamList: function getBeTeamList() {
      var that = this;
      var url = app.getPath.getTeamActivity;
      var data = {
        page: that.be_team_page,
        page_size: that.be_team_page_size,
        type: 2 };

      common.ApiGateWayTest(url, data, true, function (res) {
        var resData = res.data;

        if (resData.success === 1) {
          if (resData.result.data.length < that.team_page_size) {
            that.setData({
              checkShowBottom: true });

          }

          var beTeamList = that.beTeamList;
          that.beTeamList = beTeamList.length > 0 ? [].concat(_toConsumableArray(beTeamList), _toConsumableArray(resData.result.data)) : resData.result.data;
          that.beTeamList = that.beTeamList.map(function (item) {
            item.shop_price = parseFloat(item.shop_price);
            item.market_price = parseFloat(item.market_price);
            return item;
          });
          that.setData({
            showBottomLoading: false,
            teamGoodsList: that.beTeamList });

          common.hideLoad(that);
        }
      });
    },

    // 新厂首页轮播改变触发
    newSwiperChange: function newSwiperChange(e) {
      this.setData({
        indexAdcurrent: e.detail.current });

    },

    // 红包-获取左侧提示信息
    getHomeSituation: function getHomeSituation() {
      var that = this;
      var url = app.getPath.sureHomeSituation;
      common.ApiGateWayTest(url, '', true, function (res) {
        var resData = res.data;

        if (resData.success == 1) {
          that.setData({
            homeSituation: resData.result });

          var entry_share_info = {
            user_id: resData.result.user_id,
            invite_share_img: resData.result.invite_share_img,
            invite_share_text: resData.result.invite_share_text,
            urge_share_img: resData.result.urge_share_img,
            urge_share_text: resData.result.urge_share_text,
            rule_img: resData.result.rule_img };

          common.setStorageSync('entry_share_info', entry_share_info);
        }
      });
    },

    // 红包-左侧点击跳转（领红包）
    getEnvelopes: function getEnvelopes(e) {
      var item = e.currentTarget.dataset.item;
      var that = this;
      var pickupId = common.getStorageSync('getpickup');
      // app.aldstat.sendEvent("index_urging_report", {
      // 	"提货点": pickupId.cityName
      // });

      if (item.status == 2 || item.status == 3) {
        wx.navigateTo({
          url: '/packageB/invitation-share/invitation-share?type=2' });

      } else if (item.status == 4) {
        wx.navigateTo({
          url: '/packageB/invitation-share/invitation-share?type=1' });

      } else if (item.status == 1) {
        that.setData({
          showRedEnvel: true,
          showRedEnvelType: item.status });

      }
    },

    // 关闭手机号授权弹窗
    closePhoneModal: function closePhoneModal() {
      this.setData({
        showPhoneModal: false });

    },

    // 显示获取手机号授权弹窗
    toShowPhoneModal: function toShowPhoneModal() {
      this.setData({
        showPhoneModal: true });

    },

    // 红包-邀请分享进入
    setInviteShareLogin: function setInviteShareLogin() {
      var that = this;
      var url = app.getPath.inviteShareLogin;
      var shareTicket_info = common.getStorageSync('shareTicket_info');

      if (shareTicket_info && shareTicket_info != '') {
        wx.getShareInfo({
          shareTicket: shareTicket_info.shareTicket,
          success: function success(res) {
            var data = {
              user_id: shareTicket_info.query.user_id,
              wx_scene: shareTicket_info.scene,
              encrypted_data: JSON.stringify(res) };

            common.ApiGateWayTest(url, data, true, function (res) {
              var resData = res.data;

              if (resData.result.success) {
                common.setStorageSync('shareTicket_info', '');
              }
            });
          },
          fail: function fail(res) {
            var data = {
              user_id: shareTicket_info.query.user_id,
              wx_scene: shareTicket_info.scene,
              encrypted_data: '' };

            common.ApiGateWayTest(url, data, true, function (res) {
              var resData = res.data;

              if (resData.result.success) {
                common.setStorageSync('shareTicket_info', '');
              }
            });
          } });

      }
    },

    // 获取手机号授权
    getPhone: function getPhone(e) {
      var that = this;

      if (!(e.detail.encryptedData && e.detail.iv)) {
        return false;
      } // 新用户注册
      // 获取手机号


      var mobileUri = app.getPath.getWXMobile; // 重新获取code获取手机号

      wx.login({
        success: function success(res) {
          var Mobiledata = {
            encryptedData: e.detail.encryptedData,
            iv: e.detail.iv,
            code: res.code };

          common.ApiGateWayTest(mobileUri, Mobiledata, true, function (resData) {
            if (resData.data.success == 1) {
              common.toast('绑定成功');
              that.setData({
                getRemind: true,
                showPhoneModal: false });

            } else {
              return;
            }
          });
        } });


    },
    // 重新获取提货点信息
    getpickuplistr: function getpickuplistr() {
      var that = this;
      var uri = app.getPath.pickupInfo;
      var pickupId = common.getStorageSync('getpickup');
      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, '', true, function (res) {
          var resData = res.data;

          if (resData.success == 1) {
            if (resData.result.pickup_type != pickupId.pickup_type) {
              common.setStorageSync('getpickup', resData.result);
              resolve(false);
            } else {
              resolve(true);
            }
          } else {
            reject();
          }
        });
      });
    },
    setData: function setData(obj) {
      var that = this;
      var keys = [];
      var val, data;
      Object.keys(obj).forEach(function (key) {
        keys = key.split('.');
        val = obj[key];
        data = that.$data;
        keys.forEach(function (key2, index) {
          that[key] = obj[key];
        });
      });
    } } };exports.default = _default;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */ 1)["default"]))

/***/ }),

/***/ 70:
/*!**************************************************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue?vue&type=style&index=0&lang=scss& ***!
  \**************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_8_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_4_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-1!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader??ref--8-oneOf-1-2!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src??ref--8-oneOf-1-3!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-4!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&lang=scss& */ 71);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_8_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_4_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_8_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_4_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_8_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_4_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_8_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_4_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_8_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_8_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_4_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_8_oneOf_1_5_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_index_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 71:
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-1!./node_modules/css-loader??ref--8-oneOf-1-2!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/pages/index/index.vue?vue&type=style&index=0&lang=scss& ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ })

},[[64,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/index/index.js.map