(global["webpackJsonp"] = global["webpackJsonp"] || []).push([["packageA/team-product/team-product"],{

/***/ 634:
/*!*********************************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue ***!
  \*********************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _team_product_vue_vue_type_template_id_3ad7b1f3___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./team-product.vue?vue&type=template&id=3ad7b1f3& */ 635);
/* harmony import */ var _team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./team-product.vue?vue&type=script&lang=js& */ 637);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony import */ var _team_product_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./team-product.vue?vue&type=style&index=0&lang=css& */ 639);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/runtime/componentNormalizer.js */ 15);






/* normalize component */

var component = Object(_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__["default"])(
  _team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _team_product_vue_vue_type_template_id_3ad7b1f3___WEBPACK_IMPORTED_MODULE_0__["render"],
  _team_product_vue_vue_type_template_id_3ad7b1f3___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* hot reload */
if (false) { var api; }
component.options.__file = "Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ 635:
/*!****************************************************************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue?vue&type=template&id=3ad7b1f3& ***!
  \****************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_template_id_3ad7b1f3___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./team-product.vue?vue&type=template&id=3ad7b1f3& */ 636);
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_template_id_3ad7b1f3___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_17_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_template_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_template_id_3ad7b1f3___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ 636:
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--17-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue?vue&type=template&id=3ad7b1f3& ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function() {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
  if (!_vm._isMounted) {
    _vm.e0 = function($event) {
      _vm.shippingBonus.length > 0 ? "setModalBonus" : "goCouponList"
    }

    _vm.e1 = function($event) {
      $event.stopPropagation()
      _vm.team_type == 0 ? "nowPurchase" : "delegation"
    }
  }
}
var staticRenderFns = []
render._withStripped = true



/***/ }),

/***/ 637:
/*!**********************************************************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue?vue&type=script&lang=js& ***!
  \**********************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./team-product.vue?vue&type=script&lang=js& */ 638);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_babel_loader_lib_index_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_12_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_script_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 638:
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue?vue&type=script&lang=js& ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0; //
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

//获取应用实例
var app = getApp().globalData;
var common = __webpack_require__(/*! ../../utils/common.js */ 28);
var event = __webpack_require__(/*! ../../utils/event.js */ 59); //引入这个插件，使html内容自动转换成wxml内容
//引入这个插件，使html内容自动转换成wxml内容
// var WxParse = require("../../wxParse/wxParse.js");
var WxParse = function WxParse() {return __webpack_require__.e(/*! import() | wxParse/wxParse */ "wxParse/wxParse").then(__webpack_require__.bind(null, /*! @/wxParse/wxParse.vue */ 909));};var teamList = function teamList() {return __webpack_require__.e(/*! import() | components/teamList/teamList */ "components/teamList/teamList").then(__webpack_require__.bind(null, /*! @/components/teamList/teamList */ 895));};var navbar = function navbar() {return __webpack_require__.e(/*! import() | components/navBar/navBar */ "components/navBar/navBar").then(__webpack_require__.bind(null, /*! @/components/navBar/navBar */ 52));};var _default =



{
  components: {
    teamList: teamList,
    navbar: navbar,
    WxParse: WxParse },

  data: function data() {
    return {
      iconURL: app.dataBase.iconURL,
      bannerApp: true,
      iphoneXBottom: '0rpx',
      winWidth: 0,
      winHeight: 0,
      teamId: 0,
      itemData: {
        shop_type: 0 },

      isLike: 0,
      showSKUstatus: 0,
      optionalAttrs: {},
      skuImages: '',
      bannerItem: [],
      buynum: 1,
      // 产品图片轮播
      indicatorDots: true,
      indicatorColor: "rgba(0,0,0,.2)",
      indicatorActiveColor: "#ffe150",
      autoplay: false,
      interval: 5000,
      duration: 300,
      circular: true,
      // 属性选择
      firstIndex: -1,
      choosed_sku: '',
      cartAmount: 0,
      // 滚动判断值 1：商品，2：评价，3详情
      currentLocation: 1,
      // 是否显示subbar
      showSubbar: false,
      // 滚动到的位置
      scrollTop: 0,
      scrollBar: '',
      showBackTop: false,
      // 弹窗SKU，不能减不能加
      undel: true,
      unadd: false,
      // 领券弹窗
      showBonus: 0,
      // IP推荐
      brandID: 0,
      ipRecommend: {},
      formateDatas: [],
      // 商品评论
      comment: {},
      // 拼团次数
      teamLabel: {},
      wordsLimit: true,
      limitWords: "展开",
      // SKU的VIP价格和非SVIP是否相同
      isPriceEqual: false,
      // 优惠券分享样式
      productgift: {},
      isshare: 0,
      giftNum: '',
      bounsTxtnumOn: false,
      // 优惠券展示
      showBonusModal: false,
      // 前往设置弹窗
      showSettingModalStatus: false,
      // isShowModeWx: 1,
      isShowbox: 0,
      canPurchase: false,
      date_limite_bool: true,
      date_limite_ing: true,
      // 是否显示右上角返回首页
      isShowGoHome: false,
      // 分享图片
      isShowSharePic: false,
      preurl: null,
      // 租机弹窗
      showzjModalStatus: false,
      // 方案详情切换开关
      rentToggleStatus: 0,
      aldExposure: true,
      stopCartBtn: false,
      prom_bool: false,
      activity_bool: false,
      activity_classfy: "",
      h: "00",
      m: "00",
      s: "00",
      d: "00",
      teamList: [],
      team_num: 0,
      check_remind: false,
      check_remind_activity: false,
      showPhoneModal: false,
      // navbar
      navbarOpacity: 0,
      showBack: false,
      navBarHeight: app.navBarHeight,
      team_type: '',
      team_sku_type: 0,
      noticeUnload: false,
      // 抢购价钱
      activity_price_start: '0',
      activity_price_end: '0.00',
      activity_time_start: {},
      confirmData: {},
      currentAttrs: [],
      team_needer: '' };

  },

  // 下拉刷新
  onPullDownRefresh: function onPullDownRefresh() {
    that.loadProductDetail();
    that.loadProductgift();
    setTimeout(function () {
      wx.stopPullDownRefresh();
    }, 1500);
  },
  // 调用微信分享接口
  onShareAppMessage: function onShareAppMessage(res) {
    var that = this;
    var pickup = common.getStorageSync('getpickup');
    var entry_share_info = common.getStorageSync('entry_share_info');

    if (res.target && res.target.dataset.shareinfo) {
      var shareInfo = res.target.dataset.shareinfo;

      if (shareInfo && shareInfo.fromButton == 'notice') {
        return {
          title: entry_share_info.urge_share_text,
          path: '/pages/index/index?pickup_id=' + pickup.pickup_id + '&user_id=' + entry_share_info.user_id,
          imageUrl: entry_share_info.urge_share_img };

      } else if (shareInfo && shareInfo.fromButton == 'envelopes') {
        return {
          title: entry_share_info.invite_share_text,
          path: '/pages/index/index?pickup_id=' + pickup.pickup_id + '&user_id=' + entry_share_info.user_id,
          imageUrl: entry_share_info.invite_share_img };

      } else {
        return {
          title: that.itemData.share_title,
          path: '/packageA/team-product/team-product?teamId=' + that.itemData.goods_id + '&pickup_id=' + pickup.pickup_id,
          imageUrl: that.itemData.share_img };

      }
    } else {
      return {
        title: that.itemData.share_title,
        path: '/packageA/team-product/team-product?teamId=' + that.itemData.goods_id + '&pickup_id=' + pickup.pickup_id,
        imageUrl: that.itemData.share_img };

    }
  },
  // 传值
  onLoad: function onLoad(options) {
    console.log('options', options);
    var that = this;
    wx.showShareMenu({
      withShareTicket: true });

    var page = getCurrentPages();

    if (page.length > 1) {
      that.setData({
        showBack: true });

    }

    wx.getSystemInfo({
      success: function success(res) {
        var model = res.model;

        if (model.search('iPhone X') != -1) {
          that.setData({
            iphoneXBottom: '68rpx' });

        }
      } });
    // 监听checkSessionKey

    event.on('checkSessionKey', this, function (data) {
      var isOldUser = common.getStorageSync('isOldUser');
      this.setData({
        checkSessionKey: data,
        isOldUser: isOldUser });

    });
    var codeId = '';
    var codePickup = '';

    if (options.scene) {
      var scene = decodeURIComponent(options.scene);
      codeId = scene.split("&")[0];
      codePickup = scene.split('&amp;')[1];
    }

    if (options.teamId == undefined && codeId == '') {
      common.toast("请求参数错误");
      return;
    }

    var that = this;

    if (options && options.scene && options.scene != '') {
      that.setData({
        teamId: codeId });

      this.setData({
        isShowGoHome: true });

    } else {
      that.setData({
        teamId: options.teamId });

      this.getTeamList();
    } // 从外部分享进入时，显示左上角回到首页  改动带external时为内部进入携带参数，外部进入不带参数


    if (options && options.entryType && options.entryType == 'external') {
      this.setData({
        isShowGoHome: false });

    } else {
      this.setData({
        isShowGoHome: true });

    } // 外部带商品店铺


    this.setData({
      entryData: options });

    var options = that.entryData;

    if (options && options.scene && options.scene != '') {
      that.getExternal(codePickup).then(function () {
        // 关闭开关，让app知道已经不是第一次进入当前页
        app.firstlaunchApp = false; // 清空data内携带参数

        that.entryData = {}; // 外部已带经纬度定位，无需再调用定位接口，所以将缓存定位改为真，让页面可以显示

        common.setStorageSync('authSetting', {
          'scope.userLocation': true });

        that.checkSessionKey = true;
        that.loadProductDetail();
        that.loadProductgift();
      });
      return;
    }

    var pickupId = common.getStorageSync('getpickup'); // 判断是否第一次进入 且是从外部进入，如二维码扫码 && app.firstlaunchApp

    if (options && (options.atitude || options.pickup_id) && !pickupId) {
      that.getExternal(options.pickup_id).then(function () {
        // 关闭开关，让app知道已经不是第一次进入当前页
        app.firstlaunchApp = false; // 清空data内携带参数

        that.entryData = {}; // 外部已带经纬度定位，无需再调用定位接口，所以将缓存定位改为真，让页面可以显示

        common.setStorageSync('authSetting', {
          'scope.userLocation': true });

        that.checkSessionKey = true;
        that.loadProductDetail();
        that.loadProductgift();
      });
    } else {
      that.checkSessionKey = true;
      that.loadProductDetail();
      that.loadProductgift();
    }
  },
  onUnload: function onUnload() {
    this.setData({
      noticeUnload: true });

  },
  onShow: function onShow() {
    var isOldUser = common.getStorageSync('isOldUser');
    this.setData({
      checkSessionKey: app.checkSessionKey,
      isOldUser: isOldUser });


    if (this.itemData.team_id && this.itemData.team_id != undefined) {
      this.loadProductDetail();
      this.getTeamList();
    }
  },

  props: {},
  methods: {

    getDate: function getDate(prom_info) {
      var that = this;
      var start = prom_info.start_time * 1000;
      var end = prom_info.end_time * 1000;
      var now = new Date().getTime(); // && prom_info.prom_label=="限时抢购"

      if (now >= start && now <= end) {
        that.countTime(now, end);
        that.setData({
          date_limite_ing: true });

        this.date = setInterval(function () {
          var now = new Date().getTime();
          that.countTime(now, end);
        }, 1000);
        that.countTimeMs();
      } else if (start >= now && end >= now) {
        that.countTime(now, start);
        that.setData({
          date_limite_ing: false });

        this.date = setInterval(function () {
          var now = new Date().getTime();
          that.countTime(now, start);
        }, 1000);
      } else {
        that.setData({
          date_limite_bool: false });

      }
    },
    countTime: function countTime(now, end) {
      var leftTime = end - now;
      var d, h, m, s;

      if (leftTime >= 0) {
        d = Math.floor(leftTime / 1000 / 60 / 60 / 24, 10); //计算剩余的天数

        h = Math.floor(leftTime / 1000 / 60 / 60 % 24) + d * 24;
        m = Math.floor(leftTime / 1000 / 60 % 60);
        s = Math.floor(leftTime / 1000 % 60);
      } else {
        clearInterval(this.date);
        this.loadProductDetail();
        return false;
      }

      h = h > 9 ? h : '0' + h;
      m = m > 9 ? m : '0' + m;
      s = s > 9 ? s : '0' + s;
      this.setData({
        down_date_h: h,
        down_date_m: m,
        down_date_s: s });

    },

    // 毫秒倒计时
    countTimeMs: function countTimeMs() {var _this = this;
      var ms = 9;
      this.dataMs = setInterval(function () {
        if (ms > 1) {
          ms--;
        } else {
          ms = 9;
        }

        _this.setData({
          down_date_ms: ms });

      }, 100);
    },

    //倒计时函数
    countDown: function countDown(end) {var _this2 = this;
      var that = this;
      var now = new Date().getTime() / 1000;
      var leftTime = end - now;
      var d, h, m, s;
      clearInterval(that.teamTime);
      that.teamTime = setInterval(function () {
        leftTime = leftTime - 1;

        if (leftTime >= 0) {
          d = Math.floor(leftTime / 60 / 60 / 24, 10); //计算剩余的天数

          h = Math.floor(leftTime / 60 / 60 % 24);
          m = Math.floor(leftTime / 60 % 60);
          s = Math.floor(leftTime % 60);
          d = d > 9 ? d : '0' + d;
          h = h > 9 ? h : '0' + h;
          m = m > 9 ? m : '0' + m;
          s = s > 9 ? s : '0' + s;
        } else {
          clearInterval(that.teamTime);
          _this2.setData({
            showCountDown: false });

          that.loadProductDetail();
        }

        _this2.setData({
          d: d,
          h: h,
          m: m,
          s: s });

      }, 1000);
    },
    // 从外部二维码扫码，带经纬度和外部标识external
    getExternal: function getExternal(pickup_id) {
      var that = this;
      var uri = app.getPath.getpickup;
      var data = {
        pickup_id: pickup_id };

      return new Promise(function (resolve, reject) {
        // 获取提货点
        common.ApiGateWayTest(uri, data, true, function (res) {
          if (res && res.data && res.data.success == 1) {
            var res = res.data.result.cities.pick_up;
            common.setStorage({
              key: 'city',
              data: {
                'pickup_id': res.pickup_id,
                'warehouse_id': res.warehouse_id,
                'cityName': res.city_name,
                'is_pick_up': 1 } });


            common.setStorage({
              key: 'getpickup',
              data: {
                'pickup_id': res.pickup_id,
                'cityName': res.pickup_name,
                'pickup_address': res.pickup_address,
                'pickup_contact': res.pickup_contact,
                'pickup_phone': res.pickup_phone,
                'pickup_type': res.pickup_type } },

            function (res) {
              resolve('获取id成功');
            });
          }
        });
      });
    },
    // 轮播画廊
    setPreviewImage: function setPreviewImage(e) {
      var that = this;
      var current = e.currentTarget.dataset.current;
      var imgUrl = [];

      for (var i = 0; that.bannerItem.length > i; i++) {
        imgUrl.push(that.bannerItem[i].src);
      }

      wx.previewImage({
        current: current,
        urls: imgUrl });

    },
    // SKU弹窗
    setModalStatus: function setModalStatus(type) {
      var that = this;
      that.team_sku_type = 1;

      if (this.showSKUstatus == 0) {
        this.showSKUstatus = 1;
      } else {
        this.showSKUstatus = 0;
      }

      var animation = wx.createAnimation({
        duration: 250,
        timingFunction: "linear",
        delay: 0 });

      animation.translateY(368).opacity(1).step();
      this.setData({
        animationData: animation.export() });


      if (this.showSKUstatus == 1) {
        this.setData({
          showModalStatus: true });

      }

      setTimeout(function () {
        if (that.iphoneXBottom == "68rpx") {
          animation.translateY(-34).step();
        } else {
          animation.translateY(0).step();
        }

        this.setData({
          animationData: animation });


        if (this.showSKUstatus == 0) {
          this.setData({
            showModalStatus: false });

        }
      }.bind(this), 200);
    },
    // 领券弹窗
    setModalBonus: function setModalBonus() {
      if (this.showBonusModal == 0) {
        this.showBonusModal = 1;
      } else {
        this.showBonusModal = 0;
      }

      var animation = wx.createAnimation({
        duration: 300,
        timingFunction: "linear",
        delay: 0 });

      animation.translateY(300).opacity(1).step();
      this.setData({
        animationData: animation.export() });


      if (this.showBonusModal == 1) {
        this.setData({
          showBonusModal: true });

      }

      setTimeout(function () {
        animation.translateY(0).step();
        this.setData({
          animationData: animation });


        if (this.showBonusModal == 0) {
          this.setData({
            showBonusModal: false });

        }
      }.bind(this), 200);
    },
    // 弹窗里领取优惠券
    getBonus: function getBonus(e) {
      var that = this; // 跳转登录

      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        common.goRegister();
        return false;
      }

      var coupon_id = e.currentTarget.dataset.typeid;
      if (!that.shippingBonus) return;
      var uri = app.getPath.addCoupon;
      var data = {
        coupon_id: coupon_id };

      common.formIdUpdate(e);
      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res.statusCode == 200) {
          if (res.data.result) {
            common.toast(res.data.result.state_desc);
          }
        }

        that.loadProductgift();
      });
    },
    // 服务弹窗
    setfwModalStatus: function setfwModalStatus(e) {
      var animation = wx.createAnimation({
        duration: 300,
        timingFunction: "linear",
        delay: 0 });

      animation.translateY(300).opacity(1).step();
      this.setData({
        animationData: animation.export() });

      this.setData({
        showfwModalStatus: true });

      setTimeout(function () {
        animation.translateY('-150px').translateX('-50%').step();
        this.setData({
          animationData: animation });


        if (e.currentTarget.dataset.status == 0) {
          this.setData({
            showfwModalStatus: false });

        }
      }.bind(this), 200);
    },
    // 分享选择弹窗
    showShareModalStatus: function showShareModalStatus(e) {
      var animation = wx.createAnimation({
        duration: 300,
        timingFunction: "linear",
        delay: 0 });

      animation.translateY(300).opacity(1).step();
      this.setData({
        animationData: animation.export() });

      this.setData({
        showShareModalStatus: true });

      setTimeout(function () {
        animation.translateY(0).step();
        this.setData({
          animationData: animation });


        if (e.currentTarget.dataset.status == 0) {
          this.setData({
            showShareModalStatus: false });

        }
      }.bind(this), 200);
    },
    // 商品详情数据获取
    loadProductDetail: function loadProductDetail() {
      var that = this;
      common.showLoad(this);
      var uri = app.getPath.getTeamGoodsInfo;
      var skuAmounturi = app.getPath.getSkuAmount;
      var data = {
        team_id: that.teamId };

      // console.log(uri, skuAmounturi, data);
      common.ApiGateWayTest(uri, data, true, function (res) {

        if (res.statusCode == 200) {
          var productlist = res.data.result;
          // console.log('productlist',productlist);
          var content = productlist.goods_content;
          var introContent = productlist.detail_explain;
          var islike = productlist.is_liked;
          productlist.current_price = productlist.shop_price;
          productlist.price = productlist.market_price;
          productlist.team_price = parseFloat(productlist.team_price);
          that.setData({
            itemData: productlist,
            bannerItem: productlist.gallery,
            indicatorDots: productlist.gallery.length > 1 ? true : false,
            buynum: productlist.min_buy_amount,
            brandID: productlist.cat_id,
            skuSvipCurrent: parseFloat(productlist.shop_price),
            skuCurrent: parseFloat(productlist.market_price) });


          if (productlist.is_notice == 1) {
            that.setData({
              check_remind: true });

          }

          if (productlist.is_activity_notice == 1) {
            that.setData({
              check_remind_activity: true });

          }

          if (that.aldExposure == true) {
            that.aldExposure = false;
          }

          that.teamLabel2();
          that.setDefaultSKU(productlist);
          that.isPriceEqual2();
          common.hideLoad(that);
        } else {
          common.hideLoad(that);
          common.toast("获取购物车数量失败");
        }
      });
      common.ApiGateWayTest(skuAmounturi, '', true, function (res) {
        if (res.statusCode == 200) {
          that.setData({
            cartAmount: res.data.result.cart_num });

        }
      });
    },
    // 轮播图片加载完成
    swiperImageLoad: function swiperImageLoad() {
      var that = this;
      that.setData({
        swiperImgBl: true });

    },
    // 加载优惠券
    loadProductgift: function loadProductgift() {
      var that = this;
      var Bonusuri = app.getPath.goodscouponlist;
      var data = {
        goods_id: that.teamId };

      common.ApiGateWayTest(Bonusuri, data, true, function (res) {
        var shippingBonus = res.data.result;
        var bonusL = 0;
        var bounsTxtnum = 0;

        if (shippingBonus) {
          bonusL = shippingBonus.length > 3 ? 3 : shippingBonus.length;
        }

        for (var i = 0; i < bonusL; i++) {
          bounsTxtnum = bounsTxtnum + shippingBonus[i].name.length;
        }

        that.setData({
          shippingBonus: shippingBonus });


        if (bounsTxtnum > 24) {
          that.setData({
            bounsTxtnumOn: true });

        }
      });
    },
    //设置默认SKU
    setDefaultSKU: function setDefaultSKU(product) {
      // product 请求到的数据
      var defaultAttrIds = [];
      var defaultAttrStock = null;
      var maybeStock = [];
      var effectiveStock = []; // 得到SKU组合的原始数组

      for (var i = 0; i < product.properties.length; ++i) {
        var property = product.properties[i];

        if (!property.is_multiselect) {
          maybeStock[i] = [];

          for (var j = 0; j < property.attrs.length; j++) {
            maybeStock[i].push(property.attrs[j].id);
          }
        }
      } // 得到多个笛卡尔积组合


      maybeStock = common.multiCartesian(maybeStock);

      if (maybeStock.length && maybeStock[0] instanceof Array) {
        for (var i = 0; i < maybeStock.length; i++) {
          maybeStock[i].sort(function (a, b) {
            return a - b;
          });
        }
      } //验证是否可以购买


      this.setData({
        canPurchase: this.checkCanPurchase() });

      var min_sku_price = 9999999999;
      var min_sku_svip_price = 9999999999;

      for (var i = 0; i < product.stock.length; ++i) {
        var _goods_attr = product.stock[i].key.split('_');

        var _min_sku_price = product.stock[i].market_price,
        _min_sku_svip_price = product.stock[i].price;
        var hasDefaultFlag = false;

        if (min_sku_svip_price > _min_sku_svip_price) {
          var ids = [];

          if (product.is_goods_number > 0 && product.is_on_sale && product.stock[i].is_enough) {
            //商品能购买，并且该sku有库存 则更新最低价
            for (var ind = 0, len = _goods_attr.length; ind < len; ind++) {
              ids.push(parseInt(_goods_attr[ind]));
            }

            defaultAttrIds = ids;
            defaultAttrStock = [{
              attrs: defaultAttrIds,
              stock: product.stock[i] }];

            hasDefaultFlag = true;
            min_sku_svip_price = _min_sku_svip_price;
            min_sku_price = _min_sku_price;
          } else if (!product.is_goods_number > 0 || !product.is_on_sale) {
            //商品不能购买，则一定更新最低价，否则就是9999999999
            for (var ind = 0, len = _goods_attr.length; ind < len; ind++) {
              ids.push(parseInt(_goods_attr[ind]));
            }

            defaultAttrIds = ids;
            defaultAttrStock = [{
              attrs: defaultAttrIds,
              stock: product.stock[i] }];

            hasDefaultFlag = true;
            min_sku_svip_price = _min_sku_svip_price;
            min_sku_price = _min_sku_price;
          }
        }

        _goods_attr.sort(function (a, b) {
          return a - b;
        });

        _goods_attr = _goods_attr.join('_');

        for (var j = 0; j < maybeStock.length; j++) {
          var _thisStock = '';

          if (maybeStock[j] instanceof Array) {
            _thisStock = maybeStock[j].join('_');
          } else if (maybeStock[j] instanceof Object) {
            _thisStock = '';
          } else {
            _thisStock = maybeStock[j];
          }

          if (_goods_attr == _thisStock) {
            if (product.stock[i].is_enough == true) {
              effectiveStock.push({
                attrs: maybeStock[j],
                stock: product.stock[i] });

            }
          }
        }
      }

      var skuSvipCurrent = this.itemData.current_price;
      var skuCurrent = this.itemData.price;
      this.setData({
        sku_price: min_sku_price,
        min_sku_price: min_sku_price,
        sku_svip_price: min_sku_svip_price,
        min_sku_svip_price: min_sku_svip_price,
        skuSvipCurrent: parseFloat(skuSvipCurrent),
        skuCurrent: parseFloat(skuCurrent),
        currentStock: defaultAttrStock });
      //先通过设置默认sku，来设置默认显示价格，设置完之后，把默认sku去掉，不影响原来逻辑

      this.currentAttrs = defaultAttrIds;
      this.setData({
        hasDefaultSKU: this.currentStock ? true : false });

      this.set_choosed_sku();
      defaultAttrIds = [];
      defaultAttrStock = null;
      this.setData({
        currentStock: null,
        hasDefaultSKU: false });

      this.currentAttrs = [];

      if (effectiveStock.length == 1) {
        defaultAttrIds = effectiveStock[0].attrs instanceof Array ? effectiveStock[0].attrs : [effectiveStock[0].attrs];
        defaultAttrStock = effectiveStock[0].stock;
      }

      if (effectiveStock.length > 1) {
        for (var i in product.properties) {
          var attrs = product.properties[i].attrs;

          for (var j in attrs) {
            var isin_count = 0;

            for (var k in effectiveStock) {
              var isin = new RegExp(attrs[j].id).test(effectiveStock[k].attrs);

              if (isin) {
                isin_count++;
              }
            }

            if (isin_count == effectiveStock.length) {
              defaultAttrIds.push(attrs[j].id);
            }
          }
        }
      }

      this.setData({
        currentStock: defaultAttrStock });

      this.currentAttrs = defaultAttrIds;
      this.setData({
        hasDefaultSKU: this.currentStock ? true : false });

      this.set_choosed_sku();
    },
    //设置choosed_sku
    set_choosed_sku: function set_choosed_sku() {
      var that = this;
      var product = that.itemData;

      if (that.currentAttrs.length < product.properties.length) {
        that.sku_price = that.min_sku_price;
        that.sku_svip_price = that.min_sku_svip_price;
        that.setData({
          choosed_sku: '选择：商品规格',
          skuImages: product.header_img,
          skuSvipCurrent: parseFloat(that.itemData.current_price),
          skuCurrent: parseFloat(that.itemData.price) });

        that.setAttrsClass();
        return;
      }

      var choosed_sku = '';
      var sku_price = 0;
      var sku_svip_price = 0;
      var sku_svip_team_price = 0;
      var skuSvipCurrent = that.itemData.current_price;
      var skuCurrent = that.itemData.price;
      that.setData({
        choosed_sku: choosed_sku,
        sku_price: sku_price,
        sku_svip_price: sku_svip_price,
        skuSvipCurrent: parseFloat(skuSvipCurrent),
        skuCurrent: parseFloat(skuCurrent) });


      for (var i in product.properties) {
        var attrs = product.properties[i].attrs;

        for (var j in attrs) {
          for (var k in that.currentAttrs) {
            if (that.currentAttrs[k] == attrs[j].id) {
              choosed_sku += attrs[j].item + ' '; //					sku_price += attrs[j].attr_price;
              //					sku_svip_price += attrs[j].attr_svip_price;
            }
          }
        }
      }

      if (choosed_sku != '') {
        for (var i in product.stock) {
          var stock = product.stock[i].key;
          stock = stock.split('_');
          stock.sort(function (a, b) {
            return a - b;
          });
          stock = stock.join('_');
          var attrs = that.currentAttrs.join('_');

          if (attrs == stock) {
            that.skuImages = product.stock[i].header_img;
            sku_price = product.stock[i].market_price;
            sku_svip_price = product.stock[i].shop_price;
            sku_svip_team_price = product.stock[i].team_price;
          }
        }

        that.confirmData = [{
          goods_name: product.goods_name,
          goods_id: product.goods_id,
          sku_key: attrs,
          amount: that.buynum,
          shop_price: sku_svip_price,
          market_price: sku_price,
          sku_key_name: "规格:" + choosed_sku,
          sku_img: that.skuImages }];

        choosed_sku = '已选：' + choosed_sku;
        var skuSvipCurrent = that.team_type == 1 ? sku_svip_team_price : sku_svip_price;
        var skuCurrent = sku_price;
        that.setData({
          choosed_sku: choosed_sku,
          sku_price: sku_price,
          sku_svip_price: sku_svip_price,
          skuSvipCurrent: parseFloat(skuSvipCurrent),
          skuCurrent: parseFloat(skuCurrent),
          skuImages: that.skuImages });

      }

      that.setAttrsClass();
    },
    //SKU选择
    attrValueselest: function attrValueselest(e) {
      var that = this;
      var product = this.itemData;
      if (!product) return;
      var property = e.currentTarget.dataset.property;
      var attr = e.currentTarget.dataset.attr;

      if (attr.is_multiselect) {
        var attrs = [].concat(this.optionalAttrs);
        var index = attrs.indexOf(attr.id);

        if (-1 == index) {
          attrs.push(attr.id);
        } else {
          attrs.splice(index, 1);
        }

        this.setData({
          optionalAttrs: attrs });

      } else {
        var inStock = false;

        for (var i in product.stock) {
          if (product.stock[i].is_enough != true) {
            continue;
          }

          if (product.stock[i].key.indexOf(String(attr.id)) >= 0) {
            inStock = true;
            break;
          }
        }

        if (!inStock) {
          common.toast('库存不足');
          return;
        }

        var stock = null;
        var attrs = [].concat(this.currentAttrs);
        var index = attrs.indexOf(attr.id);

        if (-1 == index) {
          attrs.push(attr.id);
        } else {
          attrs.splice(index, 1);
        }

        for (var i in property.attrs) {
          if (property.attrs[i].id != attr.id) {
            var index = attrs.indexOf(property.attrs[i].id);

            if (-1 != index) {
              attrs.splice(index, 1);
            }
          }
        }

        attrs = attrs.filter(function (attr, index, self) {
          return self.indexOf(attr) === index;
        });
        attrs.sort(function (a, b) {
          return a - b;
        });

        if (attrs.length) {
          var key = attrs.join('_');

          for (var i = 0; i < product.stock.length; ++i) {
            var _goods_attr = product.stock[i].key.split('_');

            _goods_attr.sort(function (a, b) {
              return a - b;
            });

            _goods_attr = _goods_attr.join('_');

            if (_goods_attr == key) {
              stock = product.stock[i];
              break;
            }
          }
        }

        if (stock && stock.is_enough) {
          this.currentStock = stock, this.currentAttrs = attrs, this.setData({
            buynum: product.min_buy_amount });

        } else {
          if (attrs.length < product.properties.length) {
            this.currentStock = null, this.currentAttrs = attrs, this.setData({
              buynum: product.min_buy_amount });

          } else {
            common.toast('库存不足');
          }
        }

        this.setData({
          canPurchase: this.checkCanPurchase() });

      }

      this.set_choosed_sku();
    },
    //设置每一个attr的class
    setAttrsClass: function setAttrsClass() {
      var product = this.itemData;
      var property = product.properties;

      for (var i in property) {
        var attrs = property[i].attrs;

        for (var j in attrs) {
          var attr = attrs[j];

          if (!product) {
            attr.class = 'disable';
            continue;
          }

          if (product.is_goods_number == 0) {
            attr.class = 'disable';
            continue;
          }

          var attrArr = [];

          if (attr.is_multiselect) {
            attr.class = this.optionalAttrs.indexOf(attr.id) == -1 ? '' : 'active';
          } else {
            attr.class = this.currentAttrs.indexOf(attr.id) == -1 ? '' : 'active';
            var inStock = false;

            for (var i in product.stock) {
              if (product.stock[i].is_enough != true) {
                var currentAyyrsJn = this.currentAttrs.join("_");

                if (product.stock[i].key.indexOf(String(currentAyyrsJn)) >= 0 && this.currentAttrs.length > 0) {
                  var stockDisplyKey = product.stock[i].key.split("_");

                  for (var j in stockDisplyKey) {
                    if (stockDisplyKey[j] != this.currentAttrs) {
                      for (var k in product.properties) {
                        for (var s in product.properties[k].attrs) {
                          if (product.properties[k].attrs[s].id == stockDisplyKey[j]) {
                            product.properties[k].attrs[s].class = 'disable';
                          }
                        }
                      }
                    }
                  }
                } else {
                  continue;
                }
              }

              if (product.stock[i].key.indexOf(String(attr.id)) >= 0) {
                inStock = true;
                break;
              }
            }

            if (!inStock) {
              attr.class += 'disable';
            }
          }
        }
      }

      this.setData({
        itemData: product });

    },
    // 收藏
    addFavorites: function addFavorites(e) {
      var that = this;
      var islike = that.isLike;
      var teamId = that.teamId;
      var uri = app.getPath.goodsLike;
      var unuri = app.getPath.goodsUnlike;
      var data = {
        goods_id: teamId };

      var undata = {
        goods_id: teamId };


      if (!islike) {
        common.ApiGateWayTest(uri, data, true, function (res) {
          if (res.statusCode == 200) {
            var res = res.data.result;
            that.setData({
              isLike: !islike });

            common.toast("收藏成功");
          }
        });
      } else {
        common.ApiGateWayTest(unuri, undata, true, function (res) {
          if (res.statusCode == 200) {
            var res = res.data.result;
            that.setData({
              isLike: !islike });

            common.toast("取消收藏");
          }
        });
      }
    },
    //验证是否可以购买
    checkCanPurchase: function checkCanPurchase() {
      var product = this.itemData;
      var required = false;

      if (product.pre_info && product.pre_info.is_pre == 1) {
        this.setData({
          sumbitName: product.pre_info.pre_time });

        return false;
      }

      if (!product || product.is_enough == 0) {
        this.setData({
          sumbitName: '抱歉，商品已售罄' });

        return false;
      }

      if (product.is_on_sale == 0) {
        this.setData({
          sumbitName: '抱歉，商品已下架' });

        return false;
      }

      if (this.currentAttrs.length >= product.properties.length) {
        for (var i in product.properties) {
          if (!product.properties[i].is_multiselect) {
            required = true;
            break;
          }
        }

        if (required) {
          if (!this.currentAttrs || !this.currentAttrs.length) {
            return false;
          }

          if (!this.currentStock) {
            return false;
          }
        }
      }

      this.setData({
        sumbitName: '立即购买' });

      return true;
    },
    // SKU价格和非VIP价格是否相同
    isPriceEqual2: function isPriceEqual2() {
      var that = this;

      if (that.itemData.price && that.itemData.current_price) {
        var price = that.itemData.price + that.sku_price,
        svip_price = that.itemData.current_price + that.sku_svip_price;

        if (price == svip_price) {
          that.setData({
            isPriceEqual: true });

        } else {
          that.setData({
            isPriceEqual: false });

        }
      } else {
        that.setData({
          isPriceEqual: false });

      }
    },
    // 加减
    changeNum: function changeNum(e) {
      var that = this;
      common.formIdUpdate(e);
      var product = that.itemData;
      var invurl = app.getPath.skuEnough;

      if (product.pre_info && product.pre_info.is_pre == 1) {
        invurl = app.getPath.skuEnough;
      }

      var product_id = '';

      for (var i in product.stock) {
        var stock = product.stock[i].key;
        stock = stock.split('_');
        stock.sort(function (a, b) {
          return a - b;
        });
        stock = stock.join('_');
        var attrs = that.currentAttrs.join('_');

        if (attrs == stock) {
          product_id = product.stock[i].key;
          break;
        }
      }

      if (that.currentAttrs.length == product.properties.length) {
        // alpha-beta 0  减
        if (e.currentTarget.dataset.alphaBeta == 0) {
          if (!that.checkCanPurchase()) return; // Lin start

          if (that.buynum <= that.itemData.min_buy_amount) {
            common.toast('不能小于最小购买数量');
            return;
          } // Lin end


          if (that.buynum <= 1) {// buynum: 1
          } else if (that.buynum === 2) {
            that.setData({
              buynum: that.buynum - 1,
              undel: true });

          } else {
            that.setData({
              buynum: that.buynum - 1 });

          } // 验证库存


          if (that.buynum != 1) {
            var invdata = {
              goods_id: product.goods_id,
              sku_key: product_id,
              amount: that.buynum };

            common.ApiGateWayTest(invurl, invdata, true, function (ret) {
              if (!ret) return;

              if (ret.data.result.is_enough != 1) {
                common.toast(ret.data.result.msg);
                return;
              }
            });
          }
        } else {
          // alpha-beta 1  加      max_buy_amount==0不限制数量
          // Lin start
          if (that.itemData.max_buy_amount != 0 && that.buynum >= that.itemData.max_buy_amount) {
            common.toast('不能在多啦~');
            return;
          } // Lin end


          that.setData({
            buynum: that.buynum + 1,
            undel: false });


          if (that.buynum > 1) {
            var invdata = {
              goods_id: product.goods_id,
              sku_key: product_id,
              amount: that.buynum };

            common.ApiGateWayTest(invurl, invdata, true, function (ret) {
              if (!ret) return;

              if (ret.data.result.is_enough != 1) {
                common.toast(ret.data.result.msg);
                that.setData({
                  buynum: that.buynum - 1 });

                that.set_choosed_sku();
                return;
              }
            });
          }
        }

        that.confirmData.num = that.buynum;
      } else {
        if (that.showSKUstatus == 0) {
          that.setModalStatus();
        } else {
          common.toast('请选择商品款式');
        }
      }

      that.set_choosed_sku();
    },
    //
    goRegister: function goRegister() {
      // 未登录跳转
      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        common.goRegister();
        return false;
      }
    },
    // 是否购物车有新人商品
    isnewpersongoods: function isnewpersongoods(goods_id, product_id) {
      var uri = app.getPath.isnewpersongoods;
      var data = {
        goods_id: goods_id,
        sku_key: product_id };

      return new Promise(function (resolve, reject) {
        common.ApiGateWayTest(uri, data, true, function (res) {
          var data = res.data;

          if (data.success == 1) {
            var result = data.result.result;
            resolve(result);
          }
        });
      });
    },
    //添加到购物车
    addShopCart: function addShopCart(e) {
      // 未登录跳转
      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        common.goRegister();
        return false;
      }

      if (!this.checkCanPurchase()) return;
      var that = this;
      var product = this.itemData;
      var type = e.currentTarget.dataset.type;

      if (type == 'addcart' && that.currentAttrs.length == product.properties.length) {
































        // 加入购物车
        var
        _addcart = function _addcart() {
          // if (product.pre_info && product.pre_info.is_pre == 1) {
          //   invurl = app.getPath.addCart;
          // }
          var invdata = {
            goods_id: product.goods_id,
            sku_key: product_id,
            amount: that.buynum };

          app.aldstat.sendEvent("加入购物车", {
            "商品名称": that.itemData.report.goods_name,
            "用户名": that.itemData.report.nick_name });

          common.formIdUpdate(e);

          if (that.stopCartBtn == false) {
            that.stopCartBtn = true;
            common.ApiGateWayTest(invurl, invdata, true, function (ret) {
              if (!ret) return;

              if (ret.data.success != 0) {
                that.setData({
                  cartAmount: ret.data.result.cart_num });

                common.toast(ret.data.msg);
                that.setData({
                  showfwModalStatus: false,
                  showShareModalStatus: false,
                  showBonusModal: false,
                  showModalStatus: false });

                that.showSKUstatus = 0;
                that.stopCartBtn = false;
              } else {
                common.toast(ret.data.msg);
                return;
              }
            });
          }
        }; // 验证库存
        var product_id = '';for (var i in product.stock) {var stock = product.stock[i].key;stock = stock.split('_');stock.sort(function (a, b) {return a - b;});stock = stock.join('_');var attrs = that.currentAttrs.join('_');if (attrs == stock) {product_id = product.stock[i].key;break;}}var invurl = '';that.isnewpersongoods(product.goods_id, product_id).then(function (res) {if (res) {invurl = app.getPath.addCartnew;common.showModal('是否替换新人商品', '确定', function (res) {if (res.confirm) {_addcart();}});} else {invurl = app.getPath.addCart;_addcart();}});} else {
        if (type != 'addcart' || that.showSKUstatus == 0) {
          that.setModalStatus(type);
          that.setData({
            showfwModalStatus: false,
            showShareModalStatus: false,
            showBonusModal: false });

        } else {
          common.toast('请选择商品款式');
        }
      }
    },
    // 立即购买
    nowPurchase: function nowPurchase(e) {
      // 未登录跳转
      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        common.goRegister();
        return false;
      }

      if (!this.checkCanPurchase()) return;
      var that = this;
      var atitude = ''; //设置sku确认按钮为立即购买

      this.setData({
        team_type: 0 });


      if (that.itemData.shop_type == 1) {
        that.setzjModalStatus(e);
        return;
      }

      var product = that.itemData;

      if (that.currentAttrs.length == product.properties.length && product.max_buy_amount < 2 || that.team_sku_type == 1 &&
      that.currentAttrs.length == product.properties.length) {
        // 验证库存
        var product_id = '';

        for (var i in product.stock) {
          var stock = product.stock[i].key;
          stock = stock.split('_');
          stock.sort(function (a, b) {
            return a - b;
          });
          stock = stock.join('_');
          var attrs = that.currentAttrs.join('_');

          if (attrs == stock) {
            product_id = product.stock[i].key;
            break;
          }
        }

        var invurl = app.getPath.skuEnough;

        if (product.pre_info && product.pre_info.is_pre == 1) {
          invurl = app.getPath.skuEnough;
        }

        var invdata = {
          goods_id: product.goods_id,
          sku_key: product_id,
          amount: that.buynum };

        app.aldstat.sendEvent("立即购买", {
          "商品名称": that.itemData.report.goods_name,
          "用户名": that.itemData.report.nick_name });

        common.formIdUpdate(e);
        common.showLoad(this);
        common.ApiGateWayTest(invurl, invdata, true, function (ret) {
          if (!ret) return;

          if (ret.data.result.is_enough != 1) {
            common.hideLoad(that);
            common.toast(ret.data.result.msg);
            return;
          } else {
            next(e);
          }
        });
      } else {
        if (that.showSKUstatus == 0) {
          that.setModalStatus();
          that.setData({
            showfwModalStatus: false,
            showShareModalStatus: false,
            showBonusModal: false });

        } else {
          common.toast('请选择商品款式');
        }
      }

      function next() {
        var checkOrderUri = app.getPath.preCheckOrder;
        var orderProduct = [{
          goods_id: that.confirmData[0].goods_id,
          sku_key: that.confirmData[0].sku_key,
          num: that.confirmData[0].amount }];

        orderProduct = JSON.stringify(orderProduct);
        var checkOrderData = {
          order_product: orderProduct,
          team_order: 0,
          time_atitude: app.dataBase.userAtitude };

        common.ApiGateWayTest(checkOrderUri, checkOrderData, true, function (resData) {
          common.hideLoad(that);

          if (resData.data.success == 1) {
            that.confirmData[0]['team_order'] = 0;
            that.confirmData[0]['channel'] = that.itemData.is_team; // 立即购买的缓存

            common.setStorage({
              key: "nowPay",
              data: that.confirmData });

            wx.navigateTo({
              url: '/pages/confirm/confirm' });

          } else {
            common.toast(resData.data.msg);
            return;
          }
        });
      }
    },
    // 一键开团
    delegation: function delegation(e) {
      // 未登录跳转
      var isOldUser = common.getStorageSync('isOldUser');

      if (!app.checkSessionKey || isOldUser == 2) {
        common.goRegister();
        return false;
      }

      if (!this.checkCanPurchase()) return;
      var that = this;

      if (that.itemData.shop_type == 1) {
        that.setzjModalStatus(e);
        return;
      } //设置sku确认按钮为一键开团


      this.setData({
        team_type: 1 });

      var product = that.itemData;

      if (that.currentAttrs.length == product.properties.length && product.max_buy_amount < 2 || that.team_sku_type == 1 &&
      that.currentAttrs.length == product.properties.length) {
        // 验证库存
        var product_id = '';

        for (var i in product.stock) {
          var stock = product.stock[i].key;
          stock = stock.split('_');
          stock.sort(function (a, b) {
            return a - b;
          });
          stock = stock.join('_');
          var attrs = that.currentAttrs.join('_');

          if (attrs == stock) {
            product_id = product.stock[i].key;
            break;
          }
        }

        var invurl = app.getPath.skuEnough;

        if (product.pre_info && product.pre_info.is_pre == 1) {
          invurl = app.getPath.skuEnough;
        }

        var invdata = {
          goods_id: product.goods_id,
          sku_key: product_id,
          amount: that.buynum };

        app.aldstat.sendEvent("立即购买", {
          "商品名称": that.itemData.report.goods_name,
          "用户名": that.itemData.report.nick_name });

        common.formIdUpdate(e);
        common.showLoad(this);
        common.ApiGateWayTest(invurl, invdata, true, function (ret) {
          if (!ret) return;

          if (ret.data.result.is_enough != 1) {
            common.hideLoad(that);
            common.toast(ret.data.result.msg);
            return;
          } else {
            // showSKUstatus 0关闭  1展开  重置为关闭
            that.setData({
              showModalStatus: false,
              showSKUstatus: 0 });

            next(e);
          }
        });
      } else {
        if (that.showSKUstatus == 0) {
          that.setModalStatus();
          that.setData({
            showfwModalStatus: false,
            showShareModalStatus: false,
            showBonusModal: false,
            skuSvipCurrent: product.stock[0].team_price });

        } else {
          common.toast('请选择商品款式');
        }
      }

      function next() {
        var checkOrderUri = app.getPath.preCheckOrder;
        var orderProduct = [{
          goods_id: that.confirmData[0].goods_id,
          sku_key: that.confirmData[0].sku_key,
          num: that.confirmData[0].amount }];

        orderProduct = JSON.stringify(orderProduct);
        var checkOrderData = {
          order_product: orderProduct,
          team_order: 1,
          team_id: that.itemData.team_id,
          time_atitude: app.dataBase.userAtitude };

        common.ApiGateWayTest(checkOrderUri, checkOrderData, true, function (resData) {
          common.hideLoad(that);

          if (resData.data.success == 1) {
            that.confirmData[0]['team_order'] = 1;
            that.confirmData[0]['team_id'] = that.itemData.team_id; // 立即购买的缓存

            common.setStorage({
              key: "nowPay",
              data: that.confirmData });

            wx.navigateTo({
              url: '/pages/confirm/confirm' });

          } else {
            common.toast(resData.data.msg);
            return;
          }
        });
      }
    },
    // 分享后弹窗WX指示图
    shareTo: function shareTo() {
      this.setData({
        isShowModeWx: 1 });
      // this.onShareAppMessage();
    },
    clossShare: function clossShare() {
      this.setData({
        isShowModeWx: 0 });

    },
    //
    closeShareWx: function closeShareWx() {
      this.setData({
        isShowModeWx: 0 });

    },
    closeShareBox: function closeShareBox() {
      this.setData({
        isShowbox: 0 });

    },
    closeShareShowSku: function closeShareShowSku() {
      this.setData({
        isShowbox: 0 });

      this.setModalStatus();
    },
    //移动超出显示返回顶部按钮
    onPageScroll: function onPageScroll(e) {
      var that = this;

      if (that.navbarOpacity < 1 && e.scrollTop > 100) {
        that.setData({
          navbarOpacity: e.scrollTop / 500 });

      } else if (that.navbarOpacity > 0 && e.scrollTop < 200) {
        that.setData({
          navbarOpacity: e.scrollTop / 500 });

      }

      if (e.scrollTop > 300) {
        that.setData({
          showBackTop: true });

      } else {
        that.setData({
          showBackTop: false });

      }
    },
    gotoPagetop: function gotoPagetop() {
      wx.pageScrollTo({
        scrollTop: 0 });

    },

    /* bar滚动 */
    productGoSP: function productGoSP() {
      this.setData({
        scrollTop: 0 });

    },
    productGoPJ: function productGoPJ() {
      this.setData({
        scrollBar: "comment" //currentLocation: 2,
      });

      var that = this;
      setTimeout(function () {
        that.setData({
          currentLocation: 2 });

      }, 400);
    },
    productGoXQ: function productGoXQ() {
      this.setData({
        scrollBar: "content" //currentLocation: 3,
      });

      var that = this;
      setTimeout(function () {
        that.setData({
          currentLocation: 3 });

      }, 400);
    },
    openSvip: function openSvip() {
      app.dataBase.pageUrl =
      'http://mc.vip.qq.com/qqwallet/index?_wv=3&aid=mios.p.a.em_spxqy&ADTAG=vipmall&type=!svip&month=1';
      common.goWebview();
    },
    // 返回首页
    gotoHome: function gotoHome(e) {
      common.formIdUpdate(e);
      wx.switchTab({
        url: '/pages/index/index' });

    },
    goBonusPage: function goBonusPage() {
      this.setData({
        isShowbox: 0 });

      wx.navigateTo({
        url: '/pages/rituall/rituall' });

    },
    //获取系统信息
    initNavHeight: function initNavHeight() {
      var that = this;
      wx.getSystemInfo({
        success: function success(res) {
          that.setData({
            winWidth: res.windowWidth,
            winHeight: res.windowHeight });

        } });

    },
    bannerClosed: function bannerClosed() {
      this.setData({
        bannerApp: false });

    },
    // 跳转购物车
    goToCart: function goToCart(e) {
      common.formIdUpdate(e);
      wx.switchTab({
        url: '/pages/cart/cart' });

    },
    productGoProduct: function productGoProduct(e) {
      var id = e.currentTarget.dataset.id;
      wx.navigateTo({
        url: '/pages/product/product?productId=' + id });

    },
    productGoTheme: function productGoTheme(e) {
      var brand_id = e.currentTarget.dataset.brand;
      wx.navigateTo({
        url: '/pages/listdetail/listdetail?cat_id=&title=&brand_id=' + brand_id });

    },
    productGoComment: function productGoComment(e) {
      var productId = e.currentTarget.dataset.productid;
      wx.navigateTo({
        url: '/pages/comment/comment?productId=' + productId });

    },
    // 分享图片
    closeSharePic: function closeSharePic() {
      this.setData({
        isShowSharePic: false });

    },
    drawPic: function drawPic() {
      var that = this;
      that.clossShare();
      common.showLoad(this); // let AcodePic = null;

      var productShareimg = "";
      var codePicImage = "";
      var drawImageUrl = ""; // let promise1 = new Promise(function (resolve, reject) {
      //   /* 获得要在画布上绘制的图片 */
      //   wx.getImageInfo({
      //     src: that.data.iconURL + "/product-share-card.png",
      //     success(res) {
      //       drawImageUrl = res.path;
      //       console.log("drawImageUrl", drawImageUrl)
      //       resolve(res);
      //     }
      //   })
      // });

      var promise2 = new Promise(function (resolve, reject) {
        /* 获得要在画布上绘制的图片 */
        // wx.downloadFile({
        //   url: that.data.skuImages, // 仅为示例，并非真实的资源
        //   success(res) {
        //     // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容
        //     if (res.statusCode === 200) {
        //       productShareimg = res.tempFilePath;
        //       resolve(res);
        //     } else {
        //       wx.showToast({
        //         title: '网络繁忙，无法生成分享图',
        //         icon: 'none'
        //       })
        //       reject();
        //     }
        //   },
        //   fail(res) {
        //     wx.showToast({
        //       title: '下载接口没跑通',
        //       icon: 'none'
        //     })
        //     reject();
        //   }
        // })
        wx.getImageInfo({
          src: that.skuImages,

          success: function success(res) {
            productShareimg = res.path;
            resolve(res);
          },

          fail: function fail(res) {
            wx.showToast({
              title: '网络繁忙，无法生成分享图',
              icon: 'none' });

            reject();
          } });


      });
      var pickup = common.getStorageSync('getpickup');
      var promise3 = new Promise(function (resolve, reject) {
        wx.request({
          //正式服
          url: 'https://wx.shop.haoyousheng.com.cn/v1/goods/getWXACodeUnlimit',
          //测试服
          // url: 'https://api-t.st-llshop.surex.cn/v1/goods/getWXACodeUnlimit',
          method: 'post',
          responseType: 'arraybuffer',
          //这一行非常重要，重中之重
          data: {
            secene: that.teamId + '&' + pickup.pickup_id,
            page: "packageA/team-product/team-product",
            application: 'goodBuy' },

          success: function success(res) {
            // var base64 = wx.arrayBufferToBase64(res.data);
            // let AcodePic = "data:image/PNG;base64," + base64;
            // console.log("二维码获取临时地址")
            // wx.getImageInfo({
            //   src: base64,
            //   success(res) {
            //     codePicImage = res.path;
            //     console.log("codePicImage", codePicImage)
            //     resolve(res);
            //   }
            // })
            var timestamp = Date.parse(new Date());
            var filePath = "".concat(wx.env.USER_DATA_PATH, "/").concat('erweima' + timestamp, ".", 'jpg');
            wx.getFileSystemManager().writeFile({
              filePath: filePath,
              data: res.data,
              encoding: 'binary',

              success: function success() {
                codePicImage = filePath;
                resolve(filePath);
              },

              fail: function fail() {
                reject(new Error('ERROR_BASE64SRC_WRITE'));
              } });


          },
          fail: function fail(res) {
            reject();
          } });

      });
      /* 图片获取成功才执行后续代码 */

      Promise.all([promise2, promise3]).then(function (res) {
        /* 创建 canvas 画布 */
        var ctx = wx.createCanvasContext('shareImg'); // 填充背景色

        ctx.rect(0, 0, 283, 480);
        ctx.setFillStyle('#FFFFFF');
        ctx.fill(); // 背景上画圆

        ctx.beginPath();
        ctx.arc(142, -39, 185, 0, 2 * Math.PI);
        ctx.setFillStyle('#ffe150');
        ctx.fill(); // 圆角矩形加阴影

        var rec_x = 35,
        rec_y = 36,
        rec_r = 10,
        rec_w = 220,
        rec_h = 290;
        ctx.beginPath();
        ctx.moveTo(rec_x + rec_r, rec_y);
        ctx.arcTo(rec_x + rec_w, rec_y, rec_x + rec_w, rec_y + rec_h, rec_r);
        ctx.arcTo(rec_x + rec_w, rec_y + rec_h, rec_x, rec_y + rec_h, rec_r);
        ctx.arcTo(rec_x, rec_y + rec_h, rec_x, rec_y, rec_r);
        ctx.arcTo(rec_x, rec_y, rec_x + rec_w, rec_y, rec_r);
        ctx.setFillStyle('#FFFFFF');
        ctx.setShadow(0, 0, 15, '#DDDDDD');
        ctx.fill();
        ctx.setShadow(0, 0, 0, '#ffffff'); // 圆角矩形TAG

        var draw_x = 95,
        draw_y = 275,
        draw_r = 2,
        draw_w = 40,
        draw_h = 16;
        ctx.beginPath();
        ctx.moveTo(draw_x + draw_r, draw_y);
        ctx.arcTo(draw_x + draw_w, draw_y, draw_x + draw_w, draw_y + draw_h, draw_r);
        ctx.arcTo(draw_x + draw_w, draw_y + draw_h, draw_x, draw_y + draw_h, draw_r);
        ctx.arcTo(draw_x, draw_y + draw_h, draw_x, draw_y, draw_r);
        ctx.arcTo(draw_x, draw_y, draw_x + draw_w, draw_y, draw_r);
        ctx.setStrokeStyle('red');
        ctx.closePath();
        ctx.stroke();
        /* 绘制图像到画布  图片的位置你自己计算好就行 参数的含义看文档 */

        /* ps: 网络图片的话 就不用加../../路径了 反正我这里路径得加 */
        // ctx.setGlobalAlpha(0.1)
        // ctx.drawImage(that.data.bannerItem[0].src, -109, -109, 600, 600)
        // ctx.setGlobalAlpha(1)
        // ctx.drawImage(drawImageUrl, 31, 36, 222, 300);

        ctx.drawImage(productShareimg, 66, 71, 150, 150);
        ctx.drawImage(codePicImage, 101, 340, 80, 80);
        /* 绘制文字 位置自己计算 参数自己看文档 */

        ctx.setTextAlign('center'); //  位置

        ctx.setFillStyle('#555555'); //  颜色

        ctx.setFontSize(14); //  字号

        if (that.itemData.goods_name.length > 12) {
          ctx.fillText(that.itemData.goods_name.slice(0, 12), 283 / 2, 245); //  内容  不会自己换行 需手动换行

          ctx.fillText(that.itemData.goods_name.slice(12, 24), 283 / 2, 265); //  内容
        } else {
          ctx.fillText(that.itemData.goods_name, 283 / 2, 245); //  内容  不会自己换行 需手动换行
        } // 圆角矩形内容


        ctx.setTextAlign('center'); //  位置

        ctx.setFillStyle('red'); //  颜色

        ctx.setFontSize(10); //  字号

        ctx.fillText('抢购价', 115, 287); //  内容
        // 价格

        ctx.setTextAlign('center'); //  位置

        ctx.setFillStyle('red'); //  颜色

        ctx.setFontSize(14); //  字号

        ctx.fillText('¥' + that.skuSvipCurrent, 165, 289); //  内容
        // 底部提示

        ctx.setTextAlign('center'); //  位置

        ctx.setFillStyle('#555555'); //  颜色

        ctx.setFontSize(11); //  字号

        ctx.fillText('长按图片识别小程序码', 283 / 2, 445); //  内容

        ctx.setTextAlign('center'); //  位置

        ctx.setFillStyle('#AAAAAA'); //  颜色

        ctx.setFontSize(9); //  字号

        ctx.fillText('*实际价格以页面展示为准', 283 / 2, 460); //  内容
        // 原价

        ctx.setTextAlign('center'); //  位置

        ctx.setFillStyle('#AAAAAA'); //  颜色

        ctx.setFontSize(12); //  字号

        ctx.fillText('原价 ¥' + that.skuCurrent, 283 / 2, 310); //  内容

        ctx.beginPath();
        ctx.moveTo(100, 305);
        ctx.lineTo(183, 305);
        ctx.setStrokeStyle('#AAAAAA');
        ctx.stroke();
        common.hideLoad(that);
        /* 绘制 */

        that.setData({
          isShowSharePic: true });

        ctx.stroke();
        ctx.draw(false, function () {
          that.TransformationPic();
        });
      });
    },
    TransformationPic: function TransformationPic() {
      // 生成分享图
      var that = this;
      wx.canvasToTempFilePath({
        x: 0,
        y: 0,
        canvasId: 'shareImg',
        fileType: "jpg",
        quality: 1,

        success: function success(res) {
          console.log("分享图生成成功");
          /* 这里 就可以显示之前写的 预览区域了 把生成的图片url给image的src */

          that.setData({
            preurl: res.tempFilePath });

        },

        fail: function fail(res) {
          wx.showModal({
            title: '消息提示',
            content: '生成分享图失败,请重试',
            showCancel: false });

        } });


    },
    saveSharePic: function saveSharePic() {
      var that = this;
      common.showLoad(this);
      wx.saveImageToPhotosAlbum({
        filePath: that.preurl,

        success: function success(res) {
          common.hideLoad(that);
          that.setData({
            isShowSharePic: false,
            preurl: null });

          wx.showModal({
            title: '保存成功',
            content: '分享图保存成功',
            showCancel: false });

        },

        fail: function fail(res) {
          common.hideLoad(that);

          if (res.errMsg === "saveImageToPhotosAlbum:fail auth deny") {
            wx.showModal({
              title: '提示',
              content: '未获取相册授权，是否获取',

              success: function success(res) {
                if (res.confirm) {
                  wx.openSetting({
                    success: function success(settingdata) {
                      if (settingdata.authSetting['scope.writePhotosAlbum']) {
                        that.saveSharePic();
                      } else {
                        wx.showToast({
                          title: "拒绝授权将无法保存图片",
                          icon: 'none',
                          duration: 1500 });

                      }
                    } });


                } else if (res.cancel) {
                  wx.showToast({
                    title: "拒绝授权将无法保存图片",
                    icon: 'none',
                    duration: 1500 });

                }
              } });


          }
        } });


    },
    setzjModalStatus: function setzjModalStatus(e) {
      console.log(e);
      var animation = wx.createAnimation({
        duration: 250,
        timingFunction: "linear",
        delay: 0 });

      animation.translateY(368).opacity(1).step();
      this.setData({
        animationData: animation.export() });

      this.setData({
        showzjModalStatus: true });

      setTimeout(function () {
        animation.translateY('-150px').translateX('-50%').step();
        this.setData({
          animationData: animation });


        if (e.currentTarget.dataset.status == 0) {
          this.setData({
            showzjModalStatus: false });

        }
      }.bind(this), 200);
    },
    // 切换租机 方案详情
    rentToggle: function rentToggle(e) {
      var status = e.currentTarget.dataset.status;

      if (status != this.rentToggleStatus) {
        console.log(status);
        this.setData({
          rentToggleStatus: status });

      }
    },
    // 跳转任选活动
    to_activity: function to_activity(e) {
      var id = e.currentTarget.dataset.activity_id;
      wx.navigateTo({
        url: '/packageA/select/select?entryType=external&id=' + id });

    },
    // 取消设置弹窗
    settingModalStatus: function settingModalStatus() {
      this.setData({
        showSettingModalStatus: false });

    },
    // 拼团次数
    teamLabel2: function teamLabel2() {
      var that = this;
      var uri = app.getPath.teamLabel;
      var data = {
        team_id: that.itemData.team_id };

      common.ApiGateWayTest(uri, data, true, function (res) {
        if (res.data.success == 1) {
          that.setData({
            teamLabel: res.data.result.data });

          var nowtime = new Date().getTime() / 1000;

          if (that.teamLabel.start_time > nowtime || that.teamLabel.end_time > nowtime) {
            that.setData({
              showCountDown: true });


            if (that.teamLabel.status === 2) {
              that.countDown(that.teamLabel.start_time);
            } else if (that.teamLabel.status === 1) {
              that.countDown(that.teamLabel.end_time);
            }
          }
        }
      });
    },

    //获取拼团列表
    getTeamList: function getTeamList() {
      var that = this;
      var url = app.getPath.teamList;
      var data = {
        goods_id: this.teamId };

      common.ApiGateWayTest(url, data, true, function (res) {
        var res = res.data;

        if (res.success == 1) {
          if (res.result.data.length > 2) {
            that.setData({
              teamList: res.result.data.concat(res.result.data),
              team_num: res.result.data.length });

            console.log(that.teamList);
          } else {
            that.setData({
              teamList: res.result.data,
              team_num: res.result.data.length });

          }
        }
      });
    },

    //跳转拼团列表
    loadTeamList: function loadTeamList() {
      var that = this;
      wx.navigateTo({
        url: '/packageA/team-list/team-list?entryType=external&goods_id=' + that.productId });

    },

    // 前往设置
    goSetting: function goSetting() {
      var that = this;
      wx.openSetting({
        success: function success(res) {
          if (res.authSetting["scope.userLocation"] == true) {
            that.setData({
              showSettingModalStatus: false });

          }
        } });


    },

    // 切换提醒未提醒
    change_team: function change_team() {
      var that = this;
      common.showLoad(this);
      var url = app.getPath.remindTeam;
      var data = {
        team_id: that.itemData.team_id,
        is_notice: that.check_remind ? '0' : '1' };

      common.ApiGateWayTest(url, data, true, function (res) {
        var res = res.data;

        if (res.success == 1) {
          if (res.result.status == 1) {
            that.setData({
              check_remind: !that.check_remind });

            common.toast(res.result.msg);
          } else if (res.result.status == 0) {
            common.toast(res.result.msg);
          } else if (res.result.status == 2) {
            that.setData({
              showPhoneModal: true });

          }

          common.hideLoad(that);
        }
      });
    },

    //  跳转领券中心
    goCouponList: function goCouponList() {
      wx.navigateTo({
        url: '/pages/couponCenter/couponCenter?entryType=external' });

    },

    // 关闭手机号授权弹窗
    closePhoneModal: function closePhoneModal() {
      this.setData({
        showPhoneModal: false });

    },

    // 显示获取手机号授权弹窗
    toShowPhoneModal: function toShowPhoneModal() {
      this.setData({
        showPhoneModal: true });

    },

    // 获取手机号授权
    getPhone: function getPhone(e) {
      var that = this;

      if (!(e.detail.encryptedData && e.detail.iv)) {
        return false;
      } // 新用户注册
      // 获取手机号


      var mobileUri = app.getPath.getWXMobile; // 重新获取code获取手机号

      wx.login({
        success: function success(res) {
          var Mobiledata = {
            encryptedData: e.detail.encryptedData,
            iv: e.detail.iv,
            code: res.code };

          common.ApiGateWayTest(mobileUri, Mobiledata, true, function (resData) {
            if (resData.data.success == 1) {
              common.toast('绑定成功');
              that.setData({
                showPhoneModal: false });

            } else {
              return;
            }
          });
        } });


    },
    back: function back() {
      wx.navigateBack({
        delta: 1 });

    },
    backHome: function backHome() {
      wx.switchTab({
        url: '/pages/index/index' });

    },
    setData: function setData(obj) {
      var that = this;
      var keys = [];
      var val, data;
      Object.keys(obj).forEach(function (key) {
        keys = key.split('.');
        val = obj[key];
        data = that.$data;
        keys.forEach(function (key2, index) {
          that[key] = obj[key];
        });
      });
    } } };exports.default = _default;

/***/ }),

/***/ 639:
/*!******************************************************************************************************************************!*\
  !*** C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue?vue&type=style&index=0&lang=css& ***!
  \******************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_6_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-1!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader??ref--6-oneOf-1-2!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src??ref--6-oneOf-1-3!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib??vue-loader-options!../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./team-product.vue?vue&type=style&index=0&lang=css& */ 640);
/* harmony import */ var _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_6_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_6_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_6_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_6_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_vue_cli_plugin_uni_packages_webpack_preprocess_loader_index_js_ref_6_oneOf_1_1_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_css_loader_index_js_ref_6_oneOf_1_2_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_loaders_stylePostLoader_js_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_3_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_vue_loader_lib_index_js_vue_loader_options_Program_Files_HBuilderX_plugins_uniapp_cli_node_modules_dcloudio_webpack_uni_mp_loader_lib_style_js_team_product_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ 640:
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--6-oneOf-1-1!./node_modules/css-loader??ref--6-oneOf-1-2!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--6-oneOf-1-3!./node_modules/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/xhz/Desktop/project/mmt 10.12 - 16.00/packageA/team-product/team-product.vue?vue&type=style&index=0&lang=css& ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ })

},[[633,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/packageA/team-product/team-product.js.map